<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">

    

    

    <title>安卓ART虚拟机逆向 | Coderss</title>
    <meta name="author" content="coder">
    <meta name="version" content="1.0.0">
    <meta name="keywords" content="">
    <meta name="description" content="安卓相关逆向解析笔记
加壳与脱壳Art脱壳原理源码分析
InMemoryDexClassLoader源码分析


1、static jobject CreateSingleDexFileCookie(JNIEnv* env, std::unique_ptr&amp;lt;MemMap&amp;gt; data)
2、static const DexFile* CreateDexFile(JNIEnv* env, std::unique_ptr&amp;lt;MemMap&amp;gt; dex_mem_map)
3、DexFi">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="baidu-site-verification" content="F0CXvmUgA9">

    
    
    <link rel="icon" href="/favicon.png">
    

    <link rel="stylesheet" href="/css/style.css">
</head>
<body>

    <div class="app">
        <header class="header clearfix">
    <div id="nav" class="nav">
    <button id="open-panel" class="open-panel"><i class="icon-library"></i></button>

    <nav class="nav-inner">

        
        
        <li class="nav-item">
            <a class="nav-link" href="/">首页</a>
        </li>
        
        
        
        <li class="nav-item">
            <a class="nav-link" href="/categories/back-end">Java栈</a>
        </li>
        
        
        
        <li class="nav-item">
            <a class="nav-link" href="/categories/cpp">C/C++</a>
        </li>
        
        
        
        <li class="nav-item">
            <a class="nav-link" href="/categories/go">Go/Rust</a>
        </li>
        
        
        
        <li class="nav-item">
            <a class="nav-link" href="/categories/cloud">系统内核</a>
        </li>
        
        
        
        <li class="nav-item">
            <a class="nav-link" href="/categories/reverse">逆向知识</a>
        </li>
        
        
        
        <li class="nav-item">
            <a class="nav-link" href="/categories/data">数据库</a>
        </li>
        
        
        
        <li class="nav-item nav-item-tag">
            <a id="nav-tag" class="nav-link" href="#">标签</a>
            <div id="nav-tags" class="nav-tag-wrap">
                <i class="nav-tag-arrow"></i>
                
  <div class="widget-wrap">
    <h3 class="widget-title">
        <i class="icon-tag vm"></i>
        <span class="vm">Tags</span>
    </h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AI/">AI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Boost库/">Boost库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Collection/">Collection</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cpp编程/">Cpp编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Fescar/">Fescar</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gc/">Gc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/K8s/">K8s</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MapReduce/">MapReduce</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Math/">Math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python计算库/">Python计算库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sharding-jdbc/">Sharding-jdbc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SkyWalking/">SkyWalking</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spark/">Spark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TensorFlow/">TensorFlow</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Turi/">Turi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows系统/">Windows系统</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows驱动/">Windows驱动</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Yarn/">Yarn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/assembly/">assembly</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c-cpp语言/">c/cpp语言</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/debug/">debug</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/design/">design</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dubbo/">dubbo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/eth/">eth</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flume/">flume</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/">go</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go-kernel/">go-kernel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/io/">io</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/juc/">juc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kubernetes/">kubernetes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/map/">map</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mfc/">mfc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/microservice/">microservice</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mybatis/">mybatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/netty/">netty</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python-book/">python-book</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/qt/">qt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sentinel/">sentinel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/skycoin/">skycoin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring/">spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring-cloud/">spring-cloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/stl/">stl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tomcat/">tomcat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/x86-Windows系统总结/">x86 Windows系统总结</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/中台/">中台</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式文件系统/">分布式文件系统</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/多线程编程/">多线程编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/架构/">架构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/消息队列/">消息队列</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/网络编程/">网络编程</a></li></ul>
    </div>
  </div>


            </div>
        </li>
        
        
        
        <li class="nav-item">
            <a class="nav-link" href="/archives">归档</a>
        </li>
        
        
        

    </nav>
</div>

    <aside id="aside" class="aside">
    <div id="aside-mask" class="aside-mask"></div>
    <div id="aside-inner" class="aside-inner">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"><i class="icon-search-stroke"></i></button><input type="hidden" name="sitesearch" value="http://www.coderss.cn"></form>

        
        
        
        
        

        
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#加壳与脱壳"><span class="toc-number">1.</span> <span class="toc-text">加壳与脱壳</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Art脱壳原理"><span class="toc-number">1.1.</span> <span class="toc-text">Art脱壳原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#源码分析"><span class="toc-number">1.1.1.</span> <span class="toc-text">源码分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Art函数抽取实现方案"><span class="toc-number">1.2.</span> <span class="toc-text">Art函数抽取实现方案</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NDK开发"><span class="toc-number">2.</span> <span class="toc-text">NDK开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Java语言的特点"><span class="toc-number">2.1.</span> <span class="toc-text">Java语言的特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NDK性能分析"><span class="toc-number">2.2.</span> <span class="toc-text">NDK性能分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NDK"><span class="toc-number">2.3.</span> <span class="toc-text">NDK</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JNI函数特征一览"><span class="toc-number">2.3.1.</span> <span class="toc-text">JNI函数特征一览</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JNI基础数据"><span class="toc-number">2.3.2.</span> <span class="toc-text">JNI基础数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#类描述符"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">类描述符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#域描述符"><span class="toc-number">2.3.2.2.</span> <span class="toc-text">域描述符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#函数描述符"><span class="toc-number">2.3.2.3.</span> <span class="toc-text">函数描述符</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#String-Api"><span class="toc-number">2.3.3.</span> <span class="toc-text">String Api</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JNI-OnLoad和JNI-OnUnload"><span class="toc-number">2.4.</span> <span class="toc-text">JNI_OnLoad和JNI_OnUnload</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JavaVM与JNIEnv"><span class="toc-number">2.5.</span> <span class="toc-text">JavaVM与JNIEnv</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JavaVM的获取"><span class="toc-number">2.5.1.</span> <span class="toc-text">JavaVM的获取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#结构代码情况"><span class="toc-number">2.5.2.</span> <span class="toc-text">结构代码情况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#测试案例"><span class="toc-number">2.5.3.</span> <span class="toc-text">测试案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java反射与NDK开发"><span class="toc-number">2.6.</span> <span class="toc-text">Java反射与NDK开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JNI新建对象和访问Java属性"><span class="toc-number">2.6.1.</span> <span class="toc-text">JNI新建对象和访问Java属性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MainActivity-Java"><span class="toc-number">2.6.1.1.</span> <span class="toc-text">MainActivity.Java</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Test-java"><span class="toc-number">2.6.1.2.</span> <span class="toc-text">Test.java</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#native-lib-cpp"><span class="toc-number">2.6.1.3.</span> <span class="toc-text">native-lib.cpp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#test-c"><span class="toc-number">2.6.1.4.</span> <span class="toc-text">test.c</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JNI访问Java类函数"><span class="toc-number">2.6.2.</span> <span class="toc-text">JNI访问Java类函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MainActivity-java"><span class="toc-number">2.6.2.1.</span> <span class="toc-text">MainActivity.java</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Test-java-1"><span class="toc-number">2.6.2.2.</span> <span class="toc-text">Test.java</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#native-lib-cpp-1"><span class="toc-number">2.6.2.3.</span> <span class="toc-text">native-lib.cpp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#test-c-1"><span class="toc-number">2.6.2.4.</span> <span class="toc-text">test.c</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#全局引用、局部引用、弱全局引用"><span class="toc-number">2.7.</span> <span class="toc-text">全局引用、局部引用、弱全局引用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#三种引用简介和区别"><span class="toc-number">2.7.1.</span> <span class="toc-text">三种引用简介和区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#局部引用表"><span class="toc-number">2.7.2.</span> <span class="toc-text">局部引用表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#局部引用的管理"><span class="toc-number">2.7.3.</span> <span class="toc-text">局部引用的管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MainActivity-java-1"><span class="toc-number">2.7.4.</span> <span class="toc-text">MainActivity.java</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Test-java-2"><span class="toc-number">2.7.5.</span> <span class="toc-text">Test.java</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#native-lib-cpp-2"><span class="toc-number">2.7.6.</span> <span class="toc-text">native-lib.cpp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dalvik动态注册原理"><span class="toc-number">2.8.</span> <span class="toc-text">Dalvik动态注册原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#静态注册和动态注册"><span class="toc-number">2.8.1.</span> <span class="toc-text">静态注册和动态注册</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Art动态注册原理"><span class="toc-number">2.9.</span> <span class="toc-text">Art动态注册原理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Frida"><span class="toc-number">3.</span> <span class="toc-text">Frida</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#objection不写代码Hook、Trace、Stack"><span class="toc-number">3.1.</span> <span class="toc-text">objection不写代码Hook、Trace、Stack</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Frida上手和逆向三段"><span class="toc-number">3.2.</span> <span class="toc-text">Frida上手和逆向三段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Frida构造数组、对象、Map和类参数"><span class="toc-number">3.3.</span> <span class="toc-text">Frida构造数组、对象、Map和类参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#数组-字符串对象数组-gson-Java-array"><span class="toc-number">3.3.1.</span> <span class="toc-text">数组/字符串对象数组/gson/Java.array</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#对象-多态、强制Java-cast"><span class="toc-number">3.3.2.</span> <span class="toc-text">对象/多态、强制Java.cast</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#接口Interface、Java-register"><span class="toc-number">3.3.3.</span> <span class="toc-text">接口Interface、Java.register</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#枚举"><span class="toc-number">3.3.4.</span> <span class="toc-text">枚举</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#泛型、List、Map、Set、迭代打印"><span class="toc-number">3.3.5.</span> <span class="toc-text">泛型、List、Map、Set、迭代打印</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#重要思路-开发时如何打印、Frida中也是如何打印"><span class="toc-number">3.3.6.</span> <span class="toc-text">重要思路:开发时如何打印、Frida中也是如何打印</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#non-ascii-方法名hook"><span class="toc-number">3.3.7.</span> <span class="toc-text">non-ascii 方法名hook</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Frida综合情景案例"><span class="toc-number">3.4.</span> <span class="toc-text">Frida综合情景案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#找hook原则"><span class="toc-number">3.4.1.</span> <span class="toc-text">找hook原则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RPC远程调用概念和实例"><span class="toc-number">3.5.</span> <span class="toc-text">RPC远程调用概念和实例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#逆向三段-第三段RPC"><span class="toc-number">3.5.1.</span> <span class="toc-text">逆向三段:第三段RPC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#远程调动-互联互通-动态修改"><span class="toc-number">3.5.2.</span> <span class="toc-text">远程调动,互联互通,动态修改</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Rpc公开外网"><span class="toc-number">3.6.</span> <span class="toc-text">Rpc公开外网</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#综合实战"><span class="toc-number">3.7.</span> <span class="toc-text">综合实战</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Xposed"><span class="toc-number">4.</span> <span class="toc-text">Xposed</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Xposed与edxposed安装"><span class="toc-number">4.1.</span> <span class="toc-text">Xposed与edxposed安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Xposed-原理"><span class="toc-number">4.1.1.</span> <span class="toc-text">Xposed 原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Xposed的安装"><span class="toc-number">4.1.2.</span> <span class="toc-text">Xposed的安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Xposed优秀插件"><span class="toc-number">4.1.3.</span> <span class="toc-text">Xposed优秀插件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Xposed插件"><span class="toc-number">4.2.</span> <span class="toc-text">Xposed插件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#编写准备"><span class="toc-number">4.2.1.</span> <span class="toc-text">编写准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#插件编写"><span class="toc-number">4.2.2.</span> <span class="toc-text">插件编写</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#插件告知"><span class="toc-number">4.2.3.</span> <span class="toc-text">插件告知</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hook构造函数并修改属性"><span class="toc-number">4.3.</span> <span class="toc-text">Hook构造函数并修改属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#应用代码"><span class="toc-number">4.3.1.</span> <span class="toc-text">应用代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hook代码"><span class="toc-number">4.3.2.</span> <span class="toc-text">Hook代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HookDexClassLoader"><span class="toc-number">4.3.3.</span> <span class="toc-text">HookDexClassLoader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HookFlag"><span class="toc-number">4.3.4.</span> <span class="toc-text">HookFlag</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hook一般函数"><span class="toc-number">4.4.</span> <span class="toc-text">Hook一般函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#应用代码-1"><span class="toc-number">4.4.1.</span> <span class="toc-text">应用代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HookJavaFunction"><span class="toc-number">4.4.2.</span> <span class="toc-text">HookJavaFunction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HookJni"><span class="toc-number">4.4.3.</span> <span class="toc-text">HookJni</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#主动调用"><span class="toc-number">4.5.</span> <span class="toc-text">主动调用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HookActiveInvoke"><span class="toc-number">4.5.1.</span> <span class="toc-text">HookActiveInvoke</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#加壳App处理"><span class="toc-number">4.6.</span> <span class="toc-text">加壳App处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HookJava"><span class="toc-number">4.6.1.</span> <span class="toc-text">HookJava</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HookBelo"><span class="toc-number">4.6.2.</span> <span class="toc-text">HookBelo</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#so中函数处理"><span class="toc-number">4.7.</span> <span class="toc-text">so中函数处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MainActivity"><span class="toc-number">4.7.1.</span> <span class="toc-text">MainActivity</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#native-lib"><span class="toc-number">4.7.2.</span> <span class="toc-text">native-lib</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XposedHookSo"><span class="toc-number">4.7.3.</span> <span class="toc-text">XposedHookSo</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#so中64位函数处理"><span class="toc-number">4.8.</span> <span class="toc-text">so中64位函数处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#native-lib-1"><span class="toc-number">4.8.1.</span> <span class="toc-text">native-lib</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#so中函数主动调用"><span class="toc-number">4.9.</span> <span class="toc-text">so中函数主动调用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#activecalltesthook"><span class="toc-number">4.9.1.</span> <span class="toc-text">activecalltesthook</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Xposed指纹检测及定制反检测"><span class="toc-number">4.10.</span> <span class="toc-text">Xposed指纹检测及定制反检测</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#XposedChecker-MainActivity"><span class="toc-number">4.10.1.</span> <span class="toc-text">XposedChecker#MainActivity</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#抓包全解"><span class="toc-number">5.</span> <span class="toc-text">抓包全解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#抓包环境"><span class="toc-number">5.1.</span> <span class="toc-text">抓包环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hook方案"><span class="toc-number">5.2.</span> <span class="toc-text">Hook方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Hook之sslSocket抓包"><span class="toc-number">5.2.1.</span> <span class="toc-text">Hook之sslSocket抓包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hook之Socket抓包"><span class="toc-number">5.2.2.</span> <span class="toc-text">Hook之Socket抓包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hook之网卡和路由器抓包"><span class="toc-number">5.2.3.</span> <span class="toc-text">Hook之网卡和路由器抓包</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Arm-amp-C-汇编原理"><span class="toc-number">6.</span> <span class="toc-text">Arm&amp;C++汇编原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Arm可执行程序的生成过程"><span class="toc-number">6.1.</span> <span class="toc-text">Arm可执行程序的生成过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#预处理-Preprocessing"><span class="toc-number">6.1.1.</span> <span class="toc-text">预处理(Preprocessing)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编译-Compilation"><span class="toc-number">6.1.2.</span> <span class="toc-text">编译(Compilation)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#汇编-Assemble"><span class="toc-number">6.1.3.</span> <span class="toc-text">汇编(Assemble)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#链接-Linking"><span class="toc-number">6.1.4.</span> <span class="toc-text">链接(Linking)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#寄存器"><span class="toc-number">6.1.5.</span> <span class="toc-text">寄存器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Arm汇编寻址"><span class="toc-number">6.2.</span> <span class="toc-text">Arm汇编寻址</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Load-Store寻址方式"><span class="toc-number">6.2.1.</span> <span class="toc-text">Load Store寻址方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Arm汇编指令"><span class="toc-number">6.3.</span> <span class="toc-text">Arm汇编指令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#跳转指令"><span class="toc-number">6.3.1.</span> <span class="toc-text">跳转指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据处理指令"><span class="toc-number">6.3.2.</span> <span class="toc-text">数据处理指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#内存访问指令"><span class="toc-number">6.3.3.</span> <span class="toc-text">内存访问指令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Arm汇编程序开发"><span class="toc-number">6.4.</span> <span class="toc-text">Arm汇编程序开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#print函数"><span class="toc-number">6.4.1.</span> <span class="toc-text">print函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Arm汇编指令集"><span class="toc-number">6.5.</span> <span class="toc-text">Arm汇编指令集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#如何查看Arm官方文档"><span class="toc-number">6.5.1.</span> <span class="toc-text">如何查看Arm官方文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Arm汇编指令集-1"><span class="toc-number">6.5.2.</span> <span class="toc-text">Arm汇编指令集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Thumb汇编指令集"><span class="toc-number">6.5.3.</span> <span class="toc-text">Thumb汇编指令集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Armv8汇编指令集"><span class="toc-number">6.5.4.</span> <span class="toc-text">Armv8汇编指令集</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#C程序逆向分析"><span class="toc-number">6.6.</span> <span class="toc-text">C程序逆向分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#数据类型-amp-运算符-amp-分支-amp-循环"><span class="toc-number">6.6.1.</span> <span class="toc-text">数据类型&amp;运算符&amp;分支&amp;循环</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#hello-c"><span class="toc-number">6.6.1.1.</span> <span class="toc-text">hello.c</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hello-s"><span class="toc-number">6.6.1.2.</span> <span class="toc-text">hello.s</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#函数、结构体、数组、位操作"><span class="toc-number">6.6.2.</span> <span class="toc-text">函数、结构体、数组、位操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#main-c"><span class="toc-number">6.6.2.1.</span> <span class="toc-text">main.c</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#函数"><span class="toc-number">6.6.2.2.</span> <span class="toc-text">函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#静态变量"><span class="toc-number">6.6.2.3.</span> <span class="toc-text">静态变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#结构体"><span class="toc-number">6.6.2.4.</span> <span class="toc-text">结构体</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#数组"><span class="toc-number">6.6.2.5.</span> <span class="toc-text">数组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#位操作"><span class="toc-number">6.6.2.6.</span> <span class="toc-text">位操作</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#C-程序逆向分析"><span class="toc-number">6.7.</span> <span class="toc-text">C++程序逆向分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#main-class-cpp"><span class="toc-number">6.7.1.</span> <span class="toc-text">main_class.cpp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#main-class-1-s"><span class="toc-number">6.7.2.</span> <span class="toc-text">main_class_1.s</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#main-class-2-s"><span class="toc-number">6.7.3.</span> <span class="toc-text">main_class_2.s</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#main-class-3-s"><span class="toc-number">6.7.4.</span> <span class="toc-text">main_class_3.s</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#C-11-amp-Art虚拟机开发"><span class="toc-number">7.</span> <span class="toc-text">C++11&amp;Art虚拟机开发</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LLVM-amp-OLLVM"><span class="toc-number">8.</span> <span class="toc-text">LLVM&amp;OLLVM</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#llvm简介与调试"><span class="toc-number">8.1.</span> <span class="toc-text">llvm简介与调试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#调试Clang"><span class="toc-number">8.1.1.</span> <span class="toc-text">调试Clang</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#调试opt"><span class="toc-number">8.1.2.</span> <span class="toc-text">调试opt</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自写llvm-pass"><span class="toc-number">8.1.3.</span> <span class="toc-text">自写llvm pass</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#函数名称加密Pass"><span class="toc-number">8.1.3.1.</span> <span class="toc-text">函数名称加密Pass</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#CMakeLists-txt"><span class="toc-number">8.1.3.1.1.</span> <span class="toc-text">CMakeLists.txt</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#EncodeFunctionName-cpp"><span class="toc-number">8.1.3.2.</span> <span class="toc-text">EncodeFunctionName.cpp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#在LLvm源码之外开发Pass"><span class="toc-number">8.1.3.3.</span> <span class="toc-text">在LLvm源码之外开发Pass</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#CMakeLists-txt-out"><span class="toc-number">8.1.3.3.1.</span> <span class="toc-text">CMakeLists.txt-out</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#CMakeLists-txt-inner"><span class="toc-number">8.1.3.3.2.</span> <span class="toc-text">CMakeLists.txt-inner</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OutEncodeFunctionName-cpp"><span class="toc-number">8.1.3.3.3.</span> <span class="toc-text">OutEncodeFunctionName.cpp</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#让Clang使用Pass"><span class="toc-number">8.1.3.4.</span> <span class="toc-text">让Clang使用Pass</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#命令clang路由so文件"><span class="toc-number">8.1.3.4.1.</span> <span class="toc-text">命令clang路由so文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#直接嵌套在clang-llvm体系内"><span class="toc-number">8.1.3.4.2.</span> <span class="toc-text">直接嵌套在clang llvm体系内</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#include"><span class="toc-number">8.1.3.4.2.1.</span> <span class="toc-text">include</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#source"><span class="toc-number">8.1.3.4.2.2.</span> <span class="toc-text">source</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#IPO-PassManagerBuilder"><span class="toc-number">8.1.3.4.2.3.</span> <span class="toc-text">IPO/PassManagerBuilder</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#so动态库转a静态库"><span class="toc-number">8.1.3.4.2.4.</span> <span class="toc-text">so动态库转a静态库</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#调试Pass"><span class="toc-number">8.1.3.5.</span> <span class="toc-text">调试Pass</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ollvm的简介和移植"><span class="toc-number">8.1.4.</span> <span class="toc-text">ollvm的简介和移植</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#OLLVM简介"><span class="toc-number">8.1.4.1.</span> <span class="toc-text">OLLVM简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OLLVM使用、特性"><span class="toc-number">8.1.4.2.</span> <span class="toc-text">OLLVM使用、特性</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Bogus-Control-Flow"><span class="toc-number">8.1.4.2.1.</span> <span class="toc-text">Bogus Control Flow</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Control-Flow-Flattening"><span class="toc-number">8.1.4.2.2.</span> <span class="toc-text">Control Flow Flattening</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Substitution"><span class="toc-number">8.1.4.2.3.</span> <span class="toc-text">Substitution</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ControlFlowFlattening"><span class="toc-number">8.2.</span> <span class="toc-text">ControlFlowFlattening</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#移植ollvm代码到单独的so"><span class="toc-number">8.2.1.</span> <span class="toc-text">移植ollvm代码到单独的so</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#调试ollvm-pass"><span class="toc-number">8.2.2.</span> <span class="toc-text">调试ollvm pass</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#调试Flattening"><span class="toc-number">8.2.3.</span> <span class="toc-text">调试Flattening</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#调试VPM"><span class="toc-number">9.</span> <span class="toc-text">调试VPM</span></a></li></ol>
        
    </div>
</aside>

</header>

        <div id="content" class="content"><article class="article" itemscope="" itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            安卓ART虚拟机逆向
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="/2021/03/12/android-kernel/">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2021-03-12T14:09:41.000Z" itemprop="datePublished">2021-03-12</time>
</a>

            

        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <p>安卓相关逆向解析笔记<br><a id="more"></a></p>
<h1 id="加壳与脱壳"><a href="#加壳与脱壳" class="headerlink" title="加壳与脱壳"></a>加壳与脱壳</h1><h2 id="Art脱壳原理"><a href="#Art脱壳原理" class="headerlink" title="Art脱壳原理"></a>Art脱壳原理</h2><h3 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h3><blockquote>
<p><code>InMemoryDexClassLoader</code>源码分析</p>
</blockquote>
<ul>
<li>1、<code>static jobject CreateSingleDexFileCookie(JNIEnv* env, std::unique_ptr&lt;MemMap&gt; data)</code></li>
<li>2、<code>static const DexFile* CreateDexFile(JNIEnv* env, std::unique_ptr&lt;MemMap&gt; dex_mem_map)</code></li>
<li>3、<code>DexFile::Open(location,</code></li>
<li>4、<code>OpenCommon(map-&gt;Begin()</code></li>
<li>5、<code>DexFile::DexFile(const uint8_t* base,</code></li>
</ul>
<blockquote>
<p><code>DexClassLoader</code>加载dex源码流程分析</p>
</blockquote>
<ul>
<li>1、<code>OpenAndReadMagic(filename, &amp;magic, error_msg);</code></li>
<li>2、<code>DexFile::OpenCommon(const uint8_t* base,</code></li>
<li>3、<code>DexFile::DexFile(const uint8_t* base,</code></li>
</ul>
<p>Art下实现函数抽取dex的难点在于dex2oat</p>
<p>如果dex2oat对抽取的dex进行编译生成了oat文件,那么动态修改的dex中的smali指令流也不会生效</p>
<p>解决方案 </p>
<ul>
<li>dex指令抽取早于dex2oat</li>
<li>干掉dex2oat的过程 </li>
</ul>
<p>加壳厂商大多数干掉dex2oat<br>如果在ART下禁用掉dex2oat? </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 调用dex2oat进行编译</span><br><span class="line">GenerateOatFileNoChecks-&gt;</span><br><span class="line">Dex2Oat-&gt;</span><br><span class="line">Exec-&gt;</span><br><span class="line">ExecAndReturnCode-&gt;</span><br><span class="line">execv-&gt; 或 execve-&gt;</span><br></pre></td></tr></table></figure>
<p>如果在这个流程中任意一个阶段打断, dex2oat就不会成功<br>接下来就hookexecve的流程来干掉dex2oat</p>
<p>其中github上有一个项目TurboDex来达到了Hook dex2oat达到了第一次加载的时候快速加载完App<br>如果不干掉dex2oat第一次就会启动编译, 会非常耗时的, 所以干掉dex2oat就会提高加载dex的效率了</p>
<p><br></p>
<h2 id="Art函数抽取实现方案"><a href="#Art函数抽取实现方案" class="headerlink" title="Art函数抽取实现方案"></a>Art函数抽取实现方案</h2><p>首先利用外部工具对dex的code_item代码指令给nop掉, 然后在从loadmethod中恢复这些指令 </p>
<p>第一、抽取指令流程</p>
<ul>
<li>1、解析原始dex文件格式，保存所有方法的代码结构体信息。</li>
<li>2、通过传入需要置空指令的方法和类名，检索到其代码结构体信息。</li>
<li>3、通过方法的代码结构体信息获取指令个数和偏移地址，构造空指令集，然后覆盖原始指令。</li>
<li>4、重新计算dex文件的checksum和signature信息，回写到头部信息中。</li>
</ul>
<p>第二、指令还原流程</p>
<ul>
<li>1、native层hook系统函数dexFindClass，获取类结构体信息。</li>
<li>2、获取类中所有的方法信息，通过指定方法名进行过滤，获取该方法的代码结构体信息。</li>
<li>3、获取该方法被抽取的指令集，修改方法对应的内存地址为可读属性，直接进行指令还原。<br>在这个过程中，抽取指令需要借助编写的工具，当然工具可以进行深入优化。可以留给你们进行完善。对于还原指令中，如何保存抽取指令并<br>没有介绍，这部分内容可以后续完善优化，比如我们可以将抽取的指令再做一次加密保存到程序中的某个地方，在指令还原的时候去这个文件<br>进行读取解密即可。</li>
</ul>
<p><img src="/2021/03/12/android-kernel/image-02.png" width="700px"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;android/log.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;asm/fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;dlfcn.h&gt;</span></span></span><br><span class="line"><span class="comment">//import c header</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"hook/dlfcn/dlfcn_compat.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"hook/include/inlineHook.h"</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> byte;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TAG <span class="meta-string">"SecondShell"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LOGD(...) __android_log_print(ANDROID_LOG_DEBUG, TAG, __VA_ARGS__)</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">DexFile</span> &#123;</span></span><br><span class="line">    <span class="comment">// Field order required by test "ValidateFieldOrderOfJavaCppUnionClasses".</span></span><br><span class="line">    <span class="comment">// The class we are a part of.</span></span><br><span class="line">    <span class="keyword">uint32_t</span> declaring_class_;</span><br><span class="line">    <span class="comment">// Access flags; low 16 bits are defined by spec.</span></span><br><span class="line">    <span class="keyword">void</span> *begin;</span><br><span class="line">    <span class="comment">/* Dex file fields. The defining dex file is available via declaring_class_-&gt;dex_cache_ */</span></span><br><span class="line">    <span class="comment">// Offset to the CodeItem.</span></span><br><span class="line">    <span class="keyword">uint32_t</span> size;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ArtMethod</span> &#123;</span></span><br><span class="line">    <span class="comment">// Field order required by test "ValidateFieldOrderOfJavaCppUnionClasses".</span></span><br><span class="line">    <span class="comment">// The class we are a part of.</span></span><br><span class="line">    <span class="keyword">uint32_t</span> declaring_class_;</span><br><span class="line">    <span class="comment">// Access flags; low 16 bits are defined by spec.</span></span><br><span class="line">    <span class="keyword">uint32_t</span> access_flags_;</span><br><span class="line">    <span class="comment">/* Dex file fields. The defining dex file is available via declaring_class_-&gt;dex_cache_ */</span></span><br><span class="line">    <span class="comment">// Offset to the CodeItem.</span></span><br><span class="line">    <span class="keyword">uint32_t</span> dex_code_item_offset_;</span><br><span class="line">    <span class="comment">// Index into method_ids of the dex file associated with this method.</span></span><br><span class="line">    <span class="keyword">uint32_t</span> dex_method_index_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span>* *(*oriexecve)(<span class="keyword">const</span> <span class="keyword">char</span> *__file, <span class="keyword">char</span> *<span class="keyword">const</span> *__argv, <span class="keyword">char</span> *<span class="keyword">const</span> *__envp);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span>* *<span class="title">myexecve</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *__file, <span class="keyword">char</span> *<span class="keyword">const</span> *__argv, <span class="keyword">char</span> *<span class="keyword">const</span> *__envp)</span> </span>&#123;</span><br><span class="line">    LOGD(<span class="string">"process:%d,enter execve:%s"</span>, getpid(), __file);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strstr</span>(__file, <span class="string">"dex2oat"</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> oriexecve(__file, __argv, __envp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//void ClassLinker::LoadMethod(Thread* self, const DexFile&amp; dex_file, const ClassDataItemIterator&amp; it,Handle&lt;mirror::Class&gt; klass, ArtMethod* dst)</span></span><br><span class="line"><span class="keyword">void</span> *(*oriloadmethod)(<span class="keyword">void</span> *, <span class="keyword">void</span> *, <span class="keyword">void</span> *, <span class="keyword">void</span> *, <span class="keyword">void</span> *);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">myloadmethod</span><span class="params">(<span class="keyword">void</span> *a, <span class="keyword">void</span> *b, <span class="keyword">void</span> *c, <span class="keyword">void</span> *d, <span class="keyword">void</span> *e)</span> </span>&#123;</span><br><span class="line">    LOGD(<span class="string">"process:%d,before run loadmethod:"</span>, getpid());</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ArtMethod</span> *<span class="title">artmethod</span> = (<span class="title">struct</span> <span class="title">ArtMethod</span> *) <span class="title">e</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">DexFile</span> *<span class="title">dexfile</span> = (<span class="title">struct</span> <span class="title">DexFile</span> *) <span class="title">b</span>;</span></span><br><span class="line">    LOGD(<span class="string">"process:%d,enter loadmethod:dexfilebegin:%p,size:%d"</span>, getpid(), dexfile-&gt;begin,</span><br><span class="line">         dexfile-&gt;size);<span class="comment">//0,57344</span></span><br><span class="line">    <span class="keyword">char</span> dexfilepath[<span class="number">100</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="built_in">sprintf</span>(dexfilepath, <span class="string">"/sdcard/%d_%d.dex"</span>, dexfile-&gt;size, getpid());</span><br><span class="line">    <span class="keyword">int</span> fd = open(dexfilepath, O_CREAT | O_RDWR, <span class="number">0666</span>);</span><br><span class="line">    <span class="keyword">if</span> (fd &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        write(fd, dexfile-&gt;begin, dexfile-&gt;size);</span><br><span class="line">        close(fd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> *result = oriloadmethod(a, b, c, d, e);</span><br><span class="line">    LOGD(<span class="string">"process:%d,enter loadmethod:code_offset:%d,idx:%d"</span>, getpid(),</span><br><span class="line">         artmethod-&gt;dex_code_item_offset_, artmethod-&gt;dex_method_index_);</span><br><span class="line"></span><br><span class="line">    byte *code_item_addr = <span class="keyword">static_cast</span>&lt;byte *&gt;(dexfile-&gt;begin) + artmethod-&gt;dex_code_item_offset_;</span><br><span class="line">    LOGD(<span class="string">"process:%d,enter loadmethod:dexfilebegin:%p,size:%d,beforedumpcodeitem:%p"</span>, getpid(),</span><br><span class="line">         dexfile-&gt;begin, dexfile-&gt;size, code_item_addr);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (artmethod-&gt;dex_method_index_ == <span class="number">15203</span>) &#123;<span class="comment">//TestClass.testFunc-&gt;methodidx</span></span><br><span class="line">        LOGD(<span class="string">"process:%d,enter loadmethod:dexfilebegin:%p,size:%d,start repire method"</span>, getpid(),</span><br><span class="line">             dexfile-&gt;begin, dexfile-&gt;size);</span><br><span class="line">        byte *code_item_addr = (byte *) dexfile-&gt;begin + artmethod-&gt;dex_code_item_offset_;</span><br><span class="line">        LOGD(<span class="string">"process:%d,enter loadmethod:dexfilebegin:%p,size:%d,beforedumpcodeitem:%p"</span>, getpid(),</span><br><span class="line">             dexfile-&gt;begin, dexfile-&gt;size, code_item_addr);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> result = mprotect(dexfile-&gt;begin, dexfile-&gt;size, PROT_WRITE);</span><br><span class="line">        byte *code_item_start = <span class="keyword">static_cast</span>&lt;byte *&gt;(code_item_addr) + <span class="number">16</span>;</span><br><span class="line">        LOGD(<span class="string">"process:%d,enter loadmethod:dexfilebegin:%p,size:%d,code_item_start:%p"</span>, getpid(),</span><br><span class="line">             dexfile-&gt;begin, dexfile-&gt;size, code_item_start);</span><br><span class="line">        byte inst[<span class="number">16</span>] = &#123;<span class="number">0x1a</span>, <span class="number">0x00</span>, <span class="number">0xed</span>, <span class="number">0x34</span>, <span class="number">0x1a</span>, <span class="number">0x01</span>, <span class="number">0x43</span>, <span class="number">0x32</span>, <span class="number">0x71</span>, <span class="number">0x20</span>, <span class="number">0x91</span>, <span class="number">0x05</span>,</span><br><span class="line">                         <span class="number">0x10</span>, <span class="number">0x00</span>, <span class="number">0x0e</span>, <span class="number">0x00</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(inst); i++) &#123;</span><br><span class="line">            code_item_start[i] = inst[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//2343-&gt;i am from com.kanxue.test02.TestClass.testFunc</span></span><br><span class="line">        code_item_start[<span class="number">2</span>] = <span class="number">0x43</span>;<span class="comment">//34ed-&gt;kanxue</span></span><br><span class="line">        code_item_start[<span class="number">3</span>] = <span class="number">0x23</span>;</span><br><span class="line">        <span class="built_in">memset</span>(dexfilepath, <span class="number">0</span>, <span class="number">100</span>);</span><br><span class="line">        <span class="built_in">sprintf</span>(dexfilepath, <span class="string">"/sdcard/%d_%d.dex_15203_2"</span>, dexfile-&gt;size, getpid());</span><br><span class="line">        fd = open(dexfilepath, O_CREAT | O_RDWR, <span class="number">0666</span>);</span><br><span class="line">        <span class="keyword">if</span> (fd &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            write(fd, dexfile-&gt;begin, dexfile-&gt;size);</span><br><span class="line">            close(fd);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    LOGD(<span class="string">"process:%d,after loadmethod:code_offset:%d,idx:%d"</span>, getpid(),</span><br><span class="line">         artmethod-&gt;dex_code_item_offset_, artmethod-&gt;dex_method_index_);<span class="comment">//0,57344</span></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">hooklibc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    LOGD(<span class="string">"go into hooklibc"</span>);</span><br><span class="line">    <span class="comment">//7.0 命名空间限制</span></span><br><span class="line">    <span class="keyword">void</span> *libc_addr = dlopen_compat(<span class="string">"libc.so"</span>, RTLD_NOW);</span><br><span class="line">    <span class="keyword">void</span> *execve_addr = dlsym_compat(libc_addr, <span class="string">"execve"</span>);</span><br><span class="line">    <span class="keyword">if</span> (execve_addr != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ELE7EN_OK == registerInlineHook((<span class="keyword">uint32_t</span>) execve_addr, (<span class="keyword">uint32_t</span>) myexecve,</span><br><span class="line">                                            (<span class="keyword">uint32_t</span> **) &amp;oriexecve)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (ELE7EN_OK == inlineHook((<span class="keyword">uint32_t</span>) execve_addr)) &#123;</span><br><span class="line">                LOGD(<span class="string">"inlineHook execve success"</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                LOGD(<span class="string">"inlineHook execve failure"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">hookART</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    LOGD(<span class="string">"go into hookART"</span>);</span><br><span class="line">    <span class="keyword">void</span> *libart_addr = dlopen_compat(<span class="string">"/system/lib/libart.so"</span>, RTLD_NOW);</span><br><span class="line">    <span class="keyword">if</span> (libart_addr != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">void</span> *loadmethod_addr = dlsym_compat(libart_addr,</span><br><span class="line">                                             <span class="string">"_ZN3art11ClassLinker10LoadMethodERKNS_7DexFileERKNS_21ClassDataItemIteratorENS_6HandleINS_6mirror5ClassEEEPNS_9ArtMethodE"</span>);</span><br><span class="line">        <span class="keyword">if</span> (loadmethod_addr != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (ELE7EN_OK == registerInlineHook((<span class="keyword">uint32_t</span>) loadmethod_addr, (<span class="keyword">uint32_t</span>) myloadmethod,</span><br><span class="line">                                                (<span class="keyword">uint32_t</span> **) &amp;oriloadmethod)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (ELE7EN_OK == inlineHook((<span class="keyword">uint32_t</span>) loadmethod_addr)) &#123;</span><br><span class="line">                    LOGD(<span class="string">"inlineHook loadmethod success"</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    LOGD(<span class="string">"inlineHook loadmethod failure"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> JNIEXPORT jstring JNICALL</span><br><span class="line">Java_com_kanxue_secondshell_180_MainActivity_stringFromJNI(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject <span class="comment">/* this */</span>) &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> hello = <span class="string">"ART SecondShell"</span>;</span><br><span class="line">    <span class="keyword">return</span> env-&gt;NewStringUTF(hello.c_str());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kanxue_secondshell_180_MainActivity_SecondShell(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject <span class="comment">/* this */</span>) &#123;</span><br><span class="line">    hooklibc();</span><br><span class="line">    hookART();</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h1 id="NDK开发"><a href="#NDK开发" class="headerlink" title="NDK开发"></a>NDK开发</h1><p>JNI：Java Native Interface的缩写，通常翻译为JAVA本地接口。从Java1.1开始，Java Native Interface(JNI)标准成为java平台的一部分，它允许Java代码和其他语言写的代<br>码进行交互。JNI一开始是为本地已编译语言，尤其是 C和C++而设计的，但是它并不妨碍你使用其他语言，只要调用约定受支持就可以了。</p>
<p>JNI不是Android特有，windows、linux等凡是有JVM的地方都支持JNI。Android的Dalvik/ART虚拟机同样支持JNI标准。<br>通过JNI，便可以打通Android里的两个世界：JAVA世界和Native世界。<br>可以说，JNI是Java和Native世界的桥梁。而背后的一切都由Dalvik/ART虚拟机来驱动。</p>
<h2 id="Java语言的特点"><a href="#Java语言的特点" class="headerlink" title="Java语言的特点"></a>Java语言的特点</h2><p>特性：简单、面向对象、分布式、编译和解释性、健壮性、跨平台性（Write Once，Run Anywhere）、多线程、动态性等等<br>但是：性能较低、易于逆向分析等问题<br>因此，如何能够提高java程序的性能以及如何能够实现对海量已有C/C++代码库的复用问题？</p>
<p><br></p>
<h2 id="NDK性能分析"><a href="#NDK性能分析" class="headerlink" title="NDK性能分析"></a>NDK性能分析</h2><p>java函数运行模式：</p>
<ul>
<li>1、纯解释模式下执行；</li>
<li>2、JIT模式</li>
<li>3、经过dex2oat编译后在quick模式下运行<br>注意： Android 7.0（代号 Nougat，简称 N）开始结合使用 AOT、即时 (JIT) 编译和配置文件引导型编译。</li>
</ul>
<p>因此一个java函数可能运行在解释模式、JIT或者quick模式。</p>
<p>分别比较相同代码逻辑的java函数和JNI函数的时间代价<br>java函数运行模式：</p>
<ul>
<li>1、在4.4以前的dalvik下运行或者在ART下利用hook禁用掉dex2oat过程强制让其运行在解释模式；</li>
<li>2、使用Android6.0测试java函数在quick模式（运行dex2oat编译以后的汇编代码）</li>
</ul>
<p>JNI函数实现：</p>
<ul>
<li>1、和java函数相同的逻辑，纯C/C++实现；</li>
<li>2、和java函数相同的逻辑，经过JNI提供的接口频繁调用java函数；</li>
</ul>
<p>直观感受使用JNI开发的性能提升和代码安全性比较<br>分别用java和jni实现一个简单的耗时函数，进行执行效率的比较</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">这里特别注明一下 </span><br><span class="line"></span><br><span class="line">从Android7.0开始, 结合使用AOT、即时编译(JIT)编译和配置文件引导型编译, 所有这些编译模式的组合均可配置 </span><br><span class="line"></span><br><span class="line">1: 最初安装应用不进行任何AOT编译, 应用前几次运行时, 系统会对其进行解译, 并对经常执行的方法进行JIT编译</span><br><span class="line">2: 当设备闲置和充电时, 编译守护进程会运行, 以便根据在应用前几次运行期间生成的配置文件对常用代码进行AOT编译</span><br><span class="line">3: 下一次重启应用时将会使用配置文件引导型代码, 并避免在运行时对已经编译过的方法进行JIT编译,</span><br><span class="line">	在应用后续运行期间进行了JIT编译的方法将会被添加到配置文件中, 然后编译守护进程将会对这些方法进行AOT编译</span><br></pre></td></tr></table></figure>
<p>Art包含一个编译器(dex2oat)工具和一个启动Zygote而加载运行时(libart.so), dex2oat工具接受一个apk文件, 并生成一个或多个编译工程文件, 然后运行时加载这些文件<br>文件的个数、扩展名和名称会因版本而异</p>
<ul>
<li>.vdex: 包含Apk未压缩的dex代码,另外还有加速验证速度的元数据</li>
<li>.odex: 包含Apk中已经过AOT编译的方法代码</li>
<li>.art(optional): 包含Apk中列出的某些字符串和类的ART内部表示, 用于加快应用启动速度</li>
</ul>
<p><br><br><br></p>
<h2 id="NDK"><a href="#NDK" class="headerlink" title="NDK"></a>NDK</h2><p>NDK 即Native Development Kit，因此称为“NDK”。</p>
<ul>
<li>NDK是一系列工具的集合。<br>  NDK提供了工具链，帮助开发者快速开发以及调试C（或C++）的动态库。</li>
<li>NDK提供了一份稳定、功能有限的API库。<br>  不同于linux的glibc，Android采用的是Google Bionic Libc，大部分api是一致的。</li>
<li>一些重要逻辑、算法可以采用C/C++、甚至是汇编的形式通过NDK的工具链最终编译生成动态库，最后通过JNI完成和Dalvik/ART虚拟机环境中的Java代码的交互。</li>
</ul>
<p>使用NDK开发的so不再具有跨平台特性，需要编译提供不同平台支持ABI：ApplicationBinary Interface</p>
<p><img src="/2021/03/12/android-kernel/image-01.png" width="500px"><br>首先利用外部工具对dex的code_item代码指令给nop掉, 然后在从loadmethod中恢复这些指令 </p>
<p><br></p>
<h3 id="JNI函数特征一览"><a href="#JNI函数特征一览" class="headerlink" title="JNI函数特征一览"></a>JNI函数特征一览</h3><p>extern “C”:由于C++支持重载，C++类中的函数会有name mangling，后面会详细介绍为什么这里必须要有extern “C”</p>
<p>jni函数的参数问题：JNIEnv<em>和jobject以及JNIEnv</em>和jclass<br>JNICALL：空宏<br><code>JNIEXPORT：__attribute__ ((visibility (&quot;default&quot;)))</code>，代表当前函数符号需要导出,与之对应为hidden隐藏符号信息</p>
<p>AndroidStudio默认生成的函数名很长：如Java_com_example_jni_1enc_Jni_stringFromJNI，以下划线分割</p>
<p>NDK开发就是C/C++甚至是汇编结合JNI提供的一系列丰富的api来开发!</p>
<h3 id="JNI基础数据"><a href="#JNI基础数据" class="headerlink" title="JNI基础数据"></a>JNI基础数据</h3><p><img src="/2021/03/12/android-kernel/image-03.png" width="600px"></p>
<p>4种基本引用类型、8种基本类型</p>
<p>其中基本引用类型为:jobject, jclass, jstring, jthrowable<br>数组引用类型为:jintArray, jbyteArray, jshortArray, jlongArray, jfloatArray, jdoubleArray, jcharArray, jbooleanArray, jobjectArray</p>
<p>JNI中的其他类型: 成员域ID和方法ID</p>
<p>成员域ID、方法方法ID</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">struct_jfieldId;</span><br><span class="line"><span class="keyword">typedef</span> struct_jfieldID* jfieldID;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">jmethodID</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">jmethodID</span>* <span class="title">jmethodID</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">union</span> jvalue&#123;</span><br><span class="line">	jboolean z;</span><br><span class="line">	jbyte b;</span><br><span class="line">	jchar c;</span><br><span class="line">	jshort s;</span><br><span class="line">	jint i;</span><br><span class="line">	jlong j;</span><br><span class="line">	jfloat f;</span><br><span class="line">	jdouble d;</span><br><span class="line">	jobject l;</span><br><span class="line">&#125; jvalue;</span><br></pre></td></tr></table></figure>
<h4 id="类描述符"><a href="#类描述符" class="headerlink" title="类描述符"></a>类描述符</h4><p>在Java代码中的java.lang.String类的类描述符就是java/lang/String<br>其实在实践中, 我发现可以直接用该类型的域描述符取代, 也是成功的 </p>
<p>例如: <code>jclass intArrCls = env-&gt;FindClass(&quot;java/lang/String&quot;);</code><br>等同于: <code>jclass intArrCls = env-&gt;FindClass(&quot;Ljava/lang/String&quot;);</code></p>
<p>数组类型的描述符则为 [+其类型的域描述符]<br>例如:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int[] -&gt; [I</span><br><span class="line">float[] -&gt; [F</span><br><span class="line">String[] -&gt; [Ljava/lang/String</span><br></pre></td></tr></table></figure></p>
<h4 id="域描述符"><a href="#域描述符" class="headerlink" title="域描述符"></a>域描述符</h4><table>
<thead>
<tr>
<th>Field Descriptor</th>
<th>Java Language Type </th>
</tr>
</thead>
<tbody>
<tr>
<td>Z</td>
<td>boolean</td>
</tr>
<tr>
<td>B</td>
<td>byte</td>
</tr>
<tr>
<td>C</td>
<td>char</td>
</tr>
<tr>
<td>S</td>
<td>short</td>
</tr>
<tr>
<td>I</td>
<td>int</td>
</tr>
<tr>
<td>J</td>
<td>long</td>
</tr>
<tr>
<td>F</td>
<td>float</td>
</tr>
<tr>
<td>D</td>
<td>double</td>
</tr>
</tbody>
</table>
<h4 id="函数描述符"><a href="#函数描述符" class="headerlink" title="函数描述符"></a>函数描述符</h4><table>
<thead>
<tr>
<th>Java方法</th>
<th>JNI函数签名</th>
</tr>
</thead>
<tbody>
<tr>
<td>String test();</td>
<td>()Ljava/lang/String;</td>
</tr>
<tr>
<td>int f(int i, Object object);</td>
<td>(I,Ljava/lang/object)V;</td>
</tr>
<tr>
<td>void set(byte[] bytes)</td>
<td>([B)v</td>
</tr>
</tbody>
</table>
<p><br></p>
<h3 id="String-Api"><a href="#String-Api" class="headerlink" title="String Api"></a>String Api</h3><p>处理返回类型是String,或者参数是String, c和c++与Java交互的过程 </p>
<blockquote>
<p>jni中的字符串操作</p>
</blockquote>
<p><code>jstring NewStringUTF(const char* bytes)</code><br>函数使用给定的C字符串创建一个新的JNI字符串（jstring)，不能为构造的java.lang.String分配足够的内存，NewStringUTF会抛出一个OutOfMemoryError异常，并返回一个NULL</p>
<p><code>const char* GetStringUTFChars(jstring string, jboolean* isCopy)</code><br>函数可用于从给定的Java的jstring创建新的C字符串<code>（char *）</code>。<br>如果无法分配内存，则该函数返回NULL。 检查NULL是一个好习惯。不要忘记检查。因为该函数需要为新诞生的UTF-8字符串分配内存，这个操作有可能因为内存太少而失败。<br>失败时<code>GetStringUTFChars</code>会返回NULL，并抛出一个OutOfMemoryError异常，在不使用<code>GetStringUTFChars()</code>返回的字符串时，需要来释放内存和引用以便可以对其进行垃圾回收<br>因此之后应始终调用<code>ReleaseStringUTFChars()</code>。</p>
<p><code>jsize GetStringUTFLength(jstring string)</code>用于获取jstring的长度</p>
<p><br></p>
<h2 id="JNI-OnLoad和JNI-OnUnload"><a href="#JNI-OnLoad和JNI-OnUnload" class="headerlink" title="JNI_OnLoad和JNI_OnUnload"></a>JNI_OnLoad和JNI_OnUnload</h2><p>执行时机:当So被加载的时候,比如Java代码里面出现<code>System.loadLibrary或System.load(绝对路径)</code>就会执行到JNI_OnLoad,它会取so导出符号表,然后调用完成</p>
<p>返回值返回的是JNI的类型<br>第一个参数就是Javavm指针</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">JNIEXPORT jint <span class="title">JNI_OnLoad</span><span class="params">(JavaVM *vm, <span class="keyword">void</span> *reserved)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"JNI_OnLoad(JavaVM *vm, void *reserved)-&gt;%p"</span>, vm);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>, <span class="string">"JNI_OnLoad is called"</span>);</span><br><span class="line">    JNIEnv *env = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">if</span> (vm-&gt;GetEnv((<span class="keyword">void</span> **) &amp;env, JNI_VERSION_1_6) == JNI_OK) &#123;</span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>,</span><br><span class="line">                            <span class="string">"vm-&gt;GetEnv((void**)&amp;env,JNI_VERSION_1_6) success"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    result = JNI_VERSION_1_6;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h2 id="JavaVM与JNIEnv"><a href="#JavaVM与JNIEnv" class="headerlink" title="JavaVM与JNIEnv"></a>JavaVM与JNIEnv</h2><p>JavaVM是虚拟机在JNI层的代表, 一个进程只有一个JavaVM, 所有线程共用一个JavaVM</p>
<ul>
<li>JNIInvokeInterface_结构封装和JVM相关功能函数,如销毁JVM,获得当前线程的Java执行环境</li>
<li>在C和C++中JavaVM的定义有所不同, 在C中JavaVM是JNIInovkeInterface类型指针, 而在C++中又对JNIInovkeInterface进行了一次封装</li>
<li>推荐使用C++来编写JNI代码,比C中少了一个参数</li>
</ul>
<p>JNIEnv表示Java调用native语言的环境, 是一个封装了大量JNI方法的指针<br>JNIEnv只是在创建它的线程生效, 不能跨线程传递, 不同线程的JNIEnv彼此独立<br>native环境中创建的线程, 如果需要访问JNI, 必须要调用AttachCurrentThread关联, 并使用DetachCurrentThread解除链接 </p>
<p>两种代码风格(C\C++)<br>JavaVM和JNIEnv在C语言环境中和C++环境中调用是有区别的,主要表现在:</p>
<ul>
<li>C风格: <code>(*env)-&gt;NewStringUTF(env, &quot;HelloWorld&quot;);</code></li>
<li>C++风格: <code>(*env)-&gt;NewStringUTF(&quot;HelloWorld&quot;);</code></li>
</ul>
<h3 id="JavaVM的获取"><a href="#JavaVM的获取" class="headerlink" title="JavaVM的获取"></a>JavaVM的获取</h3><ul>
<li>1:在JNI_onLoad中作为参数获得,如下<br>  <code>JNIEXPORT jint JNICALL JNI_OnLoad(JavaVM* vm, void* reserved)</code>该函数由Art负责自动化查找和传入参数进行调用</li>
<li>2:通过JNIEnv的GetJavaVM函数获取,如下<br>  <code>JavaVm * thisJvm = nullptr;</code><br>  <code>env-&gt;GetJavaVM(&amp;thisJvm);</code></li>
</ul>
<h3 id="结构代码情况"><a href="#结构代码情况" class="headerlink" title="结构代码情况"></a>结构代码情况</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(__cplusplus)</span></span><br><span class="line"><span class="keyword">typedef</span> _JNIEnv JNIEnv;</span><br><span class="line"><span class="keyword">typedef</span> _JavaVM JavaVM;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">JNINativeInterface</span>* <span class="title">JNIEnv</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">JNIInvokeInterface</span>* <span class="title">JavaVM</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">JNIEnv</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">JavaVM</span>;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">JavaVM</span> &#123;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">JNIInvokeInterface</span>* <span class="title">functions</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(__cplusplus)</span></span><br><span class="line">    <span class="function">jint <span class="title">DestroyJavaVM</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;DestroyJavaVM(<span class="keyword">this</span>); &#125;</span><br><span class="line">    <span class="function">jint <span class="title">AttachCurrentThread</span><span class="params">(JNIEnv** p_env, <span class="keyword">void</span>* thr_args)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;AttachCurrentThread(<span class="keyword">this</span>, p_env, thr_args); &#125;</span><br><span class="line">    <span class="function">jint <span class="title">DetachCurrentThread</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;DetachCurrentThread(<span class="keyword">this</span>); &#125;</span><br><span class="line">    <span class="function">jint <span class="title">GetEnv</span><span class="params">(<span class="keyword">void</span>** env, jint version)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetEnv(<span class="keyword">this</span>, env, version); &#125;</span><br><span class="line">    <span class="function">jint <span class="title">AttachCurrentThreadAsDaemon</span><span class="params">(JNIEnv** p_env, <span class="keyword">void</span>* thr_args)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;AttachCurrentThreadAsDaemon(<span class="keyword">this</span>, p_env, thr_args); &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/*__cplusplus*/</span></span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">JNIEnv</span> &#123;</span></span><br><span class="line">    <span class="comment">/* do not rename this; it does not seem to be entirely opaque */</span></span><br><span class="line">    <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">JNINativeInterface</span>* <span class="title">functions</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(__cplusplus)</span></span><br><span class="line"></span><br><span class="line">    <span class="function">jint <span class="title">GetVersion</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetVersion(<span class="keyword">this</span>); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jclass <span class="title">DefineClass</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *name, jobject loader, <span class="keyword">const</span> jbyte* buf,</span></span></span><br><span class="line"><span class="function"><span class="params">        jsize bufLen)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;DefineClass(<span class="keyword">this</span>, name, loader, buf, bufLen); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jclass <span class="title">FindClass</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* name)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;FindClass(<span class="keyword">this</span>, name); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jmethodID <span class="title">FromReflectedMethod</span><span class="params">(jobject method)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;FromReflectedMethod(<span class="keyword">this</span>, method); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jfieldID <span class="title">FromReflectedField</span><span class="params">(jobject field)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;FromReflectedField(<span class="keyword">this</span>, field); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jobject <span class="title">ToReflectedMethod</span><span class="params">(jclass cls, jmethodID methodID, jboolean isStatic)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;ToReflectedMethod(<span class="keyword">this</span>, cls, methodID, isStatic); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jclass <span class="title">GetSuperclass</span><span class="params">(jclass clazz)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetSuperclass(<span class="keyword">this</span>, clazz); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jboolean <span class="title">IsAssignableFrom</span><span class="params">(jclass clazz1, jclass clazz2)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;IsAssignableFrom(<span class="keyword">this</span>, clazz1, clazz2); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jobject <span class="title">ToReflectedField</span><span class="params">(jclass cls, jfieldID fieldID, jboolean isStatic)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;ToReflectedField(<span class="keyword">this</span>, cls, fieldID, isStatic); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jint <span class="title">Throw</span><span class="params">(jthrowable obj)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;Throw(<span class="keyword">this</span>, obj); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jint <span class="title">ThrowNew</span><span class="params">(jclass clazz, <span class="keyword">const</span> <span class="keyword">char</span>* message)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;ThrowNew(<span class="keyword">this</span>, clazz, message); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jthrowable <span class="title">ExceptionOccurred</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;ExceptionOccurred(<span class="keyword">this</span>); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ExceptionDescribe</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;ExceptionDescribe(<span class="keyword">this</span>); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ExceptionClear</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;ExceptionClear(<span class="keyword">this</span>); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">FatalError</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* msg)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;FatalError(<span class="keyword">this</span>, msg); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jint <span class="title">PushLocalFrame</span><span class="params">(jint capacity)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;PushLocalFrame(<span class="keyword">this</span>, capacity); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jobject <span class="title">PopLocalFrame</span><span class="params">(jobject result)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;PopLocalFrame(<span class="keyword">this</span>, result); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jobject <span class="title">NewGlobalRef</span><span class="params">(jobject obj)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;NewGlobalRef(<span class="keyword">this</span>, obj); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">DeleteGlobalRef</span><span class="params">(jobject globalRef)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;DeleteGlobalRef(<span class="keyword">this</span>, globalRef); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">DeleteLocalRef</span><span class="params">(jobject localRef)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;DeleteLocalRef(<span class="keyword">this</span>, localRef); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jboolean <span class="title">IsSameObject</span><span class="params">(jobject ref1, jobject ref2)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;IsSameObject(<span class="keyword">this</span>, ref1, ref2); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jobject <span class="title">NewLocalRef</span><span class="params">(jobject ref)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;NewLocalRef(<span class="keyword">this</span>, ref); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jint <span class="title">EnsureLocalCapacity</span><span class="params">(jint capacity)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;EnsureLocalCapacity(<span class="keyword">this</span>, capacity); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jobject <span class="title">AllocObject</span><span class="params">(jclass clazz)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;AllocObject(<span class="keyword">this</span>, clazz); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jobject <span class="title">NewObject</span><span class="params">(jclass clazz, jmethodID methodID, ...)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        va_list args;</span><br><span class="line">        va_start(args, methodID);</span><br><span class="line">        jobject result = functions-&gt;NewObjectV(<span class="keyword">this</span>, clazz, methodID, args);</span><br><span class="line">        va_end(args);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jobject <span class="title">NewObjectV</span><span class="params">(jclass clazz, jmethodID methodID, va_list args)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;NewObjectV(<span class="keyword">this</span>, clazz, methodID, args); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jobject <span class="title">NewObjectA</span><span class="params">(jclass clazz, jmethodID methodID, <span class="keyword">const</span> jvalue* args)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;NewObjectA(<span class="keyword">this</span>, clazz, methodID, args); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jclass <span class="title">GetObjectClass</span><span class="params">(jobject obj)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetObjectClass(<span class="keyword">this</span>, obj); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jboolean <span class="title">IsInstanceOf</span><span class="params">(jobject obj, jclass clazz)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;IsInstanceOf(<span class="keyword">this</span>, obj, clazz); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jmethodID <span class="title">GetMethodID</span><span class="params">(jclass clazz, <span class="keyword">const</span> <span class="keyword">char</span>* name, <span class="keyword">const</span> <span class="keyword">char</span>* sig)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetMethodID(<span class="keyword">this</span>, clazz, name, sig); &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CALL_TYPE_METHOD(_jtype, _jname)                                    \</span></span><br><span class="line">    _jtype Call##_jname##Method(jobject obj, jmethodID methodID, ...)       \</span><br><span class="line">    &#123;                                                                       \</span><br><span class="line">        _jtype result;                                                      \</span><br><span class="line">        va_list args;                                                       \</span><br><span class="line">        va_start(args, methodID);                                           \</span><br><span class="line">        result = functions-&gt;Call##_jname##MethodV(<span class="keyword">this</span>, obj, methodID,      \</span><br><span class="line">                    args);                                                  \</span><br><span class="line">        va_end(args);                                                       \</span><br><span class="line">        <span class="keyword">return</span> result;                                                      \</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CALL_TYPE_METHODV(_jtype, _jname)                                   \</span></span><br><span class="line">    _jtype Call##_jname##MethodV(jobject obj, jmethodID methodID,           \</span><br><span class="line">        va_list args)                                                       \</span><br><span class="line">    &#123; <span class="keyword">return</span> functions-&gt;Call##_jname##MethodV(<span class="keyword">this</span>, obj, methodID, args); &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CALL_TYPE_METHODA(_jtype, _jname)                                   \</span></span><br><span class="line">    _jtype Call##_jname##MethodA(jobject obj, jmethodID methodID,           \</span><br><span class="line">                                 <span class="keyword">const</span> jvalue* args)                        \</span><br><span class="line">    &#123; <span class="keyword">return</span> functions-&gt;Call##_jname##MethodA(<span class="keyword">this</span>, obj, methodID, args); &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CALL_TYPE(_jtype, _jname)                                           \</span></span><br><span class="line">    CALL_TYPE_METHOD(_jtype, _jname)                                        \</span><br><span class="line">    CALL_TYPE_METHODV(_jtype, _jname)                                       \</span><br><span class="line">    CALL_TYPE_METHODA(_jtype, _jname)</span><br><span class="line"></span><br><span class="line">    CALL_TYPE(jobject, Object)</span><br><span class="line">    CALL_TYPE(jboolean, Boolean)</span><br><span class="line">    CALL_TYPE(jbyte, Byte)</span><br><span class="line">    CALL_TYPE(jchar, Char)</span><br><span class="line">    CALL_TYPE(jshort, Short)</span><br><span class="line">    CALL_TYPE(jint, Int)</span><br><span class="line">    CALL_TYPE(jlong, Long)</span><br><span class="line">    CALL_TYPE(jfloat, Float)</span><br><span class="line">    CALL_TYPE(jdouble, Double)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CallVoidMethod</span><span class="params">(jobject obj, jmethodID methodID, ...)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        va_list args;</span><br><span class="line">        va_start(args, methodID);</span><br><span class="line">        functions-&gt;CallVoidMethodV(<span class="keyword">this</span>, obj, methodID, args);</span><br><span class="line">        va_end(args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CallVoidMethodV</span><span class="params">(jobject obj, jmethodID methodID, va_list args)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;CallVoidMethodV(<span class="keyword">this</span>, obj, methodID, args); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CallVoidMethodA</span><span class="params">(jobject obj, jmethodID methodID, <span class="keyword">const</span> jvalue* args)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;CallVoidMethodA(<span class="keyword">this</span>, obj, methodID, args); &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CALL_NONVIRT_TYPE_METHOD(_jtype, _jname)                            \</span></span><br><span class="line">    _jtype CallNonvirtual##_jname##Method(jobject obj, jclass clazz,        \</span><br><span class="line">        jmethodID methodID, ...)                                            \</span><br><span class="line">    &#123;                                                                       \</span><br><span class="line">        _jtype result;                                                      \</span><br><span class="line">        va_list args;                                                       \</span><br><span class="line">        va_start(args, methodID);                                           \</span><br><span class="line">        result = functions-&gt;CallNonvirtual##_jname##MethodV(<span class="keyword">this</span>, obj,      \</span><br><span class="line">                    clazz, methodID, args);                                 \</span><br><span class="line">        va_end(args);                                                       \</span><br><span class="line">        <span class="keyword">return</span> result;                                                      \</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CALL_NONVIRT_TYPE_METHODV(_jtype, _jname)                           \</span></span><br><span class="line">    _jtype CallNonvirtual##_jname##MethodV(jobject obj, jclass clazz,       \</span><br><span class="line">        jmethodID methodID, va_list args)                                   \</span><br><span class="line">    &#123; <span class="keyword">return</span> functions-&gt;CallNonvirtual##_jname##MethodV(<span class="keyword">this</span>, obj, clazz,   \</span><br><span class="line">        methodID, args); &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CALL_NONVIRT_TYPE_METHODA(_jtype, _jname)                           \</span></span><br><span class="line">    _jtype CallNonvirtual##_jname##MethodA(jobject obj, jclass clazz,       \</span><br><span class="line">        jmethodID methodID, <span class="keyword">const</span> jvalue* args)                             \</span><br><span class="line">    &#123; <span class="keyword">return</span> functions-&gt;CallNonvirtual##_jname##MethodA(<span class="keyword">this</span>, obj, clazz,   \</span><br><span class="line">        methodID, args); &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CALL_NONVIRT_TYPE(_jtype, _jname)                                   \</span></span><br><span class="line">    CALL_NONVIRT_TYPE_METHOD(_jtype, _jname)                                \</span><br><span class="line">    CALL_NONVIRT_TYPE_METHODV(_jtype, _jname)                               \</span><br><span class="line">    CALL_NONVIRT_TYPE_METHODA(_jtype, _jname)</span><br><span class="line"></span><br><span class="line">    CALL_NONVIRT_TYPE(jobject, Object)</span><br><span class="line">    CALL_NONVIRT_TYPE(jboolean, Boolean)</span><br><span class="line">    CALL_NONVIRT_TYPE(jbyte, Byte)</span><br><span class="line">    CALL_NONVIRT_TYPE(jchar, Char)</span><br><span class="line">    CALL_NONVIRT_TYPE(jshort, Short)</span><br><span class="line">    CALL_NONVIRT_TYPE(jint, Int)</span><br><span class="line">    CALL_NONVIRT_TYPE(jlong, Long)</span><br><span class="line">    CALL_NONVIRT_TYPE(jfloat, Float)</span><br><span class="line">    CALL_NONVIRT_TYPE(jdouble, Double)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CallNonvirtualVoidMethod</span><span class="params">(jobject obj, jclass clazz,</span></span></span><br><span class="line"><span class="function"><span class="params">        jmethodID methodID, ...)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        va_list args;</span><br><span class="line">        va_start(args, methodID);</span><br><span class="line">        functions-&gt;CallNonvirtualVoidMethodV(<span class="keyword">this</span>, obj, clazz, methodID, args);</span><br><span class="line">        va_end(args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CallNonvirtualVoidMethodV</span><span class="params">(jobject obj, jclass clazz,</span></span></span><br><span class="line"><span class="function"><span class="params">        jmethodID methodID, va_list args)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;CallNonvirtualVoidMethodV(<span class="keyword">this</span>, obj, clazz, methodID, args); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CallNonvirtualVoidMethodA</span><span class="params">(jobject obj, jclass clazz,</span></span></span><br><span class="line"><span class="function"><span class="params">        jmethodID methodID, <span class="keyword">const</span> jvalue* args)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;CallNonvirtualVoidMethodA(<span class="keyword">this</span>, obj, clazz, methodID, args); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jfieldID <span class="title">GetFieldID</span><span class="params">(jclass clazz, <span class="keyword">const</span> <span class="keyword">char</span>* name, <span class="keyword">const</span> <span class="keyword">char</span>* sig)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetFieldID(<span class="keyword">this</span>, clazz, name, sig); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jobject <span class="title">GetObjectField</span><span class="params">(jobject obj, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetObjectField(<span class="keyword">this</span>, obj, fieldID); &#125;</span><br><span class="line">    <span class="function">jboolean <span class="title">GetBooleanField</span><span class="params">(jobject obj, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetBooleanField(<span class="keyword">this</span>, obj, fieldID); &#125;</span><br><span class="line">    <span class="function">jbyte <span class="title">GetByteField</span><span class="params">(jobject obj, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetByteField(<span class="keyword">this</span>, obj, fieldID); &#125;</span><br><span class="line">    <span class="function">jchar <span class="title">GetCharField</span><span class="params">(jobject obj, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetCharField(<span class="keyword">this</span>, obj, fieldID); &#125;</span><br><span class="line">    <span class="function">jshort <span class="title">GetShortField</span><span class="params">(jobject obj, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetShortField(<span class="keyword">this</span>, obj, fieldID); &#125;</span><br><span class="line">    <span class="function">jint <span class="title">GetIntField</span><span class="params">(jobject obj, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetIntField(<span class="keyword">this</span>, obj, fieldID); &#125;</span><br><span class="line">    <span class="function">jlong <span class="title">GetLongField</span><span class="params">(jobject obj, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetLongField(<span class="keyword">this</span>, obj, fieldID); &#125;</span><br><span class="line">    <span class="function">jfloat <span class="title">GetFloatField</span><span class="params">(jobject obj, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetFloatField(<span class="keyword">this</span>, obj, fieldID); &#125;</span><br><span class="line">    <span class="function">jdouble <span class="title">GetDoubleField</span><span class="params">(jobject obj, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetDoubleField(<span class="keyword">this</span>, obj, fieldID); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetObjectField</span><span class="params">(jobject obj, jfieldID fieldID, jobject value)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;SetObjectField(<span class="keyword">this</span>, obj, fieldID, value); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetBooleanField</span><span class="params">(jobject obj, jfieldID fieldID, jboolean value)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;SetBooleanField(<span class="keyword">this</span>, obj, fieldID, value); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetByteField</span><span class="params">(jobject obj, jfieldID fieldID, jbyte value)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;SetByteField(<span class="keyword">this</span>, obj, fieldID, value); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetCharField</span><span class="params">(jobject obj, jfieldID fieldID, jchar value)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;SetCharField(<span class="keyword">this</span>, obj, fieldID, value); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetShortField</span><span class="params">(jobject obj, jfieldID fieldID, jshort value)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;SetShortField(<span class="keyword">this</span>, obj, fieldID, value); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetIntField</span><span class="params">(jobject obj, jfieldID fieldID, jint value)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;SetIntField(<span class="keyword">this</span>, obj, fieldID, value); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetLongField</span><span class="params">(jobject obj, jfieldID fieldID, jlong value)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;SetLongField(<span class="keyword">this</span>, obj, fieldID, value); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetFloatField</span><span class="params">(jobject obj, jfieldID fieldID, jfloat value)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;SetFloatField(<span class="keyword">this</span>, obj, fieldID, value); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetDoubleField</span><span class="params">(jobject obj, jfieldID fieldID, jdouble value)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;SetDoubleField(<span class="keyword">this</span>, obj, fieldID, value); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jmethodID <span class="title">GetStaticMethodID</span><span class="params">(jclass clazz, <span class="keyword">const</span> <span class="keyword">char</span>* name, <span class="keyword">const</span> <span class="keyword">char</span>* sig)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetStaticMethodID(<span class="keyword">this</span>, clazz, name, sig); &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CALL_STATIC_TYPE_METHOD(_jtype, _jname)                             \</span></span><br><span class="line">    _jtype CallStatic##_jname##Method(jclass clazz, jmethodID methodID,     \</span><br><span class="line">        ...)                                                                \</span><br><span class="line">    &#123;                                                                       \</span><br><span class="line">        _jtype result;                                                      \</span><br><span class="line">        va_list args;                                                       \</span><br><span class="line">        va_start(args, methodID);                                           \</span><br><span class="line">        result = functions-&gt;CallStatic##_jname##MethodV(<span class="keyword">this</span>, clazz,        \</span><br><span class="line">                    methodID, args);                                        \</span><br><span class="line">        va_end(args);                                                       \</span><br><span class="line">        <span class="keyword">return</span> result;                                                      \</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CALL_STATIC_TYPE_METHODV(_jtype, _jname)                            \</span></span><br><span class="line">    _jtype CallStatic##_jname##MethodV(jclass clazz, jmethodID methodID,    \</span><br><span class="line">        va_list args)                                                       \</span><br><span class="line">    &#123; <span class="keyword">return</span> functions-&gt;CallStatic##_jname##MethodV(<span class="keyword">this</span>, clazz, methodID,  \</span><br><span class="line">        args); &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CALL_STATIC_TYPE_METHODA(_jtype, _jname)                            \</span></span><br><span class="line">    _jtype CallStatic##_jname##MethodA(jclass clazz, jmethodID methodID,    \</span><br><span class="line">                                       <span class="keyword">const</span> jvalue* args)                  \</span><br><span class="line">    &#123; <span class="keyword">return</span> functions-&gt;CallStatic##_jname##MethodA(<span class="keyword">this</span>, clazz, methodID,  \</span><br><span class="line">        args); &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CALL_STATIC_TYPE(_jtype, _jname)                                    \</span></span><br><span class="line">    CALL_STATIC_TYPE_METHOD(_jtype, _jname)                                 \</span><br><span class="line">    CALL_STATIC_TYPE_METHODV(_jtype, _jname)                                \</span><br><span class="line">    CALL_STATIC_TYPE_METHODA(_jtype, _jname)</span><br><span class="line"></span><br><span class="line">    CALL_STATIC_TYPE(jobject, Object)</span><br><span class="line">    CALL_STATIC_TYPE(jboolean, Boolean)</span><br><span class="line">    CALL_STATIC_TYPE(jbyte, Byte)</span><br><span class="line">    CALL_STATIC_TYPE(jchar, Char)</span><br><span class="line">    CALL_STATIC_TYPE(jshort, Short)</span><br><span class="line">    CALL_STATIC_TYPE(jint, Int)</span><br><span class="line">    CALL_STATIC_TYPE(jlong, Long)</span><br><span class="line">    CALL_STATIC_TYPE(jfloat, Float)</span><br><span class="line">    CALL_STATIC_TYPE(jdouble, Double)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CallStaticVoidMethod</span><span class="params">(jclass clazz, jmethodID methodID, ...)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        va_list args;</span><br><span class="line">        va_start(args, methodID);</span><br><span class="line">        functions-&gt;CallStaticVoidMethodV(<span class="keyword">this</span>, clazz, methodID, args);</span><br><span class="line">        va_end(args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CallStaticVoidMethodV</span><span class="params">(jclass clazz, jmethodID methodID, va_list args)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;CallStaticVoidMethodV(<span class="keyword">this</span>, clazz, methodID, args); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CallStaticVoidMethodA</span><span class="params">(jclass clazz, jmethodID methodID, <span class="keyword">const</span> jvalue* args)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;CallStaticVoidMethodA(<span class="keyword">this</span>, clazz, methodID, args); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jfieldID <span class="title">GetStaticFieldID</span><span class="params">(jclass clazz, <span class="keyword">const</span> <span class="keyword">char</span>* name, <span class="keyword">const</span> <span class="keyword">char</span>* sig)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetStaticFieldID(<span class="keyword">this</span>, clazz, name, sig); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jobject <span class="title">GetStaticObjectField</span><span class="params">(jclass clazz, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetStaticObjectField(<span class="keyword">this</span>, clazz, fieldID); &#125;</span><br><span class="line">    <span class="function">jboolean <span class="title">GetStaticBooleanField</span><span class="params">(jclass clazz, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetStaticBooleanField(<span class="keyword">this</span>, clazz, fieldID); &#125;</span><br><span class="line">    <span class="function">jbyte <span class="title">GetStaticByteField</span><span class="params">(jclass clazz, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetStaticByteField(<span class="keyword">this</span>, clazz, fieldID); &#125;</span><br><span class="line">    <span class="function">jchar <span class="title">GetStaticCharField</span><span class="params">(jclass clazz, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetStaticCharField(<span class="keyword">this</span>, clazz, fieldID); &#125;</span><br><span class="line">    <span class="function">jshort <span class="title">GetStaticShortField</span><span class="params">(jclass clazz, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetStaticShortField(<span class="keyword">this</span>, clazz, fieldID); &#125;</span><br><span class="line">    <span class="function">jint <span class="title">GetStaticIntField</span><span class="params">(jclass clazz, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetStaticIntField(<span class="keyword">this</span>, clazz, fieldID); &#125;</span><br><span class="line">    <span class="function">jlong <span class="title">GetStaticLongField</span><span class="params">(jclass clazz, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetStaticLongField(<span class="keyword">this</span>, clazz, fieldID); &#125;</span><br><span class="line">    <span class="function">jfloat <span class="title">GetStaticFloatField</span><span class="params">(jclass clazz, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetStaticFloatField(<span class="keyword">this</span>, clazz, fieldID); &#125;</span><br><span class="line">    <span class="function">jdouble <span class="title">GetStaticDoubleField</span><span class="params">(jclass clazz, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetStaticDoubleField(<span class="keyword">this</span>, clazz, fieldID); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetStaticObjectField</span><span class="params">(jclass clazz, jfieldID fieldID, jobject value)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;SetStaticObjectField(<span class="keyword">this</span>, clazz, fieldID, value); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetStaticBooleanField</span><span class="params">(jclass clazz, jfieldID fieldID, jboolean value)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;SetStaticBooleanField(<span class="keyword">this</span>, clazz, fieldID, value); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetStaticByteField</span><span class="params">(jclass clazz, jfieldID fieldID, jbyte value)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;SetStaticByteField(<span class="keyword">this</span>, clazz, fieldID, value); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetStaticCharField</span><span class="params">(jclass clazz, jfieldID fieldID, jchar value)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;SetStaticCharField(<span class="keyword">this</span>, clazz, fieldID, value); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetStaticShortField</span><span class="params">(jclass clazz, jfieldID fieldID, jshort value)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;SetStaticShortField(<span class="keyword">this</span>, clazz, fieldID, value); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetStaticIntField</span><span class="params">(jclass clazz, jfieldID fieldID, jint value)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;SetStaticIntField(<span class="keyword">this</span>, clazz, fieldID, value); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetStaticLongField</span><span class="params">(jclass clazz, jfieldID fieldID, jlong value)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;SetStaticLongField(<span class="keyword">this</span>, clazz, fieldID, value); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetStaticFloatField</span><span class="params">(jclass clazz, jfieldID fieldID, jfloat value)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;SetStaticFloatField(<span class="keyword">this</span>, clazz, fieldID, value); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetStaticDoubleField</span><span class="params">(jclass clazz, jfieldID fieldID, jdouble value)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;SetStaticDoubleField(<span class="keyword">this</span>, clazz, fieldID, value); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jstring <span class="title">NewString</span><span class="params">(<span class="keyword">const</span> jchar* unicodeChars, jsize len)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;NewString(<span class="keyword">this</span>, unicodeChars, len); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jsize <span class="title">GetStringLength</span><span class="params">(jstring <span class="built_in">string</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetStringLength(<span class="keyword">this</span>, <span class="built_in">string</span>); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">const</span> jchar* <span class="title">GetStringChars</span><span class="params">(jstring <span class="built_in">string</span>, jboolean* isCopy)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetStringChars(<span class="keyword">this</span>, <span class="built_in">string</span>, isCopy); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ReleaseStringChars</span><span class="params">(jstring <span class="built_in">string</span>, <span class="keyword">const</span> jchar* chars)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;ReleaseStringChars(<span class="keyword">this</span>, <span class="built_in">string</span>, chars); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jstring <span class="title">NewStringUTF</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* bytes)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;NewStringUTF(<span class="keyword">this</span>, bytes); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jsize <span class="title">GetStringUTFLength</span><span class="params">(jstring <span class="built_in">string</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetStringUTFLength(<span class="keyword">this</span>, <span class="built_in">string</span>); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">const</span> <span class="keyword">char</span>* <span class="title">GetStringUTFChars</span><span class="params">(jstring <span class="built_in">string</span>, jboolean* isCopy)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetStringUTFChars(<span class="keyword">this</span>, <span class="built_in">string</span>, isCopy); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ReleaseStringUTFChars</span><span class="params">(jstring <span class="built_in">string</span>, <span class="keyword">const</span> <span class="keyword">char</span>* utf)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;ReleaseStringUTFChars(<span class="keyword">this</span>, <span class="built_in">string</span>, utf); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jsize <span class="title">GetArrayLength</span><span class="params">(jarray <span class="built_in">array</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetArrayLength(<span class="keyword">this</span>, <span class="built_in">array</span>); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jobjectArray <span class="title">NewObjectArray</span><span class="params">(jsize length, jclass elementClass,</span></span></span><br><span class="line"><span class="function"><span class="params">        jobject initialElement)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;NewObjectArray(<span class="keyword">this</span>, length, elementClass,</span><br><span class="line">        initialElement); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jobject <span class="title">GetObjectArrayElement</span><span class="params">(jobjectArray <span class="built_in">array</span>, jsize index)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetObjectArrayElement(<span class="keyword">this</span>, <span class="built_in">array</span>, index); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetObjectArrayElement</span><span class="params">(jobjectArray <span class="built_in">array</span>, jsize index, jobject value)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;SetObjectArrayElement(<span class="keyword">this</span>, <span class="built_in">array</span>, index, value); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jbooleanArray <span class="title">NewBooleanArray</span><span class="params">(jsize length)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;NewBooleanArray(<span class="keyword">this</span>, length); &#125;</span><br><span class="line">    <span class="function">jbyteArray <span class="title">NewByteArray</span><span class="params">(jsize length)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;NewByteArray(<span class="keyword">this</span>, length); &#125;</span><br><span class="line">    <span class="function">jcharArray <span class="title">NewCharArray</span><span class="params">(jsize length)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;NewCharArray(<span class="keyword">this</span>, length); &#125;</span><br><span class="line">    <span class="function">jshortArray <span class="title">NewShortArray</span><span class="params">(jsize length)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;NewShortArray(<span class="keyword">this</span>, length); &#125;</span><br><span class="line">    <span class="function">jintArray <span class="title">NewIntArray</span><span class="params">(jsize length)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;NewIntArray(<span class="keyword">this</span>, length); &#125;</span><br><span class="line">    <span class="function">jlongArray <span class="title">NewLongArray</span><span class="params">(jsize length)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;NewLongArray(<span class="keyword">this</span>, length); &#125;</span><br><span class="line">    <span class="function">jfloatArray <span class="title">NewFloatArray</span><span class="params">(jsize length)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;NewFloatArray(<span class="keyword">this</span>, length); &#125;</span><br><span class="line">    <span class="function">jdoubleArray <span class="title">NewDoubleArray</span><span class="params">(jsize length)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;NewDoubleArray(<span class="keyword">this</span>, length); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jboolean* <span class="title">GetBooleanArrayElements</span><span class="params">(jbooleanArray <span class="built_in">array</span>, jboolean* isCopy)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetBooleanArrayElements(<span class="keyword">this</span>, <span class="built_in">array</span>, isCopy); &#125;</span><br><span class="line">    <span class="function">jbyte* <span class="title">GetByteArrayElements</span><span class="params">(jbyteArray <span class="built_in">array</span>, jboolean* isCopy)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetByteArrayElements(<span class="keyword">this</span>, <span class="built_in">array</span>, isCopy); &#125;</span><br><span class="line">    <span class="function">jchar* <span class="title">GetCharArrayElements</span><span class="params">(jcharArray <span class="built_in">array</span>, jboolean* isCopy)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetCharArrayElements(<span class="keyword">this</span>, <span class="built_in">array</span>, isCopy); &#125;</span><br><span class="line">    <span class="function">jshort* <span class="title">GetShortArrayElements</span><span class="params">(jshortArray <span class="built_in">array</span>, jboolean* isCopy)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetShortArrayElements(<span class="keyword">this</span>, <span class="built_in">array</span>, isCopy); &#125;</span><br><span class="line">    <span class="function">jint* <span class="title">GetIntArrayElements</span><span class="params">(jintArray <span class="built_in">array</span>, jboolean* isCopy)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetIntArrayElements(<span class="keyword">this</span>, <span class="built_in">array</span>, isCopy); &#125;</span><br><span class="line">    <span class="function">jlong* <span class="title">GetLongArrayElements</span><span class="params">(jlongArray <span class="built_in">array</span>, jboolean* isCopy)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetLongArrayElements(<span class="keyword">this</span>, <span class="built_in">array</span>, isCopy); &#125;</span><br><span class="line">    <span class="function">jfloat* <span class="title">GetFloatArrayElements</span><span class="params">(jfloatArray <span class="built_in">array</span>, jboolean* isCopy)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetFloatArrayElements(<span class="keyword">this</span>, <span class="built_in">array</span>, isCopy); &#125;</span><br><span class="line">    <span class="function">jdouble* <span class="title">GetDoubleArrayElements</span><span class="params">(jdoubleArray <span class="built_in">array</span>, jboolean* isCopy)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetDoubleArrayElements(<span class="keyword">this</span>, <span class="built_in">array</span>, isCopy); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ReleaseBooleanArrayElements</span><span class="params">(jbooleanArray <span class="built_in">array</span>, jboolean* elems,</span></span></span><br><span class="line"><span class="function"><span class="params">        jint mode)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;ReleaseBooleanArrayElements(<span class="keyword">this</span>, <span class="built_in">array</span>, elems, mode); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ReleaseByteArrayElements</span><span class="params">(jbyteArray <span class="built_in">array</span>, jbyte* elems,</span></span></span><br><span class="line"><span class="function"><span class="params">        jint mode)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;ReleaseByteArrayElements(<span class="keyword">this</span>, <span class="built_in">array</span>, elems, mode); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ReleaseCharArrayElements</span><span class="params">(jcharArray <span class="built_in">array</span>, jchar* elems,</span></span></span><br><span class="line"><span class="function"><span class="params">        jint mode)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;ReleaseCharArrayElements(<span class="keyword">this</span>, <span class="built_in">array</span>, elems, mode); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ReleaseShortArrayElements</span><span class="params">(jshortArray <span class="built_in">array</span>, jshort* elems,</span></span></span><br><span class="line"><span class="function"><span class="params">        jint mode)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;ReleaseShortArrayElements(<span class="keyword">this</span>, <span class="built_in">array</span>, elems, mode); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ReleaseIntArrayElements</span><span class="params">(jintArray <span class="built_in">array</span>, jint* elems,</span></span></span><br><span class="line"><span class="function"><span class="params">        jint mode)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;ReleaseIntArrayElements(<span class="keyword">this</span>, <span class="built_in">array</span>, elems, mode); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ReleaseLongArrayElements</span><span class="params">(jlongArray <span class="built_in">array</span>, jlong* elems,</span></span></span><br><span class="line"><span class="function"><span class="params">        jint mode)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;ReleaseLongArrayElements(<span class="keyword">this</span>, <span class="built_in">array</span>, elems, mode); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ReleaseFloatArrayElements</span><span class="params">(jfloatArray <span class="built_in">array</span>, jfloat* elems,</span></span></span><br><span class="line"><span class="function"><span class="params">        jint mode)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;ReleaseFloatArrayElements(<span class="keyword">this</span>, <span class="built_in">array</span>, elems, mode); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ReleaseDoubleArrayElements</span><span class="params">(jdoubleArray <span class="built_in">array</span>, jdouble* elems,</span></span></span><br><span class="line"><span class="function"><span class="params">        jint mode)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;ReleaseDoubleArrayElements(<span class="keyword">this</span>, <span class="built_in">array</span>, elems, mode); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetBooleanArrayRegion</span><span class="params">(jbooleanArray <span class="built_in">array</span>, jsize start, jsize len,</span></span></span><br><span class="line"><span class="function"><span class="params">        jboolean* buf)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;GetBooleanArrayRegion(<span class="keyword">this</span>, <span class="built_in">array</span>, start, len, buf); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetByteArrayRegion</span><span class="params">(jbyteArray <span class="built_in">array</span>, jsize start, jsize len,</span></span></span><br><span class="line"><span class="function"><span class="params">        jbyte* buf)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;GetByteArrayRegion(<span class="keyword">this</span>, <span class="built_in">array</span>, start, len, buf); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetCharArrayRegion</span><span class="params">(jcharArray <span class="built_in">array</span>, jsize start, jsize len,</span></span></span><br><span class="line"><span class="function"><span class="params">        jchar* buf)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;GetCharArrayRegion(<span class="keyword">this</span>, <span class="built_in">array</span>, start, len, buf); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetShortArrayRegion</span><span class="params">(jshortArray <span class="built_in">array</span>, jsize start, jsize len,</span></span></span><br><span class="line"><span class="function"><span class="params">        jshort* buf)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;GetShortArrayRegion(<span class="keyword">this</span>, <span class="built_in">array</span>, start, len, buf); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetIntArrayRegion</span><span class="params">(jintArray <span class="built_in">array</span>, jsize start, jsize len,</span></span></span><br><span class="line"><span class="function"><span class="params">        jint* buf)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;GetIntArrayRegion(<span class="keyword">this</span>, <span class="built_in">array</span>, start, len, buf); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetLongArrayRegion</span><span class="params">(jlongArray <span class="built_in">array</span>, jsize start, jsize len,</span></span></span><br><span class="line"><span class="function"><span class="params">        jlong* buf)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;GetLongArrayRegion(<span class="keyword">this</span>, <span class="built_in">array</span>, start, len, buf); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetFloatArrayRegion</span><span class="params">(jfloatArray <span class="built_in">array</span>, jsize start, jsize len,</span></span></span><br><span class="line"><span class="function"><span class="params">        jfloat* buf)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;GetFloatArrayRegion(<span class="keyword">this</span>, <span class="built_in">array</span>, start, len, buf); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetDoubleArrayRegion</span><span class="params">(jdoubleArray <span class="built_in">array</span>, jsize start, jsize len,</span></span></span><br><span class="line"><span class="function"><span class="params">        jdouble* buf)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;GetDoubleArrayRegion(<span class="keyword">this</span>, <span class="built_in">array</span>, start, len, buf); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetBooleanArrayRegion</span><span class="params">(jbooleanArray <span class="built_in">array</span>, jsize start, jsize len,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">const</span> jboolean* buf)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;SetBooleanArrayRegion(<span class="keyword">this</span>, <span class="built_in">array</span>, start, len, buf); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetByteArrayRegion</span><span class="params">(jbyteArray <span class="built_in">array</span>, jsize start, jsize len,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">const</span> jbyte* buf)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;SetByteArrayRegion(<span class="keyword">this</span>, <span class="built_in">array</span>, start, len, buf); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetCharArrayRegion</span><span class="params">(jcharArray <span class="built_in">array</span>, jsize start, jsize len,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">const</span> jchar* buf)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;SetCharArrayRegion(<span class="keyword">this</span>, <span class="built_in">array</span>, start, len, buf); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetShortArrayRegion</span><span class="params">(jshortArray <span class="built_in">array</span>, jsize start, jsize len,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">const</span> jshort* buf)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;SetShortArrayRegion(<span class="keyword">this</span>, <span class="built_in">array</span>, start, len, buf); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetIntArrayRegion</span><span class="params">(jintArray <span class="built_in">array</span>, jsize start, jsize len,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">const</span> jint* buf)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;SetIntArrayRegion(<span class="keyword">this</span>, <span class="built_in">array</span>, start, len, buf); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetLongArrayRegion</span><span class="params">(jlongArray <span class="built_in">array</span>, jsize start, jsize len,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">const</span> jlong* buf)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;SetLongArrayRegion(<span class="keyword">this</span>, <span class="built_in">array</span>, start, len, buf); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetFloatArrayRegion</span><span class="params">(jfloatArray <span class="built_in">array</span>, jsize start, jsize len,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">const</span> jfloat* buf)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;SetFloatArrayRegion(<span class="keyword">this</span>, <span class="built_in">array</span>, start, len, buf); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetDoubleArrayRegion</span><span class="params">(jdoubleArray <span class="built_in">array</span>, jsize start, jsize len,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">const</span> jdouble* buf)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;SetDoubleArrayRegion(<span class="keyword">this</span>, <span class="built_in">array</span>, start, len, buf); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jint <span class="title">RegisterNatives</span><span class="params">(jclass clazz, <span class="keyword">const</span> JNINativeMethod* methods,</span></span></span><br><span class="line"><span class="function"><span class="params">        jint nMethods)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;RegisterNatives(<span class="keyword">this</span>, clazz, methods, nMethods); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jint <span class="title">UnregisterNatives</span><span class="params">(jclass clazz)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;UnregisterNatives(<span class="keyword">this</span>, clazz); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jint <span class="title">MonitorEnter</span><span class="params">(jobject obj)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;MonitorEnter(<span class="keyword">this</span>, obj); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jint <span class="title">MonitorExit</span><span class="params">(jobject obj)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;MonitorExit(<span class="keyword">this</span>, obj); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jint <span class="title">GetJavaVM</span><span class="params">(JavaVM** vm)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetJavaVM(<span class="keyword">this</span>, vm); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetStringRegion</span><span class="params">(jstring str, jsize start, jsize len, jchar* buf)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;GetStringRegion(<span class="keyword">this</span>, str, start, len, buf); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetStringUTFRegion</span><span class="params">(jstring str, jsize start, jsize len, <span class="keyword">char</span>* buf)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetStringUTFRegion(<span class="keyword">this</span>, str, start, len, buf); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span>* <span class="title">GetPrimitiveArrayCritical</span><span class="params">(jarray <span class="built_in">array</span>, jboolean* isCopy)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetPrimitiveArrayCritical(<span class="keyword">this</span>, <span class="built_in">array</span>, isCopy); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ReleasePrimitiveArrayCritical</span><span class="params">(jarray <span class="built_in">array</span>, <span class="keyword">void</span>* carray, jint mode)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;ReleasePrimitiveArrayCritical(<span class="keyword">this</span>, <span class="built_in">array</span>, carray, mode); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">const</span> jchar* <span class="title">GetStringCritical</span><span class="params">(jstring <span class="built_in">string</span>, jboolean* isCopy)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetStringCritical(<span class="keyword">this</span>, <span class="built_in">string</span>, isCopy); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ReleaseStringCritical</span><span class="params">(jstring <span class="built_in">string</span>, <span class="keyword">const</span> jchar* carray)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;ReleaseStringCritical(<span class="keyword">this</span>, <span class="built_in">string</span>, carray); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jweak <span class="title">NewWeakGlobalRef</span><span class="params">(jobject obj)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;NewWeakGlobalRef(<span class="keyword">this</span>, obj); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">DeleteWeakGlobalRef</span><span class="params">(jweak obj)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;DeleteWeakGlobalRef(<span class="keyword">this</span>, obj); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jboolean <span class="title">ExceptionCheck</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;ExceptionCheck(<span class="keyword">this</span>); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jobject <span class="title">NewDirectByteBuffer</span><span class="params">(<span class="keyword">void</span>* address, jlong capacity)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;NewDirectByteBuffer(<span class="keyword">this</span>, address, capacity); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span>* <span class="title">GetDirectBufferAddress</span><span class="params">(jobject buf)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetDirectBufferAddress(<span class="keyword">this</span>, buf); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jlong <span class="title">GetDirectBufferCapacity</span><span class="params">(jobject buf)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetDirectBufferCapacity(<span class="keyword">this</span>, buf); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* added in JNI 1.6 */</span></span><br><span class="line">    <span class="function">jobjectRefType <span class="title">GetObjectRefType</span><span class="params">(jobject obj)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;GetObjectRefType(<span class="keyword">this</span>, obj); &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/*__cplusplus*/</span></span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>经常使用到的<code>GetEnv</code>main主线程使用,<code>AttachCurrentThread</code>新建线程使用<br>而JniEnv提供了特别多的接口使用 </p>
<h3 id="测试案例"><a href="#测试案例" class="headerlink" title="测试案例"></a>测试案例</h3><blockquote>
<p>Java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kanxue.reflectiontest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String flag = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        flag = <span class="string">"Test()"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">(String arg)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        flag = <span class="string">"Test(String arg)"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">(String arg, <span class="keyword">int</span> arg2)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        flag = <span class="string">"Test(String arg,int arg2)"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String publicStaticField = <span class="string">"i am a publicStaticField"</span>;</span><br><span class="line">    <span class="keyword">public</span> String publicField = <span class="string">"i am a publicField"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String privateStaticField = <span class="string">"i am a privateStaticField"</span>;</span><br><span class="line">    <span class="keyword">private</span> String privateField = <span class="string">"i am a privateField"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">publicStaticFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"i am from publicStaticFunc"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">publicFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"i am from publicFunc"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">privateStaticFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"i am from privateStaticFunc"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">privateFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"i am from privateStaticFunc"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.kanxue.reflectiontest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Used to load the 'native-lib' library on application startup.</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">"native-lib"</span>);</span><br><span class="line">        <span class="comment">//System.load("");</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        <span class="comment">// Example of a call to a native method</span></span><br><span class="line">        TextView tv = findViewById(R.id.sample_text);</span><br><span class="line">        tv.setText(stringFromJNI());</span><br><span class="line">        <span class="comment">//testField();</span></span><br><span class="line">        <span class="comment">//testMethod();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testField</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Test a_obj = <span class="keyword">new</span> Test();</span><br><span class="line">        Test b_obj = <span class="keyword">new</span> Test(<span class="string">"test"</span>);</span><br><span class="line">        Test c_obj = <span class="keyword">new</span> Test(<span class="string">"test"</span>, <span class="number">2</span>);</span><br><span class="line">        Class testClazz = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            testClazz = MainActivity.class.getClassLoader().loadClass(<span class="string">"com.kanxue.reflectiontest.Test"</span>);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"ClassLoader.loadClass-&gt;"</span> + testClazz);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        Class testClazz2;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            testClazz2 = Class.forName(<span class="string">"com.kanxue.reflectiontest.Test"</span>);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"Class.forName-&gt;"</span> + testClazz2);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        Class testClazz3 = Test.class;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"Test.class-&gt;"</span> + testClazz);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Field publicStaticField_field = testClazz3.getDeclaredField(<span class="string">"publicStaticField"</span>);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredField-&gt;"</span> + publicStaticField_field);</span><br><span class="line">            String content = (String) publicStaticField_field.get(<span class="keyword">null</span>);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"publicStaticField-&gt;"</span> + content);</span><br><span class="line">            content = (String) publicStaticField_field.get(a_obj);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"publicStaticField-&gt;a_obj"</span> + content);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//privateField</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Field privateStaticField_field = testClazz3.getDeclaredField(<span class="string">"privateStaticField"</span>);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredField-&gt;"</span> + privateStaticField_field);</span><br><span class="line">            privateStaticField_field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            privateStaticField_field.set(<span class="keyword">null</span>, <span class="string">"modified"</span>);</span><br><span class="line">            String content = (String) privateStaticField_field.get(<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"privateStaticField_field-&gt;"</span> + content);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Field privateField_field = testClazz3.getField(<span class="string">"privateField"</span>);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getField-&gt;"</span> + privateField_field);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Error | NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        Field[] fields = testClazz3.getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span> (Field i : fields) &#123;</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredFields-&gt;"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Field[] fields_1 = testClazz3.getFields();</span><br><span class="line">        <span class="keyword">for</span> (Field i : fields_1) &#123;</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getFields-&gt;"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Class testClazz = Test.class;</span><br><span class="line">        Method publicStaticFunc_method = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            publicStaticFunc_method = testClazz.getDeclaredMethod(<span class="string">"publicStaticFunc"</span>);</span><br><span class="line">            publicStaticFunc_method.invoke(<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredMethod-&gt;"</span> + publicStaticFunc_method);</span><br><span class="line"></span><br><span class="line">        Method privateStaticFunc_method = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            privateStaticFunc_method = testClazz.getDeclaredMethod(<span class="string">"privateStaticFunc"</span>);</span><br><span class="line">            privateStaticFunc_method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            privateStaticFunc_method.invoke(<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredMethod-&gt;"</span> + privateStaticFunc_method);</span><br><span class="line"></span><br><span class="line">        Method[] methods = testClazz.getDeclaredMethods();</span><br><span class="line">        <span class="keyword">for</span> (Method i : methods) &#123;</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredMethods-&gt;"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        Method[] methods_1 = testClazz.getMethods();</span><br><span class="line">        <span class="keyword">for</span> (Method i : methods_1) &#123;</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getMethods-&gt;"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        Constructor[] constructors=testClazz.getDeclaredConstructors();</span><br><span class="line">        <span class="keyword">for</span> (Constructor i : constructors) &#123;</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredConstructors-&gt;"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Constructor constructor=testClazz.getDeclaredConstructor(String.class,<span class="keyword">int</span>.class);</span><br><span class="line">            Object testobj=constructor.newInstance(<span class="string">"test"</span>,<span class="number">666</span>);</span><br><span class="line">            Field privateField_field=testClazz.getDeclaredField(<span class="string">"privateField"</span>);</span><br><span class="line">            privateField_field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            String privateField_String= (String) privateField_field.get(testobj);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>,<span class="string">"privateField-&gt;"</span>+privateField_String);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredConstructor-&gt;"</span> + constructor);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A native method that is implemented by the 'native-lib' native library,</span></span><br><span class="line"><span class="comment">     * which is packaged with this application.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">stringFromJNI</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">stringFromJNIC</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">getFields</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Cpp</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;android/log.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line">JavaVM *globalVM = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> JNIEXPORT jstring JNICALL</span><br><span class="line">Java_com_kanxue_reflectiontest_MainActivity_stringFromJNI(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject <span class="comment">/* this */</span>) &#123;</span><br><span class="line">    JavaVM *thisvm = <span class="literal">nullptr</span>;</span><br><span class="line">    env-&gt;GetJavaVM(&amp;thisvm);</span><br><span class="line"></span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"env-&gt;GetJavaVM(&amp;thisvm)-&gt;%p"</span>, thisvm);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>,</span><br><span class="line">                        <span class="string">"Java_com_kanxue_reflectiontest_MainActivity_stringFromJNI-&gt;%p"</span>, env);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*    jint GetVersion()</span></span><br><span class="line"><span class="comment">    &#123; return functions-&gt;GetVersion(this); &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    jclass DefineClass(const char *name, jobject loader, const jbyte* buf,</span></span><br><span class="line"><span class="comment">                       jsize bufLen)</span></span><br><span class="line"><span class="comment">    &#123; return functions-&gt;DefineClass(this, name, loader, buf, bufLen); &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    jclass FindClass(const char* name)</span></span><br><span class="line"><span class="comment">    &#123; return functions-&gt;FindClass(this, name); &#125;*/</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> hello = <span class="string">"Hello from C++"</span>;</span><br><span class="line">    <span class="comment">//publicStaticField</span></span><br><span class="line">    jclass TestJclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/Test"</span>);</span><br><span class="line">    <span class="comment">//jfieldID GetStaticFieldID(jclass clazz, const char* name, const char* sig)</span></span><br><span class="line">    jfieldID publicStaticField_jfieldID = env-&gt;GetStaticFieldID(TestJclass, <span class="string">"publicStaticField"</span>,</span><br><span class="line">                                                                <span class="string">"Ljava/lang/String;"</span>);</span><br><span class="line">    <span class="comment">//jobject GetStaticObjectField(jclass clazz, jfieldID fieldID)</span></span><br><span class="line">    jstring publicStaticField_content = (jstring) env-&gt;GetStaticObjectField(TestJclass,</span><br><span class="line">                                                                            publicStaticField_jfieldID);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *content_ptr = env-&gt;GetStringUTFChars(publicStaticField_content, <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>, content_ptr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> env-&gt;NewStringUTF(hello.c_str());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> JNIEXPORT jstring JNICALL</span><br><span class="line">Java_com_kanxue_reflectiontest_MainActivity_getFields(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject <span class="comment">/* this */</span>) &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> hello = <span class="string">"Hello from C++"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">threadtest</span><span class="params">(<span class="keyword">void</span> *args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s,%d"</span>, <span class="string">"I am from threadtest"</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">    JNIEnv *threadenv = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">if</span> (globalVM-&gt;GetEnv((<span class="keyword">void</span> **) &amp;threadenv, JNI_VERSION_1_6) == JNI_OK) &#123;</span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>,</span><br><span class="line">                            <span class="string">"globalVM-&gt;GetEnv((void**)&amp;threadenv,JNI_VERSION_1_6)==JNI_OK success"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>,</span><br><span class="line">                            <span class="string">"globalVM-&gt;GetEnv((void**)&amp;threadenv,JNI_VERSION_1_6)==JNI_OK failed"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> result = globalVM-&gt;AttachCurrentThread(&amp;threadenv, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">if</span> (result == JNI_OK) &#123;</span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>,</span><br><span class="line">                            <span class="string">"    globalVM-&gt;AttachCurrentThread(&amp;threadenv, nullptr)==JNI_OK success"</span>);</span><br><span class="line">        jstring jstring1 = threadenv-&gt;NewStringUTF(<span class="string">"threadtest jstring"</span>);</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">char</span> *content = threadenv-&gt;GetStringUTFChars(jstring1, <span class="literal">nullptr</span>);</span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>, content);</span><br><span class="line">        threadenv-&gt;ReleaseStringUTFChars(jstring1, content);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>,</span><br><span class="line">                            <span class="string">"    globalVM-&gt;AttachCurrentThread(&amp;threadenv, nullptr)==JNI_OK failed"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//publicStaticField</span></span><br><span class="line">    jclass TestJclass = threadenv-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/Test"</span>);</span><br><span class="line">    threadenv-&gt;ExceptionDescribe();</span><br><span class="line">    threadenv-&gt;ExceptionClear();</span><br><span class="line">    <span class="keyword">if</span> (TestJclass == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>,</span><br><span class="line">                            <span class="string">"TestJclass is nullptr"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>,</span><br><span class="line">                            <span class="string">"TestJclass is not nullptr"</span>);</span><br><span class="line">        <span class="comment">//jfieldID GetStaticFieldID(jclass clazz, const char* name, const char* sig)</span></span><br><span class="line">        jfieldID publicStaticField_jfieldID = threadenv-&gt;GetStaticFieldID(TestJclass,</span><br><span class="line">                                                                          <span class="string">"publicStaticField"</span>,</span><br><span class="line">                                                                          <span class="string">"Ljava/lang/String;"</span>);</span><br><span class="line">        <span class="comment">//jobject GetStaticObjectField(jclass clazz, jfieldID fieldID)</span></span><br><span class="line">        jstring publicStaticField_content = (jstring) threadenv-&gt;GetStaticObjectField(TestJclass,</span><br><span class="line">                                                                                      publicStaticField_jfieldID);</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">char</span> *content_ptr = threadenv-&gt;GetStringUTFChars(publicStaticField_content, <span class="literal">nullptr</span>);</span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>, content_ptr);</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//globalVM-&gt;AttachCurrentThread()</span></span><br><span class="line"></span><br><span class="line">    globalVM-&gt;DetachCurrentThread();</span><br><span class="line"></span><br><span class="line">    pthread_exit(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">JNIEXPORT jint <span class="title">JNI_OnLoad</span><span class="params">(JavaVM *vm, <span class="keyword">void</span> *reserved)</span> </span>&#123;</span><br><span class="line">    globalVM = vm;</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"JNI_OnLoad(JavaVM *vm, void *reserved)-&gt;%p"</span>, vm);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>, <span class="string">"JNI_OnLoad is called"</span>);</span><br><span class="line">    jint result = <span class="number">0</span>;</span><br><span class="line">    JNIEnv *env = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">if</span> (vm-&gt;GetEnv((<span class="keyword">void</span> **) &amp;env, JNI_VERSION_1_6) == JNI_OK) &#123;</span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>,</span><br><span class="line">                            <span class="string">"vm-&gt;GetEnv((void**)&amp;env,JNI_VERSION_1_6) success"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//publicStaticField</span></span><br><span class="line">    jclass TestJclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/Test"</span>);</span><br><span class="line">    <span class="comment">//jfieldID GetStaticFieldID(jclass clazz, const char* name, const char* sig)</span></span><br><span class="line">    jfieldID publicStaticField_jfieldID = env-&gt;GetStaticFieldID(TestJclass, <span class="string">"publicStaticField"</span>,</span><br><span class="line">                                                                <span class="string">"Ljava/lang/String;"</span>);</span><br><span class="line">    <span class="comment">//jobject GetStaticObjectField(jclass clazz, jfieldID fieldID)</span></span><br><span class="line">    jstring publicStaticField_content = (jstring) env-&gt;GetStaticObjectField(TestJclass,</span><br><span class="line">                                                                            publicStaticField_jfieldID);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *content_ptr = env-&gt;GetStringUTFChars(publicStaticField_content, <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>, content_ptr);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"GetEnv((void**)&amp;env,JNI_VERSION_1_6)-&gt;%p"</span>, env);</span><br><span class="line">    <span class="comment">//int pthread_create(pthread_t* __pthread_ptr, pthread_attr_t const* __attr, void* (*__start_routine)(void*), void*);</span></span><br><span class="line">    <span class="keyword">pthread_t</span> thread;</span><br><span class="line">    <span class="comment">//pthread_create(&amp;thread, nullptr,threadtest, nullptr);</span></span><br><span class="line">    pthread_create(&amp;thread, <span class="literal">nullptr</span>, threadtest, <span class="literal">nullptr</span>);</span><br><span class="line">    pthread_join(thread, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* jint DestroyJavaVM()</span></span><br><span class="line"><span class="comment">    &#123; return functions-&gt;DestroyJavaVM(this); &#125;</span></span><br><span class="line"><span class="comment">    jint AttachCurrentThread(JNIEnv** p_env, void* thr_args)</span></span><br><span class="line"><span class="comment">    &#123; return functions-&gt;AttachCurrentThread(this, p_env, thr_args); &#125;</span></span><br><span class="line"><span class="comment">    jint DetachCurrentThread()</span></span><br><span class="line"><span class="comment">    &#123; return functions-&gt;DetachCurrentThread(this); &#125;</span></span><br><span class="line"><span class="comment">    jint GetEnv(void** env, jint version)</span></span><br><span class="line"><span class="comment">    &#123; return functions-&gt;GetEnv(this, env, version); &#125;</span></span><br><span class="line"><span class="comment">    jint AttachCurrentThreadAsDaemon(JNIEnv** p_env, void* thr_args)</span></span><br><span class="line"><span class="comment">    &#123; return functions-&gt;AttachCurrentThreadAsDaemon(this, p_env, thr_args); &#125;*/</span></span><br><span class="line">    result = JNI_VERSION_1_6;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br><br><br></p>
<h2 id="Java反射与NDK开发"><a href="#Java反射与NDK开发" class="headerlink" title="Java反射与NDK开发"></a>Java反射与NDK开发</h2><p>利用Java反射可以获取所需私有成员或是方法<br>而对于public类型的成员变量和方法或属性都可以使用反射来进行访问 </p>
<p>Java反射的相关类 </p>
<table>
<thead>
<tr>
<th>类名</th>
<th>用途 </th>
</tr>
</thead>
<tbody>
<tr>
<td>Class类</td>
<td>代表类的实体,在运行的Java应用程序中表示类和接口 </td>
</tr>
<tr>
<td>Field类</td>
<td>代表类的成员变量</td>
</tr>
<tr>
<td>Method类</td>
<td>代表类的方法</td>
</tr>
<tr>
<td>Constructor类</td>
<td>代表类的构造方法 </td>
</tr>
</tbody>
</table>
<h3 id="JNI新建对象和访问Java属性"><a href="#JNI新建对象和访问Java属性" class="headerlink" title="JNI新建对象和访问Java属性"></a>JNI新建对象和访问Java属性</h3><h4 id="MainActivity-Java"><a href="#MainActivity-Java" class="headerlink" title="MainActivity.Java"></a>MainActivity.Java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kanxue.reflectiontest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Used to load the 'native-lib' library on application startup.</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">"native-lib"</span>);</span><br><span class="line">        <span class="comment">//System.load("");</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        <span class="comment">// Example of a call to a native method</span></span><br><span class="line">        TextView tv = findViewById(R.id.sample_text);</span><br><span class="line">        <span class="comment">//tv.setText(stringFromJNI());</span></span><br><span class="line">        <span class="comment">//getStaticField();</span></span><br><span class="line">        Test testobj=<span class="keyword">new</span> Test(<span class="string">"i am from java"</span>);</span><br><span class="line">        getNonStaticField(testobj);</span><br><span class="line">        <span class="keyword">int</span>[] intarray=testobj.intarray;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;intarray.length;i++)&#123;</span><br><span class="line">            Log.i(<span class="string">"kanxue-&gt;java"</span>,i+<span class="string">"--"</span>+intarray[i]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//newObject();</span></span><br><span class="line">        <span class="comment">//testField();</span></span><br><span class="line">        <span class="comment">//testMethod();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testField</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Test a_obj = <span class="keyword">new</span> Test();</span><br><span class="line">        Test b_obj = <span class="keyword">new</span> Test(<span class="string">"test"</span>);</span><br><span class="line">        Test c_obj = <span class="keyword">new</span> Test(<span class="string">"test"</span>, <span class="number">2</span>);</span><br><span class="line">        Class testClazz = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            testClazz = MainActivity.class.getClassLoader().loadClass(<span class="string">"com.kanxue.reflectiontest.Test"</span>);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"ClassLoader.loadClass-&gt;"</span> + testClazz);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        Class testClazz2;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            testClazz2 = Class.forName(<span class="string">"com.kanxue.reflectiontest.Test"</span>);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"Class.forName-&gt;"</span> + testClazz2);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        Class testClazz3 = Test.class;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"Test.class-&gt;"</span> + testClazz);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Field publicStaticField_field = testClazz3.getDeclaredField(<span class="string">"publicStaticField"</span>);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredField-&gt;"</span> + publicStaticField_field);</span><br><span class="line">            String content = (String) publicStaticField_field.get(<span class="keyword">null</span>);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"publicStaticField-&gt;"</span> + content);</span><br><span class="line">            content = (String) publicStaticField_field.get(a_obj);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"publicStaticField-&gt;a_obj"</span> + content);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//privateField</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Field privateStaticField_field = testClazz3.getDeclaredField(<span class="string">"privateStaticField"</span>);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredField-&gt;"</span> + privateStaticField_field);</span><br><span class="line">            privateStaticField_field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            privateStaticField_field.set(<span class="keyword">null</span>, <span class="string">"modified"</span>);</span><br><span class="line">            String content = (String) privateStaticField_field.get(<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"privateStaticField_field-&gt;"</span> + content);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Field privateField_field = testClazz3.getField(<span class="string">"privateField"</span>);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getField-&gt;"</span> + privateField_field);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Error | NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        Field[] fields = testClazz3.getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span> (Field i : fields) &#123;</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredFields-&gt;"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Field[] fields_1 = testClazz3.getFields();</span><br><span class="line">        <span class="keyword">for</span> (Field i : fields_1) &#123;</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getFields-&gt;"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Class testClazz = Test.class;</span><br><span class="line">        Method publicStaticFunc_method = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            publicStaticFunc_method = testClazz.getDeclaredMethod(<span class="string">"publicStaticFunc"</span>);</span><br><span class="line">            publicStaticFunc_method.invoke(<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredMethod-&gt;"</span> + publicStaticFunc_method);</span><br><span class="line"></span><br><span class="line">        Method privateStaticFunc_method = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            privateStaticFunc_method = testClazz.getDeclaredMethod(<span class="string">"privateStaticFunc"</span>);</span><br><span class="line">            privateStaticFunc_method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            privateStaticFunc_method.invoke(<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredMethod-&gt;"</span> + privateStaticFunc_method);</span><br><span class="line"></span><br><span class="line">        Method[] methods = testClazz.getDeclaredMethods();</span><br><span class="line">        <span class="keyword">for</span> (Method i : methods) &#123;</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredMethods-&gt;"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        Method[] methods_1 = testClazz.getMethods();</span><br><span class="line">        <span class="keyword">for</span> (Method i : methods_1) &#123;</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getMethods-&gt;"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        Constructor[] constructors=testClazz.getDeclaredConstructors();</span><br><span class="line">        <span class="keyword">for</span> (Constructor i : constructors) &#123;</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredConstructors-&gt;"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Constructor constructor=testClazz.getDeclaredConstructor(String.class,<span class="keyword">int</span>.class);</span><br><span class="line">            Object testobj=constructor.newInstance(<span class="string">"test"</span>,<span class="number">666</span>);</span><br><span class="line">            Field privateField_field=testClazz.getDeclaredField(<span class="string">"privateField"</span>);</span><br><span class="line">            privateField_field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            String privateField_String= (String) privateField_field.get(testobj);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>,<span class="string">"privateField-&gt;"</span>+privateField_String);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredConstructor-&gt;"</span> + constructor);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A native method that is implemented by the 'native-lib' native library,</span></span><br><span class="line"><span class="comment">     * which is packaged with this application.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">stringFromJNI</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">stringFromJNIC</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">newObject</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">getStaticField</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">getNonStaticField</span><span class="params">(Object m)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Test-java"><a href="#Test-java" class="headerlink" title="Test.java"></a>Test.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kanxue.reflectiontest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String flag = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] intarray = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        flag = <span class="string">"Test()"</span>;</span><br><span class="line">        intarray = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            intarray[i] = i;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">(String arg)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        flag = <span class="string">"Test(String arg)"</span>;</span><br><span class="line">        intarray = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            intarray[i] = i;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">(String arg, <span class="keyword">int</span> arg2)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        flag = <span class="string">"Test(String arg,int arg2)"</span>;</span><br><span class="line">        intarray = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            intarray[i] = i;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String publicStaticField = <span class="string">"i am a publicStaticField"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> publicStaticField_int = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">public</span> String publicField = <span class="string">"i am a publicField"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String privateStaticField = <span class="string">"i am a privateStaticField"</span>;</span><br><span class="line">    <span class="keyword">private</span> String privateField = <span class="string">"i am a privateField"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> privateField_int = <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">publicStaticFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"i am from publicStaticFunc"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">publicFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"i am from publicFunc"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">privateStaticFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"i am from privateStaticFunc"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">privateFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"i am from privateStaticFunc"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="native-lib-cpp"><a href="#native-lib-cpp" class="headerlink" title="native-lib.cpp"></a>native-lib.cpp</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;android/log.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line">JavaVM *globalVM = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> JNIEXPORT jstring JNICALL</span><br><span class="line">Java_com_kanxue_reflectiontest_MainActivity_stringFromJNI(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject <span class="comment">/* this */</span>) &#123;</span><br><span class="line">    JavaVM *thisvm = <span class="literal">nullptr</span>;</span><br><span class="line">    env-&gt;GetJavaVM(&amp;thisvm);</span><br><span class="line"></span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"env-&gt;GetJavaVM(&amp;thisvm)-&gt;%p"</span>, thisvm);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>,</span><br><span class="line">                        <span class="string">"Java_com_kanxue_reflectiontest_MainActivity_stringFromJNI-&gt;%p"</span>, env);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*    jint GetVersion()</span></span><br><span class="line"><span class="comment">    &#123; return functions-&gt;GetVersion(this); &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    jclass DefineClass(const char *name, jobject loader, const jbyte* buf,</span></span><br><span class="line"><span class="comment">                       jsize bufLen)</span></span><br><span class="line"><span class="comment">    &#123; return functions-&gt;DefineClass(this, name, loader, buf, bufLen); &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    jclass FindClass(const char* name)</span></span><br><span class="line"><span class="comment">    &#123; return functions-&gt;FindClass(this, name); &#125;*/</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> hello = <span class="string">"Hello from C++"</span>;</span><br><span class="line">    <span class="comment">//publicStaticField</span></span><br><span class="line">    jclass TestJclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/Test"</span>);</span><br><span class="line">    <span class="comment">//jfieldID GetStaticFieldID(jclass clazz, const char* name, const char* sig)</span></span><br><span class="line">    jfieldID publicStaticField_jfieldID = env-&gt;GetStaticFieldID(TestJclass, <span class="string">"publicStaticField"</span>,</span><br><span class="line">                                                                <span class="string">"Ljava/lang/String;"</span>);</span><br><span class="line">    <span class="comment">//jobject GetStaticObjectField(jclass clazz, jfieldID fieldID)</span></span><br><span class="line">    jstring publicStaticField_content = (jstring) env-&gt;GetStaticObjectField(TestJclass,</span><br><span class="line">                                                                            publicStaticField_jfieldID);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *content_ptr = env-&gt;GetStringUTFChars(publicStaticField_content, <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>, content_ptr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> env-&gt;NewStringUTF(hello.c_str());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kanxue_reflectiontest_MainActivity_newObject(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject <span class="comment">/* this */</span>) &#123;</span><br><span class="line">    <span class="comment">//NewObject</span></span><br><span class="line">    jclass TestJclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/Test"</span>);</span><br><span class="line"><span class="comment">//public Test(String arg)</span></span><br><span class="line"><span class="comment">//   jmethodID GetMethodID(jclass clazz, const char* name, const char* sig)</span></span><br><span class="line">    jmethodID con_mid = env-&gt;GetMethodID(TestJclass, <span class="string">"&lt;init&gt;"</span>, <span class="string">"(Ljava/lang/String;)V"</span>);</span><br><span class="line">    jstring arg = env-&gt;NewStringUTF(<span class="string">"I am From Jni"</span>);</span><br><span class="line">    <span class="comment">//jobject NewObject(jclass clazz, jmethodID methodID, ...)</span></span><br><span class="line">    jobject testobj = env-&gt;NewObject(TestJclass, con_mid, arg);</span><br><span class="line">    <span class="keyword">if</span> (testobj != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>, <span class="string">"NewObject success!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//AllocObject</span></span><br><span class="line">    <span class="comment">//jclass clazz_str = env-&gt;FindClass("java/lang/String");</span></span><br><span class="line">    <span class="comment">//jmethodID methodID_str = env-&gt;GetMethodID(clazz_str ,"&lt;init&gt;", "()V");</span></span><br><span class="line">    jobject testobj2 = env-&gt;AllocObject(TestJclass);</span><br><span class="line">    jstring arg1 = env-&gt;NewStringUTF(<span class="string">"I am From Jni-&gt;AllocObject"</span>);</span><br><span class="line">    env-&gt;CallNonvirtualVoidMethod(testobj2, TestJclass, con_mid, arg1);</span><br><span class="line">    <span class="keyword">if</span> (testobj2 != <span class="literal">nullptr</span>) &#123;</span><br><span class="line"></span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>, <span class="string">"AllocObject success!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kanxue_reflectiontest_MainActivity_getStaticField(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject <span class="comment">/* this */</span>) &#123;</span><br><span class="line">    <span class="comment">//private static</span></span><br><span class="line">    jclass TestJclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/Test"</span>);</span><br><span class="line">    <span class="comment">//    public static String publicStaticField = "i am a publicStaticField";</span></span><br><span class="line">    <span class="comment">//  jfieldID GetStaticFieldID(jclass clazz, const char* name, const char* sig)</span></span><br><span class="line">    jfieldID publicStaticField_fid = env-&gt;GetStaticFieldID(TestJclass, <span class="string">"publicStaticField"</span>,</span><br><span class="line">                                                           <span class="string">"Ljava/lang/String;"</span>);</span><br><span class="line">    <span class="comment">/*jstring publicStaticField_obj = static_cast&lt;jstring&gt;(env-&gt;GetStaticObjectField(TestJclass,</span></span><br><span class="line"><span class="comment">                                                                                   publicStaticField_fid));</span></span><br><span class="line"><span class="comment">    const char *publicStaticField_content = env-&gt;GetStringUTFChars(publicStaticField_obj, nullptr);</span></span><br><span class="line"><span class="comment">    __android_log_print(4, "kanxue-&gt;jni", "publicStaticField_obj-&gt;%s", publicStaticField_content);*/</span></span><br><span class="line"></span><br><span class="line">    jstring setjstring = env-&gt;NewStringUTF(<span class="string">"modified by jni"</span>);</span><br><span class="line">    <span class="comment">//    void SetStaticObjectField(jclass clazz, jfieldID fieldID, jobject value)</span></span><br><span class="line">    env-&gt;SetStaticObjectField(TestJclass, publicStaticField_fid, setjstring);</span><br><span class="line">    jstring publicStaticField_obj = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;GetStaticObjectField(TestJclass,</span><br><span class="line">                                                                                   publicStaticField_fid));</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *publicStaticField_content = env-&gt;GetStringUTFChars(publicStaticField_obj, <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"publicStaticField_obj-&gt;%s"</span>, publicStaticField_content);</span><br><span class="line"></span><br><span class="line"><span class="comment">//private static String privateStaticField = "i am a privateStaticField";</span></span><br><span class="line">    jfieldID privateStaticField_fid = env-&gt;GetStaticFieldID(TestJclass, <span class="string">"privateStaticField"</span>,</span><br><span class="line">                                                            <span class="string">"Ljava/lang/String;"</span>);</span><br><span class="line">    jstring privateStaticField_obj = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;GetStaticObjectField(TestJclass,</span><br><span class="line">                                                                                    privateStaticField_fid));</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *privateStaticField_content = env-&gt;GetStringUTFChars(privateStaticField_obj,</span><br><span class="line">                                                                    <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"privateStaticField_obj-&gt;%s"</span>, privateStaticField_content);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    public static int publicStaticField_int = 100;</span></span><br><span class="line"></span><br><span class="line">    jfieldID publicStaticField_int_fid = env-&gt;GetStaticFieldID(TestJclass, <span class="string">"publicStaticField_int"</span>,</span><br><span class="line">                                                               <span class="string">"I"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    env-&gt;SetStaticIntField(TestJclass, publicStaticField_int_fid, <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">    jint publicStaticField_int_value = env-&gt;GetStaticIntField(TestJclass,</span><br><span class="line">                                                              publicStaticField_int_fid);</span><br><span class="line"></span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"publicStaticField_int_value-&gt;%d"</span>,</span><br><span class="line">                        publicStaticField_int_value);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*    jobject GetStaticObjectField(jclass clazz, jfieldID fieldID)</span></span><br><span class="line"><span class="comment">    &#123; return functions-&gt;GetStaticObjectField(this, clazz, fieldID); &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    jboolean GetStaticBooleanField(jclass clazz, jfieldID fieldID)</span></span><br><span class="line"><span class="comment">    &#123; return functions-&gt;GetStaticBooleanField(this, clazz, fieldID); &#125;</span></span><br><span class="line"><span class="comment">    jbyte GetStaticByteField(jclass clazz, jfieldID fieldID)</span></span><br><span class="line"><span class="comment">    &#123; return functions-&gt;GetStaticByteField(this, clazz, fieldID); &#125;</span></span><br><span class="line"><span class="comment">    jchar GetStaticCharField(jclass clazz, jfieldID fieldID)</span></span><br><span class="line"><span class="comment">    &#123; return functions-&gt;GetStaticCharField(this, clazz, fieldID); &#125;</span></span><br><span class="line"><span class="comment">    jshort GetStaticShortField(jclass clazz, jfieldID fieldID)</span></span><br><span class="line"><span class="comment">    &#123; return functions-&gt;GetStaticShortField(this, clazz, fieldID); &#125;</span></span><br><span class="line"><span class="comment">    jint GetStaticIntField(jclass clazz, jfieldID fieldID)</span></span><br><span class="line"><span class="comment">    &#123; return functions-&gt;GetStaticIntField(this, clazz, fieldID); &#125;</span></span><br><span class="line"><span class="comment">    jlong GetStaticLongField(jclass clazz, jfieldID fieldID)</span></span><br><span class="line"><span class="comment">    &#123; return functions-&gt;GetStaticLongField(this, clazz, fieldID); &#125;</span></span><br><span class="line"><span class="comment">    jfloat GetStaticFloatField(jclass clazz, jfieldID fieldID)</span></span><br><span class="line"><span class="comment">    &#123; return functions-&gt;GetStaticFloatField(this, clazz, fieldID); &#125;</span></span><br><span class="line"><span class="comment">    jdouble GetStaticDoubleField(jclass clazz, jfieldID fieldID)</span></span><br><span class="line"><span class="comment">    &#123; return functions-&gt;GetStaticDoubleField(this, clazz, fieldID); &#125;*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*    void SetStaticObjectField(jclass clazz, jfieldID fieldID, jobject value)</span></span><br><span class="line"><span class="comment">    &#123; functions-&gt;SetStaticObjectField(this, clazz, fieldID, value); &#125;</span></span><br><span class="line"><span class="comment">    void SetStaticBooleanField(jclass clazz, jfieldID fieldID, jboolean value)</span></span><br><span class="line"><span class="comment">    &#123; functions-&gt;SetStaticBooleanField(this, clazz, fieldID, value); &#125;</span></span><br><span class="line"><span class="comment">    void SetStaticByteField(jclass clazz, jfieldID fieldID, jbyte value)</span></span><br><span class="line"><span class="comment">    &#123; functions-&gt;SetStaticByteField(this, clazz, fieldID, value); &#125;</span></span><br><span class="line"><span class="comment">    void SetStaticCharField(jclass clazz, jfieldID fieldID, jchar value)</span></span><br><span class="line"><span class="comment">    &#123; functions-&gt;SetStaticCharField(this, clazz, fieldID, value); &#125;</span></span><br><span class="line"><span class="comment">    void SetStaticShortField(jclass clazz, jfieldID fieldID, jshort value)</span></span><br><span class="line"><span class="comment">    &#123; functions-&gt;SetStaticShortField(this, clazz, fieldID, value); &#125;</span></span><br><span class="line"><span class="comment">    void SetStaticIntField(jclass clazz, jfieldID fieldID, jint value)</span></span><br><span class="line"><span class="comment">    &#123; functions-&gt;SetStaticIntField(this, clazz, fieldID, value); &#125;</span></span><br><span class="line"><span class="comment">    void SetStaticLongField(jclass clazz, jfieldID fieldID, jlong value)</span></span><br><span class="line"><span class="comment">    &#123; functions-&gt;SetStaticLongField(this, clazz, fieldID, value); &#125;</span></span><br><span class="line"><span class="comment">    void SetStaticFloatField(jclass clazz, jfieldID fieldID, jfloat value)</span></span><br><span class="line"><span class="comment">    &#123; functions-&gt;SetStaticFloatField(this, clazz, fieldID, value); &#125;</span></span><br><span class="line"><span class="comment">    void SetStaticDoubleField(jclass clazz, jfieldID fieldID, jdouble value)</span></span><br><span class="line"><span class="comment">    &#123; functions-&gt;SetStaticDoubleField(this, clazz, fieldID, value); &#125;*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//    public native void getNonStaticField(Object m);</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kanxue_reflectiontest_MainActivity_getNonStaticField(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject obj, jobject testobj) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    private String privateField = "i am a privateField";</span></span><br><span class="line"></span><br><span class="line">    jclass TestJclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/Test"</span>);</span><br><span class="line">    jfieldID privateField_fid = env-&gt;GetFieldID(TestJclass, <span class="string">"privateField"</span>, <span class="string">"Ljava/lang/String;"</span>);</span><br><span class="line">    <span class="comment">//    jobject GetObjectField(jobject obj, jfieldID fieldID)</span></span><br><span class="line">    jstring privateField_obj = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;GetObjectField(testobj, privateField_fid));</span><br><span class="line"><span class="comment">/*    const char *privateField_obj_content = env-&gt;GetStringUTFChars(privateField_obj,</span></span><br><span class="line"><span class="comment">                                                                    nullptr);</span></span><br><span class="line"><span class="comment">    __android_log_print(4, "kanxue-&gt;jni", "privateField_obj-&gt;%s", privateField_obj_content);*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    jstring newString = env-&gt;NewStringUTF(<span class="string">"Modified by jni"</span>);</span><br><span class="line">    env-&gt;SetObjectField(testobj, privateField_fid, newString);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    privateField_obj = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;GetObjectField(testobj, privateField_fid));</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *privateField_obj_content = env-&gt;GetStringUTFChars(privateField_obj,</span><br><span class="line">                                                                  <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"privateField_obj-&gt;%s"</span>, privateField_obj_content);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*    void SetObjectField(jobject obj, jfieldID fieldID, jobject value)</span></span><br><span class="line"><span class="comment">    &#123; functions-&gt;SetObjectField(this, obj, fieldID, value); &#125;</span></span><br><span class="line"><span class="comment">    void SetBooleanField(jobject obj, jfieldID fieldID, jboolean value)</span></span><br><span class="line"><span class="comment">    &#123; functions-&gt;SetBooleanField(this, obj, fieldID, value); &#125;</span></span><br><span class="line"><span class="comment">    void SetByteField(jobject obj, jfieldID fieldID, jbyte value)</span></span><br><span class="line"><span class="comment">    &#123; functions-&gt;SetByteField(this, obj, fieldID, value); &#125;</span></span><br><span class="line"><span class="comment">    void SetCharField(jobject obj, jfieldID fieldID, jchar value)</span></span><br><span class="line"><span class="comment">    &#123; functions-&gt;SetCharField(this, obj, fieldID, value); &#125;</span></span><br><span class="line"><span class="comment">    void SetShortField(jobject obj, jfieldID fieldID, jshort value)</span></span><br><span class="line"><span class="comment">    &#123; functions-&gt;SetShortField(this, obj, fieldID, value); &#125;</span></span><br><span class="line"><span class="comment">    void SetIntField(jobject obj, jfieldID fieldID, jint value)</span></span><br><span class="line"><span class="comment">    &#123; functions-&gt;SetIntField(this, obj, fieldID, value); &#125;</span></span><br><span class="line"><span class="comment">    void SetLongField(jobject obj, jfieldID fieldID, jlong value)</span></span><br><span class="line"><span class="comment">    &#123; functions-&gt;SetLongField(this, obj, fieldID, value); &#125;</span></span><br><span class="line"><span class="comment">    void SetFloatField(jobject obj, jfieldID fieldID, jfloat value)</span></span><br><span class="line"><span class="comment">    &#123; functions-&gt;SetFloatField(this, obj, fieldID, value); &#125;</span></span><br><span class="line"><span class="comment">    void SetDoubleField(jobject obj, jfieldID fieldID, jdouble value)</span></span><br><span class="line"><span class="comment">    &#123; functions-&gt;SetDoubleField(this, obj, fieldID, value); &#125;*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//    private int privateField_int = 200;</span></span><br><span class="line"></span><br><span class="line">    jfieldID privateField_int_fid = env-&gt;GetFieldID(TestJclass, <span class="string">"privateField_int"</span>, <span class="string">"I"</span>);</span><br><span class="line"><span class="comment">/*    jint privateField_int_value = env-&gt;GetIntField(testobj, privateField_int_fid);</span></span><br><span class="line"><span class="comment">    __android_log_print(4, "kanxue-&gt;jni", "privateField_int_value-&gt;%d", privateField_int_value);*/</span></span><br><span class="line"></span><br><span class="line">    env-&gt;SetIntField(testobj, privateField_int_fid, <span class="number">300</span>);</span><br><span class="line">    jint privateField_int_value = env-&gt;GetIntField(testobj, privateField_int_fid);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"privateField_int_value-&gt;%d"</span>, privateField_int_value);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    public int[] intarray = null;</span></span><br><span class="line">    jfieldID  intarray_fid=env-&gt;GetFieldID(TestJclass,<span class="string">"intarray"</span>,<span class="string">"[I"</span>);</span><br><span class="line">    jintArray intarray_obj= <span class="keyword">static_cast</span>&lt;jintArray&gt;(env-&gt;GetObjectField(testobj, intarray_fid));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> arraylength=env-&gt;GetArrayLength(intarray_obj);</span><br><span class="line"></span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"arraylength-&gt;%d"</span>, arraylength);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*    int* array=env-&gt;GetIntArrayElements(intarray_obj, nullptr);</span></span><br><span class="line"><span class="comment">    for(int i=0;i&lt;arraylength;i++)&#123;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        __android_log_print(4, "kanxue-&gt;jni", "array[%d]-&gt;%d", i,array[i]);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    <span class="comment">//    void SetIntArrayRegion(jintArray array, jsize start, jsize len,</span></span><br><span class="line">    <span class="comment">//        const jint* buf)</span></span><br><span class="line">    jint jni_array[arraylength];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;arraylength;j++)&#123;</span><br><span class="line"></span><br><span class="line">        jni_array[j]=<span class="number">10</span>-j;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> jint* ptr=jni_array;</span><br><span class="line">    env-&gt;SetIntArrayRegion(intarray_obj,<span class="number">0</span>,arraylength,ptr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span>* <span class="built_in">array</span>=env-&gt;GetIntArrayElements(intarray_obj, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;arraylength;i++)&#123;</span><br><span class="line"></span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"array[%d]-&gt;%d"</span>, i,<span class="built_in">array</span>[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//env-&gt;SetIntArrayRegion()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">JNIEXPORT jint <span class="title">JNI_OnLoad</span><span class="params">(JavaVM *vm, <span class="keyword">void</span> *reserved)</span> </span>&#123;</span><br><span class="line">    globalVM = vm;</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"JNI_OnLoad(JavaVM *vm, void *reserved)-&gt;%p"</span>, vm);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>, <span class="string">"JNI_OnLoad is called"</span>);</span><br><span class="line">    jint result = <span class="number">0</span>;</span><br><span class="line">    JNIEnv *env = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">if</span> (vm-&gt;GetEnv((<span class="keyword">void</span> **) &amp;env, JNI_VERSION_1_6) == JNI_OK) &#123;</span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>,</span><br><span class="line">                            <span class="string">"vm-&gt;GetEnv((void**)&amp;env,JNI_VERSION_1_6) success"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    result = JNI_VERSION_1_6;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="test-c"><a href="#test-c" class="headerlink" title="test.c"></a>test.c</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by tom on 3/25/20.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;android/log.h&gt;</span></span></span><br><span class="line"><span class="comment">/*void*       reserved0;</span></span><br><span class="line"><span class="comment">void*       reserved1;</span></span><br><span class="line"><span class="comment">void*       reserved2;</span></span><br><span class="line"><span class="comment">void*       reserved3;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">jint        (*GetVersion)(JNIEnv *);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">jclass      (*DefineClass)(JNIEnv*, const char*, jobject, const jbyte*,</span></span><br><span class="line"><span class="comment">                           jsize);</span></span><br><span class="line"><span class="comment">jclass      (*FindClass)(JNIEnv*, const char*);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">jmethodID   (*FromReflectedMethod)(JNIEnv*, jobject);</span></span><br><span class="line"><span class="comment">jfieldID    (*FromReflectedField)(JNIEnv*, jobject);</span></span><br><span class="line"><span class="comment">*/</span><span class="comment">/* spec doesn't show jboolean parameter */</span><span class="comment">/*</span></span><br><span class="line"><span class="comment">jobject     (*ToReflectedMethod)(JNIEnv*, jclass, jmethodID, jboolean);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">jclass      (*GetSuperclass)(JNIEnv*, jclass);*/</span></span><br><span class="line">JNIEXPORT jstring JNICALL</span><br><span class="line">Java_com_kanxue_reflectiontest_MainActivity_stringFromJNIC(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject thisobj<span class="comment">/* this */</span>) &#123;</span><br><span class="line"><span class="comment">/*    jint GetVersion()</span></span><br><span class="line"><span class="comment">    &#123; return functions-&gt;GetVersion(this); &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    jclass DefineClass(const char *name, jobject loader, const jbyte* buf,</span></span><br><span class="line"><span class="comment">                       jsize bufLen)</span></span><br><span class="line"><span class="comment">    &#123; return functions-&gt;DefineClass(this, name, loader, buf, bufLen); &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    jclass FindClass(const char* name)</span></span><br><span class="line"><span class="comment">    &#123; return functions-&gt;FindClass(this, name); &#125;*/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* hello = <span class="string">"Hello from C"</span>;</span><br><span class="line">    <span class="comment">//publicStaticField</span></span><br><span class="line">    jclass TestJclass = (*env)-&gt;FindClass(env,<span class="string">"com/kanxue/reflectiontest/Test"</span>);</span><br><span class="line">    <span class="comment">//jfieldID GetStaticFieldID(jclass clazz, const char* name, const char* sig)</span></span><br><span class="line">    jfieldID publicStaticField_jfieldID = (*env)-&gt;GetStaticFieldID(env,TestJclass, <span class="string">"publicStaticField"</span>,</span><br><span class="line">                                                                <span class="string">"Ljava/lang/String;"</span>);</span><br><span class="line">    <span class="comment">//jobject GetStaticObjectField(jclass clazz, jfieldID fieldID)</span></span><br><span class="line">    jstring publicStaticField_content = (jstring) (*env)-&gt;GetStaticObjectField(env,TestJclass,</span><br><span class="line">                                                                            publicStaticField_jfieldID);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *content_ptr = (*env)-&gt;GetStringUTFChars(env,publicStaticField_content, <span class="literal">NULL</span>);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>, content_ptr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (*env)-&gt;NewStringUTF(env,hello);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br><br><br></p>
<h3 id="JNI访问Java类函数"><a href="#JNI访问Java类函数" class="headerlink" title="JNI访问Java类函数"></a>JNI访问Java类函数</h3><h4 id="MainActivity-java"><a href="#MainActivity-java" class="headerlink" title="MainActivity.java"></a>MainActivity.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kanxue.reflectiontest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.KeyEvent;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Used to load the 'native-lib' library on application startup.</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">"native-lib"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*    @Override</span></span><br><span class="line"><span class="comment">    protected void onCreate(Bundle savedInstanceState) &#123;</span></span><br><span class="line"><span class="comment">        super.onCreate(savedInstanceState);</span></span><br><span class="line"><span class="comment">        Log.i("kanxue","onCreate is Called!");</span></span><br><span class="line"><span class="comment">        setContentView(R.layout.activity_main);</span></span><br><span class="line"><span class="comment">        TextView tv = findViewById(R.id.sample_text);</span></span><br><span class="line"><span class="comment">        Test testobj = (Test) callInit();</span></span><br><span class="line"><span class="comment">        Log.i("kanxue", testobj.flag);</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    //</span></span><br><span class="line"><span class="comment">    // Example of a call to a native method</span></span><br><span class="line"><span class="comment">    //TextView tv = findViewById(R.id.sample_text);</span></span><br><span class="line"><span class="comment">/*        Test testobj = (Test) callInit();</span></span><br><span class="line"><span class="comment">        Log.i("kanxue", testobj.flag);*/</span></span><br><span class="line">    <span class="comment">//callStaticFunc();</span></span><br><span class="line">    <span class="comment">//callNonStaticFunc();</span></span><br><span class="line">    <span class="comment">//tv.setText(stringFromJNI());</span></span><br><span class="line">    <span class="comment">//getStaticField();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">        Test testobj=new Test("i am from java");</span></span><br><span class="line"><span class="comment">        getNonStaticField(testobj);</span></span><br><span class="line"><span class="comment">        int[] intarray=testobj.intarray;</span></span><br><span class="line"><span class="comment">        for(int i=0;i&lt;intarray.length;i++)&#123;</span></span><br><span class="line"><span class="comment">            Log.i("kanxue-&gt;java",i+"--"+intarray[i]);</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//newObject();</span></span><br><span class="line">    <span class="comment">//testField();</span></span><br><span class="line">    <span class="comment">//testMethod();</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testField</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Test a_obj = <span class="keyword">new</span> Test();</span><br><span class="line">        Test b_obj = <span class="keyword">new</span> Test(<span class="string">"test"</span>);</span><br><span class="line">        Test c_obj = <span class="keyword">new</span> Test(<span class="string">"test"</span>, <span class="number">2</span>);</span><br><span class="line">        Class testClazz = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            testClazz = MainActivity.class.getClassLoader().loadClass(<span class="string">"com.kanxue.reflectiontest.Test"</span>);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"ClassLoader.loadClass-&gt;"</span> + testClazz);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        Class testClazz2;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            testClazz2 = Class.forName(<span class="string">"com.kanxue.reflectiontest.Test"</span>);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"Class.forName-&gt;"</span> + testClazz2);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        Class testClazz3 = Test.class;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"Test.class-&gt;"</span> + testClazz);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Field publicStaticField_field = testClazz3.getDeclaredField(<span class="string">"publicStaticField"</span>);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredField-&gt;"</span> + publicStaticField_field);</span><br><span class="line">            String content = (String) publicStaticField_field.get(<span class="keyword">null</span>);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"publicStaticField-&gt;"</span> + content);</span><br><span class="line">            content = (String) publicStaticField_field.get(a_obj);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"publicStaticField-&gt;a_obj"</span> + content);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//privateField</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Field privateStaticField_field = testClazz3.getDeclaredField(<span class="string">"privateStaticField"</span>);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredField-&gt;"</span> + privateStaticField_field);</span><br><span class="line">            privateStaticField_field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            privateStaticField_field.set(<span class="keyword">null</span>, <span class="string">"modified"</span>);</span><br><span class="line">            String content = (String) privateStaticField_field.get(<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"privateStaticField_field-&gt;"</span> + content);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Field privateField_field = testClazz3.getField(<span class="string">"privateField"</span>);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getField-&gt;"</span> + privateField_field);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Error | NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        Field[] fields = testClazz3.getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span> (Field i : fields) &#123;</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredFields-&gt;"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Field[] fields_1 = testClazz3.getFields();</span><br><span class="line">        <span class="keyword">for</span> (Field i : fields_1) &#123;</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getFields-&gt;"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Class testClazz = Test.class;</span><br><span class="line">        Method publicStaticFunc_method = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            publicStaticFunc_method = testClazz.getDeclaredMethod(<span class="string">"publicStaticFunc"</span>);</span><br><span class="line">            publicStaticFunc_method.invoke(<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredMethod-&gt;"</span> + publicStaticFunc_method);</span><br><span class="line"></span><br><span class="line">        Method privateStaticFunc_method = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            privateStaticFunc_method = testClazz.getDeclaredMethod(<span class="string">"privateStaticFunc"</span>);</span><br><span class="line">            privateStaticFunc_method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            privateStaticFunc_method.invoke(<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredMethod-&gt;"</span> + privateStaticFunc_method);</span><br><span class="line"></span><br><span class="line">        Method[] methods = testClazz.getDeclaredMethods();</span><br><span class="line">        <span class="keyword">for</span> (Method i : methods) &#123;</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredMethods-&gt;"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        Method[] methods_1 = testClazz.getMethods();</span><br><span class="line">        <span class="keyword">for</span> (Method i : methods_1) &#123;</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getMethods-&gt;"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        Constructor[] constructors = testClazz.getDeclaredConstructors();</span><br><span class="line">        <span class="keyword">for</span> (Constructor i : constructors) &#123;</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredConstructors-&gt;"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Constructor constructor = testClazz.getDeclaredConstructor(String.class, <span class="keyword">int</span>.class);</span><br><span class="line">            Object testobj = constructor.newInstance(<span class="string">"test"</span>, <span class="number">666</span>);</span><br><span class="line">            Field privateField_field = testClazz.getDeclaredField(<span class="string">"privateField"</span>);</span><br><span class="line">            privateField_field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            String privateField_String = (String) privateField_field.get(testobj);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"privateField-&gt;"</span> + privateField_String);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredConstructor-&gt;"</span> + constructor);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onKeyDown</span><span class="params">(<span class="keyword">int</span> keyCode, KeyEvent event)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (keyCode == KeyEvent.KEYCODE_BACK) &#123;</span><br><span class="line">            System.exit(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onKeyDown(keyCode, event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A native method that is implemented by the 'native-lib' native library,</span></span><br><span class="line"><span class="comment">     * which is packaged with this application.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">stringFromJNI</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">stringFromJNIC</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">newObject</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">getStaticField</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> Object <span class="title">callInit</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">callStaticFunc</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">callNonStaticFunc</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">getNonStaticField</span><span class="params">(Object m)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Test-java-1"><a href="#Test-java-1" class="headerlink" title="Test.java"></a>Test.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kanxue.reflectiontest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String flag = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] intarray = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        flag = <span class="string">"Test()"</span>;</span><br><span class="line">        intarray = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            intarray[i] = i;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">(String arg)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        flag = <span class="string">"Test(String arg)"</span>;</span><br><span class="line">        intarray = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            intarray[i] = i;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">(String arg, <span class="keyword">int</span> arg2)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        flag = <span class="string">"Test(String arg,int arg2)"</span>;</span><br><span class="line">        intarray = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            intarray[i] = i;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String publicStaticField = <span class="string">"i am a publicStaticField"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> publicStaticField_int = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">public</span> String publicField = <span class="string">"i am a publicField"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String privateStaticField = <span class="string">"i am a privateStaticField"</span>;</span><br><span class="line">    <span class="keyword">private</span> String privateField = <span class="string">"i am a privateField"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> privateField_int = <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">publicStaticFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"i am from publicStaticFunc"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">publicStaticFunc_int</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"i am from publicStaticFunc_int"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">100</span>+a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">publicStaticFunc_string</span><span class="params">(String arg)</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"i am from publicStaticFunc_int"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"publicStaticFunc_string-&gt;"</span>+arg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">publicFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"i am from publicFunc"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//add</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">privatetest</span><span class="params">(<span class="keyword">int</span> a, String b)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>,<span class="string">"privatetest func is called:"</span>+a+<span class="string">"---"</span>+b);</span><br><span class="line">        <span class="keyword">return</span> b + a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">privateStaticFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"i am from privateStaticFunc"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] privateFunc_array(<span class="keyword">int</span> num) &#123;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"i am from privateStaticFunc"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> array[]=<span class="keyword">new</span> <span class="keyword">int</span>[num];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;array.length;i++)&#123;</span><br><span class="line">            array[i]=i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> array;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">privateFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"i am from privateStaticFunc"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="native-lib-cpp-1"><a href="#native-lib-cpp-1" class="headerlink" title="native-lib.cpp"></a>native-lib.cpp</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;android/log.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="comment">//protected native void onCreate(Bundle savedInstanceState);</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kanxue_reflectiontest_MainActivity_onCreate(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject thiz, jobject bundle) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*    super.onCreate(savedInstanceState);</span></span><br><span class="line"><span class="comment">    Log.i("kanxue","onCreate is Called!");</span></span><br><span class="line"><span class="comment">    setContentView(R.layout.activity_main);</span></span><br><span class="line"><span class="comment">    TextView tv = findViewById(R.id.sample_text);</span></span><br><span class="line"><span class="comment">    Test testobj = (Test) callInit();</span></span><br><span class="line"><span class="comment">    Log.i("kanxue", testobj.flag);*/</span></span><br><span class="line">    jclass AppCompatActivity_jclass1 = env-&gt;FindClass(<span class="string">"androidx/appcompat/app/AppCompatActivity"</span>);</span><br><span class="line"></span><br><span class="line">    jclass MainActivity_jclass1 = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/MainActivity"</span>);</span><br><span class="line"></span><br><span class="line">    jclass MainActivity_jclass2 = env-&gt;GetObjectClass(thiz);</span><br><span class="line"></span><br><span class="line">    jclass AppCompatActivity_jclass2 = env-&gt;GetSuperclass(MainActivity_jclass2);</span><br><span class="line"></span><br><span class="line">    jmethodID superClassOnCreate_mid = env-&gt;GetMethodID(AppCompatActivity_jclass2, <span class="string">"onCreate"</span>,</span><br><span class="line">                                                        <span class="string">"(Landroid/os/Bundle;)V"</span>);</span><br><span class="line"></span><br><span class="line">    env-&gt;CallNonvirtualVoidMethod(thiz, AppCompatActivity_jclass2, superClassOnCreate_mid, bundle);</span><br><span class="line">    jstring arg1 = env-&gt;NewStringUTF(<span class="string">"kanxue"</span>);</span><br><span class="line">    jstring arg2 = env-&gt;NewStringUTF(<span class="string">"native onCreate is called!"</span>);</span><br><span class="line">    jclass Logjclass = env-&gt;FindClass(<span class="string">"android/util/Log"</span>);</span><br><span class="line">    jmethodID Log_i_mid = env-&gt;GetStaticMethodID(Logjclass, <span class="string">"i"</span>,</span><br><span class="line">                                                 <span class="string">"(Ljava/lang/String;Ljava/lang/String;)I"</span>);</span><br><span class="line"></span><br><span class="line">    jint result0 = env-&gt;CallStaticIntMethod(Logjclass, Log_i_mid, arg1, arg2);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>,</span><br><span class="line">                        <span class="string">"jint result0=env-&gt;CallStaticIntMethod(Logjclass,Log_i_mid,arg1,arg2);-&gt;%d"</span>,</span><br><span class="line">                        result0);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kanxue_reflectiontest_MainActivity_callNonStaticFunc(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject obj<span class="comment">/* this */</span>) &#123;</span><br><span class="line"></span><br><span class="line">    jclass TestJclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/Test"</span>);</span><br><span class="line"></span><br><span class="line">    jmethodID con_mid = env-&gt;GetMethodID(TestJclass, <span class="string">"&lt;init&gt;"</span>, <span class="string">"(Ljava/lang/String;I)V"</span>);</span><br><span class="line"></span><br><span class="line">    jstring arg0 = env-&gt;NewStringUTF(<span class="string">"i am from callInit"</span>);</span><br><span class="line"></span><br><span class="line">    jobject testobj = env-&gt;NewObject(TestJclass, con_mid, arg0, <span class="number">100</span>);</span><br><span class="line">    jmethodID publicFunc_mid = env-&gt;GetMethodID(TestJclass, <span class="string">"publicFunc"</span>, <span class="string">"()V"</span>);</span><br><span class="line">    env-&gt;CallVoidMethod(testobj, publicFunc_mid);</span><br><span class="line">    jmethodID privatetest = env-&gt;GetMethodID(TestJclass, <span class="string">"privatetest"</span>,</span><br><span class="line">                                             <span class="string">"(ILjava/lang/String;)Ljava/lang/String;"</span>);</span><br><span class="line"></span><br><span class="line">    jstring arg1 = env-&gt;NewStringUTF(<span class="string">"i am from jni"</span>);</span><br><span class="line"></span><br><span class="line">    jvalue args[<span class="number">2</span>];</span><br><span class="line">    args[<span class="number">0</span>].i = <span class="number">200</span>;</span><br><span class="line">    args[<span class="number">1</span>].l = arg1;</span><br><span class="line">    jstring result_obj = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;CallObjectMethodA(testobj, privatetest, args));</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *result_ptr = env-&gt;GetStringUTFChars(result_obj, <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"privatetest-&gt;%s"</span>, result_ptr);</span><br><span class="line"></span><br><span class="line">    jmethodID privateFunc_array_mid = env-&gt;GetMethodID(TestJclass, <span class="string">"privateFunc_array"</span>, <span class="string">"(I)[I"</span>);</span><br><span class="line"></span><br><span class="line">    jintArray array_obj = <span class="keyword">static_cast</span>&lt;jintArray&gt;(env-&gt;CallObjectMethod(testobj,</span><br><span class="line">                                                                       privateFunc_array_mid, <span class="number">100</span>));</span><br><span class="line"></span><br><span class="line">    jint *array_ptr = env-&gt;GetIntArrayElements(array_obj, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; env-&gt;GetArrayLength(array_obj); i++) &#123;</span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"array[%d]-&gt;%d"</span>, i, array_ptr[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kanxue_reflectiontest_MainActivity_callStaticFunc(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject <span class="comment">/* this */</span>) &#123;</span><br><span class="line">    <span class="comment">//public static void publicStaticFunc()</span></span><br><span class="line"></span><br><span class="line">    jclass TestJclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/Test"</span>);</span><br><span class="line"></span><br><span class="line">    jmethodID publicStaticFunc_mid = env-&gt;GetStaticMethodID(TestJclass, <span class="string">"publicStaticFunc"</span>, <span class="string">"()V"</span>);</span><br><span class="line"></span><br><span class="line">    env-&gt;CallStaticVoidMethod(TestJclass, publicStaticFunc_mid);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//private static void privateStaticFunc()</span></span><br><span class="line"></span><br><span class="line">    jmethodID privateStaticFunc_mid = env-&gt;GetStaticMethodID(TestJclass, <span class="string">"privateStaticFunc"</span>,</span><br><span class="line">                                                             <span class="string">"()V"</span>);</span><br><span class="line"></span><br><span class="line">    env-&gt;CallStaticVoidMethod(TestJclass, privateStaticFunc_mid);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*    public static int publicStaticFunc_int(int a) &#123;</span></span><br><span class="line"><span class="comment">        Log.i("kanxue", "i am from publicStaticFunc_int");</span></span><br><span class="line"><span class="comment">        return 100+a;</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    jmethodID publicStaticFunc_int_mid = env-&gt;GetStaticMethodID(TestJclass, <span class="string">"publicStaticFunc_int"</span>,</span><br><span class="line">                                                                <span class="string">"(I)I"</span>);</span><br><span class="line"></span><br><span class="line">    jint result_int = env-&gt;CallStaticIntMethod(TestJclass, publicStaticFunc_int_mid, <span class="number">200</span>);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"publicStaticFunc_int-&gt;%d"</span>, result_int);</span><br><span class="line">    <span class="comment">/*public static String publicStaticFunc_string(String arg) &#123;</span></span><br><span class="line"><span class="comment">        Log.i("kanxue", "i am from publicStaticFunc_int");</span></span><br><span class="line"><span class="comment">        return "publicStaticFunc_string-&gt;"+arg;</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    jmethodID publicStaticFunc_string_mid = env-&gt;GetStaticMethodID(TestJclass,</span><br><span class="line">                                                                   <span class="string">"publicStaticFunc_string"</span>,</span><br><span class="line">                                                                   <span class="string">"(Ljava/lang/String;)Ljava/lang/String;"</span>);</span><br><span class="line"></span><br><span class="line">    jstring arg_string = env-&gt;NewStringUTF(<span class="string">"i am from jni"</span>);</span><br><span class="line">    jstring result_string = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;CallStaticObjectMethod(TestJclass,</span><br><span class="line">                                                                             publicStaticFunc_string_mid,</span><br><span class="line">                                                                             arg_string));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *content = env-&gt;GetStringUTFChars(result_string, <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"publicStaticFunc_string-&gt;%s"</span>, content);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> JNIEXPORT jobject JNICALL</span><br><span class="line">Java_com_kanxue_reflectiontest_MainActivity_callInit(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject <span class="comment">/* this */</span>) &#123;</span><br><span class="line"></span><br><span class="line">    jclass TestJclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/Test"</span>);</span><br><span class="line"></span><br><span class="line">    jmethodID con_mid = env-&gt;GetMethodID(TestJclass, <span class="string">"&lt;init&gt;"</span>, <span class="string">"(Ljava/lang/String;I)V"</span>);</span><br><span class="line"></span><br><span class="line">    jstring arg0 = env-&gt;NewStringUTF(<span class="string">"i am from callInit"</span>);</span><br><span class="line"></span><br><span class="line">    jobject obj = env-&gt;NewObject(TestJclass, con_mid, arg0, <span class="number">100</span>);</span><br><span class="line">    jmethodID privatetest_mid = env-&gt;GetMethodID(TestJclass, <span class="string">"privatetest"</span>,</span><br><span class="line">                                                 <span class="string">"(ILjava/lang/String;)Ljava/lang/String;"</span>);</span><br><span class="line">    jstring arg2 = env-&gt;NewStringUTF(<span class="string">"i am from jni-CallObjectMethodA"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> JNIEXPORT jstring JNICALL</span><br><span class="line">Java_com_kanxue_reflectiontest_MainActivity_stringFromJNI(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject <span class="comment">/* this */</span>) &#123;</span><br><span class="line">    JavaVM *thisvm = <span class="literal">nullptr</span>;</span><br><span class="line">    env-&gt;GetJavaVM(&amp;thisvm);</span><br><span class="line"></span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"env-&gt;GetJavaVM(&amp;thisvm)-&gt;%p"</span>, thisvm);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>,</span><br><span class="line">                        <span class="string">"Java_com_kanxue_reflectiontest_MainActivity_stringFromJNI-&gt;%p"</span>, env);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> hello = <span class="string">"Hello from C++"</span>;</span><br><span class="line">    jclass TestJclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/Test"</span>);</span><br><span class="line">    jfieldID publicStaticField_jfieldID = env-&gt;GetStaticFieldID(TestJclass, <span class="string">"publicStaticField"</span>,</span><br><span class="line">                                                                <span class="string">"Ljava/lang/String;"</span>);</span><br><span class="line">    jstring publicStaticField_content = (jstring) env-&gt;GetStaticObjectField(TestJclass,</span><br><span class="line">                                                                            publicStaticField_jfieldID);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *content_ptr = env-&gt;GetStringUTFChars(publicStaticField_content, <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>, content_ptr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> env-&gt;NewStringUTF(hello.c_str());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">newObject</span><span class="params">(JNIEnv *env, jobject obj)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kanxue_reflectiontest_MainActivity_newObject(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject <span class="comment">/* this */</span>) &#123;</span><br><span class="line">    <span class="comment">//NewObject</span></span><br><span class="line">    jclass TestJclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/Test"</span>);</span><br><span class="line">    jmethodID con_mid = env-&gt;GetMethodID(TestJclass, <span class="string">"&lt;init&gt;"</span>, <span class="string">"(Ljava/lang/String;)V"</span>);</span><br><span class="line">    jstring arg = env-&gt;NewStringUTF(<span class="string">"I am From Jni"</span>);</span><br><span class="line">    jobject testobj = env-&gt;NewObject(TestJclass, con_mid, arg);</span><br><span class="line">    <span class="keyword">if</span> (testobj != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>, <span class="string">"NewObject success!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//AllocObject</span></span><br><span class="line">    jobject testobj2 = env-&gt;AllocObject(TestJclass);</span><br><span class="line">    jstring arg1 = env-&gt;NewStringUTF(<span class="string">"I am From Jni-&gt;AllocObject"</span>);</span><br><span class="line">    env-&gt;CallNonvirtualVoidMethod(testobj2, TestJclass, con_mid, arg1);</span><br><span class="line">    <span class="keyword">if</span> (testobj2 != <span class="literal">nullptr</span>) &#123;</span><br><span class="line"></span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>, <span class="string">"AllocObject success!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    jmethodID privatetest_mid = env-&gt;GetMethodID(TestJclass, <span class="string">"privatetest"</span>,</span><br><span class="line">                                                 <span class="string">"(ILjava/lang/String;)Ljava/lang/String;"</span>);</span><br><span class="line">    jstring arg2 = env-&gt;NewStringUTF(<span class="string">"i am from jni"</span>);</span><br><span class="line">    jobject result = env-&gt;CallObjectMethod(testobj2, privatetest_mid, <span class="number">100</span>, arg2);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kanxue_reflectiontest_MainActivity_getStaticField(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject <span class="comment">/* this */</span>) &#123;</span><br><span class="line">    <span class="comment">//private static</span></span><br><span class="line">    jclass TestJclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/Test"</span>);</span><br><span class="line">    <span class="comment">//    public static String publicStaticField = "i am a publicStaticField";</span></span><br><span class="line">    <span class="comment">//  jfieldID GetStaticFieldID(jclass clazz, const char* name, const char* sig)</span></span><br><span class="line">    jfieldID publicStaticField_fid = env-&gt;GetStaticFieldID(TestJclass, <span class="string">"publicStaticField"</span>,</span><br><span class="line">                                                           <span class="string">"Ljava/lang/String;"</span>);</span><br><span class="line">    <span class="comment">/*jstring publicStaticField_obj = static_cast&lt;jstring&gt;(env-&gt;GetStaticObjectField(TestJclass,</span></span><br><span class="line"><span class="comment">                                                                                   publicStaticField_fid));</span></span><br><span class="line"><span class="comment">    const char *publicStaticField_content = env-&gt;GetStringUTFChars(publicStaticField_obj, nullptr);</span></span><br><span class="line"><span class="comment">    __android_log_print(4, "kanxue-&gt;jni", "publicStaticField_obj-&gt;%s", publicStaticField_content);*/</span></span><br><span class="line"></span><br><span class="line">    jstring setjstring = env-&gt;NewStringUTF(<span class="string">"modified by jni"</span>);</span><br><span class="line">    <span class="comment">//    void SetStaticObjectField(jclass clazz, jfieldID fieldID, jobject value)</span></span><br><span class="line">    env-&gt;SetStaticObjectField(TestJclass, publicStaticField_fid, setjstring);</span><br><span class="line">    jstring publicStaticField_obj = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;GetStaticObjectField(TestJclass,</span><br><span class="line">                                                                                   publicStaticField_fid));</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *publicStaticField_content = env-&gt;GetStringUTFChars(publicStaticField_obj, <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"publicStaticField_obj-&gt;%s"</span>, publicStaticField_content);</span><br><span class="line"></span><br><span class="line"><span class="comment">//private static String privateStaticField = "i am a privateStaticField";</span></span><br><span class="line">    jfieldID privateStaticField_fid = env-&gt;GetStaticFieldID(TestJclass, <span class="string">"privateStaticField"</span>,</span><br><span class="line">                                                            <span class="string">"Ljava/lang/String;"</span>);</span><br><span class="line">    jstring privateStaticField_obj = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;GetStaticObjectField(TestJclass,</span><br><span class="line">                                                                                    privateStaticField_fid));</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *privateStaticField_content = env-&gt;GetStringUTFChars(privateStaticField_obj,</span><br><span class="line">                                                                    <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"privateStaticField_obj-&gt;%s"</span>, privateStaticField_content);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    public static int publicStaticField_int = 100;</span></span><br><span class="line"></span><br><span class="line">    jfieldID publicStaticField_int_fid = env-&gt;GetStaticFieldID(TestJclass, <span class="string">"publicStaticField_int"</span>,</span><br><span class="line">                                                               <span class="string">"I"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    env-&gt;SetStaticIntField(TestJclass, publicStaticField_int_fid, <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">    jint publicStaticField_int_value = env-&gt;GetStaticIntField(TestJclass,</span><br><span class="line">                                                              publicStaticField_int_fid);</span><br><span class="line"></span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"publicStaticField_int_value-&gt;%d"</span>,</span><br><span class="line">                        publicStaticField_int_value);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kanxue_reflectiontest_MainActivity_getNonStaticField(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jclass obj, jobject testobj) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    private String privateField = "i am a privateField";</span></span><br><span class="line"></span><br><span class="line">    jclass TestJclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/Test"</span>);</span><br><span class="line">    jfieldID privateField_fid = env-&gt;GetFieldID(TestJclass, <span class="string">"privateField"</span>, <span class="string">"Ljava/lang/String;"</span>);</span><br><span class="line">    <span class="comment">//    jobject GetObjectField(jobject obj, jfieldID fieldID)</span></span><br><span class="line">    jstring privateField_obj = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;GetObjectField(testobj, privateField_fid));</span><br><span class="line"></span><br><span class="line">    jstring newString = env-&gt;NewStringUTF(<span class="string">"Modified by jni"</span>);</span><br><span class="line">    env-&gt;SetObjectField(testobj, privateField_fid, newString);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    privateField_obj = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;GetObjectField(testobj, privateField_fid));</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *privateField_obj_content = env-&gt;GetStringUTFChars(privateField_obj,</span><br><span class="line">                                                                  <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"privateField_obj-&gt;%s"</span>, privateField_obj_content);</span><br><span class="line">    jfieldID privateField_int_fid = env-&gt;GetFieldID(TestJclass, <span class="string">"privateField_int"</span>, <span class="string">"I"</span>);</span><br><span class="line">    env-&gt;SetIntField(testobj, privateField_int_fid, <span class="number">300</span>);</span><br><span class="line">    jint privateField_int_value = env-&gt;GetIntField(testobj, privateField_int_fid);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"privateField_int_value-&gt;%d"</span>, privateField_int_value);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    public int[] intarray = null;</span></span><br><span class="line">    jfieldID intarray_fid = env-&gt;GetFieldID(TestJclass, <span class="string">"intarray"</span>, <span class="string">"[I"</span>);</span><br><span class="line">    jintArray intarray_obj = <span class="keyword">static_cast</span>&lt;jintArray&gt;(env-&gt;GetObjectField(testobj, intarray_fid));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> arraylength = env-&gt;GetArrayLength(intarray_obj);</span><br><span class="line"></span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"arraylength-&gt;%d"</span>, arraylength);</span><br><span class="line">    jint jni_array[arraylength];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; arraylength; j++) &#123;</span><br><span class="line"></span><br><span class="line">        jni_array[j] = <span class="number">10</span> - j;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> jint *ptr = jni_array;</span><br><span class="line">    env-&gt;SetIntArrayRegion(intarray_obj, <span class="number">0</span>, arraylength, ptr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> *<span class="built_in">array</span> = env-&gt;GetIntArrayElements(intarray_obj, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arraylength; i++) &#123;</span><br><span class="line"></span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"array[%d]-&gt;%d"</span>, i, <span class="built_in">array</span>[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">JNIEXPORT jint <span class="title">JNI_OnLoad</span><span class="params">(JavaVM *vm, <span class="keyword">void</span> *reserved)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"JNI_OnLoad(JavaVM *vm, void *reserved)-&gt;%p"</span>, vm);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>, <span class="string">"JNI_OnLoad is called"</span>);</span><br><span class="line">    JNIEnv *env = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">if</span> (vm-&gt;GetEnv((<span class="keyword">void</span> **) &amp;env, JNI_VERSION_1_6) == JNI_OK) &#123;</span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>,</span><br><span class="line">                            <span class="string">"vm-&gt;GetEnv((void**)&amp;env,JNI_VERSION_1_6) success"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    result = JNI_VERSION_1_6;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="test-c-1"><a href="#test-c-1" class="headerlink" title="test.c"></a>test.c</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by tom on 3/25/20.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;android/log.h&gt;</span></span></span><br><span class="line"><span class="comment">/*void*       reserved0;</span></span><br><span class="line"><span class="comment">void*       reserved1;</span></span><br><span class="line"><span class="comment">void*       reserved2;</span></span><br><span class="line"><span class="comment">void*       reserved3;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">jint        (*GetVersion)(JNIEnv *);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">jclass      (*DefineClass)(JNIEnv*, const char*, jobject, const jbyte*,</span></span><br><span class="line"><span class="comment">                           jsize);</span></span><br><span class="line"><span class="comment">jclass      (*FindClass)(JNIEnv*, const char*);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">jmethodID   (*FromReflectedMethod)(JNIEnv*, jobject);</span></span><br><span class="line"><span class="comment">jfieldID    (*FromReflectedField)(JNIEnv*, jobject);</span></span><br><span class="line"><span class="comment">*/</span><span class="comment">/* spec doesn't show jboolean parameter */</span><span class="comment">/*</span></span><br><span class="line"><span class="comment">jobject     (*ToReflectedMethod)(JNIEnv*, jclass, jmethodID, jboolean);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">jclass      (*GetSuperclass)(JNIEnv*, jclass);*/</span></span><br><span class="line">JNIEXPORT jstring JNICALL</span><br><span class="line">Java_com_kanxue_reflectiontest_MainActivity_stringFromJNIC(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject thisobj<span class="comment">/* this */</span>) &#123;</span><br><span class="line"><span class="comment">/*    jint GetVersion()</span></span><br><span class="line"><span class="comment">    &#123; return functions-&gt;GetVersion(this); &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    jclass DefineClass(const char *name, jobject loader, const jbyte* buf,</span></span><br><span class="line"><span class="comment">                       jsize bufLen)</span></span><br><span class="line"><span class="comment">    &#123; return functions-&gt;DefineClass(this, name, loader, buf, bufLen); &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    jclass FindClass(const char* name)</span></span><br><span class="line"><span class="comment">    &#123; return functions-&gt;FindClass(this, name); &#125;*/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* hello = <span class="string">"Hello from C"</span>;</span><br><span class="line">    <span class="comment">//publicStaticField</span></span><br><span class="line">    jclass TestJclass = (*env)-&gt;FindClass(env,<span class="string">"com/kanxue/reflectiontest/Test"</span>);</span><br><span class="line">    <span class="comment">//jfieldID GetStaticFieldID(jclass clazz, const char* name, const char* sig)</span></span><br><span class="line">    jfieldID publicStaticField_jfieldID = (*env)-&gt;GetStaticFieldID(env,TestJclass, <span class="string">"publicStaticField"</span>,</span><br><span class="line">                                                                <span class="string">"Ljava/lang/String;"</span>);</span><br><span class="line">    <span class="comment">//jobject GetStaticObjectField(jclass clazz, jfieldID fieldID)</span></span><br><span class="line">    jstring publicStaticField_content = (jstring) (*env)-&gt;GetStaticObjectField(env,TestJclass,</span><br><span class="line">                                                                            publicStaticField_jfieldID);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *content_ptr = (*env)-&gt;GetStringUTFChars(env,publicStaticField_content, <span class="literal">NULL</span>);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>, content_ptr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (*env)-&gt;NewStringUTF(env,hello);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br><br><br></p>
<h2 id="全局引用、局部引用、弱全局引用"><a href="#全局引用、局部引用、弱全局引用" class="headerlink" title="全局引用、局部引用、弱全局引用"></a>全局引用、局部引用、弱全局引用</h2><p>NDK内存管理:全局引用、局部引用、弱全局引用</p>
<p>Java当中的内存管理:透明的, 当新建类的实例时, 值需要在创建完这个类的实例之后, 拿着这个引用访问它的所有数据成员了(属性、方法)就可以了,事实上对于Java来说, 有一个垃圾回收器线程即GC线程负责将一些不再使用的对象回收</p>
<p>C/C++当中的内存管理,需要编码人员自己进行内存管理, 如在C++中new一个对象, 使用完了还要做一次delete操作, malloc一次同样也要调用free来释放相应的内存, 否则就会有内存泄漏 </p>
<h3 id="三种引用简介和区别"><a href="#三种引用简介和区别" class="headerlink" title="三种引用简介和区别"></a>三种引用简介和区别</h3><ul>
<li>局部引用:通过NewLocalRef和各种JNI接口创建(FindClass、NewOBject、GetOBjectClass和NewCharArray等)【哪怕用了全局变量指针也是局部引用】,会阻止GC回收所引用的对象, 局部引用只能在当前函数中使用, 函数返回后局部引用所引用的对象会被JVM自动释放, 或者调用DeleteLocalRef手动释放, 因此局部引用不能跨函数调用, 不能跨线程使用</li>
<li><p>全局引用:调用NewGlobalRef基于局部引用创建,会阻GC回收所引用的对象, 全局引用可以跨函数、跨线程使用。Art不会自动释放, 必须调用DeleteGlobalRef手动释放DeleteGlobalRef(g_cls_string),否则会出现内存泄露</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数内创建出来</span></span><br><span class="line">jclass tmpjclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/Test"</span>);</span><br><span class="line">   testjclass = <span class="keyword">static_cast</span>&lt;jclass&gt;(env-&gt;NewGlobalRef(tmpjclass));</span><br><span class="line">   <span class="comment">// 在其他函数或者其他线程内部手动释放掉</span></span><br><span class="line">   env-&gt;DeleteGlobalRef(testjclass);</span><br></pre></td></tr></table></figure>
</li>
<li><p>弱全局引用: 调用NewWeakGLoablRef基于内部引用或全局引用创建,不会阻止GC回收所引用的对象, 可以跨方法、跨线程使用,但是与全局引用很重要不同的一点是, 弱引用不会组织GC回收它引用的对象, 但是引用也不会自动释放, 在ART认为应该回收它的时候(比如内存紧张的时候)进行回收而被释放, 或调用DeleteWeakGlobalRef手动释放</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jclass tmpjclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/Test"</span>);</span><br><span class="line">   testjclass = <span class="keyword">static_cast</span>&lt;jclass&gt;(env-&gt;NewWeakGlobalRef(tmpjclass));</span><br><span class="line">   env-&gt;DeleteWeakGlobalRef(testjclass);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="局部引用表"><a href="#局部引用表" class="headerlink" title="局部引用表"></a>局部引用表</h3><p>局部引用表并不是无限的, 一般在JNI函数调用结束后, art会释放这个引用<br>但是如果函数里面有大量的JNI循环调用Java函数, 那么因为局部引用太多而出现异常情况 </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2048</span>; i++) &#123;</span><br><span class="line">   jstring content = env-&gt;NewStringUTF(<span class="string">"test localreference"</span>);</span><br><span class="line">   __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"localreference number-&gt;%d"</span>,</span><br><span class="line">                       i);</span><br><span class="line">   <span class="comment">//如果想正常使用,每次使用完就必须delete掉</span></span><br><span class="line">   <span class="comment">//env-&gt;DeleteLocalRef(content);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>6.0的系统局部引用表最大512,会出现溢出的错误</p>
<h3 id="局部引用的管理"><a href="#局部引用的管理" class="headerlink" title="局部引用的管理"></a>局部引用的管理</h3><ul>
<li>函数返回时自动释放</li>
<li>手动调用DeleteLocalRef释放</li>
<li>使用JNI提供的一系列函数来管理局部引用的生命周期 </li>
</ul>
<p>JNI提供了一些函数来管理局部引用的生命周期</p>
<ul>
<li>EnsureLocalCapacity:如果需要创建更多的引用,可以通过调用EnsureLocalCapacity确保当前线程创建指定数量的局部引用,如果创建成功返回0,失败则抛出OutOfMemoryError异常</li>
<li>NewLocalRef</li>
<li>DeleteLocalRef</li>
<li>PushLocalFrame</li>
<li>PopLocalFrame<br>  Push和Pop是局部引用创建一个引用堆栈和销毁栈中所有引用,因此不需要在关注获取一个引用后再调用DeleteLocalRef来释放引用,在调用PopLocalFrame销毁当前frame中的所用引用前,如果第二个参数result不为空, 会由result生成一个新的局部引用,再把这个新生成的局部引用存储在上一个frame中</li>
</ul>
<h3 id="MainActivity-java-1"><a href="#MainActivity-java-1" class="headerlink" title="MainActivity.java"></a>MainActivity.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kanxue.reflectiontest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.KeyEvent;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Used to load the 'native-lib' library on application startup.</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">"native-lib"</span>);</span><br><span class="line">        <span class="comment">//System.load("/data/data/xxxx/test.so");</span></span><br><span class="line">        Test testobj = <span class="keyword">new</span> Test();</span><br><span class="line">        getNonStaticField(testobj);</span><br><span class="line">        <span class="comment">//System.load("");</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*    @Override</span></span><br><span class="line"><span class="comment">    protected void onCreate(Bundle savedInstanceState) &#123;</span></span><br><span class="line"><span class="comment">        super.onCreate(savedInstanceState);</span></span><br><span class="line"><span class="comment">        Log.i("kanxue","onCreate is Called!");</span></span><br><span class="line"><span class="comment">        setContentView(R.layout.activity_main);</span></span><br><span class="line"><span class="comment">        TextView tv = findViewById(R.id.sample_text);</span></span><br><span class="line"><span class="comment">        Test testobj = (Test) callInit();</span></span><br><span class="line"><span class="comment">        Log.i("kanxue", testobj.flag);</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    //</span></span><br><span class="line"><span class="comment">    // Example of a call to a native method</span></span><br><span class="line"><span class="comment">    //TextView tv = findViewById(R.id.sample_text);</span></span><br><span class="line"><span class="comment">/*        Test testobj = (Test) callInit();</span></span><br><span class="line"><span class="comment">        Log.i("kanxue", testobj.flag);*/</span></span><br><span class="line">    <span class="comment">//callStaticFunc();</span></span><br><span class="line">    <span class="comment">//callNonStaticFunc();</span></span><br><span class="line">    <span class="comment">//tv.setText(stringFromJNI());</span></span><br><span class="line">    <span class="comment">//getStaticField();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">        Test testobj=new Test("i am from java");</span></span><br><span class="line"><span class="comment">        getNonStaticField(testobj);</span></span><br><span class="line"><span class="comment">        int[] intarray=testobj.intarray;</span></span><br><span class="line"><span class="comment">        for(int i=0;i&lt;intarray.length;i++)&#123;</span></span><br><span class="line"><span class="comment">            Log.i("kanxue-&gt;java",i+"--"+intarray[i]);</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//newObject();</span></span><br><span class="line">    <span class="comment">//testField();</span></span><br><span class="line">    <span class="comment">//testMethod();</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testField</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Test a_obj = <span class="keyword">new</span> Test();</span><br><span class="line">        Test b_obj = <span class="keyword">new</span> Test(<span class="string">"test"</span>);</span><br><span class="line">        Test c_obj = <span class="keyword">new</span> Test(<span class="string">"test"</span>, <span class="number">2</span>);</span><br><span class="line">        Class testClazz = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            testClazz = MainActivity.class.getClassLoader().loadClass(<span class="string">"com.kanxue.reflectiontest.Test"</span>);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"ClassLoader.loadClass-&gt;"</span> + testClazz);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        Class testClazz2;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            testClazz2 = Class.forName(<span class="string">"com.kanxue.reflectiontest.Test"</span>);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"Class.forName-&gt;"</span> + testClazz2);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        Class testClazz3 = Test.class;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"Test.class-&gt;"</span> + testClazz);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Field publicStaticField_field = testClazz3.getDeclaredField(<span class="string">"publicStaticField"</span>);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredField-&gt;"</span> + publicStaticField_field);</span><br><span class="line">            String content = (String) publicStaticField_field.get(<span class="keyword">null</span>);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"publicStaticField-&gt;"</span> + content);</span><br><span class="line">            content = (String) publicStaticField_field.get(a_obj);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"publicStaticField-&gt;a_obj"</span> + content);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//privateField</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Field privateStaticField_field = testClazz3.getDeclaredField(<span class="string">"privateStaticField"</span>);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredField-&gt;"</span> + privateStaticField_field);</span><br><span class="line">            privateStaticField_field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            privateStaticField_field.set(<span class="keyword">null</span>, <span class="string">"modified"</span>);</span><br><span class="line">            String content = (String) privateStaticField_field.get(<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"privateStaticField_field-&gt;"</span> + content);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Field privateField_field = testClazz3.getField(<span class="string">"privateField"</span>);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getField-&gt;"</span> + privateField_field);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Error | NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        Field[] fields = testClazz3.getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span> (Field i : fields) &#123;</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredFields-&gt;"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Field[] fields_1 = testClazz3.getFields();</span><br><span class="line">        <span class="keyword">for</span> (Field i : fields_1) &#123;</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getFields-&gt;"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Class testClazz = Test.class;</span><br><span class="line">        Method publicStaticFunc_method = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            publicStaticFunc_method = testClazz.getDeclaredMethod(<span class="string">"publicStaticFunc"</span>);</span><br><span class="line">            publicStaticFunc_method.invoke(<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredMethod-&gt;"</span> + publicStaticFunc_method);</span><br><span class="line"></span><br><span class="line">        Method privateStaticFunc_method = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            privateStaticFunc_method = testClazz.getDeclaredMethod(<span class="string">"privateStaticFunc"</span>);</span><br><span class="line">            privateStaticFunc_method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            privateStaticFunc_method.invoke(<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredMethod-&gt;"</span> + privateStaticFunc_method);</span><br><span class="line"></span><br><span class="line">        Method[] methods = testClazz.getDeclaredMethods();</span><br><span class="line">        <span class="keyword">for</span> (Method i : methods) &#123;</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredMethods-&gt;"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        Method[] methods_1 = testClazz.getMethods();</span><br><span class="line">        <span class="keyword">for</span> (Method i : methods_1) &#123;</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getMethods-&gt;"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        Constructor[] constructors = testClazz.getDeclaredConstructors();</span><br><span class="line">        <span class="keyword">for</span> (Constructor i : constructors) &#123;</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredConstructors-&gt;"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Constructor constructor = testClazz.getDeclaredConstructor(String.class, <span class="keyword">int</span>.class);</span><br><span class="line">            Object testobj = constructor.newInstance(<span class="string">"test"</span>, <span class="number">666</span>);</span><br><span class="line">            Field privateField_field = testClazz.getDeclaredField(<span class="string">"privateField"</span>);</span><br><span class="line">            privateField_field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            String privateField_String = (String) privateField_field.get(testobj);</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"privateField-&gt;"</span> + privateField_String);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>, <span class="string">"getDeclaredConstructor-&gt;"</span> + constructor);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onKeyDown</span><span class="params">(<span class="keyword">int</span> keyCode, KeyEvent event)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (keyCode == KeyEvent.KEYCODE_BACK) &#123;</span><br><span class="line">            System.exit(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onKeyDown(keyCode, event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A native method that is implemented by the 'native-lib' native library,</span></span><br><span class="line"><span class="comment">     * which is packaged with this application.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">stringFromJNI</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">stringFromJNIC</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">newObject</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">getStaticField</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> Object <span class="title">callInit</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">callStaticFunc</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">callNonStaticFunc</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">getNonStaticField</span><span class="params">(Object m)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Test-java-2"><a href="#Test-java-2" class="headerlink" title="Test.java"></a>Test.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kanxue.reflectiontest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String flag = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] intarray = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        flag = <span class="string">"Test()"</span>;</span><br><span class="line">        intarray = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            intarray[i] = i;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">(String arg)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        flag = <span class="string">"Test(String arg)"</span>;</span><br><span class="line">        intarray = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            intarray[i] = i;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">(String arg, <span class="keyword">int</span> arg2)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        flag = <span class="string">"Test(String arg,int arg2)"</span>;</span><br><span class="line">        intarray = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            intarray[i] = i;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String publicStaticField = <span class="string">"i am a publicStaticField"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> publicStaticField_int = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">public</span> String publicField = <span class="string">"i am a publicField"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String privateStaticField = <span class="string">"i am a privateStaticField"</span>;</span><br><span class="line">    <span class="keyword">private</span> String privateField = <span class="string">"i am a privateField"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> privateField_int = <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">publicStaticFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"i am from publicStaticFunc"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">publicStaticFunc_int</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"i am from publicStaticFunc_int"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">100</span>+a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">publicStaticFunc_string</span><span class="params">(String arg)</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"i am from publicStaticFunc_int"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"publicStaticFunc_string-&gt;"</span>+arg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">publicFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"i am from publicFunc"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//add</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">privatetest</span><span class="params">(<span class="keyword">int</span> a, String b)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>,<span class="string">"privatetest func is called:"</span>+a+<span class="string">"---"</span>+b);</span><br><span class="line">        <span class="keyword">return</span> b + a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">privateStaticFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"i am from privateStaticFunc"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] privateFunc_array(<span class="keyword">int</span> num) &#123;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"i am from privateStaticFunc"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> array[]=<span class="keyword">new</span> <span class="keyword">int</span>[num];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;array.length;i++)&#123;</span><br><span class="line">            array[i]=i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> array;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">privateFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>, <span class="string">"i am from privateStaticFunc"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="native-lib-cpp-2"><a href="#native-lib-cpp-2" class="headerlink" title="native-lib.cpp"></a>native-lib.cpp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;android/log.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line">JavaVM *globalVM = <span class="literal">nullptr</span>;</span><br><span class="line">jclass testjclass = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//protected native void onCreate(Bundle savedInstanceState);</span></span><br><span class="line">__attribute__ ((visibility (<span class="string">"hidden"</span>))) <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        JNIEnv *env,</span></span></span><br><span class="line"><span class="function"><span class="params">        jobject thiz, jobject bundle)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*    super.onCreate(savedInstanceState);</span></span><br><span class="line"><span class="comment">    Log.i("kanxue","onCreate is Called!");</span></span><br><span class="line"><span class="comment">    setContentView(R.layout.activity_main);</span></span><br><span class="line"><span class="comment">    TextView tv = findViewById(R.id.sample_text);</span></span><br><span class="line"><span class="comment">    Test testobj = (Test) callInit();</span></span><br><span class="line"><span class="comment">    Log.i("kanxue", testobj.flag);*/</span></span><br><span class="line">    jclass AppCompatActivity_jclass1 = env-&gt;FindClass(<span class="string">"androidx/appcompat/app/AppCompatActivity"</span>);</span><br><span class="line"></span><br><span class="line">    jclass MainActivity_jclass1 = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/MainActivity"</span>);</span><br><span class="line"></span><br><span class="line">    jclass MainActivity_jclass2 = env-&gt;GetObjectClass(thiz);</span><br><span class="line"></span><br><span class="line">    jclass AppCompatActivity_jclass2 = env-&gt;GetSuperclass(MainActivity_jclass2);</span><br><span class="line"></span><br><span class="line">    jmethodID superClassOnCreate_mid = env-&gt;GetMethodID(AppCompatActivity_jclass2, <span class="string">"onCreate"</span>,</span><br><span class="line">                                                        <span class="string">"(Landroid/os/Bundle;)V"</span>);</span><br><span class="line"></span><br><span class="line">    env-&gt;CallNonvirtualVoidMethod(thiz, AppCompatActivity_jclass2, superClassOnCreate_mid, bundle);</span><br><span class="line">    jstring arg1 = env-&gt;NewStringUTF(<span class="string">"kanxue"</span>);</span><br><span class="line">    jstring arg2 = env-&gt;NewStringUTF(<span class="string">"native onCreate is called!"</span>);</span><br><span class="line">    jclass Logjclass = env-&gt;FindClass(<span class="string">"android/util/Log"</span>);</span><br><span class="line">    jmethodID Log_i_mid = env-&gt;GetStaticMethodID(Logjclass, <span class="string">"i"</span>,</span><br><span class="line">                                                 <span class="string">"(Ljava/lang/String;Ljava/lang/String;)I"</span>);</span><br><span class="line"></span><br><span class="line">    jint result0 = env-&gt;CallStaticIntMethod(Logjclass, Log_i_mid, arg1, arg2);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>,</span><br><span class="line">                        <span class="string">"jint result0=env-&gt;CallStaticIntMethod(Logjclass,Log_i_mid,arg1,arg2);-&gt;%d"</span>,</span><br><span class="line">                        result0);</span><br><span class="line">    jmethodID setContentView_mid = env-&gt;GetMethodID(MainActivity_jclass2, <span class="string">"setContentView"</span>, <span class="string">"(I)V"</span>);</span><br><span class="line"></span><br><span class="line">    jclass R_layoutjclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/R$layout"</span>);</span><br><span class="line">    jfieldID activity_main_fieldid = env-&gt;GetStaticFieldID(R_layoutjclass, <span class="string">"activity_main"</span>, <span class="string">"I"</span>);</span><br><span class="line">    jint activity_main_value = env-&gt;GetStaticIntField(R_layoutjclass, activity_main_fieldid);</span><br><span class="line"></span><br><span class="line">    env-&gt;CallVoidMethod(thiz, setContentView_mid, activity_main_value);</span><br><span class="line">    jmethodID findViewById_mid = env-&gt;GetMethodID(MainActivity_jclass2, <span class="string">"findViewById"</span>,</span><br><span class="line">                                                  <span class="string">"(I)Landroid/view/View;"</span>);</span><br><span class="line"></span><br><span class="line">    jclass R_idjclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/R$id"</span>);</span><br><span class="line">    jfieldID sample_text_fieldid = env-&gt;GetStaticFieldID(R_idjclass, <span class="string">"sample_text"</span>, <span class="string">"I"</span>);</span><br><span class="line">    jint sample_text_value = env-&gt;GetStaticIntField(R_idjclass, sample_text_fieldid);</span><br><span class="line"></span><br><span class="line">    jobject tvobj = env-&gt;CallObjectMethod(thiz, findViewById_mid, sample_text_value);</span><br><span class="line">    jmethodID callInit_mid = env-&gt;GetMethodID(MainActivity_jclass2, <span class="string">"callInit"</span>,</span><br><span class="line">                                              <span class="string">"()Ljava/lang/Object;"</span>);</span><br><span class="line">    jobject testobj = env-&gt;CallObjectMethod(thiz, callInit_mid);</span><br><span class="line">    jfieldID flagjfield = env-&gt;GetFieldID(testjclass, <span class="string">"flag"</span>, <span class="string">"Ljava/lang/String;"</span>);</span><br><span class="line">    jstring flagvalue = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;GetObjectField(testobj, flagjfield));</span><br><span class="line"></span><br><span class="line">    jint result1 = env-&gt;CallStaticIntMethod(Logjclass, Log_i_mid, arg1, flagvalue);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>,</span><br><span class="line">                        <span class="string">" jint result1=env-&gt;CallStaticIntMethod(Logjclass,Log_i_mid,arg1,flagvalue);-&gt;%d"</span>,</span><br><span class="line">                        result1);</span><br><span class="line"></span><br><span class="line">    env-&gt;DeleteWeakGlobalRef(testjclass);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kanxue_reflectiontest_MainActivity_callNonStaticFunc(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject obj<span class="comment">/* this */</span>) &#123;</span><br><span class="line"></span><br><span class="line">    jclass TestJclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/Test"</span>);</span><br><span class="line"></span><br><span class="line">    jmethodID con_mid = env-&gt;GetMethodID(TestJclass, <span class="string">"&lt;init&gt;"</span>, <span class="string">"(Ljava/lang/String;I)V"</span>);</span><br><span class="line"></span><br><span class="line">    jstring arg0 = env-&gt;NewStringUTF(<span class="string">"i am from callInit"</span>);</span><br><span class="line"></span><br><span class="line">    jobject testobj = env-&gt;NewObject(TestJclass, con_mid, arg0, <span class="number">100</span>);</span><br><span class="line">    jmethodID publicFunc_mid = env-&gt;GetMethodID(TestJclass, <span class="string">"publicFunc"</span>, <span class="string">"()V"</span>);</span><br><span class="line">    env-&gt;CallVoidMethod(testobj, publicFunc_mid);</span><br><span class="line">    jmethodID privatetest = env-&gt;GetMethodID(TestJclass, <span class="string">"privatetest"</span>,</span><br><span class="line">                                             <span class="string">"(ILjava/lang/String;)Ljava/lang/String;"</span>);</span><br><span class="line"></span><br><span class="line">    jstring arg1 = env-&gt;NewStringUTF(<span class="string">"i am from jni"</span>);</span><br><span class="line"></span><br><span class="line">    jvalue args[<span class="number">2</span>];</span><br><span class="line">    args[<span class="number">0</span>].i = <span class="number">200</span>;</span><br><span class="line">    args[<span class="number">1</span>].l = arg1;</span><br><span class="line">    jstring result_obj = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;CallObjectMethodA(testobj, privatetest, args));</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *result_ptr = env-&gt;GetStringUTFChars(result_obj, <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"privatetest-&gt;%s"</span>, result_ptr);</span><br><span class="line"></span><br><span class="line">    jmethodID privateFunc_array_mid = env-&gt;GetMethodID(TestJclass, <span class="string">"privateFunc_array"</span>, <span class="string">"(I)[I"</span>);</span><br><span class="line"></span><br><span class="line">    jintArray array_obj = <span class="keyword">static_cast</span>&lt;jintArray&gt;(env-&gt;CallObjectMethod(testobj,</span><br><span class="line">                                                                       privateFunc_array_mid, <span class="number">100</span>));</span><br><span class="line"></span><br><span class="line">    jint *array_ptr = env-&gt;GetIntArrayElements(array_obj, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; env-&gt;GetArrayLength(array_obj); i++) &#123;</span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"array[%d]-&gt;%d"</span>, i, array_ptr[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kanxue_reflectiontest_MainActivity_callStaticFunc(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject <span class="comment">/* this */</span>) &#123;</span><br><span class="line">    <span class="comment">//public static void publicStaticFunc()</span></span><br><span class="line"></span><br><span class="line">    jclass TestJclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/Test"</span>);</span><br><span class="line"></span><br><span class="line">    jmethodID publicStaticFunc_mid = env-&gt;GetStaticMethodID(TestJclass, <span class="string">"publicStaticFunc"</span>, <span class="string">"()V"</span>);</span><br><span class="line"></span><br><span class="line">    env-&gt;CallStaticVoidMethod(TestJclass, publicStaticFunc_mid);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//private static void privateStaticFunc()</span></span><br><span class="line"></span><br><span class="line">    jmethodID privateStaticFunc_mid = env-&gt;GetStaticMethodID(TestJclass, <span class="string">"privateStaticFunc"</span>,</span><br><span class="line">                                                             <span class="string">"()V"</span>);</span><br><span class="line"></span><br><span class="line">    env-&gt;CallStaticVoidMethod(TestJclass, privateStaticFunc_mid);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*    public static int publicStaticFunc_int(int a) &#123;</span></span><br><span class="line"><span class="comment">        Log.i("kanxue", "i am from publicStaticFunc_int");</span></span><br><span class="line"><span class="comment">        return 100+a;</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    jmethodID publicStaticFunc_int_mid = env-&gt;GetStaticMethodID(TestJclass, <span class="string">"publicStaticFunc_int"</span>,</span><br><span class="line">                                                                <span class="string">"(I)I"</span>);</span><br><span class="line"></span><br><span class="line">    jint result_int = env-&gt;CallStaticIntMethod(TestJclass, publicStaticFunc_int_mid, <span class="number">200</span>);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"publicStaticFunc_int-&gt;%d"</span>, result_int);</span><br><span class="line">    <span class="comment">/*public static String publicStaticFunc_string(String arg) &#123;</span></span><br><span class="line"><span class="comment">        Log.i("kanxue", "i am from publicStaticFunc_int");</span></span><br><span class="line"><span class="comment">        return "publicStaticFunc_string-&gt;"+arg;</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    jmethodID publicStaticFunc_string_mid = env-&gt;GetStaticMethodID(TestJclass,</span><br><span class="line">                                                                   <span class="string">"publicStaticFunc_string"</span>,</span><br><span class="line">                                                                   <span class="string">"(Ljava/lang/String;)Ljava/lang/String;"</span>);</span><br><span class="line"></span><br><span class="line">    jstring arg_string = env-&gt;NewStringUTF(<span class="string">"i am from jni"</span>);</span><br><span class="line">    jstring result_string = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;CallStaticObjectMethod(TestJclass,</span><br><span class="line">                                                                             publicStaticFunc_string_mid,</span><br><span class="line">                                                                             arg_string));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *content = env-&gt;GetStringUTFChars(result_string, <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"publicStaticFunc_string-&gt;%s"</span>, content);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> JNIEXPORT jobject JNICALL</span><br><span class="line">Java_com_kanxue_reflectiontest_MainActivity_callInit(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject <span class="comment">/* this */</span>) &#123;</span><br><span class="line"></span><br><span class="line">    jclass TestJclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/Test"</span>);</span><br><span class="line"></span><br><span class="line">    jmethodID con_mid = env-&gt;GetMethodID(TestJclass, <span class="string">"&lt;init&gt;"</span>, <span class="string">"(Ljava/lang/String;I)V"</span>);</span><br><span class="line"></span><br><span class="line">    jstring arg0 = env-&gt;NewStringUTF(<span class="string">"i am from callInit"</span>);</span><br><span class="line"></span><br><span class="line">    jobject obj = env-&gt;NewObject(TestJclass, con_mid, arg0, <span class="number">100</span>);</span><br><span class="line">    jmethodID privatetest_mid = env-&gt;GetMethodID(TestJclass, <span class="string">"privatetest"</span>,</span><br><span class="line">                                                 <span class="string">"(ILjava/lang/String;)Ljava/lang/String;"</span>);</span><br><span class="line">    jstring arg2 = env-&gt;NewStringUTF(<span class="string">"i am from jni-CallObjectMethodA"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> JNIEXPORT jstring JNICALL</span><br><span class="line">Java_com_kanxue_reflectiontest_MainActivity_stringFromJNI(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject <span class="comment">/* this */</span>) &#123;</span><br><span class="line">    JavaVM *thisvm = <span class="literal">nullptr</span>;</span><br><span class="line">    env-&gt;GetJavaVM(&amp;thisvm);</span><br><span class="line"></span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"env-&gt;GetJavaVM(&amp;thisvm)-&gt;%p"</span>, thisvm);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>,</span><br><span class="line">                        <span class="string">"Java_com_kanxue_reflectiontest_MainActivity_stringFromJNI-&gt;%p"</span>, env);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> hello = <span class="string">"Hello from C++"</span>;</span><br><span class="line">    jclass TestJclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/Test"</span>);</span><br><span class="line">    jfieldID publicStaticField_jfieldID = env-&gt;GetStaticFieldID(TestJclass, <span class="string">"publicStaticField"</span>,</span><br><span class="line">                                                                <span class="string">"Ljava/lang/String;"</span>);</span><br><span class="line">    jstring publicStaticField_content = (jstring) env-&gt;GetStaticObjectField(TestJclass,</span><br><span class="line">                                                                            publicStaticField_jfieldID);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *content_ptr = env-&gt;GetStringUTFChars(publicStaticField_content, <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>, content_ptr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> env-&gt;NewStringUTF(hello.c_str());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">newObject</span><span class="params">(JNIEnv *env, jobject obj)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kanxue_reflectiontest_MainActivity_newObject(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject <span class="comment">/* this */</span>) &#123;</span><br><span class="line">    <span class="comment">//NewObject</span></span><br><span class="line">    jclass TestJclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/Test"</span>);</span><br><span class="line">    jmethodID con_mid = env-&gt;GetMethodID(TestJclass, <span class="string">"&lt;init&gt;"</span>, <span class="string">"(Ljava/lang/String;)V"</span>);</span><br><span class="line">    jstring arg = env-&gt;NewStringUTF(<span class="string">"I am From Jni"</span>);</span><br><span class="line">    jobject testobj = env-&gt;NewObject(TestJclass, con_mid, arg);</span><br><span class="line">    <span class="keyword">if</span> (testobj != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>, <span class="string">"NewObject success!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//AllocObject</span></span><br><span class="line">    jobject testobj2 = env-&gt;AllocObject(TestJclass);</span><br><span class="line">    jstring arg1 = env-&gt;NewStringUTF(<span class="string">"I am From Jni-&gt;AllocObject"</span>);</span><br><span class="line">    env-&gt;CallNonvirtualVoidMethod(testobj2, TestJclass, con_mid, arg1);</span><br><span class="line">    <span class="keyword">if</span> (testobj2 != <span class="literal">nullptr</span>) &#123;</span><br><span class="line"></span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>, <span class="string">"AllocObject success!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    jmethodID privatetest_mid = env-&gt;GetMethodID(TestJclass, <span class="string">"privatetest"</span>,</span><br><span class="line">                                                 <span class="string">"(ILjava/lang/String;)Ljava/lang/String;"</span>);</span><br><span class="line">    jstring arg2 = env-&gt;NewStringUTF(<span class="string">"i am from jni"</span>);</span><br><span class="line">    jobject result = env-&gt;CallObjectMethod(testobj2, privatetest_mid, <span class="number">100</span>, arg2);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kanxue_reflectiontest_MainActivity_getStaticField(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject <span class="comment">/* this */</span>) &#123;</span><br><span class="line">    <span class="comment">//private static</span></span><br><span class="line">    jclass TestJclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/Test"</span>);</span><br><span class="line">    <span class="comment">//    public static String publicStaticField = "i am a publicStaticField";</span></span><br><span class="line">    <span class="comment">//  jfieldID GetStaticFieldID(jclass clazz, const char* name, const char* sig)</span></span><br><span class="line">    jfieldID publicStaticField_fid = env-&gt;GetStaticFieldID(TestJclass, <span class="string">"publicStaticField"</span>,</span><br><span class="line">                                                           <span class="string">"Ljava/lang/String;"</span>);</span><br><span class="line">    <span class="comment">/*jstring publicStaticField_obj = static_cast&lt;jstring&gt;(env-&gt;GetStaticObjectField(TestJclass,</span></span><br><span class="line"><span class="comment">                                                                                   publicStaticField_fid));</span></span><br><span class="line"><span class="comment">    const char *publicStaticField_content = env-&gt;GetStringUTFChars(publicStaticField_obj, nullptr);</span></span><br><span class="line"><span class="comment">    __android_log_print(4, "kanxue-&gt;jni", "publicStaticField_obj-&gt;%s", publicStaticField_content);*/</span></span><br><span class="line"></span><br><span class="line">    jstring setjstring = env-&gt;NewStringUTF(<span class="string">"modified by jni"</span>);</span><br><span class="line">    <span class="comment">//    void SetStaticObjectField(jclass clazz, jfieldID fieldID, jobject value)</span></span><br><span class="line">    env-&gt;SetStaticObjectField(TestJclass, publicStaticField_fid, setjstring);</span><br><span class="line">    jstring publicStaticField_obj = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;GetStaticObjectField(TestJclass,</span><br><span class="line">                                                                                   publicStaticField_fid));</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *publicStaticField_content = env-&gt;GetStringUTFChars(publicStaticField_obj, <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"publicStaticField_obj-&gt;%s"</span>, publicStaticField_content);</span><br><span class="line"></span><br><span class="line"><span class="comment">//private static String privateStaticField = "i am a privateStaticField";</span></span><br><span class="line">    jfieldID privateStaticField_fid = env-&gt;GetStaticFieldID(TestJclass, <span class="string">"privateStaticField"</span>,</span><br><span class="line">                                                            <span class="string">"Ljava/lang/String;"</span>);</span><br><span class="line">    jstring privateStaticField_obj = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;GetStaticObjectField(TestJclass,</span><br><span class="line">                                                                                    privateStaticField_fid));</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *privateStaticField_content = env-&gt;GetStringUTFChars(privateStaticField_obj,</span><br><span class="line">                                                                    <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"privateStaticField_obj-&gt;%s"</span>, privateStaticField_content);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    public static int publicStaticField_int = 100;</span></span><br><span class="line"></span><br><span class="line">    jfieldID publicStaticField_int_fid = env-&gt;GetStaticFieldID(TestJclass, <span class="string">"publicStaticField_int"</span>,</span><br><span class="line">                                                               <span class="string">"I"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    env-&gt;SetStaticIntField(TestJclass, publicStaticField_int_fid, <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">    jint publicStaticField_int_value = env-&gt;GetStaticIntField(TestJclass,</span><br><span class="line">                                                              publicStaticField_int_fid);</span><br><span class="line"></span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"publicStaticField_int_value-&gt;%d"</span>,</span><br><span class="line">                        publicStaticField_int_value);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__attribute__ ((visibility (<span class="string">"hidden"</span>))) <span class="function"><span class="keyword">void</span> <span class="title">cccc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        JNIEnv *env,</span></span></span><br><span class="line"><span class="function"><span class="params">        jclass obj, jobject testobj)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    private String privateField = "i am a privateField";</span></span><br><span class="line"></span><br><span class="line">    jclass TestJclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/Test"</span>);</span><br><span class="line">    jfieldID privateField_fid = env-&gt;GetFieldID(TestJclass, <span class="string">"privateField"</span>, <span class="string">"Ljava/lang/String;"</span>);</span><br><span class="line">    <span class="comment">//    jobject GetObjectField(jobject obj, jfieldID fieldID)</span></span><br><span class="line">    jstring privateField_obj = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;GetObjectField(testobj, privateField_fid));</span><br><span class="line"></span><br><span class="line">    jstring newString = env-&gt;NewStringUTF(<span class="string">"Modified by jni"</span>);</span><br><span class="line">    env-&gt;SetObjectField(testobj, privateField_fid, newString);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    privateField_obj = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;GetObjectField(testobj, privateField_fid));</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *privateField_obj_content = env-&gt;GetStringUTFChars(privateField_obj,</span><br><span class="line">                                                                  <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"privateField_obj-&gt;%s"</span>, privateField_obj_content);</span><br><span class="line">    jfieldID privateField_int_fid = env-&gt;GetFieldID(TestJclass, <span class="string">"privateField_int"</span>, <span class="string">"I"</span>);</span><br><span class="line">    env-&gt;SetIntField(testobj, privateField_int_fid, <span class="number">300</span>);</span><br><span class="line">    jint privateField_int_value = env-&gt;GetIntField(testobj, privateField_int_fid);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"privateField_int_value-&gt;%d"</span>, privateField_int_value);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    public int[] intarray = null;</span></span><br><span class="line">    jfieldID intarray_fid = env-&gt;GetFieldID(TestJclass, <span class="string">"intarray"</span>, <span class="string">"[I"</span>);</span><br><span class="line">    jintArray intarray_obj = <span class="keyword">static_cast</span>&lt;jintArray&gt;(env-&gt;GetObjectField(testobj, intarray_fid));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> arraylength = env-&gt;GetArrayLength(intarray_obj);</span><br><span class="line"></span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"arraylength-&gt;%d"</span>, arraylength);</span><br><span class="line">    jint jni_array[arraylength];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; arraylength; j++) &#123;</span><br><span class="line"></span><br><span class="line">        jni_array[j] = <span class="number">10</span> - j;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> jint *ptr = jni_array;</span><br><span class="line">    env-&gt;SetIntArrayRegion(intarray_obj, <span class="number">0</span>, arraylength, ptr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> *<span class="built_in">array</span> = env-&gt;GetIntArrayElements(intarray_obj, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arraylength; i++) &#123;</span><br><span class="line"></span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"array[%d]-&gt;%d"</span>, i, <span class="built_in">array</span>[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__attribute__ ((visibility (<span class="string">"hidden"</span>))) <span class="function"><span class="keyword">void</span> <span class="title">dddd</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        JNIEnv *env,</span></span></span><br><span class="line"><span class="function"><span class="params">        jclass obj, jobject testobj)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    private String privateField = "i am a privateField";</span></span><br><span class="line"></span><br><span class="line">    jclass TestJclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/Test"</span>);</span><br><span class="line">    jfieldID privateField_fid = env-&gt;GetFieldID(TestJclass, <span class="string">"privateField"</span>, <span class="string">"Ljava/lang/String;"</span>);</span><br><span class="line">    <span class="comment">//    jobject GetObjectField(jobject obj, jfieldID fieldID)</span></span><br><span class="line">    jstring privateField_obj = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;GetObjectField(testobj, privateField_fid));</span><br><span class="line"></span><br><span class="line">    jstring newString = env-&gt;NewStringUTF(<span class="string">"Modified by jni"</span>);</span><br><span class="line">    env-&gt;SetObjectField(testobj, privateField_fid, newString);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    privateField_obj = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;GetObjectField(testobj, privateField_fid));</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *privateField_obj_content = env-&gt;GetStringUTFChars(privateField_obj,</span><br><span class="line">                                                                  <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"privateField_obj-&gt;%s"</span>, privateField_obj_content);</span><br><span class="line">    jfieldID privateField_int_fid = env-&gt;GetFieldID(TestJclass, <span class="string">"privateField_int"</span>, <span class="string">"I"</span>);</span><br><span class="line">    env-&gt;SetIntField(testobj, privateField_int_fid, <span class="number">300</span>);</span><br><span class="line">    jint privateField_int_value = env-&gt;GetIntField(testobj, privateField_int_fid);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"privateField_int_value-&gt;%d"</span>, privateField_int_value);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    public int[] intarray = null;</span></span><br><span class="line">    jfieldID intarray_fid = env-&gt;GetFieldID(TestJclass, <span class="string">"intarray"</span>, <span class="string">"[I"</span>);</span><br><span class="line">    jintArray intarray_obj = <span class="keyword">static_cast</span>&lt;jintArray&gt;(env-&gt;GetObjectField(testobj, intarray_fid));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> arraylength = env-&gt;GetArrayLength(intarray_obj);</span><br><span class="line"></span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"arraylength-&gt;%d"</span>, arraylength);</span><br><span class="line">    jint jni_array[arraylength];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; arraylength; j++) &#123;</span><br><span class="line"></span><br><span class="line">        jni_array[j] = <span class="number">10</span> - j;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> jint *ptr = jni_array;</span><br><span class="line">    env-&gt;SetIntArrayRegion(intarray_obj, <span class="number">0</span>, arraylength, ptr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> *<span class="built_in">array</span> = env-&gt;GetIntArrayElements(intarray_obj, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arraylength; i++) &#123;</span><br><span class="line"></span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"array[%d]-&gt;%d"</span>, i, <span class="built_in">array</span>[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function">jint <span class="title">testPushAndPopLocalFrame</span><span class="params">(JNIEnv *env)</span> </span>&#123;</span><br><span class="line">    jobject result = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">if</span> (env-&gt;PushLocalFrame(<span class="number">20</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">18</span>; i++) &#123;</span><br><span class="line">            jstring tmp = env-&gt;NewStringUTF(<span class="string">"kanxue"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        jstring tmp1 = env-&gt;NewStringUTF(<span class="string">"result1"</span>);</span><br><span class="line">        jstring tmp2 = env-&gt;NewStringUTF(<span class="string">"result2"</span>);</span><br><span class="line">        result = env-&gt;PopLocalFrame(<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//error</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">JNIEXPORT jint <span class="title">JNI_OnLoad</span><span class="params">(JavaVM *vm, <span class="keyword">void</span> *reserved)</span> </span>&#123;</span><br><span class="line">    globalVM = vm;</span><br><span class="line">    <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"JNI_OnLoad(JavaVM *vm, void *reserved)-&gt;%p"</span>, vm);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>, <span class="string">"JNI_OnLoad is called"</span>);</span><br><span class="line">    JNIEnv *env = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">if</span> (vm-&gt;GetEnv((<span class="keyword">void</span> **) &amp;env, JNI_VERSION_1_6) == JNI_OK) &#123;</span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>,</span><br><span class="line">                            <span class="string">"vm-&gt;GetEnv((void**)&amp;env,JNI_VERSION_1_6) success"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*  protected native void onCreate(Bundle savedInstanceState);</span></span><br><span class="line"><span class="comment">    public native String stringFromJNI();</span></span><br><span class="line"><span class="comment">    public native String stringFromJNIC();</span></span><br><span class="line"><span class="comment">    public native void newObject();</span></span><br><span class="line"><span class="comment">    public native void getStaticField();</span></span><br><span class="line"><span class="comment">    public native Object callInit();</span></span><br><span class="line"><span class="comment">    public native void callStaticFunc();</span></span><br><span class="line"><span class="comment">    public native void callNonStaticFunc();</span></span><br><span class="line"><span class="comment">    public static native void getNonStaticField(Object m);*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*typedef struct &#123;</span></span><br><span class="line"><span class="comment">    const char* name;</span></span><br><span class="line"><span class="comment">    const char* signature;</span></span><br><span class="line"><span class="comment">    void*       fnPtr;</span></span><br><span class="line"><span class="comment">&#125; JNINativeMethod;*/</span></span><br><span class="line"><span class="comment">/*jint        (*RegisterNatives)(jclass, const JNINativeMethod*,</span></span><br><span class="line"><span class="comment">                               jint);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                               */</span></span><br><span class="line"></span><br><span class="line">    JNINativeMethod jniNativeMethod[] = &#123;&#123;<span class="string">"onCreate"</span>,          <span class="string">"(Landroid/os/Bundle;)V"</span>, (<span class="keyword">void</span> *) onCreate&#125;,</span><br><span class="line">                                         &#123;<span class="string">"getNonStaticField"</span>, <span class="string">"(Ljava/lang/Object;)V"</span>,  (<span class="keyword">void</span> *) cccc&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    jclass MainActivityjclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/MainActivity"</span>);</span><br><span class="line"></span><br><span class="line">    env-&gt;RegisterNatives(MainActivityjclass, jniNativeMethod,</span><br><span class="line">                         <span class="keyword">sizeof</span>(jniNativeMethod) / <span class="keyword">sizeof</span>(JNINativeMethod));</span><br><span class="line"></span><br><span class="line">    JNINativeMethod jniNativeMethod2[] = &#123;&#123;<span class="string">"onCreate"</span>,          <span class="string">"(Landroid/os/Bundle;)V"</span>, (<span class="keyword">void</span> *) onCreate&#125;,</span><br><span class="line">                                         &#123;<span class="string">"getNonStaticField"</span>, <span class="string">"(Ljava/lang/Object;)V"</span>,  (<span class="keyword">void</span> *) dddd&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    env-&gt;RegisterNatives(MainActivityjclass, jniNativeMethod2,</span><br><span class="line">                         <span class="keyword">sizeof</span>(jniNativeMethod2) / <span class="keyword">sizeof</span>(JNINativeMethod));</span><br><span class="line"></span><br><span class="line">    jclass tmpjclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/Test"</span>);</span><br><span class="line">    testjclass = <span class="keyword">static_cast</span>&lt;jclass&gt;(env-&gt;NewWeakGlobalRef(tmpjclass));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*   for (int i = 0; i &lt; 2048; i++) &#123;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">           jstring content = env-&gt;NewStringUTF("test localreference");</span></span><br><span class="line"><span class="comment">           __android_log_print(4, "kanxue-&gt;jni", "localreference number-&gt;%d",</span></span><br><span class="line"><span class="comment">                               i);</span></span><br><span class="line"><span class="comment">           env-&gt;DeleteLocalRef(content);</span></span><br><span class="line"><span class="comment">       &#125;*/</span></span><br><span class="line"><span class="comment">/*    int len = 10;</span></span><br><span class="line"><span class="comment">    if (env-&gt;EnsureLocalCapacity(1024) == 0) &#123;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        for (int i = 0; i &lt; len; i++) &#123;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            jstring content = env-&gt;NewStringUTF("test localreference");</span></span><br><span class="line"><span class="comment">            __android_log_print(4, "kanxue-&gt;jni", "localreference number-&gt;%d",</span></span><br><span class="line"><span class="comment">                                i);</span></span><br><span class="line"><span class="comment">            env-&gt;DeleteLocalRef(content);</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*    __android_log_print(4, "kanxue-&gt;jni", "nullptr and NULL-&gt;%d,%d",</span></span><br><span class="line"><span class="comment">                        nullptr,NULL);</span></span><br><span class="line"><span class="comment">    jstring resultjstring = testPushAndPop(env);</span></span><br><span class="line"><span class="comment">    const char *content = env-&gt;GetStringUTFChars(resultjstring, nullptr);</span></span><br><span class="line"><span class="comment">    __android_log_print(4, "kanxue-&gt;jni", "testPushAndPop-&gt;%s",</span></span><br><span class="line"><span class="comment">                        content);*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*   jobject resultobj = testPushAndPopLocalFrame(env);</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">       if (!env-&gt;IsSameObject(resultobj, NULL)) &#123;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">           const char *content = env-&gt;GetStringUTFChars(static_cast&lt;jstring&gt;(resultobj), nullptr);</span></span><br><span class="line"><span class="comment">           __android_log_print(4, "kanxue-&gt;jni", "testPushAndPopLocalFrame-&gt;%s",</span></span><br><span class="line"><span class="comment">                               content);</span></span><br><span class="line"><span class="comment">       &#125;*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    jint result_jint = testPushAndPopLocalFrame(env);</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"testPushAndPopLocalFrame-&gt;%d"</span>,</span><br><span class="line">                        result_jint);</span><br><span class="line">    result = JNI_VERSION_1_6;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h2 id="Dalvik动态注册原理"><a href="#Dalvik动态注册原理" class="headerlink" title="Dalvik动态注册原理"></a>Dalvik动态注册原理</h2><h3 id="静态注册和动态注册"><a href="#静态注册和动态注册" class="headerlink" title="静态注册和动态注册"></a>静态注册和动态注册</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> JNIEXPORT <span class="keyword">void</span> JNICALL </span><br><span class="line">Java_......(JNIEnv *env, jobject <span class="keyword">this</span>)&#123;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这类的函数都是冗长的能否用简介的函数签名来注册</span></span><br><span class="line"><span class="comment">// 那就需要用到动态注册</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">(JNIEnv *env, jobject <span class="keyword">this</span>)</span></span>&#123;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于任意一个jni函数来说,在该函数被调用前,必须要完成java函数与so中地址的绑定<br>这个绑定过程可以是被动的, 即由Dalvik、ART虚拟机在调用前查找完成地址的绑定<br>也可以是主动即由App自己完成地址的绑定 </p>
<blockquote>
<p>静态注册</p>
</blockquote>
<ul>
<li>1:对应函数名: Java+包名+类名+方法名<br>其中使用下划线将每部分隔开,包名也使用下划线隔开, 如果名称中本来就包含下划线,将下划线加数字替换</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">例如(包名:com.afei.jnidemo 类名:MainActivity)</span><br><span class="line"><span class="comment">// Java Native method</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> native String <span class="title">stringFromJNI</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Jni method</span></span><br><span class="line">JNIEXPORT jstring JNICALL</span><br><span class="line">Java_com_afei_jnidemo_MainActivity_stringFromJNI(JNIEnv* env, jobject instance);</span><br></pre></td></tr></table></figure>
<ul>
<li>2:优点: 对于静态注册来说,简单明了, 语义清晰</li>
<li>3:缺点: 不够安全</li>
</ul>
<p>必须遵从注册规则从而导致名称过长,由于保留了符号签名,很容易使用IDA等直接定位地址</p>
<blockquote>
<p>动态注册</p>
</blockquote>
<ul>
<li>1:定义</li>
</ul>
<p>通过RegisterNatives方法手动完成native方法和so中的方法的绑定,这样虚拟机就可以通过这个函数映射关系直接找到相应的方法了</p>
<ul>
<li>2: 注册过程示例</li>
</ul>
<p>假设有两个native方法如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">stringFromJNI</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br></pre></td></tr></table></figure>
<p>通常我们在JNI_OnLoad方法中完成动态注册,事实上只需要在该jni函数被调用钱的任意时机完成注册即可, 甚至是多次注册到不同地址都可以 </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">JNIEXPORT jint <span class="title">JNI_OnLoad</span><span class="params">(JavaVM *vm, <span class="keyword">void</span> *reserved)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    JNIEnv *env = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">if</span> (vm-&gt;GetEnv((<span class="keyword">void</span> **) &amp;env, JNI_VERSION_1_6) == JNI_OK) &#123;</span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"kanxue-&gt;jni"</span>, <span class="string">"jni-&gt;%s"</span>,</span><br><span class="line">                            <span class="string">"vm-&gt;GetEnv((void**)&amp;env,JNI_VERSION_1_6) success"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    JNINativeMethod jniNativeMethod[] = &#123;&#123;<span class="string">"onCreate"</span>, <span class="string">"(Landroid/os/Bundle;)V"</span>, (<span class="keyword">void</span> *) onCreate&#125;,</span><br><span class="line">                                         &#123;<span class="string">"getNonStaticField"</span>, <span class="string">"(Ljava/lang/Object;)V"</span>,  (<span class="keyword">void</span> *) cccc&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    jclass MainActivityjclass = env-&gt;FindClass(<span class="string">"com/kanxue/reflectiontest/MainActivity"</span>);</span><br><span class="line"></span><br><span class="line">    env-&gt;RegisterNatives(MainActivityjclass, jniNativeMethod,</span><br><span class="line">                         <span class="keyword">sizeof</span>(jniNativeMethod) / <span class="keyword">sizeof</span>(JNINativeMethod));</span><br><span class="line"></span><br><span class="line">    JNINativeMethod jniNativeMethod2[] = &#123;&#123;<span class="string">"onCreate"</span>,          <span class="string">"(Landroid/os/Bundle;)V"</span>, (<span class="keyword">void</span> *) onCreate&#125;,</span><br><span class="line">                                          &#123;<span class="string">"getNonStaticField"</span>, <span class="string">"(Ljava/lang/Object;)V"</span>,  (<span class="keyword">void</span> *) dddd&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    env-&gt;RegisterNatives(MainActivityjclass, jniNativeMethod2,</span><br><span class="line">                         <span class="keyword">sizeof</span>(jniNativeMethod2) / <span class="keyword">sizeof</span>(JNINativeMethod));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> JNI_VERSION_1_6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>env-&gt;RegisterNatives</code>的参数解析 </p>
<ul>
<li>第一个参数, 要注册上的Java类</li>
<li>第二个参数, 要动态注册的方法</li>
<li>第三个参数, 要动态注册的方法数量</li>
</ul>
<p><code>JNIEXPORT</code>对应的就是<code>__attribute__((visibility(&quot;default&quot;)))</code>默认展现出符号名<br>就是IDA直接能够提取到当前函数的原来函数名称<br>如果想要隐藏的话<code>__attribute__((visibility(&quot;hidden&quot;)))</code>纠正这样的情况即可</p>
<p>Dalvik具体RegisterNatives实现的原理</p>
<p><code>dalvik/vm/Jni.cpp#RegisterNatives</code>-&gt;<code>dvmRegisterJNIMethod</code>-&gt;<code>dvmUserJNIBridge</code></p>
<p><br></p>
<h2 id="Art动态注册原理"><a href="#Art动态注册原理" class="headerlink" title="Art动态注册原理"></a>Art动态注册原理</h2><p>Art具体的RegisterNatives的实现 </p>
<p><code>art/runtime/jni_internal.cc#RegisterNatives</code>-&gt;<code>RegisterNativeMethods</code>-&gt;<code>JNI::RegisterNativeMethods</code>-&gt;<code>ReportInvalidJNINativeMethod</code></p>
<p>Java类定义nativeMethod都是ArtMethod<br>-&gt;<code>FindMethod</code>(在Art虚拟机中找ArtMethod)</p>
<p><code>ClassLiner::LoadClassMembers</code></p>
<p>ArtMethod类的定义在<code>art/runtime/art_method.h</code>文件中</p>
<p><br><br><br></p>
<h1 id="Frida"><a href="#Frida" class="headerlink" title="Frida"></a>Frida</h1><h2 id="objection不写代码Hook、Trace、Stack"><a href="#objection不写代码Hook、Trace、Stack" class="headerlink" title="objection不写代码Hook、Trace、Stack"></a>objection不写代码Hook、Trace、Stack</h2><p><code>apt install liblzma-dev</code><br><code>apt-get install -y make build-essential libssl-dev zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm libncurses5-dev libncursesw5-dev xz-utils tk-dev</code></p>
<p>objection可以不用写代码直接用命令执行hook</p>
<ul>
<li>objection与Frida版本匹配安装<ul>
<li>frida 12.8.0</li>
<li>frida-tools 5.3.0</li>
<li>objection 1.8.4</li>
</ul>
</li>
<li>objection内存漫游<br>  <code>https://www.anquanke.com/post/id/197657</code><ul>
<li>objection -g com.android.settings explore 注入应用</li>
<li>memory list modules 查看内存中加载的库</li>
<li>memory list exports libssl.so 查看库的导出函数</li>
<li>memory list exports libart.so –json /root/libart.json 将结果保存到json文件中</li>
<li>memory dump all from_base 提取整个(或部分)内存</li>
<li>memory search –string –offsets-only 搜索整个内存</li>
<li>android heap search instances com.android.settings.DisplaySettings 在堆上搜索实例</li>
<li>android heap execute 0x2526 getPreferenceScreenResId 调用实例的方法</li>
<li>android heap evaluate 0x2526  在实例上执行js代码,进入迷你编辑器</li>
</ul>
</li>
<li>objection hook、trace、stack<ul>
<li>android hooking list classes 列出内存中所有的类</li>
<li>android hooking list activities 列出内存中所有的activity</li>
<li>android intent launch_activity xxxx 进入某个activity</li>
<li>android hooking search classes display 内存中搜索所有的类</li>
<li>android hooking list class_methods com.android.settings.DisplaySettings  列出类的所有方法</li>
<li>android hooking watch class android.bluetooth.BluetoothDevice hook类的所有方法</li>
<li>android hooking watch class_method android.bluetooth.BluetoothDevice.getName –dump-args –dump-return –dump-backtrace hook方法的参数、返回值和调用栈</li>
</ul>
</li>
<li>objection插件体系:WallBreaker<br>  <code>https://github.com/hluwa/Wallbreaker</code><br>  <code>plugin load /root/Desktop/Wallbreaker</code><ul>
<li>plugin wallbreaker classdump –fullname com.vivo.push.sdk.LinkProxyClientActivity </li>
</ul>
</li>
<li>objection + DexDump脱壳<ul>
<li>配合fart-dexdump进行objection的插件, 进行dex导出处理</li>
<li>plugin dexdump dump 接着寻找关键的Activity存在的dex文件 grep -ril “LoginActivity” *</li>
</ul>
</li>
</ul>
<p><code>objection主动调用,heap寻找实例,无法调用静态函数,只能在Frida来主动调用静态函数</code></p>
<p><br></p>
<h2 id="Frida上手和逆向三段"><a href="#Frida上手和逆向三段" class="headerlink" title="Frida上手和逆向三段"></a>Frida上手和逆向三段</h2><ul>
<li>Frida基本操作<br>  参数、返回值<br>  调用栈(<code>Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;),$new())</code>)</li>
<li>Frida精髓<ul>
<li>方法重载<br>  使用overload来选择方法重载确定的函数</li>
<li>参数构造<br>  构造字符串参数Java.use(‘java.lang.String’).$new(“NIHAOJAVA”)</li>
<li>动静态处理<br>  动态函数的意思就是需要找到instance实例, 再去调用<br>  静态函数则可以直接找到这个class调用</li>
<li>主动调用</li>
<li>忽略内部细节,直接返回结果</li>
</ul>
</li>
<li>逆向三段<ul>
<li>hook、invoke、rpc</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     </span><br><span class="line">        Java.use(<span class="string">"com.example.lesson4one.MainActivity"</span>).fun.overload(<span class="string">'int'</span>, <span class="string">'int'</span>).implementation = <span class="function"><span class="keyword">function</span>(<span class="params">arg1,arg2</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> result = <span class="keyword">this</span>.fun(arg1,arg2);</span><br><span class="line">            <span class="built_in">console</span>.log(Java.use(<span class="string">"android.util.Log"</span>).getStackTraceString(Java.use(<span class="string">"java.lang.Throwable"</span>).$<span class="keyword">new</span>()));</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"arg1,arg2,result"</span>,arg1,arg2,result)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">800</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Java.use(<span class="string">"com.example.lesson4one.MainActivity"</span>).fun.overload(<span class="string">'java.lang.String'</span>).implementation = <span class="function"><span class="keyword">function</span> (<span class="params">arg1 </span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> result = <span class="keyword">this</span>.fun(Java.use(<span class="string">'java.lang.String'</span>).$<span class="keyword">new</span>(<span class="string">"NIHAOJAVA"</span>));</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"arg1,result"</span>,arg1,result)</span><br><span class="line">            <span class="keyword">return</span> Java.use(<span class="string">'java.lang.String'</span>).$<span class="keyword">new</span>(<span class="string">"NIHAOJS"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Java.choose(<span class="string">"com.example.lesson4one.MainActivity"</span>,&#123;</span><br><span class="line">            onMatch:<span class="function"><span class="keyword">function</span>(<span class="params">instance</span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"found instance :"</span>,instance)</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"found instance :"</span>,instance.secret())</span><br><span class="line">            &#125;,<span class="attr">onComplete</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> result = Java.use(<span class="string">"com.example.lesson4one.MainActivity"</span>).secret2();</span><br><span class="line">        <span class="built_in">console</span>.log(result);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(main)</span><br></pre></td></tr></table></figure>
<p><br></p>
<h2 id="Frida构造数组、对象、Map和类参数"><a href="#Frida构造数组、对象、Map和类参数" class="headerlink" title="Frida构造数组、对象、Map和类参数"></a>Frida构造数组、对象、Map和类参数</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.r0ysue.a0526printout;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        <span class="comment">//TrafficLight.main();</span></span><br><span class="line">        <span class="comment">//com.r0ysue.a0526printout.Juice.main();</span></span><br><span class="line">        <span class="comment">//milk.main();</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        Log.d("SimpleArray", "onCreate: SImpleArray");</span></span><br><span class="line"><span class="comment">        char arr[][] = new char[4][]; // 创建一个4行的二维数组</span></span><br><span class="line"><span class="comment">        arr[0] = new char[] &#123; '春', '眠', '不', '觉', '晓' &#125;; // 为每一行赋值</span></span><br><span class="line"><span class="comment">        arr[1] = new char[] &#123; '处', '处', '闻', '啼', '鸟' &#125;;</span></span><br><span class="line"><span class="comment">        arr[2] = new char[] &#123; '夜', '来', '风', '雨', '声' &#125;;</span></span><br><span class="line"><span class="comment">        arr[3] = new char[] &#123; '花', '落', '知', '多', '少' &#125;;</span></span><br><span class="line"><span class="comment">        Log.d("SimpleArray", "-----横版-----");</span></span><br><span class="line"><span class="comment">        for (int i = 0; i &lt; 4; i++) &#123; // 循环4行</span></span><br><span class="line"><span class="comment">            Log.d("SimpleArraysToString", Arrays.toString(arr[i]));</span></span><br><span class="line"><span class="comment">            Log.d("SimpleStringBytes", Arrays.toString (Arrays.toString (arr[i]).getBytes()));</span></span><br><span class="line"><span class="comment">            for (int j = 0; j &lt; 5; j++) &#123; // 循环5列</span></span><br><span class="line"><span class="comment">                Log.d("SimpleArray", Character.toString(arr[i][j])); // 输出数组中的元素</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">            if (i % 2 == 0) &#123;</span></span><br><span class="line"><span class="comment">                Log.d("SimpleArray", ",");// 如果是一、三句，输出逗号</span></span><br><span class="line"><span class="comment">            &#125; else &#123;</span></span><br><span class="line"><span class="comment">                Log.d("SimpleArray", "。");// 如果是二、四句，输出句号</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; mapr0ysue = <span class="keyword">new</span> HashMap&lt;&gt;(); <span class="comment">// 创建Map集合对象</span></span><br><span class="line">        mapr0ysue.put(<span class="string">"ISBN 978-7-5677-8742-1"</span>, <span class="string">"Android项目开发实战入门"</span>); <span class="comment">// 向Map集合中添加元素</span></span><br><span class="line">        mapr0ysue.put(<span class="string">"ISBN 978-7-5677-8741-4"</span>, <span class="string">"C语言项目开发实战入门"</span>);</span><br><span class="line">        mapr0ysue.put(<span class="string">"ISBN 978-7-5677-9097-1"</span>, <span class="string">"PHP项目开发实战入门"</span>);</span><br><span class="line">        mapr0ysue.put(<span class="string">"ISBN 978-7-5677-8740-7"</span>, <span class="string">"Java项目开发实战入门"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Log.d("5map", "key值toString"+mapr0ysue.toString());</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Set&lt;String&gt; set = mapr0ysue.keySet(); <span class="comment">// 构建Map集合中所有key的Set集合</span></span><br><span class="line">        Iterator&lt;String&gt; it = set.iterator(); <span class="comment">// 创建Iterator迭代器</span></span><br><span class="line">        Log.d(<span class="string">"5map"</span>, <span class="string">"key值："</span>);</span><br><span class="line">        <span class="keyword">while</span> (it.hasNext()) &#123; <span class="comment">// 遍历并输出Map集合中的key值</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">                Log.d(<span class="string">"5map"</span>, it.next()+<span class="string">"  "</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="数组-字符串对象数组-gson-Java-array"><a href="#数组-字符串对象数组-gson-Java-array" class="headerlink" title="数组/字符串对象数组/gson/Java.array"></a>数组/字符串对象数组/gson/Java.array</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Java.openClassFile(<span class="string">"/data/local/tmp/r0gson.dex"</span>).load();</span><br><span class="line"><span class="keyword">const</span> gson = Java.use(<span class="string">'com.r0ysue.gson.Gson'</span>);</span><br><span class="line"></span><br><span class="line">Java.use(<span class="string">"java.util.Arrays"</span>).toString.overload(<span class="string">'[C'</span>).implementation = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> charArray = Java.array(<span class="string">'char'</span>, [ <span class="string">'一'</span>,<span class="string">'去'</span>,<span class="string">'二'</span>,<span class="string">'三'</span>,<span class="string">'里'</span> ]);</span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">this</span>.toString(charArray);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"x,result"</span>,gson.$<span class="keyword">new</span>().toJson(charArray),result);            </span><br><span class="line">    <span class="keyword">return</span> Java.use(<span class="string">'java.lang.String'</span>).$<span class="keyword">new</span>(Java.array(<span class="string">'char'</span>,[<span class="string">'烟'</span>,<span class="string">'村'</span>,<span class="string">'四'</span>,<span class="string">'五'</span>,<span class="string">'家'</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="对象-多态、强制Java-cast"><a href="#对象-多态、强制Java-cast" class="headerlink" title="对象/多态、强制Java.cast"></a>对象/多态、强制Java.cast</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Water</span> </span>&#123; <span class="comment">// 水 类</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">flow</span><span class="params">(Water W)</span> </span>&#123; <span class="comment">// 水 的方法</span></span><br><span class="line">        <span class="comment">// SomeSentence</span></span><br><span class="line">        Log.d(<span class="string">"2Object"</span>, <span class="string">"water flow: I`m flowing"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"water flow: I`m flowing"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">still</span><span class="params">(Water W)</span> </span>&#123; <span class="comment">// 水 的方法</span></span><br><span class="line">        <span class="comment">// SomeSentence</span></span><br><span class="line">        Log.d(<span class="string">"2Object"</span>, <span class="string">"water still: still water runs deep!"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"water still: still water runs deep!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">package</span> com.r0ysue.a0526printout;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> com.r0ysue.a0526printout.Water;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Juice</span> <span class="keyword">extends</span> <span class="title">Water</span> </span>&#123; <span class="comment">// 果汁 类 继承了水类</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">fillEnergy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Log.d(<span class="string">"2Object"</span>, <span class="string">"Juice: i`m fillingEnergy!"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Juice: i`m fillingEnergy!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Water w1 = <span class="keyword">new</span> Water();</span><br><span class="line">        flow(w1) ; <span class="comment">//</span></span><br><span class="line">        Juice J = <span class="keyword">new</span> Juice(); <span class="comment">// 实例化果汁类对象</span></span><br><span class="line">        flow(J) ; <span class="comment">// 调用水的方法  向上转型 J → W</span></span><br><span class="line">        Water w2 = <span class="keyword">new</span> Juice();</span><br><span class="line">        ((Juice) w2).fillEnergy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Waterhandle = <span class="literal">null</span>;</span><br><span class="line">Java.choose(<span class="string">"com.r0ysue.a0526printout.Water"</span>,&#123;</span><br><span class="line">    onMatch:<span class="function"><span class="keyword">function</span>(<span class="params">instance</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"found instance:"</span>,instance);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"water instance call still:"</span>,instance.still(instance));</span><br><span class="line">        Waterhandle = instance;</span><br><span class="line">    &#125;,<span class="attr">onComplete</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">"search completed!"</span>)&#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 这是无法转换的, 无法把父类转换为子类</span></span><br><span class="line"><span class="keyword">var</span> JuiceHandle = Java.cast(Waterhandle,Java.use(<span class="string">"com.r0ysue.a0526printout.Juice"</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"Juice fillEnergy method :"</span>,JuiceHandle.fillEnergy());</span><br><span class="line"><span class="keyword">var</span> JuiceHandle = <span class="literal">null</span> ;</span><br><span class="line">Java.choose(<span class="string">"com.r0ysue.a0526printout.Juice"</span>,&#123;</span><br><span class="line">    onMatch:<span class="function"><span class="keyword">function</span>(<span class="params">instance</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"found instance :"</span>,instance);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"filling energy,"</span>,instance.fillEnergy());</span><br><span class="line">        JuiceHandle= instance;</span><br><span class="line">    &#125;,<span class="attr">onComplete</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="string">"Search Completed!"</span>&#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">var</span> WaterHandle = Java.cast(JuiceHandle ,Java.use(<span class="string">"com.r0ysue.a0526printout.Water"</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"Water invoke still "</span>, WaterHandle.still(WaterHandle));</span><br></pre></td></tr></table></figure>
<h3 id="接口Interface、Java-register"><a href="#接口Interface、Java-register" class="headerlink" title="接口Interface、Java.register"></a>接口Interface、Java.register</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.r0ysue.a0526printout;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">liquid</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">flow</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">package</span> com.r0ysue.a0526printout;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">milk</span> <span class="keyword">implements</span> <span class="title">liquid</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">flow</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Log.d(<span class="string">"3interface"</span>, <span class="string">"flowing : interface "</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"nihao"</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        milk m = <span class="keyword">new</span> milk();</span><br><span class="line">        m.flow();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> beer = Java.registerClass(&#123;</span><br><span class="line">    name: <span class="string">'com.r0ysue.a0526printout.beer'</span>,</span><br><span class="line">    implements: [Java.use(<span class="string">'com.r0ysue.a0526printout.liquid'</span>)],</span><br><span class="line">    methods: &#123;</span><br><span class="line">        flow: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"look I`m beer!"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"taste good!"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"beer.flow:"</span>,beer.$<span class="keyword">new</span>().flow());</span><br></pre></td></tr></table></figure>
<h3 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.r0ysue.a0526printout;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">enum</span> Signal &#123;</span><br><span class="line">    GREEN, YELLOW, RED</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TrafficLight</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Signal color = Signal.RED;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"4enum"</span>, <span class="string">"enum "</span>+ color.getClass().getName().toString());</span><br><span class="line">        <span class="keyword">switch</span> (color) &#123;</span><br><span class="line">            <span class="keyword">case</span> RED:</span><br><span class="line">                color = Signal.GREEN;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> YELLOW:</span><br><span class="line">                color = Signal.RED;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> GREEN:</span><br><span class="line">                color = Signal.YELLOW;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Java.choose(<span class="string">"com.r0ysue.a0526printout.Signal"</span>,&#123;</span><br><span class="line">    onMatch:<span class="function"><span class="keyword">function</span>(<span class="params">instance</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"found instance:"</span>,instance)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"invoke getDeclaringClass"</span>,instance.getDeclaringClass())</span><br><span class="line">    &#125;,<span class="attr">onComplete</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">"Search Completed!"</span>)&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="泛型、List、Map、Set、迭代打印"><a href="#泛型、List、Map、Set、迭代打印" class="headerlink" title="泛型、List、Map、Set、迭代打印"></a>泛型、List、Map、Set、迭代打印</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, String&gt; mapr0ysue = <span class="keyword">new</span> HashMap&lt;&gt;(); <span class="comment">// 创建Map集合对象</span></span><br><span class="line">mapr0ysue.put(<span class="string">"ISBN 978-7-5677-8742-1"</span>, <span class="string">"Android项目开发实战入门"</span>); <span class="comment">// 向Map集合中添加元素</span></span><br><span class="line">mapr0ysue.put(<span class="string">"ISBN 978-7-5677-8741-4"</span>, <span class="string">"C语言项目开发实战入门"</span>);</span><br><span class="line">mapr0ysue.put(<span class="string">"ISBN 978-7-5677-9097-1"</span>, <span class="string">"PHP项目开发实战入门"</span>);</span><br><span class="line">mapr0ysue.put(<span class="string">"ISBN 978-7-5677-8740-7"</span>, <span class="string">"Java项目开发实战入门"</span>);</span><br><span class="line">Set&lt;String&gt; set = mapr0ysue.keySet(); <span class="comment">// 构建Map集合中所有key的Set集合</span></span><br><span class="line">Iterator&lt;String&gt; it = set.iterator(); <span class="comment">// 创建Iterator迭代器</span></span><br><span class="line">Log.d(<span class="string">"5map"</span>, <span class="string">"key值："</span>);</span><br><span class="line"><span class="keyword">while</span> (it.hasNext()) &#123; <span class="comment">// 遍历并输出Map集合中的key值</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">        Log.d(<span class="string">"5map"</span>, it.next()+<span class="string">"  "</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Java.choose(<span class="string">"java.util.HashMap"</span>,&#123;</span><br><span class="line">        onMatch:<span class="function"><span class="keyword">function</span>(<span class="params">instance</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance.toString().indexOf(<span class="string">"ISBN"</span>)!=<span class="number">-1</span>)&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"found HashMap"</span>,instance);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"HashMap toString:"</span>,instance.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,<span class="attr">onComplete</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">"Search Completed!"</span>)&#125;</span><br><span class="line">&#125;)</span><br><span class="line">Java.use(<span class="string">"java.util.HashMap"</span>).put.implementation = <span class="function"><span class="keyword">function</span>(<span class="params">x,y</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">this</span>.put(x,y);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"x,y,result"</span>,x,y,result)</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="重要思路-开发时如何打印、Frida中也是如何打印"><a href="#重要思路-开发时如何打印、Frida中也是如何打印" class="headerlink" title="重要思路:开发时如何打印、Frida中也是如何打印"></a>重要思路:开发时如何打印、Frida中也是如何打印</h3><p>hook的时机要控制好,比如App启动了,实例创建后马上销毁再hook也无济于事</p>
<h3 id="non-ascii-方法名hook"><a href="#non-ascii-方法名hook" class="headerlink" title="non-ascii 方法名hook"></a>non-ascii 方法名hook</h3><p><code>https://api-caller.com/2019/03/30/frida-note/</code><br>比如说一些符号方法名,那就可以通过url编码, 之后再url解码, 就可以hook了<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">int ֏(int x) &#123;</span><br><span class="line">    <span class="keyword">return</span> x + <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line">Java.perform(</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> targetClass = <span class="string">"com.example.hooktest.MainActivity"</span>;</span><br><span class="line">        <span class="keyword">var</span> hookCls = Java.use(targetClass);</span><br><span class="line">        <span class="keyword">var</span> methods = hookCls.class.getDeclaredMethods();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> methods) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(methods[i].toString());</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="built_in">encodeURIComponent</span>(methods[i].toString().replace(<span class="regexp">/^.*?\.([^\s\.\(\)]+)\(.*?$/</span>, <span class="string">"$1"</span>)));</span><br><span class="line">        &#125;</span><br><span class="line">        hookCls[<span class="built_in">decodeURIComponent</span>(<span class="string">"%D6%8F"</span>)]</span><br><span class="line">            .implementation = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"original call: fun("</span> + x + <span class="string">")"</span>);</span><br><span class="line">                <span class="keyword">var</span> result = <span class="keyword">this</span>[<span class="built_in">decodeURIComponent</span>(<span class="string">"%D6%8F"</span>)](<span class="number">900</span>);</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h2 id="Frida综合情景案例"><a href="#Frida综合情景案例" class="headerlink" title="Frida综合情景案例"></a>Frida综合情景案例</h2><ul>
<li>调用静态函数和调用非静态函数</li>
<li><p>设置成员变量</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Java.use(<span class="string">"com.example.androiddemo.Activity.FridaActivity3"</span>).static_bool_var.value = <span class="literal">true</span> ;</span><br></pre></td></tr></table></figure>
</li>
<li><p>内部类,枚举类的函数并hook, trace原型1</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> all_methods = InnerClass.class.getDeclaredMethods();</span><br><span class="line"><span class="comment">//console.log(all_methods);</span></span><br><span class="line"><span class="keyword">var</span> InnerClass = Java.use(class_name);</span><br><span class="line"><span class="keyword">var</span> all_methods = InnerClass.class.getDeclaredMethods();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>;i&lt;all_methods.length;i++)&#123;</span><br><span class="line">   <span class="keyword">var</span> method = all_methods[i];</span><br><span class="line">    <span class="comment">//console.log(method.toString());</span></span><br><span class="line">    <span class="keyword">var</span> substring = method.toString().substr(method.toString().indexOf(class_name)+class_name.length+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">var</span> finalMethodString = substring.substr(<span class="number">0</span>,substring.indexOf(<span class="string">"("</span>));</span><br><span class="line">    <span class="built_in">console</span>.log(finalMethodString);</span><br><span class="line">    InnerClass[finalMethodString].implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="literal">true</span>&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查找接口,hook动态加载dex,<code>补充一个找interface的实现&quot;通杀&quot;的方法</code></p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Java.enumerateClassLoaders(&#123;</span><br><span class="line">    onMatch:<span class="function"><span class="keyword">function</span>(<span class="params">loader</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(loader.findClass(<span class="string">"com.example.androiddemo.Dynamic.DynamicCheck"</span>))&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"Succefully found loader!"</span>,loader);</span><br><span class="line">                Java.classFactory.loader = loader;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"found error "</span>+error)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,<span class="attr">onComplete</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="string">"enum completed!"</span>&#125;</span><br><span class="line">&#125;)</span><br><span class="line">Java.use(<span class="string">"com.example.androiddemo.Dynamic.DynamicCheck"</span>).check.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="literal">true</span>&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>枚举class, trace原型2</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     Java.enumerateLoadedClasses(&#123;</span><br><span class="line">         onMatch:<span class="function"><span class="keyword">function</span>(<span class="params">name,handle</span>)</span>&#123;</span><br><span class="line">             <span class="keyword">if</span>(name.toString().indexOf(<span class="string">"com.example.androiddemo.Activity.Frida6.Frida6"</span>)&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">                 <span class="built_in">console</span>.log(<span class="string">"name"</span>,name)</span><br><span class="line">                 Java.use(name).check.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="literal">true</span>&#125;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;,onComplete()&#123;&#125;</span><br><span class="line">     &#125;)</span><br><span class="line"> &#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="找hook原则"><a href="#找hook原则" class="headerlink" title="找hook原则"></a>找hook原则</h3><ul>
<li>开发视角</li>
<li>hook点离数据越近越好</li>
<li>换安卓版本,换frida版本试试</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        Java.use(<span class="string">"com.example.androiddemo.Activity.LoginActivity"</span>).a.overload(<span class="string">'java.lang.String'</span>, <span class="string">'java.lang.String'</span>).implementation = <span class="function"><span class="keyword">function</span>(<span class="params">x,y</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> result = <span class="keyword">this</span>.a(x,y);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"x,y,result"</span>,x,y,result);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Java.use(<span class="string">"com.example.androiddemo.Activity.FridaActivity1"</span>).a.implementation = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"first challenge 1"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"R4jSLLLLLLLLLLOrLE7/5B+Z6fsl65yj6BgC6YWz66gO6g2t65Pk6a+P65NK44NNROl0wNOLLLL="</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">second</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        Java.use(<span class="string">"com.example.androiddemo.Activity.FridaActivity2"</span>).setStatic_bool_var();</span><br><span class="line"></span><br><span class="line">        Java.choose(<span class="string">"com.example.androiddemo.Activity.FridaActivity2"</span>,&#123;</span><br><span class="line">            onMatch:<span class="function"><span class="keyword">function</span>(<span class="params">instance</span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"found instance :"</span>,instance);</span><br><span class="line">                instance.setBool_var()</span><br><span class="line">            &#125;,<span class="attr">onComplete</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">third</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        </span><br><span class="line">        Java.use(<span class="string">"com.example.androiddemo.Activity.FridaActivity3"</span>).static_bool_var.value = <span class="literal">true</span> ;</span><br><span class="line"></span><br><span class="line">        Java.choose(<span class="string">"com.example.androiddemo.Activity.FridaActivity3"</span>,&#123;</span><br><span class="line">            onMatch:<span class="function"><span class="keyword">function</span>(<span class="params">instance</span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"found instance :"</span>,instance);</span><br><span class="line">                instance.bool_var.value = <span class="literal">true</span> ;</span><br><span class="line">                instance._same_name_bool_var.value = <span class="literal">true</span> ;</span><br><span class="line">            &#125;,<span class="attr">onComplete</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">forth</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        Java.use(<span class="string">"com.example.androiddemo.Activity.FridaActivity4$InnerClasses"</span>).check1.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="literal">true</span>&#125;;</span><br><span class="line">        Java.use(<span class="string">"com.example.androiddemo.Activity.FridaActivity4$InnerClasses"</span>).check2.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="literal">true</span>&#125;;</span><br><span class="line">        Java.use(<span class="string">"com.example.androiddemo.Activity.FridaActivity4$InnerClasses"</span>).check3.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="literal">true</span>&#125;;</span><br><span class="line">        Java.use(<span class="string">"com.example.androiddemo.Activity.FridaActivity4$InnerClasses"</span>).check4.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="literal">true</span>&#125;;</span><br><span class="line">        Java.use(<span class="string">"com.example.androiddemo.Activity.FridaActivity4$InnerClasses"</span>).check5.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="literal">true</span>&#125;;</span><br><span class="line">        Java.use(<span class="string">"com.example.androiddemo.Activity.FridaActivity4$InnerClasses"</span>).check6.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="literal">true</span>&#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">forth2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> class_name = <span class="string">"com.example.androiddemo.Activity.FridaActivity4$InnerClasses"</span> ;</span><br><span class="line">        <span class="keyword">var</span> InnerClass = Java.use(class_name);</span><br><span class="line">        <span class="keyword">var</span> all_methods = InnerClass.class.getDeclaredMethods();</span><br><span class="line">        <span class="comment">//console.log(all_methods);</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>;i&lt;all_methods.length;i++)&#123;</span><br><span class="line">            <span class="keyword">var</span> method = all_methods[i];</span><br><span class="line">            <span class="comment">//console.log(method.toString());</span></span><br><span class="line">            <span class="keyword">var</span> substring = method.toString().substr(method.toString().indexOf(class_name)+class_name.length+<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">var</span> finalMethodString = substring.substr(<span class="number">0</span>,substring.indexOf(<span class="string">"("</span>));</span><br><span class="line">            <span class="built_in">console</span>.log(finalMethodString);</span><br><span class="line">            InnerClass[finalMethodString].implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="literal">true</span>&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fifth</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        Java.choose(<span class="string">"com.example.androiddemo.Activity.FridaActivity5"</span>,&#123;</span><br><span class="line">            onMatch:<span class="function"><span class="keyword">function</span>(<span class="params">instance</span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"found instance getDynamicDexCheck :"</span>,instance.getDynamicDexCheck().$className);</span><br><span class="line">            &#125;,<span class="attr">onComplete</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">"search complete!"</span>)&#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        Java.enumerateClassLoaders(&#123;</span><br><span class="line">            onMatch:<span class="function"><span class="keyword">function</span>(<span class="params">loader</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span>(loader.findClass(<span class="string">"com.example.androiddemo.Dynamic.DynamicCheck"</span>))&#123;</span><br><span class="line">                        <span class="built_in">console</span>.log(<span class="string">"Succefully found loader!"</span>,loader);</span><br><span class="line">                        Java.classFactory.loader = loader;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">"found error "</span>+error)</span><br><span class="line">                    </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,<span class="attr">onComplete</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="string">"enum completed!"</span>&#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        Java.use(<span class="string">"com.example.androiddemo.Dynamic.DynamicCheck"</span>).check.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="literal">true</span>&#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sixth</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        Java.use(<span class="string">"com.example.androiddemo.Activity.Frida6.Frida6Class0"</span>).check.implementation = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="literal">true</span> &#125;;</span><br><span class="line">        Java.use(<span class="string">"com.example.androiddemo.Activity.Frida6.Frida6Class1"</span>).check.implementation = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="literal">true</span> &#125;;</span><br><span class="line">        Java.use(<span class="string">"com.example.androiddemo.Activity.Frida6.Frida6Class2"</span>).check.implementation = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="literal">true</span> &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sixth2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        Java.enumerateLoadedClasses(&#123;</span><br><span class="line">            onMatch:<span class="function"><span class="keyword">function</span>(<span class="params">name,handle</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(name.toString().indexOf(<span class="string">"com.example.androiddemo.Activity.Frida6.Frida6"</span>)&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">"name"</span>,name)</span><br><span class="line">                    Java.use(name).check.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="literal">true</span>&#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,onComplete()&#123;&#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(sixth2);</span><br></pre></td></tr></table></figure>
<p><br><br><br></p>
<h2 id="RPC远程调用概念和实例"><a href="#RPC远程调用概念和实例" class="headerlink" title="RPC远程调用概念和实例"></a>RPC远程调用概念和实例</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"></span><br><span class="line">def my_message_handler(message, payload):</span><br><span class="line">    print(message)</span><br><span class="line">    print(payload)</span><br><span class="line"></span><br><span class="line"># usb connection</span><br><span class="line">device = frida.get_usb_device()</span><br><span class="line"></span><br><span class="line">device = frida.get_device_manager().add_remote_device(<span class="string">"192.168.1.102:9999"</span>)</span><br><span class="line"># 注意frida-server的端口也是开在9999上,并且是同一个局域网互联</span><br><span class="line">device = frida.</span><br><span class="line">#pid = device.spawn("com.example.session4one")</span><br><span class="line">#device.resume</span><br><span class="line">#time.sleep(1)</span><br><span class="line">#session = device.attach(pid)</span><br><span class="line">session = device.attach(<span class="string">"com.example.session4one"</span>)</span><br><span class="line"><span class="keyword">while</span> open(<span class="string">"task.js"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    script = session.create_script(f.read())</span><br><span class="line">script.on(<span class="string">"message"</span>, my_message_handler)</span><br><span class="line">script.load()</span><br><span class="line"></span><br><span class="line">command = <span class="string">""</span></span><br><span class="line"><span class="keyword">while</span> True:</span><br><span class="line">    command = input(<span class="string">"Enter Command:"</span>)</span><br><span class="line">    <span class="keyword">if</span> command == <span class="string">"1"</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    elif command == <span class="string">"2"</span>:</span><br><span class="line">        script.exports.infokefunc</span><br></pre></td></tr></table></figure>
<h3 id="逆向三段-第三段RPC"><a href="#逆向三段-第三段RPC" class="headerlink" title="逆向三段:第三段RPC"></a>逆向三段:第三段RPC</h3><p>Remote Procedure Call 远程调用<br>利用这段可以进行多主机多手机多端口混连<code>device = frida.get_device_manager().add_remote_device(&quot;192.168.1.102:9999&quot;)</code></p>
<h3 id="远程调动-互联互通-动态修改"><a href="#远程调动-互联互通-动态修改" class="headerlink" title="远程调动,互联互通,动态修改"></a>远程调动,互联互通,动态修改</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.use(<span class="string">"android.widget.TextView"</span>).setText.overload(<span class="string">'java.lang.CharSequence'</span>).implementation = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> string_to_send_x = x.toString();</span><br><span class="line">        <span class="keyword">var</span> string_to_recv;</span><br><span class="line">        send(string_to_send_x);</span><br><span class="line">        recv(<span class="function"><span class="keyword">function</span>(<span class="params">received_json_objection</span>)</span>&#123;</span><br><span class="line">            string_to_recv = received_json_objection.my_data</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"string_to_recv:"</span>+string_to_recv)</span><br><span class="line">        &#125;).wait();</span><br><span class="line">        <span class="keyword">var</span> javaStringToSend=Java.use(<span class="string">'java.lang.String'</span>).$<span class="keyword">new</span>(string_to_recv);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> result = <span class="keyword">this</span>.setText(javaStringToSend);</span><br><span class="line">        <span class="comment">//console.log("x.toString(),result",x.toString(),result);</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_message_handler</span><span class="params">(message,payload)</span>:</span></span><br><span class="line">    print(message)</span><br><span class="line">    print(payload)</span><br><span class="line">    <span class="keyword">if</span> message[<span class="string">"type"</span>]==<span class="string">"send"</span>:</span><br><span class="line">        print(message[<span class="string">"payload"</span>])</span><br><span class="line">        data = message[<span class="string">"payload"</span>].split(<span class="string">":"</span>)[<span class="number">1</span>].strip()</span><br><span class="line">        print(<span class="string">'message:'</span>,message)</span><br><span class="line">        data = str(base64.b64decode(data))</span><br><span class="line">        print(<span class="string">'data:'</span>,data)</span><br><span class="line">        usr,pw = data.split(<span class="string">":"</span>)</span><br><span class="line">        print(<span class="string">'pw:'</span>,pw)</span><br><span class="line">        data = str(base64.b64encode((<span class="string">"admin"</span>+<span class="string">":"</span>+pw).encode()))</span><br><span class="line">        print(<span class="string">"encode data:"</span>,data)</span><br><span class="line">        script.post(&#123;<span class="string">"my_data"</span>:data&#125;)</span><br><span class="line">        print(<span class="string">"Modified data sent !"</span>)</span><br><span class="line"></span><br><span class="line">device = frida.get_usb_device()</span><br><span class="line"></span><br><span class="line"><span class="comment">#pid = device.spawn(["com.example.lesson4one"])</span></span><br><span class="line"><span class="comment">#device.resume</span></span><br><span class="line"><span class="comment">#time.sleep(1)</span></span><br><span class="line"><span class="comment">#session = device.attach(pid)</span></span><br><span class="line">session = device.attach(<span class="string">"com.example.lesson7sec"</span>)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"lesson7sec.js"</span>) <span class="keyword">as</span> f :</span><br><span class="line">    script = session.create_script(f.read())</span><br><span class="line">script.on(<span class="string">"message"</span>,my_message_handler)</span><br><span class="line">script.load()</span><br><span class="line">input()</span><br></pre></td></tr></table></figure>
<p><br></p>
<h2 id="Rpc公开外网"><a href="#Rpc公开外网" class="headerlink" title="Rpc公开外网"></a>Rpc公开外网</h2><p>通过flask的web框架公布到公网集群中去</p>
<p><code>nps: 一款轻量级、高性能、功能强大的内网穿透代理服务器。支持tcp、udp、socks5、http等几乎所有流量转发，可用来访问内网网站、本地支付接口调试、ssh访问、远程桌面，内网dns解析、内网socks5代理等等……，并带有功能强大的web管理端。</code></p>
<p>先通过nps的server段架设到公网<br>再通过nps的client段架设到Android手机上<br>建立tcp隧道通信,直接连通android frida server的端口,映射公网的端口<br>这样python脚本的frida rpc可以直接操作android手机客户端的frida server<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">device = frida.get_device_manager().add_remote_device(<span class="string">"公网ip:58888"</span>)</span><br></pre></td></tr></table></figure></p>
<p>Zentracer是葫芦娃大佬写的Tracer工具，它基于Pyqt+Frida开发，短小精悍。</p>
<p><code>https://www.anquanke.com/post/id/196657</code></p>
<p><code>child-gating</code>子进程管理器</p>
<p>解析原先DEXDump的源码以及Zentrace的源码</p>
<p><br></p>
<h2 id="综合实战"><a href="#综合实战" class="headerlink" title="综合实战"></a>综合实战</h2><ul>
<li>spawn/attach 时机的选择</li>
<li>各种主动调用/直接lu完</li>
<li>各种hook及构造函数</li>
<li>动态加载自己的dex</li>
<li>约束求解/符号执行</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        Java.openClassFile(<span class="string">"/data/local/tmp/classes.dex"</span>).load();</span><br><span class="line">        <span class="keyword">const</span> reverseA = Java.use(<span class="string">'com.example.lesson9.reverseA'</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"reverseA result:"</span>,reverseA.decode_P());</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"r_to_hex result:"</span>,reverseA.r_to_hex());</span><br><span class="line"></span><br><span class="line">        Java.use(<span class="string">"java.lang.System"</span>).getProperty.overload(<span class="string">'java.lang.String'</span>).implementation = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> result = <span class="keyword">this</span>.getProperty(x);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"x,result:"</span>,x,result);</span><br><span class="line">            <span class="keyword">return</span> Java.use(<span class="string">"java.lang.String"</span>).$<span class="keyword">new</span>(<span class="string">"Russia"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Java.use(<span class="string">"java.lang.System"</span>).getenv.overload(<span class="string">'java.lang.String'</span>).implementation = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> result = <span class="keyword">this</span>.getenv(x);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"x,result:"</span>,x,result);</span><br><span class="line">            <span class="keyword">return</span> Java.use(<span class="string">"java.lang.String"</span>).$<span class="keyword">new</span>(<span class="string">"RkxBR3s1N0VSTDFOR180UkNIM1J9Cg=="</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        Java.use("com.tlamb96.kgbmessenger.b.a").$init.implementation = function(str0,str1,str2,b)&#123;</span></span><br><span class="line"><span class="comment">            var result = this.$init(str0,str1,str2,b);</span></span><br><span class="line"><span class="comment">            console.log(Java.use("android.util.Log").getStackTraceString(Java.use("java.lang.Throwable").$new()));</span></span><br><span class="line"><span class="comment">            console.log("str0,str1,str2,b:",str0,str1,str2,b)</span></span><br><span class="line"><span class="comment">            return result;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        Java.use("com.tlamb96.kgbmessenger.MessengerActivity").a.implementation = function(x)&#123;            </span></span><br><span class="line"><span class="comment">            var result = this.a(x);</span></span><br><span class="line"><span class="comment">            console.log("a:x,result:",x,result);</span></span><br><span class="line"><span class="comment">            if(x=="aaaa")&#123;</span></span><br><span class="line"><span class="comment">                result= Java.use("java.lang.String").$new("V@]EAASB\u0012WZF\u0012e,a$7(&amp;am2(3.\u0003");            </span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">            return result;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment">        Java.use("com.tlamb96.kgbmessenger.MessengerActivity").b.implementation = function(x)&#123;</span></span><br><span class="line"><span class="comment">            var result = this.b(x);</span></span><br><span class="line"><span class="comment">            console.log("b:x,result:",x,result);</span></span><br><span class="line"><span class="comment">            if(x=="bbbb")&#123;</span></span><br><span class="line"><span class="comment">                result= Java.use("java.lang.String").$new("\u0000dslp&#125;oQ\u0000 dks$|M\u0000h +AYQg\u0000P*!M$gQ\u0000");</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">            return result;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(main)</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.lesson9;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">reverseA</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">decode_P</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String p = <span class="string">"V@]EAASB\u0012WZF\u0012e,a$7(&amp;am2(3.\u0003"</span>;</span><br><span class="line">        String result = a(p);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">a</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">char</span>[] charArray = str.toCharArray();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; charArray.length / <span class="number">2</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">char</span> c = charArray[i];</span><br><span class="line">            charArray[i] = (<span class="keyword">char</span>) (charArray[(charArray.length - i) - <span class="number">1</span>] ^ <span class="string">'A'</span>);</span><br><span class="line">            charArray[(charArray.length - i) - <span class="number">1</span>] = (<span class="keyword">char</span>) (c ^ <span class="string">'2'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String(charArray);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">r_to_hex</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String r = <span class="string">"\u0000dslp&#125;oQ\u0000 dks$|M\u0000h +AYQg\u0000P*!M$gQ\u0000"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] bytes = r.getBytes();</span><br><span class="line">        String result = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;bytes.length;i++)&#123;</span><br><span class="line">            result += String.format(<span class="string">"%02x"</span>,bytes[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br><br><br></p>
<h1 id="Xposed"><a href="#Xposed" class="headerlink" title="Xposed"></a>Xposed</h1><p><code>一般公司稳定性选用xposed, frida一般都用于逆向测试, xposed用来开发产品并发布</code></p>
<p>Xposed是一款可以不修改Apk情况下影响程序运行的框架<br>基于它可以制作许多功能强大的模块,且在功能不冲突的情况下同时运作</p>
<p>在这个框架下,我们可以编写并加载自己编写的插件App,实现对目标Apk的注入、拦截等</p>
<p>Xposed作者出自国外大名鼎鼎的Android论坛Xda, 由作者rovo89进行更新和维护<br>在8.1的betal版后目前迟迟未见更新 </p>
<p>xposed历史悠久, 几乎伴随着Google对每一个Android版本的升级, 上至Android2时代, 到现在的Android8, 在没有AndroidStudio作为Android开发的ide时代</p>
<h2 id="Xposed与edxposed安装"><a href="#Xposed与edxposed安装" class="headerlink" title="Xposed与edxposed安装"></a>Xposed与edxposed安装</h2><h3 id="Xposed-原理"><a href="#Xposed-原理" class="headerlink" title="Xposed 原理"></a>Xposed 原理</h3><p>控制Zygote进程,通过替换<code>/system/bin/app_process</code>程序控制zygote进程,使得它在系统启动的过程中会加载Xposed Framework的一个jar文件即XposedBridge.jar,<br>从而完成对Zygote进程以及其创建Dalvik/Art虚拟机的劫持, 并且能够允许开发者独立的替代任何class, 例如framework本身, 系统UI又或者随意的一个App</p>
<h3 id="Xposed的安装"><a href="#Xposed的安装" class="headerlink" title="Xposed的安装"></a>Xposed的安装</h3><p>4.4以下Android版本安装较为简单, 只需两步即可</p>
<ul>
<li>对需要安装Xposed的手机进行root</li>
<li>下载并安装xposedinstaller, 之手授予其root权限, 进入app点击安装即可 </li>
</ul>
<p>很遗憾, 当前官网不再维护, 导致无法直接通过xposedinstaller下载补丁包 </p>
<p>从Android5.0开始, 谷歌使用Art替换Dalvik, 所以xposed安装有点麻烦, 分为两个部分: <code>xposed*.zip</code>和<code>XposedInstaller.apk</code><br>zip文件是框架主体, 需要进入Recovery后刷入, apk文件是xposed模块管理应用, 主要用于下载、激活、是否启用模块等管理功能 </p>
<ul>
<li>完成对手机的Root,并刷入recovery(比如twrp);</li>
<li>下载对应的zip补丁包,进入recovery刷入;</li>
<li>重启手机, 安装xposedinstaller并授予root权限即可 </li>
</ul>
<p>如果你买了华为、小米,并不是Google亲儿子手机, 虽然说rom可以搜到,并且rom是定制的,这会踩很多的坑<br>所以还是推荐pixel或者nexus手机</p>
<p>从Android9,10等新版本安装Edxposed<br>对于Xposed官方不支持的较新的Android版本可以先安装magisk, 接着安装riyu模块, 最后再进行Edxposed的安装即可</p>
<h3 id="Xposed优秀插件"><a href="#Xposed优秀插件" class="headerlink" title="Xposed优秀插件"></a>Xposed优秀插件</h3><p>隐私保护:Xprivacy<br>微信相关模块: 红包助手、防撤回、自动化营销等<br>QQ相关模块: QQ抢红包、QQ防撤回、记录QQ账号密码模块</p>
<p>开启Debug的<br>幸运破解器: 应用内购破解, 去广告神器<br>绿色守护: 切断后台唤醒、推送的神器<br>抓包神器: justtrustme<br>等等其他优秀插件 </p>
<p><br></p>
<h2 id="Xposed插件"><a href="#Xposed插件" class="headerlink" title="Xposed插件"></a>Xposed插件</h2><ul>
<li>拷贝XposedBridgeApi.jar到新建工程的libs目录</li>
<li>修改app目录下的build.gradle文件,在AndroidManifest.xml中增加Xposed相关内容</li>
<li>新建hook类, 编写hook代码</li>
<li>新建assets文件夹,然后在assets目录下新建文件xposed_init,在里面写上hook类的完整路径 </li>
</ul>
<h3 id="编写准备"><a href="#编写准备" class="headerlink" title="编写准备"></a>编写准备</h3><ul>
<li>新建Android Studio工程,选择有无Activity皆可, 并将XposedBridge.jar拷贝到libs目录下, 然后双击App目录下的build.gradle文件, 将 </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">compile fileTree(include:&#123;&apos;*.jar&apos;&#125;, dir:&apos;libs&apos;)</span><br><span class="line">替换为</span><br><span class="line">provided fileTree(include:&#123;&apos;*.jar&apos;&#125;, dir:&apos;libs&apos;)</span><br><span class="line">由于provided比较老,用compileOnly也是比较合适的</span><br><span class="line">compileOnly</span><br></pre></td></tr></table></figure>
<p>如果使用compile,可以正常编译生成插件apk, 但是当安装到手机上后, xposed会报错无法正常工作 </p>
<ul>
<li>修改AndroidManifest.xml文件,在Application标签下增加内容如下</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta-data</span><br><span class="line">    android:name=&quot;xposedmodule&quot;     //是否配置为xposed插件,设置为true</span><br><span class="line">    android:value=&quot;true&quot; /&gt;</span><br><span class="line">&lt;meta-data android:name=&quot;xposeddescription&quot;</span><br><span class="line">    android:value=&quot;第一个Xposed插件&quot;/&gt;       // 模块名称</span><br><span class="line">&lt;meta-data android:name=&quot;xposedminversion&quot;</span><br><span class="line">    android:value=&quot;54&quot; /&gt;       //最低版本号</span><br></pre></td></tr></table></figure>
<h3 id="插件编写"><a href="#插件编写" class="headerlink" title="插件编写"></a>插件编写</h3><p>新建hook类,命名为XModule,并实现接口IXposedHookLoadPackage即可, 并实现里面关键方法<code>handleLoadPackage(XC_LoadPackage.LoadPackageParam lpParam)</code>,该方法会在每个软件被启动的时候回调,所以一般需要通过目标包过滤,内容如下 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XModule</span> <span class="title">implementes</span> <span class="title">IXposedHookLoadPackage</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleLoadPackage</span><span class="params">(XC_LoadPackage.LoadPackageParam loadPackageParam)</span> <span class="keyword">throws</span> Throwable</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(loadPackageParam.packageName.equals(<span class="string">"com.example.test"</span>))&#123;</span><br><span class="line">            XposedBridge.log(<span class="string">"XLZH"</span> + loadPackageParam.packageName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="插件告知"><a href="#插件告知" class="headerlink" title="插件告知"></a>插件告知</h3><p> 新建assets目录,在其中新建文本xposed_init<br> 里面内容为实现了IXposedHookLoadPackage接口的hook类的完整类名<br> 可以有多个,每一个hook实现类一行</p>
<h2 id="Hook构造函数并修改属性"><a href="#Hook构造函数并修改属性" class="headerlink" title="Hook构造函数并修改属性"></a>Hook构造函数并修改属性</h2><ul>
<li>无参构造函数的hook</li>
<li>有参构造函数的hook</li>
</ul>
<h3 id="应用代码"><a href="#应用代码" class="headerlink" title="应用代码"></a>应用代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kanxue.xposedhook01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    String name = <span class="keyword">null</span>;</span><br><span class="line">    String id = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">int</span> age = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String nickname = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String teacher = <span class="keyword">null</span>;</span><br><span class="line"><span class="comment">/*01-09 04:53:39.748 20009-20009/com.kanxue.xposedhook01 I/Xposed: beforeHookedMethod publicfunc-&gt;arg0:publicfunc---arg1:500</span></span><br><span class="line"><span class="comment">01-09 04:53:39.748 20009-20009/com.kanxue.xposedhook01 I/Xposed: beforeHookedMethod11 privatefunc-&gt;arg0:privatefunc---arg1:300</span></span><br><span class="line"><span class="comment">01-09 04:53:39.748 20009-20009/com.kanxue.xposedhook01 I/Xposed: privatefunc is called!---privatefunc---300</span></span><br><span class="line"><span class="comment">01-09 04:53:39.748 20009-20009/com.kanxue.xposedhook01 I/Xposed: afterHookedMethod11 privatefunc-&gt;result:privatefunc---300</span></span><br><span class="line"><span class="comment">01-09 04:53:39.748 20009-20009/com.kanxue.xposedhook01 I/Xposed: publicfunc is called!---changedbyxposedjava---888</span></span><br><span class="line"><span class="comment">01-09 04:53:39.748 20009-20009/com.kanxue.xposedhook01 I/Xposed: beforeHookedMethod getpersonname-&gt;person</span></span><br><span class="line"><span class="comment">01-09 04:53:39.749 20009-20009/com.kanxue.xposedhook01 I/Xposed: afterHookedMethod getpersonname-&gt;person</span></span><br><span class="line"><span class="comment">01-09 04:53:39.749 20009-20009/com.kanxue.xposedhook01 I/Xposed: afterHookedMethod publicfunc-&gt;result:changedbyxposedjava---888---privatefunc---300---person</span></span><br><span class="line"><span class="comment">01-09 04:53:39.749 20009-20009/com.kanxue.xposedhook01 I/xposed: changedbyxposed-&gt;afterHookedMethod</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">person</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> String name;</span><br><span class="line">        <span class="keyword">public</span> String sex;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getpersonname</span><span class="params">(String arg0)</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> arg0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNickname</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> nickname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getTeacher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> teacher;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        name = <span class="string">"default"</span>;</span><br><span class="line">        id = <span class="string">"default"</span>;</span><br><span class="line">        age = <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        id = <span class="string">"default"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String name, String id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String name, String id, <span class="keyword">int</span> age, String teachername, String nickname)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        teacher = teachername;</span><br><span class="line">        <span class="keyword">this</span>.nickname = nickname;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">publicstaticfunc</span><span class="params">(String arg1, <span class="keyword">int</span> arg2)</span> </span>&#123;</span><br><span class="line">        String result = privatestaticfunc(<span class="string">"privatestaticfunc"</span>, <span class="number">200</span>);</span><br><span class="line">        Log.i(<span class="string">"Xposed"</span>,<span class="string">"publicstaticfunc is called!"</span>+<span class="string">"---"</span>+arg1+<span class="string">"---"</span>+arg2);</span><br><span class="line">        <span class="keyword">return</span> arg1 + <span class="string">"---"</span> + arg2 + <span class="string">"---"</span> + result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">privatestaticfunc</span><span class="params">(String arg1, <span class="keyword">int</span> arg2)</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"Xposed"</span>,<span class="string">"privatestaticfunc is called!"</span>+<span class="string">"---"</span>+arg1+<span class="string">"---"</span>+arg2);</span><br><span class="line">        <span class="keyword">return</span> arg1 + <span class="string">"---"</span> + arg2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">publicfunc</span><span class="params">(String arg1, <span class="keyword">int</span> arg2)</span> </span>&#123;</span><br><span class="line">        String result = privatefunc(<span class="string">"privatefunc"</span>, <span class="number">300</span>);</span><br><span class="line">        Log.i(<span class="string">"Xposed"</span>,<span class="string">"publicfunc is called!"</span>+<span class="string">"---"</span>+arg1+<span class="string">"---"</span>+arg2);</span><br><span class="line">        person tmp=<span class="keyword">new</span> person();</span><br><span class="line">        String tmpresult=tmp.getpersonname(<span class="string">"person"</span>);</span><br><span class="line">        <span class="keyword">return</span> arg1 + <span class="string">"---"</span> + arg2 + <span class="string">"---"</span> + result+<span class="string">"---"</span>+tmpresult;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">privatefunc</span><span class="params">(String arg1, <span class="keyword">int</span> arg2)</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"Xposed"</span>,<span class="string">"privatefunc is called!"</span>+<span class="string">"---"</span>+arg1+<span class="string">"---"</span>+arg2);</span><br><span class="line">        <span class="keyword">return</span> arg1 + <span class="string">"---"</span> + arg2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Student astudent = <span class="keyword">new</span> Student();</span><br><span class="line">Student bstudent = <span class="keyword">new</span> Student(<span class="string">"xiaoming"</span>);</span><br><span class="line">Student cstudent = <span class="keyword">new</span> Student(<span class="string">"xiaohua"</span>, <span class="string">"2020"</span>);</span><br><span class="line">Student dstudent = <span class="keyword">new</span> Student(<span class="string">"xiaohong"</span>, <span class="string">"2010"</span>, <span class="number">20</span>, <span class="string">"teacher"</span>, <span class="string">"panda"</span>);</span><br></pre></td></tr></table></figure>
<h3 id="Hook代码"><a href="#Hook代码" class="headerlink" title="Hook代码"></a>Hook代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kanxue.xposed01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.IXposedHookLoadPackage;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XC_MethodHook;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedBridge;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedHelpers;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.callbacks.XC_LoadPackage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HookConstructors</span> <span class="keyword">implements</span> <span class="title">IXposedHookLoadPackage</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleLoadPackage</span><span class="params">(XC_LoadPackage.LoadPackageParam loadPackageParam)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"Xposed01"</span>, loadPackageParam.packageName);</span><br><span class="line">        XposedBridge.log(<span class="string">"Xposed01-&gt;app packagename"</span> + loadPackageParam.packageName);</span><br><span class="line">        <span class="keyword">if</span> (loadPackageParam.packageName.equals(<span class="string">"com.kanxue.xposedhook01"</span>)) &#123;</span><br><span class="line">            <span class="comment">//XposedBridge.log("kanxue " + loadPackageParam.packageName);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     <span class="comment">/*     public static de.robv.android.xposed.XC_MethodHook.Unhook findAndHookConstructor(java.lang.Class&lt;?&gt; clazz, java.lang.Object... parameterTypesAndCallback)</span></span><br><span class="line"><span class="comment">            public static de.robv.android.xposed.XC_MethodHook.Unhook findAndHookConstructor(java.lang.String className, java.lang.ClassLoader classLoader, java.lang.Object... parameterTypesAndCallback)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">            ClassLoader classLoader = loadPackageParam.classLoader;</span><br><span class="line">            Class StudentClass = classLoader.loadClass(<span class="string">"com.kanxue.xposedhook01.Student"</span>);</span><br><span class="line">            XposedHelpers.findAndHookConstructor(StudentClass, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(<span class="string">"com.kanxue.xposedhook01.Student() is called!!beforeHookedMethod"</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(<span class="string">"com.kanxue.xposedhook01.Student() is called!!afterHookedMethod"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//    public Student(String name2) &#123;</span></span><br><span class="line">            <span class="comment">//        this.name = name2;</span></span><br><span class="line">            <span class="comment">//        this.id = "default";</span></span><br><span class="line">            <span class="comment">//    &#125;</span></span><br><span class="line">            <span class="comment">//       public java.lang.Object thisObject;</span></span><br><span class="line">            <span class="comment">//        public java.lang.Object[] args;</span></span><br><span class="line">            <span class="comment">//        private java.lang.Object result;</span></span><br><span class="line">            XposedHelpers.findAndHookConstructor(StudentClass, String.class, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">                    java.lang.Object[] argsobjarray = param.args;</span><br><span class="line">                    String name = (String) argsobjarray[<span class="number">0</span>];</span><br><span class="line">                    XposedBridge.log(<span class="string">"com.kanxue.xposedhook01.Student(String) is called!!beforeHookedMethod--"</span> + name);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(<span class="string">"com.kanxue.xposedhook01.Student(String) is called!!afterHookedMethod"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">//    public Student(String name2, String id2) &#123;</span></span><br><span class="line">            <span class="comment">//        this.name = name2;</span></span><br><span class="line">            <span class="comment">//        this.id = id2;</span></span><br><span class="line">            <span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line">            XposedHelpers.findAndHookConstructor(<span class="string">"com.kanxue.xposedhook01.Student"</span>, loadPackageParam.classLoader, String.class, String.class, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">                    java.lang.Object[] argsobjarray = param.args;</span><br><span class="line">                    String name = (String) argsobjarray[<span class="number">0</span>];</span><br><span class="line">                    String id = (String) argsobjarray[<span class="number">1</span>];</span><br><span class="line">                    XposedBridge.log(<span class="string">"com.kanxue.xposedhook01.Student(String,String) is called!!beforeHookedMethod--"</span> + name + <span class="string">"---"</span> + id);</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(<span class="string">"com.kanxue.xposedhook01.Student(String,String) is called!!afterHookedMethod"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            ClassLoader pathClassLoader= loadPackageParam.classLoader;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">final</span> Class stuClass=pathClassLoader.loadClass(<span class="string">"com.kanxue.xposedhook01.Student"</span>);</span><br><span class="line">            XposedBridge.log(<span class="string">"StudentClass-&gt;"</span>+stuClass);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*            Field teacherField=stuClass.getDeclaredField("teacher");</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            //teacherField.setAccessible(true);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            teacherField.set(null,"teacher666");</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            String teachername1= (String) teacherField.get(null);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            XposedBridge.log("teacherField-&gt;"+teachername1);*/</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//(java.lang.Class&lt;?&gt; clazz, java.lang.String fieldName, java.lang.Object value)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            XposedHelpers.setStaticObjectField(stuClass,<span class="string">"teacher"</span>,<span class="string">"teacher888"</span>);</span><br><span class="line"></span><br><span class="line">            String teachername2= (String) XposedHelpers.getStaticObjectField(stuClass,<span class="string">"teacher"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            XposedBridge.log(<span class="string">"XposedHelpers.getStaticObjectField-&gt;"</span>+teachername2);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">/*XposedHelpers.findAndHookConstructor(StudentClass, String.class, String.class, new XC_MethodHook() &#123;</span></span><br><span class="line"><span class="comment">                @Override</span></span><br><span class="line"><span class="comment">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span></span><br><span class="line"><span class="comment">                    super.beforeHookedMethod(param);</span></span><br><span class="line"><span class="comment">                    java.lang.Object[] argsobjarray = param.args;</span></span><br><span class="line"><span class="comment">                    String name = (String) argsobjarray[0];</span></span><br><span class="line"><span class="comment">                    String id = (String) argsobjarray[1];</span></span><br><span class="line"><span class="comment">                    XposedBridge.log("com.kanxue.xposedhook01.Student(String,String) is called!!beforeHookedMethod--" + name + "---" + id);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                @Override</span></span><br><span class="line"><span class="comment">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span></span><br><span class="line"><span class="comment">                    super.afterHookedMethod(param);</span></span><br><span class="line"><span class="comment">                    XposedBridge.log("com.kanxue.xposedhook01.Student(String,String) is called!!afterHookedMethod");</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">            &#125;);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">            <span class="comment">//public Student(String name2, String id2, int age2)</span></span><br><span class="line">            XposedHelpers.findAndHookConstructor(StudentClass, String.class, String.class, <span class="keyword">int</span>.class,String.class,String.class, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">                    java.lang.Object[] argsobjarray = param.args;</span><br><span class="line">                    String name = (String) argsobjarray[<span class="number">0</span>];</span><br><span class="line">                    String id = (String) argsobjarray[<span class="number">1</span>];</span><br><span class="line">                    <span class="keyword">int</span> age = (<span class="keyword">int</span>) (argsobjarray[<span class="number">2</span>]);</span><br><span class="line">                    argsobjarray[<span class="number">1</span>] = <span class="string">"2050"</span>;</span><br><span class="line">                    argsobjarray[<span class="number">2</span>] = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">                    String teacher= (String) argsobjarray[<span class="number">3</span>];</span><br><span class="line">                    String nickname= (String) argsobjarray[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                    XposedBridge.log(<span class="string">"com.kanxue.xposedhook01.Student(String,String) is called!!beforeHookedMethod--"</span> + name + <span class="string">"---"</span> + id + <span class="string">"--"</span> + age+<span class="string">"---"</span>+teacher+<span class="string">"---"</span>+nickname);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line"></span><br><span class="line">                    Object thisobj = param.thisObject;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">             <span class="comment">/*       Field nicknameField=stuClass.getDeclaredField("nickname");</span></span><br><span class="line"><span class="comment">                    XposedBridge.log(stuClass+"--nicknameField-&gt;"+nicknameField);</span></span><br><span class="line"><span class="comment">                    nicknameField.setAccessible(true);</span></span><br><span class="line"><span class="comment">                    nicknameField.set(thisobj,"bear");*/</span></span><br><span class="line"></span><br><span class="line">                    XposedHelpers.setObjectField(thisobj,<span class="string">"nickname"</span>,<span class="string">"chick"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                    Object returnobj = param.getResult();</span><br><span class="line">                    XposedBridge.log(thisobj + <span class="string">"---"</span> + returnobj);</span><br><span class="line">                    XposedBridge.log(<span class="string">"com.kanxue.xposedhook01.Student(String,String,int) is called!!afterHookedMethod"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>xposed不仅实现对App类构造函数Hook,也可以hook系统层面的框架 </p>
<h3 id="HookDexClassLoader"><a href="#HookDexClassLoader" class="headerlink" title="HookDexClassLoader"></a>HookDexClassLoader</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kanxue.xposed01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dalvik.system.DexClassLoader;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.IXposedHookLoadPackage;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XC_MethodHook;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedBridge;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedHelpers;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.callbacks.XC_LoadPackage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HookDexClassLoader</span> <span class="keyword">implements</span> <span class="title">IXposedHookLoadPackage</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleLoadPackage</span><span class="params">(XC_LoadPackage.LoadPackageParam loadPackageParam)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"HookDexClassLoader"</span>, loadPackageParam.packageName);</span><br><span class="line">        XposedBridge.log(<span class="string">"HookDexClassLoader-&gt;app packagename"</span> + loadPackageParam.packageName);</span><br><span class="line">        <span class="keyword">if</span> (loadPackageParam.packageName.equals(<span class="string">"com.kanxue.loaddex"</span>)) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//public DexClassLoader(String dexPath, String optimizedDirectory,</span></span><br><span class="line">            <span class="comment">//            String librarySearchPath, ClassLoader parent) &#123;</span></span><br><span class="line">            <span class="comment">//        super(dexPath, null, librarySearchPath, parent);</span></span><br><span class="line">            <span class="comment">//    &#125;</span></span><br><span class="line">            XposedHelpers.findAndHookConstructor(DexClassLoader.class, String.class, String.class, String.class, ClassLoader.class, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">                    Object array[]=param.args;</span><br><span class="line">                    String dexpath= (String) array[<span class="number">0</span>];</span><br><span class="line">                    String optimizedDirectory= (String) array[<span class="number">1</span>];</span><br><span class="line">                    String librarySearchPath= (String) array[<span class="number">2</span>];</span><br><span class="line">                    XposedBridge.log(<span class="string">"DexClassLoader beforeHookedMethod:"</span>+dexpath+<span class="string">"---"</span>+optimizedDirectory+<span class="string">"---"</span>+librarySearchPath);</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line"></span><br><span class="line">                    DexClassLoader dexClassLoader= (DexClassLoader) param.thisObject;</span><br><span class="line">                    XposedBridge.log(<span class="string">"DexClassLoader afterHookedMethod:"</span>+dexClassLoader);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="HookFlag"><a href="#HookFlag" class="headerlink" title="HookFlag"></a>HookFlag</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kanxue.xposed01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.IXposedHookLoadPackage;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XC_MethodHook;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedBridge;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedHelpers;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.callbacks.XC_LoadPackage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HookFlag</span> <span class="keyword">implements</span> <span class="title">IXposedHookLoadPackage</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleLoadPackage</span><span class="params">(XC_LoadPackage.LoadPackageParam loadPackageParam)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"HookFlag"</span>, loadPackageParam.packageName);</span><br><span class="line">        XposedBridge.log(<span class="string">"HookFlag-&gt;app packagename"</span> + loadPackageParam.packageName);</span><br><span class="line">        <span class="keyword">if</span> (loadPackageParam.packageName.equals(<span class="string">"com.kanxue.xposedflag"</span>)) &#123;</span><br><span class="line">            XposedBridge.log(<span class="string">"HookFlag "</span> + loadPackageParam.packageName);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            ClassLoader classLoader=loadPackageParam.classLoader;</span><br><span class="line"></span><br><span class="line">            Class Flag1Class=classLoader.loadClass(<span class="string">"com.kanxue.xposedflag.Flag1"</span>);</span><br><span class="line">            XposedHelpers.setStaticIntField(Flag1Class,<span class="string">"length"</span>,<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            XposedHelpers.findAndHookConstructor(<span class="string">"com.kanxue.xposedflag.Flag2"</span>, classLoader, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(<span class="string">"go into com.kanxue.xposedflag.Flag2()-&gt;beforeHookedMethod"</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(<span class="string">"leave com.kanxue.xposedflag.Flag2()-&gt;afterHookedMethod"</span>);</span><br><span class="line"></span><br><span class="line">                    Object Flag2obj=param.thisObject;</span><br><span class="line">                    XposedHelpers.setObjectField(Flag2obj,<span class="string">"flag"</span>,<span class="string">"12345678"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h2 id="Hook一般函数"><a href="#Hook一般函数" class="headerlink" title="Hook一般函数"></a>Hook一般函数</h2><ul>
<li>HookJava一般函数</li>
<li><p>HookJava内部类&amp;匿名函数中的函数</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">寻找ClassParentName$ClassChildName</span><br><span class="line">直接拖到GDA寻找类名就可以了</span><br></pre></td></tr></table></figure>
</li>
<li><p>HookJNI函数</p>
</li>
</ul>
<h3 id="应用代码-1"><a href="#应用代码-1" class="headerlink" title="应用代码"></a>应用代码</h3><blockquote>
<p>Student.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kanxue.xposedhook01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    String name = <span class="keyword">null</span>;</span><br><span class="line">    String id = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">int</span> age = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String nickname = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String teacher = <span class="keyword">null</span>;</span><br><span class="line"><span class="comment">/*01-09 04:53:39.748 20009-20009/com.kanxue.xposedhook01 I/Xposed: beforeHookedMethod publicfunc-&gt;arg0:publicfunc---arg1:500</span></span><br><span class="line"><span class="comment">01-09 04:53:39.748 20009-20009/com.kanxue.xposedhook01 I/Xposed: beforeHookedMethod11 privatefunc-&gt;arg0:privatefunc---arg1:300</span></span><br><span class="line"><span class="comment">01-09 04:53:39.748 20009-20009/com.kanxue.xposedhook01 I/Xposed: privatefunc is called!---privatefunc---300</span></span><br><span class="line"><span class="comment">01-09 04:53:39.748 20009-20009/com.kanxue.xposedhook01 I/Xposed: afterHookedMethod11 privatefunc-&gt;result:privatefunc---300</span></span><br><span class="line"><span class="comment">01-09 04:53:39.748 20009-20009/com.kanxue.xposedhook01 I/Xposed: publicfunc is called!---changedbyxposedjava---888</span></span><br><span class="line"><span class="comment">01-09 04:53:39.748 20009-20009/com.kanxue.xposedhook01 I/Xposed: beforeHookedMethod getpersonname-&gt;person</span></span><br><span class="line"><span class="comment">01-09 04:53:39.749 20009-20009/com.kanxue.xposedhook01 I/Xposed: afterHookedMethod getpersonname-&gt;person</span></span><br><span class="line"><span class="comment">01-09 04:53:39.749 20009-20009/com.kanxue.xposedhook01 I/Xposed: afterHookedMethod publicfunc-&gt;result:changedbyxposedjava---888---privatefunc---300---person</span></span><br><span class="line"><span class="comment">01-09 04:53:39.749 20009-20009/com.kanxue.xposedhook01 I/xposed: changedbyxposed-&gt;afterHookedMethod</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">person</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> String name;</span><br><span class="line">        <span class="keyword">public</span> String sex;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getpersonname</span><span class="params">(String arg0)</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> arg0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNickname</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> nickname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getTeacher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> teacher;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        name = <span class="string">"default"</span>;</span><br><span class="line">        id = <span class="string">"default"</span>;</span><br><span class="line">        age = <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        id = <span class="string">"default"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String name, String id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String name, String id, <span class="keyword">int</span> age, String teachername, String nickname)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        teacher = teachername;</span><br><span class="line">        <span class="keyword">this</span>.nickname = nickname;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">publicstaticfunc</span><span class="params">(String arg1, <span class="keyword">int</span> arg2)</span> </span>&#123;</span><br><span class="line">        String result = privatestaticfunc(<span class="string">"privatestaticfunc"</span>, <span class="number">200</span>);</span><br><span class="line">        Log.i(<span class="string">"Xposed"</span>,<span class="string">"publicstaticfunc is called!"</span>+<span class="string">"---"</span>+arg1+<span class="string">"---"</span>+arg2);</span><br><span class="line">        <span class="keyword">return</span> arg1 + <span class="string">"---"</span> + arg2 + <span class="string">"---"</span> + result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">privatestaticfunc</span><span class="params">(String arg1, <span class="keyword">int</span> arg2)</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"Xposed"</span>,<span class="string">"privatestaticfunc is called!"</span>+<span class="string">"---"</span>+arg1+<span class="string">"---"</span>+arg2);</span><br><span class="line">        <span class="keyword">return</span> arg1 + <span class="string">"---"</span> + arg2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">publicfunc</span><span class="params">(String arg1, <span class="keyword">int</span> arg2)</span> </span>&#123;</span><br><span class="line">        String result = privatefunc(<span class="string">"privatefunc"</span>, <span class="number">300</span>);</span><br><span class="line">        Log.i(<span class="string">"Xposed"</span>,<span class="string">"publicfunc is called!"</span>+<span class="string">"---"</span>+arg1+<span class="string">"---"</span>+arg2);</span><br><span class="line">        person tmp=<span class="keyword">new</span> person();</span><br><span class="line">        String tmpresult=tmp.getpersonname(<span class="string">"person"</span>);</span><br><span class="line">        <span class="keyword">return</span> arg1 + <span class="string">"---"</span> + arg2 + <span class="string">"---"</span> + result+<span class="string">"---"</span>+tmpresult;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">privatefunc</span><span class="params">(String arg1, <span class="keyword">int</span> arg2)</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"Xposed"</span>,<span class="string">"privatefunc is called!"</span>+<span class="string">"---"</span>+arg1+<span class="string">"---"</span>+arg2);</span><br><span class="line">        <span class="keyword">return</span> arg1 + <span class="string">"---"</span> + arg2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>MainActivity</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kanxue.xposedhook01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printStudent</span><span class="params">(Student stu)</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"Xposed"</span>, stu.name + <span class="string">"--"</span> + stu.id + <span class="string">"---"</span> + stu.age + <span class="string">"---"</span> + stu.getNickname() + <span class="string">"---"</span> + stu.getTeacher());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        Student astudent = <span class="keyword">new</span> Student();</span><br><span class="line">        Student bstudent = <span class="keyword">new</span> Student(<span class="string">"xiaoming"</span>);</span><br><span class="line">        Student cstudent = <span class="keyword">new</span> Student(<span class="string">"xiaohua"</span>, <span class="string">"2020"</span>);</span><br><span class="line">        Student dstudent = <span class="keyword">new</span> Student(<span class="string">"xiaohong"</span>, <span class="string">"2010"</span>, <span class="number">20</span>, <span class="string">"teacher"</span>, <span class="string">"panda"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        printStudent(astudent);</span><br><span class="line">        printStudent(bstudent);</span><br><span class="line">        printStudent(cstudent);</span><br><span class="line">        printStudent(dstudent);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        public static String publicstaticfunc(String arg1, int arg2) &#123;</span></span><br><span class="line"><span class="comment">//            return arg1 + "---" + arg2;</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        <span class="comment">//publicstaticfunc---100---privatestaticfunc---200</span></span><br><span class="line">        Log.i(<span class="string">"xposed"</span>, Student.publicstaticfunc(<span class="string">"publicstaticfunc"</span>, <span class="number">100</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        private static String privatestaticfunc(String arg1, int arg2) &#123;</span></span><br><span class="line"><span class="comment">//            return arg1 + "---" + arg2;</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        <span class="comment">//publicfunc---500---privatefunc---300</span></span><br><span class="line">        Log.i(<span class="string">"xposed"</span>, dstudent.publicfunc(<span class="string">"publicfunc"</span>, <span class="number">500</span>));</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        public String publicsfunc(String arg1, int arg2) &#123;</span></span><br><span class="line"><span class="comment">//            return arg1 + "---" + arg2;</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        private String privatefunc(String arg1, int arg2) &#123;</span></span><br><span class="line"><span class="comment">//            return arg1 + "---" + arg2;</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="HookJavaFunction"><a href="#HookJavaFunction" class="headerlink" title="HookJavaFunction"></a>HookJavaFunction</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kanxue.xposed01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Application;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.IXposedHookLoadPackage;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XC_MethodHook;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedBridge;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedHelpers;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.callbacks.XC_LoadPackage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HookJavaFunction</span> <span class="keyword">implements</span> <span class="title">IXposedHookLoadPackage</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleLoadPackage</span><span class="params">(XC_LoadPackage.LoadPackageParam loadPackageParam)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"Xposed01"</span>, loadPackageParam.packageName);</span><br><span class="line">        XposedBridge.log(<span class="string">"HookJava-&gt;app packagename"</span> + loadPackageParam.packageName);</span><br><span class="line">        <span class="keyword">if</span> (loadPackageParam.packageName.equals(<span class="string">"com.kanxue.xposedhook01"</span>)) &#123;</span><br><span class="line">            XposedBridge.log(<span class="string">"kanxue "</span> + loadPackageParam.packageName);</span><br><span class="line">            <span class="comment">/* public static de.robv.android.xposed.XC_MethodHook.Unhook findAndHookMethod(java.lang.Class&lt;?&gt; clazz, java.lang.String methodName, java.lang.Object... parameterTypesAndCallback) &#123; */</span><span class="comment">/* compiled code */</span><span class="comment">/* &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            public static de.robv.android.xposed.XC_MethodHook.Unhook findAndHookMethod(java.lang.String className, java.lang.ClassLoader classLoader, java.lang.String methodName, java.lang.Object... parameterTypesAndCallback) &#123; */</span><span class="comment">/* compiled code */</span><span class="comment">/* &#125;</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            ClassLoader classLoader = loadPackageParam.classLoader;</span><br><span class="line"></span><br><span class="line">            XposedBridge.log(<span class="string">"loadPackageParam.classLoader-&gt;"</span> + classLoader);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            Class StuClass = classLoader.loadClass(<span class="string">"com.kanxue.xposedhook01.Student"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//            public static String publicstaticfunc(String arg1, int arg2) &#123;</span></span><br><span class="line"><span class="comment">//                String result = privatestaticfunc("privatestaticfunc", 200);</span></span><br><span class="line"><span class="comment">//                return arg1 + "---" + arg2 + "---" + result;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">            XposedHelpers.findAndHookMethod(StuClass, <span class="string">"publicstaticfunc"</span>, String.class, <span class="keyword">int</span>.class, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">                    Object[] objectarray=param.args;</span><br><span class="line">                    String arg0= (String) objectarray[<span class="number">0</span>];</span><br><span class="line">                    <span class="keyword">int</span> arg1= (<span class="keyword">int</span>) objectarray[<span class="number">1</span>];</span><br><span class="line">                    objectarray[<span class="number">0</span>]=<span class="string">"changedbyxposedjava"</span>;</span><br><span class="line">                    objectarray[<span class="number">1</span>]=<span class="number">888</span>;</span><br><span class="line">                    XposedBridge.log(<span class="string">"beforeHookedMethod publicstaticfunc-&gt;arg0:"</span>+arg0+<span class="string">"---arg1:"</span>+arg1);</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line"></span><br><span class="line">                    String result= (String) param.getResult();</span><br><span class="line">                    param.setResult(<span class="string">"changedbyxposed-&gt;afterHookedMethod"</span>);</span><br><span class="line">                    XposedBridge.log(<span class="string">"afterHookedMethod publicstaticfunc-&gt;result:"</span>+result);</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            XposedHelpers.findAndHookMethod(StuClass, <span class="string">"privatestaticfunc"</span>, String.class, <span class="keyword">int</span>.class, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">                    Object[] objectarray = param.args;</span><br><span class="line">                    String arg0 = (String) objectarray[<span class="number">0</span>];</span><br><span class="line">                    <span class="keyword">int</span> arg1 = (<span class="keyword">int</span>) objectarray[<span class="number">1</span>];</span><br><span class="line">                    objectarray[<span class="number">0</span>] = <span class="string">"changedbyxposedjava"</span>;</span><br><span class="line">                    objectarray[<span class="number">1</span>] = <span class="number">888</span>;</span><br><span class="line">                    XposedBridge.log(<span class="string">"beforeHookedMethod privatestaticfunc-&gt;arg0:"</span> + arg0 + <span class="string">"---arg1:"</span> + arg1);</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line"></span><br><span class="line">                    String result = (String) param.getResult();</span><br><span class="line">                    param.setResult(<span class="string">"changedbyxposed-&gt;afterHookedMethod"</span>);</span><br><span class="line">                    XposedBridge.log(<span class="string">"afterHookedMethod privatestaticfunc-&gt;result:"</span> + result);</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"><span class="comment">//            private static String privatestaticfunc(String arg1, int arg2) &#123;</span></span><br><span class="line"><span class="comment">//                return arg1 + "---" + arg2;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">            XposedHelpers.findAndHookMethod(StuClass, <span class="string">"publicfunc"</span>, String.class, <span class="keyword">int</span>.class, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">                    Object[] objectarray = param.args;</span><br><span class="line">                    String arg0 = (String) objectarray[<span class="number">0</span>];</span><br><span class="line">                    <span class="keyword">int</span> arg1 = (<span class="keyword">int</span>) objectarray[<span class="number">1</span>];</span><br><span class="line">                    objectarray[<span class="number">0</span>] = <span class="string">"changedbyxposedjava"</span>;</span><br><span class="line">                    objectarray[<span class="number">1</span>] = <span class="number">888</span>;</span><br><span class="line">                    XposedBridge.log(<span class="string">"beforeHookedMethod publicfunc-&gt;arg0:"</span> + arg0 + <span class="string">"---arg1:"</span> + arg1);</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line"></span><br><span class="line">                    String result = (String) param.getResult();</span><br><span class="line">                    param.setResult(<span class="string">"changedbyxposed-&gt;afterHookedMethod"</span>);</span><br><span class="line">                    XposedBridge.log(<span class="string">"afterHookedMethod publicfunc-&gt;result:"</span> + result);</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"><span class="comment">//            public String publicfunc(String arg1, int arg2) &#123;</span></span><br><span class="line"><span class="comment">//                String result = privatefunc("privatefunc", 300);</span></span><br><span class="line"><span class="comment">//                return arg1 + "---" + arg2 + "---" + result;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">///*            XposedHelpers.findAndHookMethod(StuClass, "privatefunc", String.class, int.class, new XC_MethodHook() &#123;</span></span><br><span class="line"><span class="comment">//                @Override</span></span><br><span class="line"><span class="comment">//                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span></span><br><span class="line"><span class="comment">//                    super.beforeHookedMethod(param);</span></span><br><span class="line"><span class="comment">//                    Object[] objectarray = param.args;</span></span><br><span class="line"><span class="comment">//                    String arg0 = (String) objectarray[0];</span></span><br><span class="line"><span class="comment">//                    int arg1 = (int) objectarray[1];</span></span><br><span class="line"><span class="comment">//                    XposedBridge.log("beforeHookedMethod privatefunc-&gt;arg0:" + arg0 + "---arg1:" + arg1);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//                @Override</span></span><br><span class="line"><span class="comment">//                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span></span><br><span class="line"><span class="comment">//                    super.afterHookedMethod(param);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//                    String result = (String) param.getResult();</span></span><br><span class="line"><span class="comment">//                    XposedBridge.log("afterHookedMethod privatefunc-&gt;result:" + result);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line"><span class="comment">//            &#125;);*/</span></span><br><span class="line"><span class="comment">//            private String privatefunc(String arg1, int arg2) &#123;</span></span><br><span class="line"><span class="comment">//                return arg1 + "---" + arg2;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            XposedHelpers.findAndHookMethod(<span class="string">"com.kanxue.xposedhook01.Student"</span>, loadPackageParam.classLoader, <span class="string">"privatefunc"</span>, String.class, <span class="keyword">int</span>.class, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">                    Object[] objectarray = param.args;</span><br><span class="line">                    String arg0 = (String) objectarray[<span class="number">0</span>];</span><br><span class="line">                    <span class="keyword">int</span> arg1 = (<span class="keyword">int</span>) objectarray[<span class="number">1</span>];</span><br><span class="line">                    XposedBridge.log(<span class="string">"beforeHookedMethod11 privatefunc-&gt;arg0:"</span> + arg0 + <span class="string">"---arg1:"</span> + arg1);</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line"></span><br><span class="line">                    String result = (String) param.getResult();</span><br><span class="line">                    XposedBridge.log(<span class="string">"afterHookedMethod11 privatefunc-&gt;result:"</span> + result);</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            Class personClass = XposedHelpers.findClass(<span class="string">"com.kanxue.xposedhook01.Student$person"</span>, loadPackageParam.classLoader);</span><br><span class="line">            XposedHelpers.findAndHookMethod(personClass, <span class="string">"getpersonname"</span>, String.class, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(<span class="string">"beforeHookedMethod getpersonname-&gt;"</span> + param.args[<span class="number">0</span>]);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(<span class="string">"afterHookedMethod getpersonname-&gt;"</span> + param.getResult());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">          <span class="comment">//    public static java.lang.Class&lt;?&gt; findClass(java.lang.String className, java.lang.ClassLoader classLoader)</span></span><br><span class="line">            <span class="comment">//Class StuClassByXposed=XposedHelpers.findClass("com.kanxue.xposedhook01.Student",classLoader);</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="HookJni"><a href="#HookJni" class="headerlink" title="HookJni"></a>HookJni</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kanxue.xposed01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.IXposedHookLoadPackage;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XC_MethodHook;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedBridge;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedHelpers;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.callbacks.XC_LoadPackage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HookJni</span> <span class="keyword">implements</span> <span class="title">IXposedHookLoadPackage</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleLoadPackage</span><span class="params">(XC_LoadPackage.LoadPackageParam loadPackageParam)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"Xposed01"</span>, loadPackageParam.packageName);</span><br><span class="line">        XposedBridge.log(<span class="string">"HookJava-&gt;app packagename"</span> + loadPackageParam.packageName);</span><br><span class="line">        <span class="keyword">if</span> (loadPackageParam.packageName.equals(<span class="string">"com.kanxue.loaddex"</span>)) &#123;</span><br><span class="line"></span><br><span class="line">            Class MainActivityClass=XposedHelpers.findClass(<span class="string">"com.kanxue.loaddex.MainActivity"</span>,loadPackageParam.classLoader);</span><br><span class="line"></span><br><span class="line">            XposedHelpers.findAndHookMethod(MainActivityClass, <span class="string">"onCreate"</span>, Bundle.class, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(<span class="string">"beforeHookedMethod onCreate-&gt;"</span>+param.args[<span class="number">0</span>]);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(<span class="string">"afterHookedMethod onCreate-&gt;"</span>+param.thisObject);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            XposedHelpers.findAndHookMethod(MainActivityClass, <span class="string">"replaceClassloader"</span>, ClassLoader.class, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(<span class="string">"beforeHookedMethod replaceClassloader-&gt;Classloader:"</span>+param.args[<span class="number">0</span>]);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(<span class="string">"afterHookedMethod replaceClassloader-&gt;"</span>+param.thisObject);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h2 id="主动调用"><a href="#主动调用" class="headerlink" title="主动调用"></a>主动调用</h2><ul>
<li>利用Java反射完成对类函数的调用</li>
<li>使用Xposed的Api完成对类函数的调用 </li>
</ul>
<p>对于类静态函数直接调用<br>对于非静态函数,需要得到类的实例</p>
<h3 id="HookActiveInvoke"><a href="#HookActiveInvoke" class="headerlink" title="HookActiveInvoke"></a>HookActiveInvoke</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kanxue.xposed01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.IXposedHookLoadPackage;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XC_MethodHook;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedBridge;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedHelpers;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.callbacks.XC_LoadPackage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HookActiveInvoke</span> <span class="keyword">implements</span> <span class="title">IXposedHookLoadPackage</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleLoadPackage</span><span class="params">(XC_LoadPackage.LoadPackageParam loadPackageParam)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"XposedActiveInvoke"</span>, loadPackageParam.packageName);</span><br><span class="line">        XposedBridge.log(<span class="string">"XposedActiveInvoke-&gt;app packagename"</span> + loadPackageParam.packageName);</span><br><span class="line">        <span class="keyword">if</span> (loadPackageParam.packageName.equals(<span class="string">"com.kanxue.xposedhook01"</span>)) &#123;</span><br><span class="line">            XposedBridge.log(<span class="string">"kanxue "</span> + loadPackageParam.packageName);</span><br><span class="line"></span><br><span class="line"><span class="comment">//            public static String publicstaticfunc(String arg1, int arg2) &#123;</span></span><br><span class="line"><span class="comment">//                String result = privatestaticfunc("privatestaticfunc", 200);</span></span><br><span class="line"><span class="comment">//                Log.i("Xposed","publicstaticfunc is called!");</span></span><br><span class="line"><span class="comment">//                return arg1 + "---" + arg2 + "---" + result;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">            ClassLoader classLoader = loadPackageParam.classLoader;</span><br><span class="line">            Class StuClass = classLoader.loadClass(<span class="string">"com.kanxue.xposedhook01.Student"</span>);</span><br><span class="line">            Method publicstaticfunc_method = StuClass.getDeclaredMethod(<span class="string">"publicstaticfunc"</span>, String.class, <span class="keyword">int</span>.class);</span><br><span class="line">            publicstaticfunc_method.invoke(<span class="keyword">null</span>, <span class="string">"InvokedByXposed"</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//            public static java.lang.Object callMethod(java.lang.Object obj, java.lang.String methodName, java.lang.Object... args) &#123; /* compiled code */ &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//            public static java.lang.Object callMethod(java.lang.Object obj, java.lang.String methodName, java.lang.Class&lt;?&gt;[] parameterTypes, java.lang.Object... args) &#123; /* compiled code */ &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//            public static java.lang.Object callStaticMethod(java.lang.Class&lt;?&gt; clazz, java.lang.String methodName, java.lang.Object... args)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//            public static java.lang.Object callStaticMethod(java.lang.Class&lt;?&gt; clazz, java.lang.String methodName, java.lang.Class&lt;?&gt;[] parameterTypes, java.lang.Object... args)</span></span><br><span class="line"></span><br><span class="line">            java.lang.Class&lt;?&gt;[] parameterTypes = &#123;String.class, <span class="keyword">int</span>.class&#125;;</span><br><span class="line"></span><br><span class="line">            XposedHelpers.callStaticMethod(StuClass, <span class="string">"publicstaticfunc"</span>, parameterTypes, <span class="string">"publicstaticfunc is called by XposedHelpers.callStaticMethod11"</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">            XposedHelpers.callStaticMethod(StuClass, <span class="string">"publicstaticfunc"</span>, <span class="string">"publicstaticfunc is called by XposedHelpers.callStaticMethod22"</span>, <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">            XposedHelpers.callStaticMethod(StuClass, <span class="string">"privatestaticfunc"</span>, parameterTypes, <span class="string">"privatestaticfunc is called by XposedHelpers.callStaticMethod11"</span>, <span class="number">400</span>);</span><br><span class="line">            XposedHelpers.callStaticMethod(StuClass, <span class="string">"privatestaticfunc"</span>, <span class="string">"privatestaticfunc is called by XposedHelpers.callStaticMethod22"</span>, <span class="number">300</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            Method privatestaticfunc_method = StuClass.getDeclaredMethod(<span class="string">"privatestaticfunc"</span>, String.class, <span class="keyword">int</span>.class);</span><br><span class="line"></span><br><span class="line">            privatestaticfunc_method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">            String result = (String) privatestaticfunc_method.invoke(<span class="keyword">null</span>, <span class="string">"privatestaticfuncIsInvokedByXposed"</span>, <span class="number">200</span>);</span><br><span class="line">            XposedBridge.log(<span class="string">"privatestaticfuncIsInvokedByXposed-&gt;result:"</span> + result);</span><br><span class="line"><span class="comment">//            private static String privatestaticfunc(String arg1, int arg2) &#123;</span></span><br><span class="line"><span class="comment">//                Log.i("Xposed","privatestaticfunc is called!");</span></span><br><span class="line"><span class="comment">//                return arg1 + "---" + arg2;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//            public static java.lang.Object callMethod(java.lang.Object obj, java.lang.String methodName, java.lang.Object... args) &#123; /* compiled code */ &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//            public static java.lang.Object callMethod(java.lang.Object obj, java.lang.String methodName, java.lang.Class&lt;?&gt;[] parameterTypes, java.lang.Object... args) &#123; /* compiled code */ &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//            public static java.lang.Object newInstance(java.lang.Class&lt;?&gt; clazz, java.lang.Object... args) &#123; /* compiled code */ &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//            public static java.lang.Object newInstance(java.lang.Class&lt;?&gt; clazz, java.lang.Class&lt;?&gt;[] parameterTypes, java.lang.Object... args) &#123; /* compiled code */ &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            Object StuObjByXposed = XposedHelpers.newInstance(StuClass, <span class="string">"StuObjByXposed.newInstance"</span>, <span class="string">"500"</span>);</span><br><span class="line">            String result1 = (String) XposedHelpers.callMethod(StuObjByXposed, <span class="string">"publicfunc"</span>, <span class="string">"publicfunc is called by XposedHelpers.callMethod"</span>, <span class="number">125</span>);</span><br><span class="line">            XposedBridge.log(<span class="string">"publicfunc XposedHelpers.callMethod result-&gt;"</span> + result1);</span><br><span class="line"></span><br><span class="line">            XposedHelpers.callMethod(StuObjByXposed, <span class="string">"privatefunc"</span>, <span class="string">"privatefunc is called by XposedHelpers.callMethod"</span>, <span class="number">130</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            Method publicfunc_method = StuClass.getDeclaredMethod(<span class="string">"publicfunc"</span>, String.class, <span class="keyword">int</span>.class);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//             public Student(String name, String id) &#123;</span></span><br><span class="line"><span class="comment">//                this.name = name;</span></span><br><span class="line"><span class="comment">//                this.id = id;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// public Student(String name, String id)</span></span><br><span class="line">            Constructor StuCon = StuClass.getDeclaredConstructor(String.class, String.class);</span><br><span class="line"></span><br><span class="line">            Object StuObj = StuCon.newInstance(<span class="string">"InstanceByXposed"</span>, <span class="string">"300"</span>);</span><br><span class="line"></span><br><span class="line">            publicfunc_method.invoke(StuObj, <span class="string">"publicfuncInvokedByXposed"</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//            public String publicfunc(String arg1, int arg2) &#123;</span></span><br><span class="line"><span class="comment">//                String result = privatefunc("privatefunc", 300);</span></span><br><span class="line"><span class="comment">//                Log.i("Xposed","publicfunc is called!"+"---"+arg1+"---"+arg2);</span></span><br><span class="line"><span class="comment">//                person tmp=new person();</span></span><br><span class="line"><span class="comment">//                String tmpresult=tmp.getpersonname("person");</span></span><br><span class="line"><span class="comment">//                return arg1 + "---" + arg2 + "---" + result+"---"+tmpresult;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line">            Method privatefunc_method = StuClass.getDeclaredMethod(<span class="string">"privatefunc"</span>, String.class, <span class="keyword">int</span>.class);</span><br><span class="line">            privatefunc_method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            String privatefunc_result = (String) privatefunc_method.invoke(StuObj, <span class="string">"privatefuncInvokedByXposed"</span>, <span class="number">200</span>);</span><br><span class="line">            XposedBridge.log(<span class="string">"privatefunc activeInvokeByXposed--&gt;"</span> + privatefunc_result);</span><br><span class="line"><span class="comment">//            private String privatefunc(String arg1, int arg2) &#123;</span></span><br><span class="line"><span class="comment">//                Log.i("Xposed","privatefunc is called!"+"---"+arg1+"---"+arg2);</span></span><br><span class="line"><span class="comment">//                return arg1 + "---" + arg2;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">//Student cstudent = new Student("xiaohua", "2020");</span></span><br><span class="line">            XposedHelpers.findAndHookConstructor(StuClass, String.class, String.class, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(<span class="string">"Student(String,String) is called beforeHookedMethod"</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(<span class="string">"Student(String,String) is called afterHookedMethod"</span>);</span><br><span class="line">                    Object cstudent=param.thisObject;</span><br><span class="line">                    XposedHelpers.callMethod(cstudent,<span class="string">"publicfunc"</span>,<span class="string">"publicfunc is called XposedHelpers.findAndHookConstructor"</span>,<span class="number">666</span>);</span><br><span class="line">                    XposedHelpers.callMethod(cstudent,<span class="string">"privatefunc"</span>,<span class="string">"privatefunc is called XposedHelpers.findAndHookConstructor"</span>,<span class="number">888</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//            public String getNickname() &#123;</span></span><br><span class="line"><span class="comment">//                return nickname;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"></span><br><span class="line">            XposedHelpers.findAndHookMethod(StuClass, <span class="string">"getNickname"</span>, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">                    Object obj=param.thisObject;</span><br><span class="line">                    XposedHelpers.callMethod(obj,<span class="string">"publicfunc"</span>,<span class="string">"beforeHookedMethod publicfunc is called XposedHelpers.callMethod"</span>,<span class="number">444</span>);</span><br><span class="line">                    XposedHelpers.callMethod(obj,<span class="string">"privatefunc"</span>,<span class="string">"beforeHookedMethod privatefunc is called XposedHelpers.callMethod"</span>,<span class="number">333</span>);</span><br><span class="line"></span><br><span class="line">                    XposedBridge.log(<span class="string">"getNickname is called beforeHookedMethod-&gt;"</span>+obj);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line">                    Object obj=param.thisObject;</span><br><span class="line">                    XposedHelpers.callMethod(obj,<span class="string">"publicfunc"</span>,<span class="string">"afterHookedMethod publicfunc is called XposedHelpers.callMethod"</span>,<span class="number">222</span>);</span><br><span class="line">                    XposedHelpers.callMethod(obj,<span class="string">"privatefunc"</span>,<span class="string">"afterHookedMethod privatefunc is called XposedHelpers.callMethod"</span>,<span class="number">111</span>);</span><br><span class="line"></span><br><span class="line">                    XposedBridge.log(<span class="string">"getNickname is called afterHookedMethod-&gt;"</span>+param.thisObject);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h2 id="加壳App处理"><a href="#加壳App处理" class="headerlink" title="加壳App处理"></a>加壳App处理</h2><h3 id="HookJava"><a href="#HookJava" class="headerlink" title="HookJava"></a>HookJava</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kanxue.xposed01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Application;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.IXposedHookLoadPackage;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XC_MethodHook;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedBridge;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedHelpers;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.callbacks.XC_LoadPackage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HookJava</span> <span class="keyword">implements</span> <span class="title">IXposedHookLoadPackage</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Field <span class="title">getClassField</span><span class="params">(ClassLoader classloader, String class_name,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      String filedName)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class obj_class = classloader.loadClass(class_name);<span class="comment">//Class.forName(class_name);</span></span><br><span class="line">            Field field = obj_class.getDeclaredField(filedName);</span><br><span class="line">            field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            <span class="keyword">return</span> field;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SecurityException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getClassFieldObject</span><span class="params">(ClassLoader classloader, String class_name, Object obj,</span></span></span><br><span class="line"><span class="function"><span class="params">                                             String filedName)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class obj_class = classloader.loadClass(class_name);<span class="comment">//Class.forName(class_name);</span></span><br><span class="line">            Field field = obj_class.getDeclaredField(filedName);</span><br><span class="line">            field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            Object result = <span class="keyword">null</span>;</span><br><span class="line">            result = field.get(obj);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SecurityException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">invokeStaticMethod</span><span class="params">(String class_name,</span></span></span><br><span class="line"><span class="function"><span class="params">                                            String method_name, Class[] pareTyple, Object[] pareVaules)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class obj_class = Class.forName(class_name);</span><br><span class="line">            Method method = obj_class.getMethod(method_name, pareTyple);</span><br><span class="line">            <span class="keyword">return</span> method.invoke(<span class="keyword">null</span>, pareVaules);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SecurityException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getFieldOjbect</span><span class="params">(String class_name, Object obj,</span></span></span><br><span class="line"><span class="function"><span class="params">                                        String filedName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class obj_class = Class.forName(class_name);</span><br><span class="line">            Field field = obj_class.getDeclaredField(filedName);</span><br><span class="line">            field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            <span class="keyword">return</span> field.get(obj);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SecurityException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NullPointerException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ClassLoader <span class="title">getClassloader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ClassLoader resultClassloader = <span class="keyword">null</span>;</span><br><span class="line">        Object currentActivityThread = invokeStaticMethod(</span><br><span class="line">                <span class="string">"android.app.ActivityThread"</span>, <span class="string">"currentActivityThread"</span>,</span><br><span class="line">                <span class="keyword">new</span> Class[]&#123;&#125;, <span class="keyword">new</span> Object[]&#123;&#125;);</span><br><span class="line">        Object mBoundApplication = getFieldOjbect(</span><br><span class="line">                <span class="string">"android.app.ActivityThread"</span>, currentActivityThread,</span><br><span class="line">                <span class="string">"mBoundApplication"</span>);</span><br><span class="line">        Application mInitialApplication = (Application) getFieldOjbect(<span class="string">"android.app.ActivityThread"</span>,</span><br><span class="line">                currentActivityThread, <span class="string">"mInitialApplication"</span>);</span><br><span class="line">        Object loadedApkInfo = getFieldOjbect(</span><br><span class="line">                <span class="string">"android.app.ActivityThread$AppBindData"</span>,</span><br><span class="line">                mBoundApplication, <span class="string">"info"</span>);</span><br><span class="line">        Application mApplication = (Application) getFieldOjbect(<span class="string">"android.app.LoadedApk"</span>, loadedApkInfo, <span class="string">"mApplication"</span>);</span><br><span class="line">        resultClassloader = mApplication.getClassLoader();</span><br><span class="line">        <span class="keyword">return</span> resultClassloader;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetClassLoaderClasslist</span><span class="params">(ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//private final DexPathList pathList;</span></span><br><span class="line">        <span class="comment">//public static java.lang.Object getObjectField(java.lang.Object obj, java.lang.String fieldName)</span></span><br><span class="line">        XposedBridge.log(<span class="string">"start dealwith classloader:"</span> + classLoader);</span><br><span class="line">        Object pathListObj = XposedHelpers.getObjectField(classLoader, <span class="string">"pathList"</span>);</span><br><span class="line">        <span class="comment">//private final Element[] dexElements;</span></span><br><span class="line">        Object[] dexElementsObj = (Object[]) XposedHelpers.getObjectField(pathListObj, <span class="string">"dexElements"</span>);</span><br><span class="line">        <span class="keyword">for</span> (Object i : dexElementsObj) &#123;</span><br><span class="line">            <span class="comment">//private final DexFile dexFile;</span></span><br><span class="line">            Object dexFileObj = XposedHelpers.getObjectField(i, <span class="string">"dexFile"</span>);</span><br><span class="line">            <span class="comment">//private Object mCookie;</span></span><br><span class="line">            Object mCookieObj = XposedHelpers.getObjectField(dexFileObj, <span class="string">"mCookie"</span>);</span><br><span class="line">            <span class="comment">//private static native String[] getClassNameList(Object cookie);</span></span><br><span class="line">            <span class="comment">//    public static java.lang.Object callStaticMethod(java.lang.Class&lt;?&gt; clazz, java.lang.String methodName, java.lang.Object... args) &#123; /* compiled code */ &#125;</span></span><br><span class="line">            Class DexFileClass = XposedHelpers.findClass(<span class="string">"dalvik.system.DexFile"</span>, classLoader);</span><br><span class="line"></span><br><span class="line">            String[] classlist = (String[]) XposedHelpers.callStaticMethod(DexFileClass, <span class="string">"getClassNameList"</span>, mCookieObj);</span><br><span class="line">            <span class="keyword">for</span> (String classname : classlist) &#123;</span><br><span class="line">                XposedBridge.log(dexFileObj + <span class="string">"---"</span> + classname);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        XposedBridge.log(<span class="string">"end dealwith classloader:"</span> + classLoader);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleLoadPackage</span><span class="params">(XC_LoadPackage.LoadPackageParam loadPackageParam)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"Xposed01"</span>, loadPackageParam.packageName);</span><br><span class="line">        XposedBridge.log(<span class="string">"HookJava-&gt;app packagename"</span> + loadPackageParam.packageName);</span><br><span class="line">        <span class="keyword">if</span> (loadPackageParam.packageName.equals(<span class="string">"com.kanxue.xposedhook01"</span>)) &#123;</span><br><span class="line">            XposedBridge.log(<span class="string">"kanxue "</span> + loadPackageParam.packageName);</span><br><span class="line">            <span class="comment">/* public static de.robv.android.xposed.XC_MethodHook.Unhook findAndHookMethod(java.lang.Class&lt;?&gt; clazz, java.lang.String methodName, java.lang.Object... parameterTypesAndCallback) &#123; */</span><span class="comment">/* compiled code */</span><span class="comment">/* &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            public static de.robv.android.xposed.XC_MethodHook.Unhook findAndHookMethod(java.lang.String className, java.lang.ClassLoader classLoader, java.lang.String methodName, java.lang.Object... parameterTypesAndCallback) &#123; */</span><span class="comment">/* compiled code */</span><span class="comment">/* &#125;</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            ClassLoader classLoader = loadPackageParam.classLoader;</span><br><span class="line"></span><br><span class="line">            XposedBridge.log(<span class="string">"loadPackageParam.classLoader-&gt;"</span> + classLoader);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">            01-09 05:26:25.678 29011-29011/? I/Xposed: loadPackageParam.classLoader-&gt;dalvik.system.PathClassLoader[DexPathList[[zip file "/data/app/com.kanxue.xposedhook01-1/base.apk"],nativeLibraryDirectories=[/data/app/com.kanxue.xposedhook01-1/lib/arm, /vendor/lib, /system/lib]]]</span></span><br><span class="line"><span class="comment">            01-09 05:26:25.679 29011-29011/? I/Xposed: start dealwith classloader:dalvik.system.PathClassLoader[DexPathList[[zip file "/data/app/com.kanxue.xposedhook01-1/base.apk"],nativeLibraryDirectories=[/data/app/com.kanxue.xposedhook01-1/lib/arm, /vendor/lib, /system/lib]]]</span></span><br><span class="line"><span class="comment">            01-09 05:26:25.681 29011-29011/? I/Xposed: /data/app/com.kanxue.xposedhook01-1/base.apk---com.qihoo.util.Configuration</span></span><br><span class="line"><span class="comment">            01-09 05:26:25.681 29011-29011/? I/Xposed: /data/app/com.kanxue.xposedhook01-1/base.apk---com.qihoo.util.DtcLoader</span></span><br><span class="line"><span class="comment">            01-09 05:26:25.681 29011-29011/? I/Xposed: /data/app/com.kanxue.xposedhook01-1/base.apk---com.qihoo.util.QHDialog</span></span><br><span class="line"><span class="comment">            01-09 05:26:25.681 29011-29011/? I/Xposed: /data/app/com.kanxue.xposedhook01-1/base.apk---com.qihoo.util.ᵢˋ</span></span><br><span class="line"><span class="comment">            01-09 05:26:25.681 29011-29011/? I/Xposed: /data/app/com.kanxue.xposedhook01-1/base.apk---com.qihoo.util.ᵢˎ</span></span><br><span class="line"><span class="comment">            01-09 05:26:25.681 29011-29011/? I/Xposed: /data/app/com.kanxue.xposedhook01-1/base.apk---com.qihoo.util.ᵢˏ</span></span><br><span class="line"><span class="comment">            01-09 05:26:25.681 29011-29011/? I/Xposed: /data/app/com.kanxue.xposedhook01-1/base.apk---com.stub.StubApp</span></span><br><span class="line"><span class="comment">            01-09 05:26:25.681 29011-29011/? I/Xposed: end dealwith classloader:dalvik.system.PathClassLoader[DexPathList[[zip file "/data/app/com.kanxue.xposedhook01-1/base.apk"],nativeLibraryDirectories=[/data/app/com.kanxue.xposedhook01-1/lib/arm, /vendor/lib, /system/lib]]]</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">            GetClassLoaderClasslist(classLoader);</span><br><span class="line"></span><br><span class="line">            ClassLoader parent = classLoader.getParent();</span><br><span class="line">            <span class="keyword">while</span> (parent != <span class="keyword">null</span>) &#123;</span><br><span class="line">                XposedBridge.log(<span class="string">"parent-&gt;"</span> + parent);</span><br><span class="line">                <span class="keyword">if</span> (parent.toString().contains(<span class="string">"BootClassLoader"</span>)) &#123;</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    GetClassLoaderClasslist(parent);</span><br><span class="line">                &#125;</span><br><span class="line">                parent = parent.getParent();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 01-09 05:05:34.284 24462-24462/? I/Xposed: loadPackageParam.classLoader-&gt;dalvik.system.PathClassLoader[DexPathList[[zip file "/data/app/com.kanxue.xposedhook01-1/base.apk"],nativeLibraryDirectories=[/data/app/com.kanxue.xposedhook01-1/lib/arm, /vendor/lib, /system/lib]]]</span></span><br><span class="line"><span class="comment">01-09 05:05:34.284 24462-24462/? I/Xposed: parent-&gt;dalvik.system.PathClassLoader[DexPathList[[dex file "/data/dalvik-cache/xposed_XResourcesSuperClass.dex", dex file "/data/dalvik-cache/xposed_XTypedArraySuperClass.dex"],nativeLibraryDirectories=[/vendor/lib, /system/lib]]]</span></span><br><span class="line"><span class="comment">01-09 05:05:34.284 24462-24462/? I/Xposed: parent-&gt;java.lang.BootClassLoader@6c4cdad</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            Class StubAppClass=XposedHelpers.findClass(<span class="string">"com.stub.StubApp"</span>,loadPackageParam.classLoader);</span><br><span class="line">            Method[] methods=StubAppClass.getDeclaredMethods();</span><br><span class="line">            <span class="keyword">for</span>(Method i:methods)&#123;</span><br><span class="line">                XposedBridge.log(<span class="string">"com.stub.StubApp-&gt;"</span>+i);</span><br><span class="line">            &#125;</span><br><span class="line">            XposedHelpers.findAndHookMethod(<span class="string">"com.stub.StubApp"</span>, loadPackageParam.classLoader, <span class="string">"onCreate"</span>, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(<span class="string">"com.stub.StubApp-&gt;onCreate beforeHookedMethod"</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(<span class="string">"com.stub.StubApp-&gt;onCreate afterHookedMethod"</span>);</span><br><span class="line"></span><br><span class="line">                    ClassLoader finalClassLoader=getClassloader();</span><br><span class="line">                    XposedBridge.log(<span class="string">"finalClassLoader-&gt;"</span> + finalClassLoader);</span><br><span class="line">                    GetClassLoaderClasslist(finalClassLoader);</span><br><span class="line">                    XposedHelpers.findAndHookMethod(<span class="string">"com.kanxue.xposedhook01.Student"</span>, finalClassLoader, <span class="string">"privatefunc"</span>, String.class, <span class="keyword">int</span>.class, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                            <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">                            Object[] objectarray = param.args;</span><br><span class="line">                            String arg0 = (String) objectarray[<span class="number">0</span>];</span><br><span class="line">                            <span class="keyword">int</span> arg1 = (<span class="keyword">int</span>) objectarray[<span class="number">1</span>];</span><br><span class="line">                            XposedBridge.log(<span class="string">"beforeHookedMethod11 privatefunc-&gt;arg0:"</span> + arg0 + <span class="string">"---arg1:"</span> + arg1);</span><br><span class="line"></span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                            <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line"></span><br><span class="line">                            String result = (String) param.getResult();</span><br><span class="line">                            XposedBridge.log(<span class="string">"afterHookedMethod11 privatefunc-&gt;result:"</span> + result);</span><br><span class="line"></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line"></span><br><span class="line">                    Class personClass = XposedHelpers.findClass(<span class="string">"com.kanxue.xposedhook01.Student$person"</span>, finalClassLoader);</span><br><span class="line">                    XposedHelpers.findAndHookMethod(personClass, <span class="string">"getpersonname"</span>, String.class, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                            <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">                            XposedBridge.log(<span class="string">"beforeHookedMethod getpersonname-&gt;"</span> + param.args[<span class="number">0</span>]);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                            <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line">                            XposedBridge.log(<span class="string">"afterHookedMethod getpersonname-&gt;"</span> + param.getResult());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="comment">/*Class StuClass = classLoader.loadClass("com.kanxue.xposedhook01.Student");*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//            public static String publicstaticfunc(String arg1, int arg2) &#123;</span></span><br><span class="line"><span class="comment">//                String result = privatestaticfunc("privatestaticfunc", 200);</span></span><br><span class="line"><span class="comment">//                return arg1 + "---" + arg2 + "---" + result;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">/*            XposedHelpers.findAndHookMethod(StuClass, "publicstaticfunc", String.class, int.class, new XC_MethodHook() &#123;</span></span><br><span class="line"><span class="comment">                @Override</span></span><br><span class="line"><span class="comment">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span></span><br><span class="line"><span class="comment">                    super.beforeHookedMethod(param);</span></span><br><span class="line"><span class="comment">                    Object[] objectarray=param.args;</span></span><br><span class="line"><span class="comment">                    String arg0= (String) objectarray[0];</span></span><br><span class="line"><span class="comment">                    int arg1= (int) objectarray[1];</span></span><br><span class="line"><span class="comment">                    objectarray[0]="changedbyxposedjava";</span></span><br><span class="line"><span class="comment">                    objectarray[1]=888;</span></span><br><span class="line"><span class="comment">                    XposedBridge.log("beforeHookedMethod publicstaticfunc-&gt;arg0:"+arg0+"---arg1:"+arg1);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                @Override</span></span><br><span class="line"><span class="comment">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span></span><br><span class="line"><span class="comment">                    super.afterHookedMethod(param);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                    String result= (String) param.getResult();</span></span><br><span class="line"><span class="comment">                    param.setResult("changedbyxposed-&gt;afterHookedMethod");</span></span><br><span class="line"><span class="comment">                    XposedBridge.log("afterHookedMethod publicstaticfunc-&gt;result:"+result);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">            &#125;);*/</span></span><br><span class="line">            <span class="comment">/*XposedHelpers.findAndHookMethod(StuClass, "privatestaticfunc", String.class, int.class, new XC_MethodHook() &#123;</span></span><br><span class="line"><span class="comment">                @Override</span></span><br><span class="line"><span class="comment">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span></span><br><span class="line"><span class="comment">                    super.beforeHookedMethod(param);</span></span><br><span class="line"><span class="comment">                    Object[] objectarray = param.args;</span></span><br><span class="line"><span class="comment">                    String arg0 = (String) objectarray[0];</span></span><br><span class="line"><span class="comment">                    int arg1 = (int) objectarray[1];</span></span><br><span class="line"><span class="comment">                    objectarray[0] = "changedbyxposedjava";</span></span><br><span class="line"><span class="comment">                    objectarray[1] = 888;</span></span><br><span class="line"><span class="comment">                    XposedBridge.log("beforeHookedMethod privatestaticfunc-&gt;arg0:" + arg0 + "---arg1:" + arg1);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                @Override</span></span><br><span class="line"><span class="comment">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span></span><br><span class="line"><span class="comment">                    super.afterHookedMethod(param);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                    String result = (String) param.getResult();</span></span><br><span class="line"><span class="comment">                    param.setResult("changedbyxposed-&gt;afterHookedMethod");</span></span><br><span class="line"><span class="comment">                    XposedBridge.log("afterHookedMethod privatestaticfunc-&gt;result:" + result);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">            &#125;);*/</span></span><br><span class="line"><span class="comment">//            private static String privatestaticfunc(String arg1, int arg2) &#123;</span></span><br><span class="line"><span class="comment">//                return arg1 + "---" + arg2;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">            XposedHelpers.findAndHookMethod(StuClass, "publicfunc", String.class, int.class, new XC_MethodHook() &#123;</span></span><br><span class="line"><span class="comment">                @Override</span></span><br><span class="line"><span class="comment">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span></span><br><span class="line"><span class="comment">                    super.beforeHookedMethod(param);</span></span><br><span class="line"><span class="comment">                    Object[] objectarray = param.args;</span></span><br><span class="line"><span class="comment">                    String arg0 = (String) objectarray[0];</span></span><br><span class="line"><span class="comment">                    int arg1 = (int) objectarray[1];</span></span><br><span class="line"><span class="comment">                    objectarray[0] = "changedbyxposedjava";</span></span><br><span class="line"><span class="comment">                    objectarray[1] = 888;</span></span><br><span class="line"><span class="comment">                    XposedBridge.log("beforeHookedMethod publicfunc-&gt;arg0:" + arg0 + "---arg1:" + arg1);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                @Override</span></span><br><span class="line"><span class="comment">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span></span><br><span class="line"><span class="comment">                    super.afterHookedMethod(param);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                    String result = (String) param.getResult();</span></span><br><span class="line"><span class="comment">                    param.setResult("changedbyxposed-&gt;afterHookedMethod");</span></span><br><span class="line"><span class="comment">                    XposedBridge.log("afterHookedMethod publicfunc-&gt;result:" + result);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">            &#125;);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//            public String publicfunc(String arg1, int arg2) &#123;</span></span><br><span class="line"><span class="comment">//                String result = privatefunc("privatefunc", 300);</span></span><br><span class="line"><span class="comment">//                return arg1 + "---" + arg2 + "---" + result;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">/*            XposedHelpers.findAndHookMethod(StuClass, "privatefunc", String.class, int.class, new XC_MethodHook() &#123;</span></span><br><span class="line"><span class="comment">                @Override</span></span><br><span class="line"><span class="comment">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span></span><br><span class="line"><span class="comment">                    super.beforeHookedMethod(param);</span></span><br><span class="line"><span class="comment">                    Object[] objectarray = param.args;</span></span><br><span class="line"><span class="comment">                    String arg0 = (String) objectarray[0];</span></span><br><span class="line"><span class="comment">                    int arg1 = (int) objectarray[1];</span></span><br><span class="line"><span class="comment">                    XposedBridge.log("beforeHookedMethod privatefunc-&gt;arg0:" + arg0 + "---arg1:" + arg1);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                @Override</span></span><br><span class="line"><span class="comment">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span></span><br><span class="line"><span class="comment">                    super.afterHookedMethod(param);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                    String result = (String) param.getResult();</span></span><br><span class="line"><span class="comment">                    XposedBridge.log("afterHookedMethod privatefunc-&gt;result:" + result);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">            &#125;);*/</span></span><br><span class="line"><span class="comment">//            private String privatefunc(String arg1, int arg2) &#123;</span></span><br><span class="line"><span class="comment">//                return arg1 + "---" + arg2;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*            XposedHelpers.findAndHookMethod("com.kanxue.xposedhook01.Student", loadPackageParam.classLoader, "privatefunc", String.class, int.class, new XC_MethodHook() &#123;</span></span><br><span class="line"><span class="comment">                @Override</span></span><br><span class="line"><span class="comment">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span></span><br><span class="line"><span class="comment">                    super.beforeHookedMethod(param);</span></span><br><span class="line"><span class="comment">                    Object[] objectarray = param.args;</span></span><br><span class="line"><span class="comment">                    String arg0 = (String) objectarray[0];</span></span><br><span class="line"><span class="comment">                    int arg1 = (int) objectarray[1];</span></span><br><span class="line"><span class="comment">                    XposedBridge.log("beforeHookedMethod11 privatefunc-&gt;arg0:" + arg0 + "---arg1:" + arg1);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                @Override</span></span><br><span class="line"><span class="comment">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span></span><br><span class="line"><span class="comment">                    super.afterHookedMethod(param);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                    String result = (String) param.getResult();</span></span><br><span class="line"><span class="comment">                    XposedBridge.log("afterHookedMethod11 privatefunc-&gt;result:" + result);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">            &#125;);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            Class personClass = XposedHelpers.findClass("com.kanxue.xposedhook01.Student$person", loadPackageParam.classLoader);</span></span><br><span class="line"><span class="comment">            XposedHelpers.findAndHookMethod(personClass, "getpersonname", String.class, new XC_MethodHook() &#123;</span></span><br><span class="line"><span class="comment">                @Override</span></span><br><span class="line"><span class="comment">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span></span><br><span class="line"><span class="comment">                    super.beforeHookedMethod(param);</span></span><br><span class="line"><span class="comment">                    XposedBridge.log("beforeHookedMethod getpersonname-&gt;" + param.args[0]);</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                @Override</span></span><br><span class="line"><span class="comment">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span></span><br><span class="line"><span class="comment">                    super.afterHookedMethod(param);</span></span><br><span class="line"><span class="comment">                    XposedBridge.log("afterHookedMethod getpersonname-&gt;" + param.getResult());</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">            &#125;);</span></span><br><span class="line"><span class="comment">            */</span><span class="comment">//    public static java.lang.Class&lt;?&gt; findClass(java.lang.String className, java.lang.ClassLoader classLoader)</span></span><br><span class="line">            <span class="comment">//Class StuClassByXposed=XposedHelpers.findClass("com.kanxue.xposedhook01.Student",classLoader);</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>之前Xposed的Hook代码只对一些未加壳的App<br>现在直接从loadPackageParam的classLoader找class是会出现classNotFound<br>如果加壳了的话, AdnroidManifest.xml中的application会出现<code>android:name=&quot;com.stub.StubApp&quot;</code><br><code>https://bbs.pediy.com/thread-252630.htm#msg_header_h2_1</code><br><img src="/2021/03/12/android-kernel/image-04.png" width="600px"><br>Application的实现类StubApp的attachBaseContext和onCreate要做的事情就是如上图</p>
<p>所以我们要劫持StubApp的OnCreate之后它利用反射设置的ActivityThread里面的相关classLoader<br>这个classLoader才是加载应用载入的dex代码, 有这个classLoader我们就可以继续寻找应用代码的实例和hook相关功能</p>
<p>还有一点要说明, 可能这些加壳厂商自己定制了classLoader而不是使用了BaseClassLoader,所以这点可能有时候会有问题</p>
<h3 id="HookBelo"><a href="#HookBelo" class="headerlink" title="HookBelo"></a>HookBelo</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kanxue.xposed01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Application;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.IXposedHookLoadPackage;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XC_MethodHook;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedBridge;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedHelpers;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.callbacks.XC_LoadPackage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HookLebo</span> <span class="keyword">implements</span> <span class="title">IXposedHookLoadPackage</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Field <span class="title">getClassField</span><span class="params">(ClassLoader classloader, String class_name,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      String filedName)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class obj_class = classloader.loadClass(class_name);<span class="comment">//Class.forName(class_name);</span></span><br><span class="line">            Field field = obj_class.getDeclaredField(filedName);</span><br><span class="line">            field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            <span class="keyword">return</span> field;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SecurityException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getClassFieldObject</span><span class="params">(ClassLoader classloader, String class_name, Object obj,</span></span></span><br><span class="line"><span class="function"><span class="params">                                             String filedName)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class obj_class = classloader.loadClass(class_name);<span class="comment">//Class.forName(class_name);</span></span><br><span class="line">            Field field = obj_class.getDeclaredField(filedName);</span><br><span class="line">            field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            Object result = <span class="keyword">null</span>;</span><br><span class="line">            result = field.get(obj);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SecurityException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">invokeStaticMethod</span><span class="params">(String class_name,</span></span></span><br><span class="line"><span class="function"><span class="params">                                            String method_name, Class[] pareTyple, Object[] pareVaules)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class obj_class = Class.forName(class_name);</span><br><span class="line">            Method method = obj_class.getMethod(method_name, pareTyple);</span><br><span class="line">            <span class="keyword">return</span> method.invoke(<span class="keyword">null</span>, pareVaules);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SecurityException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getFieldOjbect</span><span class="params">(String class_name, Object obj,</span></span></span><br><span class="line"><span class="function"><span class="params">                                        String filedName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class obj_class = Class.forName(class_name);</span><br><span class="line">            Field field = obj_class.getDeclaredField(filedName);</span><br><span class="line">            field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            <span class="keyword">return</span> field.get(obj);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SecurityException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NullPointerException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ClassLoader <span class="title">getClassloader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ClassLoader resultClassloader = <span class="keyword">null</span>;</span><br><span class="line">        Object currentActivityThread = invokeStaticMethod(</span><br><span class="line">                <span class="string">"android.app.ActivityThread"</span>, <span class="string">"currentActivityThread"</span>,</span><br><span class="line">                <span class="keyword">new</span> Class[]&#123;&#125;, <span class="keyword">new</span> Object[]&#123;&#125;);</span><br><span class="line">        Object mBoundApplication = getFieldOjbect(</span><br><span class="line">                <span class="string">"android.app.ActivityThread"</span>, currentActivityThread,</span><br><span class="line">                <span class="string">"mBoundApplication"</span>);</span><br><span class="line">        Application mInitialApplication = (Application) getFieldOjbect(<span class="string">"android.app.ActivityThread"</span>,</span><br><span class="line">                currentActivityThread, <span class="string">"mInitialApplication"</span>);</span><br><span class="line">        Object loadedApkInfo = getFieldOjbect(</span><br><span class="line">                <span class="string">"android.app.ActivityThread$AppBindData"</span>,</span><br><span class="line">                mBoundApplication, <span class="string">"info"</span>);</span><br><span class="line">        Application mApplication = (Application) getFieldOjbect(<span class="string">"android.app.LoadedApk"</span>, loadedApkInfo, <span class="string">"mApplication"</span>);</span><br><span class="line">        resultClassloader = mApplication.getClassLoader();</span><br><span class="line">        <span class="keyword">return</span> resultClassloader;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetClassLoaderClasslist</span><span class="params">(ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//private final DexPathList pathList;</span></span><br><span class="line">        <span class="comment">//public static java.lang.Object getObjectField(java.lang.Object obj, java.lang.String fieldName)</span></span><br><span class="line">        XposedBridge.log(<span class="string">"start dealwith classloader:"</span> + classLoader);</span><br><span class="line">        Object pathListObj = XposedHelpers.getObjectField(classLoader, <span class="string">"pathList"</span>);</span><br><span class="line">        <span class="comment">//private final Element[] dexElements;</span></span><br><span class="line">        Object[] dexElementsObj = (Object[]) XposedHelpers.getObjectField(pathListObj, <span class="string">"dexElements"</span>);</span><br><span class="line">        <span class="keyword">for</span> (Object i : dexElementsObj) &#123;</span><br><span class="line">            <span class="comment">//private final DexFile dexFile;</span></span><br><span class="line">            Object dexFileObj = XposedHelpers.getObjectField(i, <span class="string">"dexFile"</span>);</span><br><span class="line">            <span class="comment">//private Object mCookie;</span></span><br><span class="line">            Object mCookieObj = XposedHelpers.getObjectField(dexFileObj, <span class="string">"mCookie"</span>);</span><br><span class="line">            <span class="comment">//private static native String[] getClassNameList(Object cookie);</span></span><br><span class="line">            <span class="comment">//    public static java.lang.Object callStaticMethod(java.lang.Class&lt;?&gt; clazz, java.lang.String methodName, java.lang.Object... args) &#123; /* compiled code */ &#125;</span></span><br><span class="line">            Class DexFileClass = XposedHelpers.findClass(<span class="string">"dalvik.system.DexFile"</span>, classLoader);</span><br><span class="line"></span><br><span class="line">            String[] classlist = (String[]) XposedHelpers.callStaticMethod(DexFileClass, <span class="string">"getClassNameList"</span>, mCookieObj);</span><br><span class="line">            <span class="keyword">for</span> (String classname : classlist) &#123;</span><br><span class="line">                XposedBridge.log(dexFileObj + <span class="string">"---"</span> + classname);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        XposedBridge.log(<span class="string">"end dealwith classloader:"</span> + classLoader);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleLoadPackage</span><span class="params">(XC_LoadPackage.LoadPackageParam loadPackageParam)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"Xposed01"</span>, loadPackageParam.packageName);</span><br><span class="line">        XposedBridge.log(<span class="string">"HookLebo-&gt;app packagename"</span> + loadPackageParam.packageName);</span><br><span class="line">        <span class="keyword">if</span> (loadPackageParam.packageName.equals(<span class="string">"com.f0208.lebo"</span>)) &#123;</span><br><span class="line">            XposedBridge.log(<span class="string">"kanxue "</span> + loadPackageParam.packageName);</span><br><span class="line">            Class StubAppClass=XposedHelpers.findClass(<span class="string">"com.f0208.lebo.MyWrapperProxyApplication"</span>,loadPackageParam.classLoader);</span><br><span class="line">            Method[] methods=StubAppClass.getDeclaredMethods();</span><br><span class="line">            <span class="keyword">for</span>(Method i:methods)&#123;</span><br><span class="line">                XposedBridge.log(<span class="string">"com.f0208.lebo.MyWrapperProxyApplication-&gt;"</span>+i);</span><br><span class="line">            &#125;</span><br><span class="line">            XposedHelpers.findAndHookMethod(<span class="string">"com.f0208.lebo.MyWrapperProxyApplication"</span>, loadPackageParam.classLoader, <span class="string">"onCreate"</span>, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(<span class="string">"com.f0208.lebo.MyWrapperProxyApplication-&gt;onCreate beforeHookedMethod"</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(<span class="string">"com.f0208.lebo.MyWrapperProxyApplication-&gt;onCreate afterHookedMethod"</span>);</span><br><span class="line"></span><br><span class="line">                    ClassLoader finalClassLoader=getClassloader();</span><br><span class="line">                    XposedBridge.log(<span class="string">"finalClassLoader-&gt;"</span> + finalClassLoader);</span><br><span class="line">                    XposedHelpers.findAndHookMethod(<span class="string">"com.zw.lebo.MainActivity"</span>, finalClassLoader, <span class="string">"onCreate"</span>, Bundle.class, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                            <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">                            XposedBridge.log(<span class="string">"beforeHookedMethod com.zw.lebo.MainActivity.onCreate"</span>);</span><br><span class="line"></span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                            <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line">                            XposedBridge.log(<span class="string">"afterHookedMethod com.zw.lebo.MainActivity.onCreate"</span>);</span><br><span class="line"></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>除此之外还有一种非加固壳的, 只是利用了DexClassLoader进行了热加载或者外部加载Dex文件<br>这种也可以Hook, DexClassLoader的构造函数, 在用新出的DexClassLoader实例进行loadClass或者查找DexFile文件内容</p>
<p><br></p>
<h2 id="so中函数处理"><a href="#so中函数处理" class="headerlink" title="so中函数处理"></a>so中函数处理</h2><p>对so库中某个函数进行hook<br>第一步用Xposed进行hook的是<code>System.loadlibrary</code><br>如果能hook成功的话, 接下来就是直接再利用<code>System.load</code>加载我们的hook代码的so<br>然后把hook函数写在JNI_OnLoad以前的_init方法或者jni_init方法</p>
<blockquote>
<p>System.load打破了原来的ClassLoader, 所以后期又推荐使用Runtime的load</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loadLibrary</span><span class="params">(String libName)</span> </span>&#123;</span><br><span class="line">  Runtime.getRuntime().loadLibrary(libName, VMStack.getCallingClassLoader());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以hook代码又变成了这样</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">XposedHelpers.findAndHookMethod(<span class="string">"java.lang.Runtime"</span>, loadPackageParam.classLoader, <span class="string">"loadLibrary"</span>, </span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<h3 id="MainActivity"><a href="#MainActivity" class="headerlink" title="MainActivity"></a>MainActivity</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kanxue.hookso;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Used to load the 'native-lib' library on application startup.</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">"native-lib"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Example of a call to a native method</span></span><br><span class="line">        TextView tv = findViewById(R.id.sample_text);</span><br><span class="line">        tv.setText(stringFromJNI());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A native method that is implemented by the 'native-lib' native library,</span></span><br><span class="line"><span class="comment">     * which is packaged with this application.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">stringFromJNI</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="native-lib"><a href="#native-lib" class="headerlink" title="native-lib"></a>native-lib</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;android/log.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;dlfcn.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"include/inlineHook.h"</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">void</span> *(*old_strstr)(<span class="keyword">char</span> *, <span class="keyword">char</span> *) = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">new_strstr</span><span class="params">(<span class="keyword">char</span> *arg0, <span class="keyword">char</span> *arg1)</span> </span>&#123;</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"hookso"</span>, <span class="string">"strstr is called,arg1:%s,arg2:%s"</span>, arg0, arg1);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strcmp</span>(arg1, <span class="string">"hookso"</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> &amp;a;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">void</span> *result = old_strstr(arg0, arg1);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">starthooklibc</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> *libchandle = dlopen(<span class="string">"libc.so"</span>, RTLD_NOW);</span><br><span class="line">    <span class="keyword">void</span> *strstr_addr = dlsym(libchandle, <span class="string">"strstr"</span>);</span><br><span class="line">    <span class="keyword">if</span> (registerInlineHook((<span class="keyword">uint32_t</span>) strstr_addr, (<span class="keyword">uint32_t</span>) new_strstr,</span><br><span class="line">                           (<span class="keyword">uint32_t</span> **) &amp;old_strstr) !=</span><br><span class="line">        ELE7EN_OK) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (inlineHook((<span class="keyword">uint32_t</span>) strstr_addr) == ELE7EN_OK) &#123;</span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"hookso"</span>, <span class="string">"hook libc.so-&gt;strstr success!"</span>);</span><br><span class="line">        <span class="comment">//return -1;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> <span class="keyword">void</span> _init(<span class="keyword">void</span>) &#123;</span><br><span class="line">    __android_log_print(<span class="number">4</span>,<span class="string">"kanxuetest"</span>,<span class="string">"go into _init"</span>);</span><br><span class="line">    starthooklibc();</span><br><span class="line">&#125;</span><br><span class="line">__attribute__ ((constructor(<span class="number">10</span>), visibility (<span class="string">"hidden"</span>))) <span class="function"><span class="keyword">void</span> <span class="title">initarray_4</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    __android_log_print(<span class="number">4</span>,<span class="string">"kanxuetest"</span>,<span class="string">"go into initarray_4"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">JNIEXPORT jint JNICALL <span class="title">JNI_OnLoad</span><span class="params">(JavaVM *vm, <span class="keyword">void</span> *reserved)</span> </span>&#123;</span><br><span class="line">    JNIEnv *env = <span class="literal">nullptr</span>;</span><br><span class="line">    jint result = <span class="number">-1</span>;</span><br><span class="line">    __android_log_print(<span class="number">4</span>,<span class="string">"kanxuetest"</span>,<span class="string">"go into JNI_OnLoad"</span>);</span><br><span class="line">    <span class="comment">//starthooklibc();</span></span><br><span class="line">    <span class="keyword">if</span> ((vm)-&gt;GetEnv((<span class="keyword">void</span> **) &amp;env, JNI_VERSION_1_6) != JNI_OK) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"err!!"</span>);</span><br><span class="line">        <span class="keyword">return</span> JNI_ERR;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> JNI_VERSION_1_6;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> JNIEXPORT jstring JNICALL</span><br><span class="line">Java_com_kanxue_hookso_MainActivity_stringFromJNI(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject <span class="comment">/* this */</span>) &#123;</span><br><span class="line">    __android_log_print(<span class="number">4</span>,<span class="string">"kanxuetest"</span>,<span class="string">"go into Java_com_kanxue_hookso_MainActivity_stringFromJNI"</span>);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> hello = <span class="string">"Hello from C++"</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">strstr</span>(<span class="string">"aaaaabbbbb"</span>,<span class="string">"hookso"</span>)!= <span class="literal">nullptr</span>)&#123;</span><br><span class="line">        __android_log_print(<span class="number">4</span>,<span class="string">"kanxuetest"</span>,<span class="string">"find hookso"</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        __android_log_print(<span class="number">4</span>,<span class="string">"kanxuetest"</span>,<span class="string">"not find hookso"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> env-&gt;NewStringUTF(hello.c_str());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="XposedHookSo"><a href="#XposedHookSo" class="headerlink" title="XposedHookSo"></a>XposedHookSo</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kanxue.xposed01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.IXposedHookLoadPackage;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XC_MethodHook;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedBridge;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedHelpers;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.callbacks.XC_LoadPackage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>  <span class="class"><span class="keyword">class</span> <span class="title">XposedHookSo</span> <span class="keyword">implements</span> <span class="title">IXposedHookLoadPackage</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleLoadPackage</span><span class="params">(XC_LoadPackage.LoadPackageParam loadPackageParam)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"XposedHookSo"</span>, loadPackageParam.packageName);</span><br><span class="line">        XposedBridge.log(<span class="string">"XposedHookSo-&gt;app packagename"</span> + loadPackageParam.packageName);</span><br><span class="line">        <span class="keyword">if</span> (loadPackageParam.packageName.equals(<span class="string">"com.kanxue.xposedhookso"</span>)) &#123;</span><br><span class="line">            XposedBridge.log(<span class="string">"XposedHookSo "</span> + loadPackageParam.packageName);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">           XposedHelpers.findAndHookMethod(<span class="string">"java.lang.Runtime"</span>, loadPackageParam.classLoader, <span class="string">"loadLibrary"</span>, String.class,ClassLoader.class, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">                    String soname= (String) param.args[<span class="number">0</span>];</span><br><span class="line">                    XposedBridge.log(<span class="string">"beforeHookedMethod Runtime.load("</span>+soname+<span class="string">","</span>+param.args[<span class="number">1</span>]+<span class="string">")"</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line">                    String soname= (String) param.args[<span class="number">0</span>];</span><br><span class="line">                    XposedBridge.log(<span class="string">"afterHookedMethod Runtime.load("</span>+soname+<span class="string">")"</span>);</span><br><span class="line">                    <span class="keyword">if</span>(soname.contains(<span class="string">"native-lib"</span>))&#123;</span><br><span class="line">                        System.load(<span class="string">"/data/data/com.kanxue.xposedhookso/files/hookso.so"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h2 id="so中64位函数处理"><a href="#so中64位函数处理" class="headerlink" title="so中64位函数处理"></a>so中64位函数处理</h2><p>上面的hook框架inline hook在nexus5的机器上的Android 6.0是没有问题的<br>但是在android 8.0 以上的64位手机是有问题的;</p>
<p>主要是把<code>build.gradle</code>中的部分属性配置注释掉就会有64位的平台ndk(这里默认就是4种平台的)</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ndk&#123;</span><br><span class="line">    abiFilters 'armeabi-v7a'// 这里注释掉,就会生成4种平台</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>默认情况下，cmake会输出 4 种 ABI（&quot;armeabi-v7a&quot; , &quot;arm64-v8a&quot;, &quot;x86&quot;, &quot;x86_64&quot;）</code></p>
<p>64位的inline hook库, 有个EdXposed所使用的<code>SandHook</code></p>
<h3 id="native-lib-1"><a href="#native-lib-1" class="headerlink" title="native-lib"></a>native-lib</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sandhook_native.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"utils/log.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;android/log.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"includes/elf.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">instance</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> *(*old_strstr)(<span class="keyword">char</span> *, <span class="keyword">char</span> *) = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">new_strstr</span><span class="params">(<span class="keyword">char</span> *arg0, <span class="keyword">char</span> *arg1)</span> </span>&#123;</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"hooksoarm64"</span>, <span class="string">"strstr is called,arg1:%s,arg2:%s"</span>, arg0, arg1);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strcmp</span>(arg1, <span class="string">"hookso"</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> &amp;a;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">void</span> *result = old_strstr(arg0, arg1);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">starthooklibc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">sizeof</span>(<span class="keyword">void</span> *) == <span class="number">8</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">char</span> *libcpath = <span class="string">"/system/lib64/libc.so"</span>;</span><br><span class="line">        old_strstr = <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">void</span> *(*)(<span class="keyword">char</span> *, <span class="keyword">char</span> *)&gt;(SandInlineHookSym(libcpath,</span><br><span class="line">                                                                                   <span class="string">"strstr"</span>,</span><br><span class="line">                                                                                   <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">void</span> *&gt;(new_strstr)));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">char</span> *libcpath = <span class="string">"/system/lib/libc.so"</span>;</span><br><span class="line">        old_strstr = <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">void</span> *(*)(<span class="keyword">char</span> *, <span class="keyword">char</span> *)&gt;(SandInlineHookSym(libcpath,</span><br><span class="line">                                                                                   <span class="string">"strstr"</span>,</span><br><span class="line">                                                                                   <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">void</span> *&gt;(new_strstr)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">testhook</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *content)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strstr</span>(content, <span class="string">"hookso"</span>) != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"xposedhookso"</span>, <span class="string">"find hookso"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"xposedhookso"</span>, <span class="string">"not find hookso"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> (*testhookfunctin)(<span class="keyword">const</span> <span class="keyword">char</span> *) = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> <span class="keyword">void</span> _init(<span class="keyword">void</span>) &#123;</span><br><span class="line">    LOGD(<span class="string">"go into _init"</span>);</span><br><span class="line">    <span class="comment">//starthooklibc();</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> <span class="function">jint JNICALL <span class="title">JNI_OnLoad</span><span class="params">(JavaVM *vm, <span class="keyword">void</span> *reserved)</span> </span>&#123;</span><br><span class="line">    LOGD(<span class="string">"go into JNI_OnLoad"</span>);</span><br><span class="line">    starthooklibc();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> JNI_VERSION_1_6;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> JNIEXPORT jstring JNICALL</span><br><span class="line">Java_com_kanxue_xposeehooksobysandhook_MainActivity_stringFromJNI(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject <span class="comment">/* this */</span>) &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> hello = <span class="string">"Hello from C++"</span>;</span><br><span class="line">    <span class="keyword">return</span> env-&gt;NewStringUTF(hello.c_str());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里有个坑点, sandHook必须早于starthooklibc, 所以starthooklibc必须不能出现在_init,而是放置到JNI_OnLoad</p>
<p><br></p>
<h2 id="so中函数主动调用"><a href="#so中函数主动调用" class="headerlink" title="so中函数主动调用"></a>so中函数主动调用</h2><p>这里的函数偏移都是从IDA中看到的</p>
<p>Ida的<code>Edit-&gt;Segments-&gt;Rebase program</code>填写ImageValue</p>
<p>thumb需要奇数 + 1</p>
<h3 id="activecalltesthook"><a href="#activecalltesthook" class="headerlink" title="activecalltesthook"></a>activecalltesthook</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sandhook_native.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"utils/log.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;android/log.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"includes/elf.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">instance</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> *(*old_strstr)(<span class="keyword">char</span> *, <span class="keyword">char</span> *) = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">new_strstr</span><span class="params">(<span class="keyword">char</span> *arg0, <span class="keyword">char</span> *arg1)</span> </span>&#123;</span><br><span class="line">    __android_log_print(<span class="number">4</span>, <span class="string">"hooksoarm64"</span>, <span class="string">"strstr is called,arg1:%s,arg2:%s"</span>, arg0, arg1);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strcmp</span>(arg1, <span class="string">"hookso"</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> &amp;a;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">void</span> *result = old_strstr(arg0, arg1);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">starthooklibc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">sizeof</span>(<span class="keyword">void</span> *) == <span class="number">8</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">char</span> *libcpath = <span class="string">"/system/lib64/libc.so"</span>;</span><br><span class="line">        old_strstr = <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">void</span> *(*)(<span class="keyword">char</span> *, <span class="keyword">char</span> *)&gt;(SandInlineHookSym(libcpath,</span><br><span class="line">                                                                                   <span class="string">"strstr"</span>,</span><br><span class="line">                                                                                   <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">void</span> *&gt;(new_strstr)));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">char</span> *libcpath = <span class="string">"/system/lib/libc.so"</span>;</span><br><span class="line">        old_strstr = <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">void</span> *(*)(<span class="keyword">char</span> *, <span class="keyword">char</span> *)&gt;(SandInlineHookSym(libcpath,</span><br><span class="line">                                                                                   <span class="string">"strstr"</span>,</span><br><span class="line">                                                                                   <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">void</span> *&gt;(new_strstr)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">testhook</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *content)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strstr</span>(content, <span class="string">"hookso"</span>) != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"xposedhookso"</span>, <span class="string">"find hookso"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        __android_log_print(<span class="number">4</span>, <span class="string">"xposedhookso"</span>, <span class="string">"not find hookso"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> (*testhookfunctin)(<span class="keyword">const</span> <span class="keyword">char</span> *) = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">activecalltesthook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">(*testhook)</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *a1)</span></span>;</span><br><span class="line"></span><br><span class="line">    testhook testhookfunction = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="comment">//得到函数地址</span></span><br><span class="line"><span class="comment">/*    extern "C"</span></span><br><span class="line"><span class="comment">    EXPORT void* SandGetModuleBase(const char* so);*/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> *libnativebase = SandGetModuleBase(<span class="string">"libnative-lib.so"</span>);</span><br><span class="line">    <span class="comment">//thumb</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">sizeof</span>(<span class="keyword">void</span>*)==<span class="number">4</span>)&#123;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">long</span> tmpaddr = (<span class="keyword">unsigned</span> <span class="keyword">long</span>) libnativebase + <span class="number">0x8B4C</span> + <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// 这个0x8B4C是从ide这边来看到的</span></span><br><span class="line">        <span class="keyword">void</span> *testhookaddr = <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">void</span> *&gt;(tmpaddr);</span><br><span class="line">        testhookfunction = <span class="keyword">reinterpret_cast</span>&lt;testhook&gt;(testhookaddr);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">long</span> tmpaddr = (<span class="keyword">unsigned</span> <span class="keyword">long</span>) libnativebase + <span class="number">0xf67c</span>;</span><br><span class="line">        <span class="keyword">void</span> *testhookaddr = <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">void</span> *&gt;(tmpaddr);</span><br><span class="line">        testhookfunction = <span class="keyword">reinterpret_cast</span>&lt;testhook&gt;(testhookaddr);</span><br><span class="line">        LOGD(<span class="string">"libnative-lib.so base:%p,testfuncaddr:%p"</span>,libnativebase,(<span class="keyword">void</span>*)tmpaddr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> result1 = testhookfunction(<span class="string">"aaaaahookso"</span>);</span><br><span class="line"></span><br><span class="line">    LOGD(<span class="string">"testhookfunction(\"aaaaahookso\"); return:%d"</span>, result1);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> result2 = testhookfunction(<span class="string">"aaaabbbbb"</span>);</span><br><span class="line">    LOGD(<span class="string">"testhookfunction(\"aaaabbbbb\"); return:%d"</span>, result2);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> <span class="keyword">void</span> _init(<span class="keyword">void</span>) &#123;</span><br><span class="line">    LOGD(<span class="string">"go into _init"</span>);</span><br><span class="line">    <span class="comment">//starthooklibc();</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> <span class="function">jint JNICALL <span class="title">JNI_OnLoad</span><span class="params">(JavaVM *vm, <span class="keyword">void</span> *reserved)</span> </span>&#123;</span><br><span class="line">    LOGD(<span class="string">"go into JNI_OnLoad"</span>);</span><br><span class="line">    <span class="comment">//starthooklibc();</span></span><br><span class="line">    activecalltesthook();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> JNI_VERSION_1_6;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> JNIEXPORT jstring JNICALL</span><br><span class="line">Java_com_kanxue_xposeehooksobysandhook_MainActivity_stringFromJNI(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject <span class="comment">/* this */</span>) &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> hello = <span class="string">"Hello from C++"</span>;</span><br><span class="line">    <span class="keyword">return</span> env-&gt;NewStringUTF(hello.c_str());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h2 id="Xposed指纹检测及定制反检测"><a href="#Xposed指纹检测及定制反检测" class="headerlink" title="Xposed指纹检测及定制反检测"></a>Xposed指纹检测及定制反检测</h2><blockquote>
<p>Xposed都有哪些指纹 </p>
<ul>
<li>Xposed插件的管理: XposedInstaller</li>
<li>Xposed对函数Hook的根本原理: Java函数变native<br>  <code>hook住检测方法,使其检测失效掉</code></li>
<li>Xposed框架拥有的大量Api</li>
<li>Xposed框架的特定文件<br>  <code>system/lib/libxposed_art.so</code><br>  <code>system/xposed.prop</code><br>  <code>system/framework/xposedBridge.jar</code></li>
<li>等等</li>
</ul>
</blockquote>
<p>Github上检测Xposed的demo: XposedChecker</p>
<blockquote>
<p>Xposed的组成 </p>
<ul>
<li>XposedInstaller:完整的AndroidStudio工程,用于管理Xposed框架的插件</li>
<li>Xposed: 对Zygote进程定制,能够实现对接下来任何一个App进程的hook</li>
<li>android_art: 用于支持对Java类函数hook而对Art源码进行的一系列定制</li>
<li>XposedBridge: Xposed的Java部分, 可单独作为AndroidStudio工程进行编译</li>
<li>XposedTools: 用于编译和打包Xposed框架</li>
</ul>
</blockquote>
<h3 id="XposedChecker-MainActivity"><a href="#XposedChecker-MainActivity" class="headerlink" title="XposedChecker#MainActivity"></a>XposedChecker#MainActivity</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] CHECK_ITEM = &#123;</span><br><span class="line">        <span class="string">"载入Xposed工具类"</span>,</span><br><span class="line">        <span class="string">"寻找特征动态链接库"</span>,</span><br><span class="line">        <span class="string">"代码堆栈寻找调起者"</span>,</span><br><span class="line">        <span class="string">"检测Xposed安装情况"</span>,</span><br><span class="line">        <span class="string">"判定系统方法调用钩子"</span>,</span><br><span class="line">        <span class="string">"检测虚拟Xposed环境"</span>,</span><br><span class="line">        <span class="string">"寻找Xposed运行库文件"</span>,</span><br><span class="line">        <span class="string">"内核查找Xposed链接库"</span>,</span><br><span class="line">        <span class="string">"环境变量特征字判断"</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] ROOT_STATUS = &#123;<span class="string">"出错"</span>, <span class="string">"未发现Root"</span>, <span class="string">"发现Root"</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;Integer&gt; status = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ALL_ALLOW = <span class="number">0777</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setTitle(<span class="string">"Xposed Checker"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FutureTask futureTask = <span class="keyword">new</span> FutureTask&lt;&gt;(<span class="keyword">new</span> UnpackThread());</span><br><span class="line">            <span class="keyword">new</span> Thread(futureTask).start();</span><br><span class="line">            futureTask.get();</span><br><span class="line"></span><br><span class="line">            futureTask = <span class="keyword">new</span> FutureTask&lt;&gt;(<span class="keyword">new</span> CheckThread());</span><br><span class="line">            <span class="keyword">new</span> Thread(futureTask).start();</span><br><span class="line">            futureTask.get();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        <span class="keyword">final</span> TextView textView = (TextView) findViewById(R.id.a);</span><br><span class="line">        <span class="keyword">final</span> ListView listView = (ListView) findViewById(R.id.b);</span><br><span class="line">        <span class="keyword">final</span> TextView about = (TextView) findViewById(R.id.about);</span><br><span class="line">        <span class="keyword">final</span> TextView donation = (TextView) findViewById(R.id.donation);</span><br><span class="line">        <span class="keyword">if</span> (about != <span class="keyword">null</span>) &#123;</span><br><span class="line">            about.getPaint().setAntiAlias(<span class="keyword">true</span>);</span><br><span class="line">            about.getPaint().setUnderlineText(<span class="keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (donation != <span class="keyword">null</span>) &#123;</span><br><span class="line">            donation.getPaint().setAntiAlias(<span class="keyword">true</span>);</span><br><span class="line">            donation.getPaint().setUnderlineText(<span class="keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (listView != <span class="keyword">null</span>) &#123;</span><br><span class="line">            listView.setAdapter(<span class="keyword">new</span> BaseAdapter() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> CHECK_ITEM.length + <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> Object <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> position;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getItemId</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> position;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View convertView, ViewGroup parent)</span> </span>&#123;</span><br><span class="line">                        RelativeLayout layout = (RelativeLayout) LayoutInflater.from(MainActivity.<span class="keyword">this</span>).inflate(R.layout.items, <span class="keyword">null</span>);</span><br><span class="line">                        TextView textView1 = (TextView) layout.findViewById(R.id.check_item);</span><br><span class="line">                        TextView textView2 = (TextView) layout.findViewById(R.id.check_result);</span><br><span class="line">                        <span class="keyword">int</span> itemStatus = status.get(position);</span><br><span class="line">                        <span class="keyword">boolean</span> pass = itemStatus == <span class="number">0</span>;</span><br><span class="line">                        <span class="keyword">if</span> (position == CHECK_ITEM.length) &#123;</span><br><span class="line">                            textView1.setText(R.string.root_check);</span><br><span class="line">                            textView2.setText(ROOT_STATUS[itemStatus + <span class="number">1</span>]);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            textView1.setText(CHECK_ITEM[position]);</span><br><span class="line">                            textView2.setText((pass ? getString(R.string.item_no_xposed) : getString(R.string.item_found_xposed)));</span><br><span class="line">                        &#125;</span><br><span class="line">                        textView2.setTextColor(pass ? Color.GREEN : Color.RED);</span><br><span class="line">                        <span class="keyword">return</span> layout;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> checkCode = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; CHECK_ITEM.length; ++i) &#123;</span><br><span class="line">            checkCode += status.get(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (textView != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (checkCode &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">                textView.setTextColor(Color.RED);</span><br><span class="line"></span><br><span class="line">                textView.setText(String.format(getString(R.string.found_xposed), checkCode, CHECK_ITEM.length));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                textView.setTextColor(Color.GREEN);</span><br><span class="line">                textView.setText(R.string.no_xposed);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">CheckThread</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Void</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Void <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            status.clear();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= CHECK_ITEM.length; i++) &#123;</span><br><span class="line">                Method method = MainActivity.class.getDeclaredMethod(<span class="string">"check"</span> + (i + <span class="number">1</span>));</span><br><span class="line">                method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    status.add((<span class="keyword">int</span>) method.invoke(MainActivity.<span class="keyword">this</span>));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">                    status.add(<span class="number">0</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">about</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> AlertDialog.Builder(<span class="keyword">this</span>).setTitle(<span class="string">"关于"</span>)</span><br><span class="line">            .setMessage(String.format(getString(R.string.about), Process.myPid()))</span><br><span class="line">            .setPositiveButton(<span class="string">"我知道了"</span>, <span class="keyword">null</span>)</span><br><span class="line">            .show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">donation</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> AlertDialog.Builder(<span class="keyword">this</span>).setTitle(<span class="string">"关于捐赠"</span>)</span><br><span class="line">            .setMessage(getString(R.string.donation))</span><br><span class="line">            .setPositiveButton(<span class="string">"支付宝捐赠"</span>, <span class="keyword">new</span> DialogInterface.OnClickListener() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialog, <span class="keyword">int</span> which)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (!AlipayDonate.startAlipayClient(MainActivity.<span class="keyword">this</span>, <span class="string">"fkx04282fwosw4vwrfnsr82"</span>)) &#123;</span><br><span class="line">                        Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"朋友你看起来大概是没有安装支付宝..."</span>, Toast.LENGTH_LONG).show();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            .show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Keep</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">check1</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> testClassLoader() || testUseClassDirectly() ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">testClassLoader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ClassLoader.getSystemClassLoader()</span><br><span class="line">                .loadClass(<span class="string">"de.robv.android.xposed.XposedHelpers"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">testUseClassDirectly</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            XposedBridge.log(<span class="string">"fuck wechat"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Keep</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">check2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> checkContains(<span class="string">"XposedBridge"</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Keep</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">check3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            StackTraceElement[] arrayOfStackTraceElement = e.getStackTrace();</span><br><span class="line">            <span class="keyword">for</span> (StackTraceElement s : arrayOfStackTraceElement) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">"de.robv.android.xposed.XposedBridge"</span>.equals(s.getClassName())) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Keep</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">check4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;PackageInfo&gt; list = getPackageManager().getInstalledPackages(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">for</span> (PackageInfo info : list) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">"de.robv.android.xposed.installer"</span>.equals(info.packageName)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">"io.va.exposed"</span>.equals(info.packageName)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Throwable ignored) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Keep</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">check5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Method method = Throwable.class.getDeclaredMethod(<span class="string">"getStackTrace"</span>);</span><br><span class="line">            <span class="keyword">return</span> Modifier.isNative(method.getModifiers()) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Keep</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">check6</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> System.getProperty(<span class="string">"vxp"</span>) != <span class="keyword">null</span> ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> paramString check string</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> whether check string is found in maps</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">checkContains</span><span class="params">(String paramString)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            HashSet&lt;String&gt; localObject = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">            <span class="comment">// 读取maps文件信息</span></span><br><span class="line">            BufferedReader localBufferedReader =</span><br><span class="line">                <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(<span class="string">"/proc/"</span> + Process.myPid() + <span class="string">"/maps"</span>));</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                String str = localBufferedReader.readLine();</span><br><span class="line">                <span class="keyword">if</span> (str == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                localObject.add(str.substring(str.lastIndexOf(<span class="string">" "</span>) + <span class="number">1</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//应用程序的链接库不可能是空，除非是高于7.0。。。</span></span><br><span class="line">            <span class="keyword">if</span> (localObject.isEmpty() &amp;&amp; Build.VERSION.SDK_INT &lt;= Build.VERSION_CODES.M) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            localBufferedReader.close();</span><br><span class="line">            <span class="keyword">for</span> (String aLocalObject : localObject) &#123;</span><br><span class="line">                <span class="keyword">if</span> (aLocalObject.contains(paramString)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Throwable ignored) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Keep</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">check7</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        CommandResult commandResult = Shell.run(<span class="string">"ls /system/lib"</span>);</span><br><span class="line">        <span class="keyword">return</span> commandResult.isSuccessful() ? commandResult.getStdout().contains(<span class="string">"xposed"</span>) ? <span class="number">1</span> : <span class="number">0</span> : <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Keep</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">check8</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        CommandResult commandResult = Shell.run(getFilesDir().getAbsolutePath() + <span class="string">"/checkman "</span> + Process.myPid());</span><br><span class="line">        <span class="keyword">return</span> commandResult.isSuccessful() ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Keep</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">check9</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> System.getenv(<span class="string">"CLASSPATH"</span>).contains(<span class="string">"XposedBridge"</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Keep</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">check10</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> RootCheckerUtils.detect(<span class="keyword">this</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            t.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">UnpackThread</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Void</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Void <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">new</span> File(getFilesDir().getAbsolutePath() + <span class="string">"/checkman"</span>).exists()) &#123;</span><br><span class="line">                InputStream inputStream = getAssets().open(<span class="string">"checkman"</span>);</span><br><span class="line">                OutputStream outputStream = openFileOutput(<span class="string">"checkman"</span>, MODE_PRIVATE);</span><br><span class="line">                <span class="keyword">int</span> bit;</span><br><span class="line">                <span class="keyword">while</span> ((bit = inputStream.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">                    outputStream.write(bit);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            setFilePermissions(getFilesDir(), ALL_ALLOW, -<span class="number">1</span>, -<span class="number">1</span>);</span><br><span class="line">            setFilePermissions(getFilesDir().getAbsolutePath() + <span class="string">"/checkman"</span>, ALL_ALLOW, -<span class="number">1</span>, -<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 修改文件权限</span></span><br><span class="line"><span class="comment">         * setFilePermissions(file, 0777, -1, -1);</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">boolean</span> <span class="title">setFilePermissions</span><span class="params">(File file, <span class="keyword">int</span> chmod, <span class="keyword">int</span> uid, <span class="keyword">int</span> gid)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (file != <span class="keyword">null</span>) &#123;</span><br><span class="line">                Class&lt;?&gt; fileUtils;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fileUtils = Class.forName(<span class="string">"android.os.FileUtils"</span>);</span><br><span class="line">                    Method setPermissions = fileUtils.getMethod(<span class="string">"setPermissions"</span>, File.class, <span class="keyword">int</span>.class, <span class="keyword">int</span>.class, <span class="keyword">int</span>.class);</span><br><span class="line">                    <span class="keyword">int</span> result = (Integer) setPermissions.invoke(<span class="keyword">null</span>, file, chmod, uid, gid);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> result == <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">boolean</span> <span class="title">setFilePermissions</span><span class="params">(String file, <span class="keyword">int</span> chmod, <span class="keyword">int</span> uid, <span class="keyword">int</span> gid)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> setFilePermissions(<span class="keyword">new</span> File(file), chmod, uid, gid);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h1 id="抓包全解"><a href="#抓包全解" class="headerlink" title="抓包全解"></a>抓包全解</h1><ul>
<li>抓包的核心原理: 抓包处在明文状态下的一切实际</li>
<li>Https抓包种类: <code>Http框架Hook</code>、<code>系统框架hook</code>,<code>中间人抓包</code>(中间人把一段通信切割两段通信)</li>
<li>搭建环境抓取Http: Charles、BurpSuite</li>
<li>Http的缺陷<ul>
<li>通信使用明文(不加密),内容可能会被窃听</li>
<li>不验证通信方的身份, 因此有可能遭遇伪装</li>
<li>无法证明报文的完整性, 所以有可能已遭篡改</li>
</ul>
</li>
</ul>
<p><code>frida_ssl_logger</code> native的ssl日志</p>
<blockquote>
<p>Https抓包详解 </p>
</blockquote>
<ul>
<li>Http + SSL + 认证 + 完整性保护 = Https</li>
<li>预共享密钥的非对称加密技术</li>
<li>Https通信完整流程</li>
<li>中间人抓包核心原理</li>
<li>Charles、BurpSuite开启SSL抓包</li>
</ul>
<h2 id="抓包环境"><a href="#抓包环境" class="headerlink" title="抓包环境"></a>抓包环境</h2><p>虚拟机,网络需要从Nat设置成桥接模式, Nat是一个子网, Nat下的虚拟机可以访问手机, 手机无法访问虚拟机<br>所以虚拟机先设置成桥接模式</p>
<p>虚拟机-&gt;编辑-&gt;虚拟网络编辑器</p>
<p>虚拟网络编辑器中设置桥接模式, 已桥接连接到正在上网的网卡上 </p>
<h2 id="Hook方案"><a href="#Hook方案" class="headerlink" title="Hook方案"></a>Hook方案</h2><h3 id="Hook之sslSocket抓包"><a href="#Hook之sslSocket抓包" class="headerlink" title="Hook之sslSocket抓包"></a>Hook之sslSocket抓包</h3><h3 id="Hook之Socket抓包"><a href="#Hook之Socket抓包" class="headerlink" title="Hook之Socket抓包"></a>Hook之Socket抓包</h3><h3 id="Hook之网卡和路由器抓包"><a href="#Hook之网卡和路由器抓包" class="headerlink" title="Hook之网卡和路由器抓包"></a>Hook之网卡和路由器抓包</h3><p><br></p>
<h1 id="Arm-amp-C-汇编原理"><a href="#Arm-amp-C-汇编原理" class="headerlink" title="Arm&amp;C++汇编原理"></a>Arm&amp;C++汇编原理</h1><ul>
<li>Arm可执行程序生成过程</li>
<li>Arm汇编</li>
<li>Arm汇编指令集</li>
<li>thumb、AArch64</li>
</ul>
<h2 id="Arm可执行程序的生成过程"><a href="#Arm可执行程序的生成过程" class="headerlink" title="Arm可执行程序的生成过程"></a>Arm可执行程序的生成过程</h2><ul>
<li>预处理(Preprocessing)</li>
<li>编译(Compilation)</li>
<li>汇编(Assemble)</li>
<li>链接(Linking)</li>
</ul>
<p>首先环境准备,我们得准备一个android的Ndk, 拿android最新的ndk内部<code>/root/Documents/android-ndk-r21e/toolchains/llvm/prebuilt/linux-x86_64/bin/clang</code>, 作为主要的clang编译器</p>
<p>至此可以拿<code>clang --target xxx hello.c -o hello</code>进行各个平台target的编译操作 </p>
<blockquote>
<p>汇编语言组成结构</p>
<ul>
<li>cpu</li>
<li>section段<ul>
<li><code>.text</code></li>
<li><code>.section .rodata.str1.1,&quot;aMS&quot;,%progbits,1</code></li>
<li><code>.section &quot;.note.GNU-stack&quot;,&quot;&quot;,%progbits</code></li>
</ul>
</li>
<li>符号<ul>
<li>外部符号<br>  bl  printf</li>
</ul>
</li>
<li>子程序<br>  .globl  main</li>
<li>main<br>  .fnstart/.fnend</li>
<li>标号<br>  <code>字符串+冒号</code>: <code>main:</code>这类型都是</li>
<li>注释<br>  <code>@</code></li>
</ul>
</blockquote>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">.text</span></span><br><span class="line">    .syntax unified</span><br><span class="line">    .cpu    arm7tdmi</span><br><span class="line">    .globl  main                    <span class="comment">@ -- Begin function main</span></span><br><span class="line">    .type   main,%<span class="meta">function</span></span><br><span class="line">    <span class="meta">.code</span>   <span class="number">32</span>                      <span class="comment">@ @main</span></span><br><span class="line"><span class="symbol">main</span>:</span><br><span class="line">    .fnstart</span><br><span class="line">    <span class="keyword">push </span>   &#123;<span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;       <span class="comment">@保存寄存器lr, r11到栈里面, lr记录函数的返回地址</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r11</span>, <span class="built_in">sp</span>             <span class="comment">@把sp赋值给r11  寄存器寻址</span></span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#24</span>         <span class="comment">@sp=sp-24   @sub rm, rn, #24 rm=rn-24</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r2</span>, <span class="number">#0</span>              <span class="comment">@r2=0           立即数寻址</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r2</span>, [<span class="built_in">r11</span>, #-<span class="number">4</span>]      <span class="comment">@把r2的值存到r11-4的地址上       基址寻址</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">r11</span>, #-<span class="number">8</span>]      <span class="comment">@把r0的值存到r11-8的地址上       基址寻址</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">sp</span>, <span class="number">#12</span>]       <span class="comment">@把r1的值存到sp-12的地址上       基址寻址</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, .LCPI0_0        <span class="comment">@ldr    r0,  [pc,  #40], 从pc+40读取内容存到r0, PC是当前指令的地址+两条指令长度 0x17a8, </span></span><br><span class="line"><span class="symbol">.LPC0_0</span>:</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">pc</span>, <span class="built_in">r0</span>          <span class="comment">@r0=pc+r0</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r1</span>, .LCPI0_1</span><br><span class="line"><span class="symbol">.LPC0_1</span>:</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r1</span>, <span class="built_in">pc</span>, <span class="built_in">r1</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r2</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]            <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">bl </span> printf              <span class="comment">@子程序的调用， r0~r3传递参数， 大于4个参数的时候，多的参数用栈传参数， si单步步入， </span></span><br><span class="line">                            <span class="comment">@r0用作返回值</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r1</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]            <span class="comment">@ 4-byte Reload</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#4</span>]            <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="built_in">r1</span>              <span class="comment">@r0返回值</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">sp</span>, <span class="built_in">r11</span>             <span class="comment">@恢复栈</span></span><br><span class="line">    <span class="keyword">pop </span>&#123;<span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;           <span class="comment">@恢复r11, lr</span></span><br><span class="line">    <span class="keyword">bx </span> <span class="built_in">lr</span>                  <span class="comment">@bx lr， 跳转到lr地址， arm -&gt; thumb 或者 thumb -&gt; arm</span></span><br><span class="line"><span class="comment">@ %bb.1:</span></span><br><span class="line"><span class="symbol">.LCPI0_0</span>:</span><br><span class="line">    <span class="meta">.long</span>   .L.<span class="keyword">str-(.LPC0_0+8)</span></span><br><span class="line"><span class="keyword">.LCPI0_1:</span></span><br><span class="line"><span class="keyword"> </span>   <span class="meta">.long</span>   .L.<span class="keyword">str.1-(.LPC0_1+8)</span></span><br><span class="line"><span class="keyword">.Lfunc_end0:</span></span><br><span class="line"><span class="keyword"> </span>   .size   main, .Lfunc_end0-main</span><br><span class="line">    .fnend</span><br><span class="line">                                        <span class="comment">@ -- End function</span></span><br><span class="line">    .type   .L.<span class="keyword">str,%object </span>         <span class="comment">@ @.str</span></span><br><span class="line">    <span class="meta">.section</span>    .rodata.<span class="keyword">str1.1,"aMS",%progbits,1</span></span><br><span class="line"><span class="keyword">.L.str:</span></span><br><span class="line"><span class="keyword"> </span>   <span class="meta">.asciz</span>  <span class="string">"hello %s!\r\n"</span></span><br><span class="line">    .size   .L.<span class="keyword">str, </span><span class="number">12</span></span><br><span class="line"></span><br><span class="line">    .type   .L.<span class="keyword">str.1,%object </span>       <span class="comment">@ @.str.1</span></span><br><span class="line"><span class="symbol">.L.str.1</span>:</span><br><span class="line">    <span class="meta">.asciz</span>  <span class="string">"arm"</span></span><br><span class="line">    .size   .L.<span class="keyword">str.1, </span><span class="number">7</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">.section</span>    <span class="string">".note.GNU-stack"</span>,<span class="string">""</span>,%progbits</span><br></pre></td></tr></table></figure>
<h3 id="预处理-Preprocessing"><a href="#预处理-Preprocessing" class="headerlink" title="预处理(Preprocessing)"></a>预处理(Preprocessing)</h3><p><code>clang -E hello.c -o arm_hello.i</code><br>切换到具体的目标<br><code>clang -target arm-linux--android30 -E hello.c -o arm_hello.i</code></p>
<h3 id="编译-Compilation"><a href="#编译-Compilation" class="headerlink" title="编译(Compilation)"></a>编译(Compilation)</h3><p><code>clang -S arm_hello.i -o arm_hello.s</code><br>切换到具体的目标<br><code>clang -target arm-linux--android30 -S arm_hello.i -o arm_hello.s</code></p>
<h3 id="汇编-Assemble"><a href="#汇编-Assemble" class="headerlink" title="汇编(Assemble)"></a>汇编(Assemble)</h3><p><code>clang -c arm_hello.s -o arm_hello.o</code>(小写c)<br>切换具体的目标<br><code>clang -target arm-linux--android30 -c arm_hello.s -o arm_hello.o</code></p>
<h3 id="链接-Linking"><a href="#链接-Linking" class="headerlink" title="链接(Linking)"></a>链接(Linking)</h3><p><code>clang x86_hello.o -o x86_hello</code><br>切换具体的目标<br><code>clang -target amr-linux--android30 x86_hello.o -o x86_hello</code></p>
<p><br></p>
<h3 id="寄存器"><a href="#寄存器" class="headerlink" title="寄存器"></a>寄存器</h3><p>R0~R7 未分组寄存器<br>R8~R12 是分组寄存器<br>R13~R14<br>    R13 SP<br>    R14 LR</p>
<p>R15 PC</p>
<p>CPSR</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">$r0</span>  : <span class="number">0x0</span></span><br><span class="line"><span class="symbol">$r1</span>  : <span class="number">0x0</span></span><br><span class="line"><span class="symbol">$r2</span>  : <span class="number">0x0</span></span><br><span class="line"><span class="symbol">$r3</span>  : <span class="number">0x0</span></span><br><span class="line"><span class="symbol">$r4</span>  : <span class="number">0x0</span></span><br><span class="line"><span class="symbol">$r5</span>  : <span class="number">0x0</span></span><br><span class="line"><span class="symbol">$r6</span>  : <span class="number">0x0</span></span><br><span class="line"><span class="symbol">$r7</span>  : <span class="number">0x0</span></span><br><span class="line"><span class="symbol">$r8</span>  : <span class="number">0x0</span></span><br><span class="line"><span class="symbol">$r9</span>  : <span class="number">0x0</span></span><br><span class="line"><span class="symbol">$r10</span> : <span class="number">0x0</span></span><br><span class="line"><span class="symbol">$r11</span> : <span class="number">0x0</span></span><br><span class="line"><span class="symbol">$r12</span> : <span class="number">0x0</span></span><br><span class="line"><span class="symbol">$sp</span>  : <span class="number">0xfffef990</span>  →  <span class="number">0x00000001</span></span><br><span class="line"><span class="symbol">$lr</span>  : <span class="number">0x0</span></span><br><span class="line"><span class="symbol">$pc</span>  : <span class="number">0xf773c3b8</span>  →  &lt;__dl__start+<span class="number">0</span>&gt; <span class="keyword">mov </span><span class="built_in">r0</span>,  <span class="built_in">sp</span></span><br><span class="line"><span class="symbol">$cpsr</span>: [negative zero carry overflow interrupt fast <span class="meta">thumb</span>]</span><br></pre></td></tr></table></figure>
<p><br></p>
<h2 id="Arm汇编寻址"><a href="#Arm汇编寻址" class="headerlink" title="Arm汇编寻址"></a>Arm汇编寻址</h2><p>数据处理指令的寻址方式</p>
<ul>
<li>立即数(都要<code>#</code>符号)<br>  <code>mov r0, #0     @立即数寻址</code><br>  <code>mov r0, #123   @十进制数</code><br>  <code>mov r0, #0x12  @十六进制数值</code></li>
<li>寄存器<br>  <code>mov r1, #0       @r1 = 0</code><br>  <code>mov r0, r1       @r0 = r1</code><br>  <code>add r0, r1, r2   @r0 = r1 + r2</code> </li>
<li>寄存器移位寻址<br>  <code>mov r0, r1, LSL #4   @ r0 = r1 &lt;&lt; 4</code><ul>
<li>LSL 逻辑左移</li>
<li>LSR 逻辑右移</li>
<li>ROR 循环右移</li>
<li>ASR 算术右移</li>
<li>RRX 扩展的循环右移</li>
</ul>
</li>
</ul>
<h3 id="Load-Store寻址方式"><a href="#Load-Store寻址方式" class="headerlink" title="Load Store寻址方式"></a>Load Store寻址方式</h3><blockquote>
<p><code>ldr伪指令和mov是比较相似的。只不过mov指令限制了立即数的长度为8位，也就是不能超过512。而ldr伪指令没有这个限制。</code><br><code>如果使用ldr伪指令，后面跟的立即数没有超过8位，那么在实际汇编的时候该ldr伪指令会被转换为mov指令。</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">例ldr r0, 0x12345678</span><br><span class="line">是把0x12345678这个地址中的值存放到r0中。</span><br><span class="line">而mov不能干这个活，mov只能在寄存器之间移动数据，或者把立即数移动到寄存器中。</span><br></pre></td></tr></table></figure>
<ul>
<li>立即数</li>
<li>寄存器<ul>
<li><code>ldr r0, [r2, r0, LSL #2] @ r0 = (r2 + (r0 &lt;&lt; 2))</code></li>
<li><code>ldr r0, [r1]    @r0=[r1]</code></li>
<li><code>ldr/ str</code></li>
<li><code>ldmia r3, [r4-r5] @从r3取个指给r4 , +4给r5, 再+4给r6</code></li>
</ul>
</li>
<li>基址变址<ul>
<li><code>str r0,[r3, #4]  @ r3+4 = r0</code></li>
<li><code>strb r0,[r3, #4]  @存一个字节</code></li>
</ul>
</li>
<li>栈寻址<ul>
<li><code>stmfd</code></li>
<li><code>ldmfd</code></li>
</ul>
</li>
</ul>
<h2 id="Arm汇编指令"><a href="#Arm汇编指令" class="headerlink" title="Arm汇编指令"></a>Arm汇编指令</h2><h3 id="跳转指令"><a href="#跳转指令" class="headerlink" title="跳转指令"></a>跳转指令</h3><p>B 强制跳转<br>BL 带返回的跳转指令 往LR寄存器赋值一个地址,函数结束后回到LR的寄存器的返回地址<br>BLX 带返回+带状态切换(arm -&gt; thumb, thumb-&gt;arm)<br>BX 带状态切换</p>
<h3 id="数据处理指令"><a href="#数据处理指令" class="headerlink" title="数据处理指令"></a>数据处理指令</h3><ul>
<li><p><code>mov, add, sub, and, eor, orr, bic</code></p>
  <figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mov </span><span class="built_in">r0</span>,<span class="built_in">r1</span></span><br><span class="line"><span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">r1</span>, <span class="built_in">r2</span>  <span class="comment">@r0 = r1 + r2</span></span><br><span class="line"><span class="keyword">sub </span><span class="built_in">r0</span>, <span class="built_in">r1</span>, <span class="built_in">r2</span>   <span class="comment">@r0 = r1 - r2</span></span><br><span class="line"><span class="keyword">and </span><span class="built_in">r0</span>, <span class="built_in">r1</span>, <span class="built_in">r2</span>   <span class="comment">@r0 = r1 &amp; r2</span></span><br><span class="line"><span class="keyword">eor </span><span class="built_in">r0</span>, <span class="built_in">r1</span>, <span class="built_in">r2</span>   <span class="comment">@r0 = r1 ^ r2</span></span><br><span class="line"><span class="keyword">orr </span><span class="built_in">r0</span>, <span class="built_in">r1</span>, <span class="built_in">r2</span>   <span class="comment">@r0 = r1 | r2</span></span><br><span class="line"><span class="keyword">bic </span><span class="built_in">r0</span>, <span class="built_in">r1</span>, <span class="number">#0xf</span> <span class="comment">@0x12345678 -&gt; 0x12345670</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>乘法指令 </p>
<ul>
<li><code>MUL r0, r1, r2 @r0 = r1 * r2</code></li>
<li><code>MLA r0, r1, r2 @r0 = r1 * r2 + r3</code></li>
<li><code>SMULL r0, r1, r2, r3 @ r0 = (r2 * r3)的低32位, r1 = (r2 * r3)的高32位</code></li>
<li><code>SMLAL r0, r1, r2, r3 @ r0 = (r2 * r3)的低32位 + r0, r1 = (r2 * r3)的高32位 + r1</code></li>
<li><code>UMULL r0, r1, r2, r3 @ r0 = (r2 * r3)的低32位, r1 = (r2 * r3)的高32位</code></li>
<li><code>UMLAL r0, r1, r2, r3 @ r0 = (r2 * r3)的低32位 + r0, r1 = (r2 * r3)的高32位 + r1</code></li>
</ul>
</li>
</ul>
<h3 id="内存访问指令"><a href="#内存访问指令" class="headerlink" title="内存访问指令"></a>内存访问指令</h3><ul>
<li><code>ldr 4字节读取</code></li>
<li><code>ldrb 1字节读取</code></li>
<li><code>ldrh 2字节读取</code></li>
<li><code>str 4字节写入</code></li>
<li><code>strb 1字节写入</code></li>
<li><code>strh 2字节写入</code></li>
</ul>
<h2 id="Arm汇编程序开发"><a href="#Arm汇编程序开发" class="headerlink" title="Arm汇编程序开发"></a>Arm汇编程序开发</h2><h3 id="print函数"><a href="#print函数" class="headerlink" title="print函数"></a>print函数</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">.text</span></span><br><span class="line">    .syntax unified</span><br><span class="line">    .cpu    arm7tdmi</span><br><span class="line">    .globl  main</span><br><span class="line">    .type   main,%<span class="meta">function</span></span><br><span class="line">    <span class="meta">.code</span>   <span class="number">32</span></span><br><span class="line"><span class="symbol">main</span>:</span><br><span class="line">    <span class="keyword">push </span>&#123;<span class="built_in">r4</span>, <span class="built_in">r5</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">@arm_ls path</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">r1</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">bl </span>opendir</span><br><span class="line">    <span class="keyword">cmp </span><span class="built_in">r0</span>, <span class="number">#0</span></span><br><span class="line">    <span class="keyword">beq </span>.LABEL_EXIT</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r4</span>, <span class="built_in">r0</span></span><br><span class="line">    <span class="keyword">bl </span>readdir</span><br><span class="line">    <span class="keyword">cmp </span><span class="built_in">r0</span>, <span class="number">#0</span></span><br><span class="line">    <span class="keyword">beq </span>.LABEL_CLOSE_DIR</span><br><span class="line"></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r5</span>, .format_str_</span><br><span class="line"><span class="symbol">.LABLE0</span>:</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r5</span>, <span class="built_in">pc</span>, <span class="built_in">r5</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">.LOOP_READDIR</span>:</span><br><span class="line">    <span class="comment">@printf("%s\r\n", str)</span></span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r1</span>, <span class="built_in">r0</span>, <span class="number">#0x13</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="built_in">r5</span></span><br><span class="line">    <span class="keyword">bl </span>printf</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="built_in">r4</span></span><br><span class="line">    <span class="keyword">bl </span>readdir</span><br><span class="line">    <span class="keyword">cmp </span><span class="built_in">r0</span>, <span class="number">#0</span></span><br><span class="line">    <span class="keyword">bne </span>.LOOP_READDIR</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="symbol">.LABEL_CLOSE_DIR</span>:</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="built_in">r4</span></span><br><span class="line">    <span class="keyword">bl </span>closedir</span><br><span class="line"></span><br><span class="line"><span class="symbol">.LABEL_EXIT</span>:</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#0</span></span><br><span class="line">    <span class="keyword">pop </span>&#123;<span class="built_in">r4</span>, <span class="built_in">r5</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    <span class="keyword">bx </span><span class="built_in">lr</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">.format_str_</span>:</span><br><span class="line">    <span class="meta">.long</span> .format_str-(.LABLE0 + <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="symbol">.format_str</span>:</span><br><span class="line">    <span class="meta">.asciz</span> <span class="string">"%s\r\n"</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<h2 id="Arm汇编指令集"><a href="#Arm汇编指令集" class="headerlink" title="Arm汇编指令集"></a>Arm汇编指令集</h2><blockquote>
<p>Arm和Thumb的区别<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">thumb-&gt; 16,32</span><br><span class="line"></span><br><span class="line">描述新增</span><br><span class="line">.code 16</span><br><span class="line">.thumb_func</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>Arm与Aarch64的区别<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">寄存器多了, x0是寄存器, w0是x0的低32位寄存器</span><br><span class="line">64位有x0~x30, x0~x7传递参数, x0经常作为返回结果,</span><br><span class="line"></span><br><span class="line">### x8当一个返回值大于x0返回的长度, 那么x8会作为x0的结果地址</span><br><span class="line"></span><br><span class="line">x9~x15临时寄存器, x16~x17用来内部过程调用的寄存器</span><br><span class="line">x18临时</span><br><span class="line">x19~x28用来做备份</span><br><span class="line">x29 用来做栈的寄存器 FP</span><br><span class="line"></span><br><span class="line">### x30 LR返回地址寄存器</span><br><span class="line"></span><br><span class="line">64位有专门的SP、PC、CPSR寄存器</span><br><span class="line">我</span><br><span class="line">还有arm和thumb的返回指是bx lr,但是aarch64都是ret直接返回</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="如何查看Arm官方文档"><a href="#如何查看Arm官方文档" class="headerlink" title="如何查看Arm官方文档"></a>如何查看Arm官方文档</h3><ul>
<li><a href="http://developer.arm.com/" target="_blank" rel="noopener">http://developer.arm.com/</a></li>
<li><a href="https://armconverter.com/" target="_blank" rel="noopener">https://armconverter.com/</a></li>
</ul>
<h3 id="Arm汇编指令集-1"><a href="#Arm汇编指令集-1" class="headerlink" title="Arm汇编指令集"></a>Arm汇编指令集</h3><ul>
<li><code>clang -target arm-linux-android30 -S hello.c -o hello.s</code></li>
</ul>
<h3 id="Thumb汇编指令集"><a href="#Thumb汇编指令集" class="headerlink" title="Thumb汇编指令集"></a>Thumb汇编指令集</h3><ul>
<li><p><code>clang -target arm-linux-android30 -S -mthumb hello.c -o hello.s</code></p>
<h3 id="Armv8汇编指令集"><a href="#Armv8汇编指令集" class="headerlink" title="Armv8汇编指令集"></a>Armv8汇编指令集</h3></li>
<li><p><code>clang target aarch64-linux-android30 -S hello.c -o hello.s</code></p>
</li>
</ul>
<p><br></p>
<h2 id="C程序逆向分析"><a href="#C程序逆向分析" class="headerlink" title="C程序逆向分析"></a>C程序逆向分析</h2><ul>
<li>数据类型</li>
<li>运算符</li>
<li>分支与跳转</li>
<li>循环</li>
<li>函数</li>
<li>数组与指针</li>
<li>结构体</li>
<li>位操作 </li>
</ul>
<h3 id="数据类型-amp-运算符-amp-分支-amp-循环"><a href="#数据类型-amp-运算符-amp-分支-amp-循环" class="headerlink" title="数据类型&amp;运算符&amp;分支&amp;循环"></a>数据类型&amp;运算符&amp;分支&amp;循环</h3><blockquote>
<p>char &amp; shourt</p>
</blockquote>
<ul>
<li>strb:一个字节 byte</li>
<li>strh:两个字节 short</li>
<li>str: 四个字节</li>
</ul>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">strb </span>   <span class="built_in">r0</span>, [<span class="built_in">r11</span>, #-<span class="number">14</span>]</span><br><span class="line"><span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#16</span></span><br><span class="line"><span class="keyword">strh </span>   <span class="built_in">r0</span>, [<span class="built_in">r11</span>, #-<span class="number">16</span>]</span><br><span class="line"><span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#32</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>float</p>
</blockquote>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#26738688</span></span><br><span class="line"><span class="keyword">orr </span><span class="built_in">r0</span>, <span class="built_in">r0</span>, <span class="number">#1073741824</span></span><br><span class="line"><span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#36</span>] </span><br><span class="line"></span><br><span class="line"><span class="comment">@ 这里怎么算,先算指数部分(30~23), 比如19.0f</span></span><br><span class="line"><span class="comment">@ 19翻译二进制就是0001 0011</span></span><br><span class="line"><span class="comment">@ 19是正数,所以31位为0, 负数则为1(31)</span></span><br><span class="line"><span class="comment">@ 19.0 翻译一下就是10011 -&gt; 1.0011 那就是向右边移动4位 则2^4, 值就是4 那么127 + 4代表的是131</span></span><br><span class="line"><span class="comment">@ 得到的指数位结果131就是 1000 0011</span></span><br><span class="line"><span class="comment">@ 小数部分的计算就是 0.0011 -&gt; 0011那么(22~0)</span></span><br><span class="line"><span class="comment">@ 得到的结果就是0100 0001 1(30~23)001 1000 000 000 000 000(22~0)</span></span><br><span class="line"><span class="comment">@ 这样算出的结果就是 0x4198 0000</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>double </p>
</blockquote>
<ul>
<li>double d1 = 29.0;</li>
<li>double d2 = 39.0;</li>
</ul>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">@ 0x403d0000 29.0 -&gt; 1.1101 * 2^4 =  100 0000 0011 = 1023 + 4</span></span><br><span class="line"><span class="comment">@ double比float指数位长一点,(30~20)</span></span><br><span class="line"><span class="comment">@ 小数位1101(19~0)</span></span><br><span class="line"><span class="comment">@ 29是正数,所以31位为0, 负数则为1(31)</span></span><br><span class="line"><span class="comment">@ 结果就是 0100 0000 0011 1101 0000 0000 0000 0000</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>运算符 </p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> ch3 = ch1 + ch2;</span><br><span class="line"><span class="keyword">short</span> s3 = s1 - s2;</span><br><span class="line"><span class="keyword">int</span> n3 = n1 * n2;</span><br><span class="line">n3 = <span class="number">0x1000</span>;</span><br><span class="line"><span class="comment">// int n4 = n3 / 11;</span></span><br><span class="line"><span class="keyword">int</span> n5 = n3 % <span class="number">7</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ldrb </span>   <span class="built_in">r0</span>, [<span class="built_in">r11</span>, #-<span class="number">13</span>]</span><br><span class="line"><span class="keyword">ldrb </span>   <span class="built_in">r1</span>, [<span class="built_in">r11</span>, #-<span class="number">14</span>]</span><br><span class="line"><span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">r0</span>, <span class="built_in">r1</span>              <span class="comment">@ 加法</span></span><br><span class="line"><span class="keyword">strb </span>   <span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#15</span>]</span><br><span class="line"><span class="keyword">ldrh </span>   <span class="built_in">r0</span>, [<span class="built_in">r11</span>, #-<span class="number">16</span>]</span><br><span class="line"><span class="keyword">ldrh </span>   <span class="built_in">r1</span>, [<span class="built_in">r11</span>, #-<span class="number">18</span>]</span><br><span class="line"><span class="keyword">sub </span><span class="built_in">r0</span>, <span class="built_in">r0</span>, <span class="built_in">r1</span>              <span class="comment">@减法</span></span><br><span class="line"><span class="keyword">strh </span>   <span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#12</span>]</span><br><span class="line"><span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">r11</span>, #-<span class="number">24</span>]</span><br><span class="line"><span class="keyword">ldr </span><span class="built_in">r1</span>, [<span class="built_in">r11</span>, #-<span class="number">28</span>]</span><br><span class="line"><span class="keyword">mul </span><span class="built_in">r2</span>, <span class="built_in">r0</span>, <span class="built_in">r1</span>              <span class="comment">@乘法</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]</span><br><span class="line"><span class="keyword">ldr </span><span class="built_in">r1</span>, .LCPI0_1</span><br><span class="line"><span class="keyword">smull </span>  <span class="built_in">r3</span>, <span class="built_in">r12</span>, <span class="built_in">r0</span>, <span class="built_in">r1</span>      <span class="comment">@除法</span></span><br><span class="line"><span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">r12</span>, <span class="built_in">r0</span>              <span class="comment">@r0 = 0xffff f924 + 0x1000 = 0x1 0000 0924, 高位全部用1填充, 只有4个字节舍弃高位1, r0则为0x0000 0924</span></span><br><span class="line"><span class="keyword">asr </span><span class="built_in">r1</span>, <span class="built_in">r0</span> ,<span class="number">#2</span>               <span class="comment">@r1 = 0x0000 0924 &gt;&gt; 2 = 0x249</span></span><br><span class="line"><span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">r1</span>, <span class="built_in">r0</span>, <span class="keyword">lsr </span><span class="number">#31</span>      <span class="comment">@r0 = (0x0000 0924 &gt;&gt; 31) + 0x249 = 0x249</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">@ smull   r3, r12, r0, r1  </span></span><br><span class="line"><span class="comment">@ r0 = 0x1000</span></span><br><span class="line"><span class="comment">@ r1 = 0x92492493</span></span><br><span class="line"><span class="comment">@ 这两个值的乘法为 0x924 9249 3000 超过了32位</span></span><br><span class="line"><span class="comment">@ 低位放到了r2, 高位放到了r3</span></span><br><span class="line"><span class="comment">@ r3 = 0x9249 3000  </span></span><br><span class="line"><span class="comment">@ r12 = 0xffff f924</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>分支 </p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(n5 &gt; <span class="number">6</span>)&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"n5:%d\n"</span>, n5);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span>(n5)&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"1\n"</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"2\n"</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"3\n"</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"default\n"</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmp </span><span class="built_in">r0</span>,<span class="number">#7</span>           # <span class="meta">if</span> 分支</span><br><span class="line"><span class="keyword">blt </span>.LABEL_2</span><br><span class="line"><span class="symbol">xxx</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">.LABEL_2</span></span><br><span class="line"><span class="symbol">xxx</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="symbol">.LBBO_11</span></span><br><span class="line"><span class="keyword">ldr </span><span class="built_in">r0</span>, &#123;<span class="built_in">sp</span>, <span class="number">#4</span>&#125;</span><br><span class="line"><span class="keyword">cmp </span><span class="built_in">r0</span>, <span class="number">#1</span></span><br><span class="line"><span class="keyword">str </span><span class="built_in">r0</span>, &#123;<span class="built_in">sp</span>&#125;</span><br><span class="line"><span class="keyword">beq </span>.LBBO_1</span><br><span class="line"><span class="keyword">b </span>  .LBBO_5</span><br><span class="line"></span><br><span class="line"><span class="symbol">.LBBO_12</span></span><br><span class="line"><span class="keyword">ldr </span><span class="built_in">r0</span>, &#123;<span class="built_in">sp</span>&#125;</span><br><span class="line"><span class="keyword">cmp </span><span class="built_in">r0</span>, <span class="number">#2</span></span><br><span class="line"><span class="keyword">beq </span>.LBBO_2</span><br><span class="line"><span class="keyword">b </span>  .LBBO_5</span><br><span class="line"></span><br><span class="line"><span class="symbol">.LBBO_13</span></span><br><span class="line"><span class="keyword">ldr </span><span class="built_in">r0</span>, &#123;<span class="built_in">sp</span>&#125;</span><br><span class="line"><span class="keyword">cmp </span><span class="built_in">r0</span>, <span class="number">#3</span></span><br><span class="line"><span class="keyword">beq </span>.LBBO_3</span><br><span class="line"><span class="keyword">b </span>  .LBBO_5</span><br></pre></td></tr></table></figure>
<h4 id="hello-c"><a href="#hello-c" class="headerlink" title="hello.c"></a>hello.c</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> ch1 = <span class="string">'a'</span>;</span><br><span class="line">    <span class="keyword">char</span> ch2 = <span class="string">'b'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">short</span> s1 = <span class="number">0x10</span>;</span><br><span class="line">    <span class="keyword">short</span> s2 = <span class="number">0x20</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> n1 = <span class="number">0x100</span>;</span><br><span class="line">    <span class="keyword">int</span> n2 = <span class="number">0x200</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> f1 = <span class="number">9.0f</span>;</span><br><span class="line">    <span class="keyword">float</span> f2 = <span class="number">19.0f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> d1 = <span class="number">29.0</span>;</span><br><span class="line">    <span class="keyword">double</span> d2 = <span class="number">39.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> ch3 = ch1 + ch2;</span><br><span class="line">    <span class="keyword">short</span> s3 = s1 - s2;</span><br><span class="line">    <span class="keyword">int</span> n3 = n1 * n2;</span><br><span class="line">    n3 = <span class="number">0x1000</span>;</span><br><span class="line">    <span class="comment">// int n4 = n3 / 11;</span></span><br><span class="line">    <span class="keyword">int</span> n5 = n3 % <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//goto goto_label;</span></span><br><span class="line">    <span class="keyword">if</span> (n5 &lt; <span class="number">6</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"if n5:%d\r\n"</span>,n5);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="built_in">printf</span>(<span class="string">"else n5:%d\r\n"</span>,n5);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (n5)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"case 1\r\n"</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"case 2\r\n"</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"case 3\r\n"</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"case 4\r\n"</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"case default\r\n"</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">goto_label:</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"goto"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"for i : %d\r\n"</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> j = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">while</span> (j)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"while j : %d\r\n"</span>, j);</span><br><span class="line">        j--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">       <span class="built_in">printf</span>(<span class="string">"do while k : %d\r\n"</span>, k--);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">while</span> (k);</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="hello-s"><a href="#hello-s" class="headerlink" title="hello.s"></a>hello.s</h4><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">.text</span></span><br><span class="line">    .syntax unified</span><br><span class="line">    .eabi_attribute <span class="number">67</span>, <span class="string">"2.09"</span>  <span class="comment">@ Tag_conformance</span></span><br><span class="line">    .cpu    arm7tdmi</span><br><span class="line">    .eabi_attribute <span class="number">6</span>, <span class="number">2</span>    <span class="comment">@ Tag_CPU_arch</span></span><br><span class="line">    .eabi_attribute <span class="number">8</span>, <span class="number">1</span>    <span class="comment">@ Tag_ARM_ISA_use</span></span><br><span class="line">    .eabi_attribute <span class="number">9</span>, <span class="number">1</span>    <span class="comment">@ Tag_THUMB_ISA_use</span></span><br><span class="line">    .eabi_attribute <span class="number">34</span>, <span class="number">0</span>   <span class="comment">@ Tag_CPU_unaligned_access</span></span><br><span class="line">    .eabi_attribute <span class="number">15</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_PCS_RW_data</span></span><br><span class="line">    .eabi_attribute <span class="number">16</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_PCS_RO_data</span></span><br><span class="line">    .eabi_attribute <span class="number">17</span>, <span class="number">2</span>   <span class="comment">@ Tag_ABI_PCS_GOT_use</span></span><br><span class="line">    .eabi_attribute <span class="number">20</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_FP_denormal</span></span><br><span class="line">    .eabi_attribute <span class="number">21</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_FP_exceptions</span></span><br><span class="line">    .eabi_attribute <span class="number">23</span>, <span class="number">3</span>   <span class="comment">@ Tag_ABI_FP_number_model</span></span><br><span class="line">    .eabi_attribute <span class="number">24</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_align_needed</span></span><br><span class="line">    .eabi_attribute <span class="number">25</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_align_preserved</span></span><br><span class="line">    .eabi_attribute <span class="number">38</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_FP_16bit_format</span></span><br><span class="line">    .eabi_attribute <span class="number">18</span>, <span class="number">4</span>   <span class="comment">@ Tag_ABI_PCS_wchar_t</span></span><br><span class="line">    .eabi_attribute <span class="number">26</span>, <span class="number">2</span>   <span class="comment">@ Tag_ABI_enum_size</span></span><br><span class="line">    .eabi_attribute <span class="number">14</span>, <span class="number">0</span>   <span class="comment">@ Tag_ABI_PCS_R9_use</span></span><br><span class="line">    .file   <span class="string">"c_hello.c"</span></span><br><span class="line">    .globl  main                    <span class="comment">@ -- Begin function main</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line">    .type   main,%<span class="meta">function</span></span><br><span class="line">    <span class="meta">.code</span>   <span class="number">32</span>                      <span class="comment">@ @main</span></span><br><span class="line"><span class="symbol">main</span>:</span><br><span class="line">    .fnstart</span><br><span class="line"><span class="comment">@ %bb.0:</span></span><br><span class="line">    .save   &#123;<span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    <span class="keyword">push </span>   &#123;<span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    .setfp  <span class="built_in">r11</span>, <span class="built_in">sp</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r11</span>, <span class="built_in">sp</span></span><br><span class="line">    .pad    <span class="number">#72</span></span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#72</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r2</span>, <span class="number">#0</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r2</span>, [<span class="built_in">r11</span>, #-<span class="number">4</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">r11</span>, #-<span class="number">8</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r11</span>, #-<span class="number">12</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#97</span></span><br><span class="line">    <span class="keyword">strb </span>   <span class="built_in">r0</span>, [<span class="built_in">r11</span>, #-<span class="number">13</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#98</span></span><br><span class="line">    <span class="keyword">strb </span>   <span class="built_in">r0</span>, [<span class="built_in">r11</span>, #-<span class="number">14</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#16</span></span><br><span class="line">    <span class="keyword">strh </span>   <span class="built_in">r0</span>, [<span class="built_in">r11</span>, #-<span class="number">16</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#32</span></span><br><span class="line">    <span class="keyword">strh </span>   <span class="built_in">r0</span>, [<span class="built_in">r11</span>, #-<span class="number">18</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#256</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">r11</span>, #-<span class="number">24</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#512</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">r11</span>, #-<span class="number">28</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#17825792</span></span><br><span class="line">    <span class="keyword">orr </span><span class="built_in">r0</span>, <span class="built_in">r0</span>, <span class="number">#1073741824</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">r11</span>, #-<span class="number">32</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#26738688</span></span><br><span class="line">    <span class="keyword">orr </span><span class="built_in">r0</span>, <span class="built_in">r0</span>, <span class="number">#1073741824</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#36</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#3997696</span></span><br><span class="line">    <span class="keyword">orr </span><span class="built_in">r0</span>, <span class="built_in">r0</span>, <span class="number">#1073741824</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#28</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r2</span>, [<span class="built_in">sp</span>, <span class="number">#24</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, .LCPI0_0</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#20</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r2</span>, [<span class="built_in">sp</span>, <span class="number">#16</span>]</span><br><span class="line">    <span class="keyword">ldrb </span>   <span class="built_in">r0</span>, [<span class="built_in">r11</span>, #-<span class="number">13</span>]</span><br><span class="line">    <span class="keyword">ldrb </span>   <span class="built_in">r1</span>, [<span class="built_in">r11</span>, #-<span class="number">14</span>]</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">r0</span>, <span class="built_in">r1</span></span><br><span class="line">    <span class="keyword">strb </span>   <span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#15</span>]</span><br><span class="line">    <span class="keyword">ldrh </span>   <span class="built_in">r0</span>, [<span class="built_in">r11</span>, #-<span class="number">16</span>]</span><br><span class="line">    <span class="keyword">ldrh </span>   <span class="built_in">r1</span>, [<span class="built_in">r11</span>, #-<span class="number">18</span>]</span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">r0</span>, <span class="built_in">r0</span>, <span class="built_in">r1</span></span><br><span class="line">    <span class="keyword">strh </span>   <span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">r11</span>, #-<span class="number">24</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r1</span>, [<span class="built_in">r11</span>, #-<span class="number">28</span>]</span><br><span class="line">    <span class="keyword">mul </span><span class="built_in">r2</span>, <span class="built_in">r0</span>, <span class="built_in">r1</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r2</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#4096</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r1</span>, .LCPI0_1</span><br><span class="line">    <span class="keyword">smull </span>  <span class="built_in">r2</span>, <span class="built_in">r3</span>, <span class="built_in">r0</span>, <span class="built_in">r1</span></span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r1</span>, <span class="built_in">r3</span>, <span class="built_in">r0</span></span><br><span class="line">    <span class="keyword">asr </span><span class="built_in">r3</span>, <span class="built_in">r1</span>, <span class="number">#2</span></span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r1</span>, <span class="built_in">r3</span>, <span class="built_in">r1</span>, <span class="keyword">lsr </span><span class="number">#31</span></span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">r1</span>, <span class="built_in">r1</span>, <span class="built_in">r1</span>, <span class="keyword">lsl </span><span class="number">#3</span></span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">r0</span>, <span class="built_in">r1</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">cmp </span><span class="built_in">r0</span>, <span class="number">#5</span></span><br><span class="line">    <span class="keyword">bgt </span>.LBB0_2</span><br><span class="line">    <span class="keyword">b </span>  .LBB0_1</span><br><span class="line"><span class="symbol">.LBB0_1</span>:</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r1</span>, [<span class="built_in">sp</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, .LCPI0_2</span><br><span class="line"><span class="symbol">.LPC0_0</span>:</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">pc</span>, <span class="built_in">r0</span></span><br><span class="line">    <span class="keyword">bl </span> printf</span><br><span class="line">    <span class="keyword">b </span>  .LBB0_3</span><br><span class="line"><span class="symbol">.LBB0_2</span>:</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r1</span>, [<span class="built_in">sp</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, .LCPI0_3</span><br><span class="line"><span class="symbol">.LPC0_1</span>:</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">pc</span>, <span class="built_in">r0</span></span><br><span class="line">    <span class="keyword">bl </span> printf</span><br><span class="line">    <span class="keyword">b </span>  .LBB0_3</span><br><span class="line"><span class="symbol">.LBB0_3</span>:</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">r0</span>, <span class="built_in">r0</span>, <span class="number">#1</span></span><br><span class="line">    <span class="keyword">cmp </span><span class="built_in">r0</span>, <span class="number">#3</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>]                <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">bhi </span>.LBB0_10</span><br><span class="line"><span class="comment">@ %bb.4:</span></span><br><span class="line">    <span class="keyword">adr </span><span class="built_in">r0</span>, .LJTI0_0</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r1</span>, [<span class="built_in">sp</span>]                <span class="comment">@ 4-byte Reload</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r2</span>, [<span class="built_in">r0</span>, <span class="built_in">r1</span>, <span class="keyword">lsl </span><span class="number">#2</span>]</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">pc</span>, <span class="built_in">r0</span>, <span class="built_in">r2</span></span><br><span class="line"><span class="comment">@ %bb.5:</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line"><span class="symbol">.LJTI0_0</span>:</span><br><span class="line">    <span class="meta">.long</span>   .LBB0_6-.LJTI0_0</span><br><span class="line">    <span class="meta">.long</span>   .LBB0_7-.LJTI0_0</span><br><span class="line">    <span class="meta">.long</span>   .LBB0_8-.LJTI0_0</span><br><span class="line">    <span class="meta">.long</span>   .LBB0_9-.LJTI0_0</span><br><span class="line"><span class="symbol">.LBB0_6</span>:</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, .LCPI0_4</span><br><span class="line"><span class="symbol">.LPC0_2</span>:</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">pc</span>, <span class="built_in">r0</span></span><br><span class="line">    <span class="keyword">bl </span> printf</span><br><span class="line">    <span class="keyword">b </span>  .LBB0_11</span><br><span class="line"><span class="symbol">.LBB0_7</span>:</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, .LCPI0_5</span><br><span class="line"><span class="symbol">.LPC0_3</span>:</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">pc</span>, <span class="built_in">r0</span></span><br><span class="line">    <span class="keyword">bl </span> printf</span><br><span class="line">    <span class="keyword">b </span>  .LBB0_11</span><br><span class="line"><span class="symbol">.LBB0_8</span>:</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, .LCPI0_6</span><br><span class="line"><span class="symbol">.LPC0_4</span>:</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">pc</span>, <span class="built_in">r0</span></span><br><span class="line">    <span class="keyword">bl </span> printf</span><br><span class="line">    <span class="keyword">b </span>  .LBB0_11</span><br><span class="line"><span class="symbol">.LBB0_9</span>:</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, .LCPI0_7</span><br><span class="line"><span class="symbol">.LPC0_5</span>:</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">pc</span>, <span class="built_in">r0</span></span><br><span class="line">    <span class="keyword">bl </span> printf</span><br><span class="line">    <span class="keyword">b </span>  .LBB0_11</span><br><span class="line"><span class="symbol">.LBB0_10</span>:</span><br><span class="line">    <span class="keyword">b </span>  .LBB0_11</span><br><span class="line"><span class="symbol">.LBB0_11</span>:</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#0</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">sp</span>, <span class="built_in">r11</span></span><br><span class="line">    <span class="keyword">pop </span>&#123;<span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    <span class="keyword">bx </span> <span class="built_in">lr</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line"><span class="comment">@ %bb.12:</span></span><br><span class="line"><span class="symbol">.LCPI0_0</span>:</span><br><span class="line">    <span class="meta">.long</span>   <span class="number">1078165504</span>              <span class="comment">@ 0x40438000</span></span><br><span class="line"><span class="symbol">.LCPI0_1</span>:</span><br><span class="line">    <span class="meta">.long</span>   <span class="number">2454267027</span>              <span class="comment">@ 0x92492493</span></span><br><span class="line"><span class="symbol">.LCPI0_2</span>:</span><br><span class="line">    <span class="meta">.long</span>   .L.<span class="keyword">str-(.LPC0_0+8)</span></span><br><span class="line"><span class="keyword">.LCPI0_3:</span></span><br><span class="line"><span class="keyword"> </span>   <span class="meta">.long</span>   .L.<span class="keyword">str.1-(.LPC0_1+8)</span></span><br><span class="line"><span class="keyword">.LCPI0_4:</span></span><br><span class="line"><span class="keyword"> </span>   <span class="meta">.long</span>   .L.<span class="keyword">str.2-(.LPC0_2+8)</span></span><br><span class="line"><span class="keyword">.LCPI0_5:</span></span><br><span class="line"><span class="keyword"> </span>   <span class="meta">.long</span>   .L.<span class="keyword">str.3-(.LPC0_3+8)</span></span><br><span class="line"><span class="keyword">.LCPI0_6:</span></span><br><span class="line"><span class="keyword"> </span>   <span class="meta">.long</span>   .L.<span class="keyword">str.4-(.LPC0_4+8)</span></span><br><span class="line"><span class="keyword">.LCPI0_7:</span></span><br><span class="line"><span class="keyword"> </span>   <span class="meta">.long</span>   .L.<span class="keyword">str.5-(.LPC0_5+8)</span></span><br><span class="line"><span class="keyword">.Lfunc_end0:</span></span><br><span class="line"><span class="keyword"> </span>   .size   main, .Lfunc_end0-main</span><br><span class="line">    .cantunwind</span><br><span class="line">    .fnend</span><br><span class="line">                                        <span class="comment">@ -- End function</span></span><br><span class="line">    .type   .L.<span class="keyword">str,%object </span>         <span class="comment">@ @.str</span></span><br><span class="line">    <span class="meta">.section</span>    .rodata.<span class="keyword">str1.1,"aMS",%progbits,1</span></span><br><span class="line"><span class="keyword">.L.str:</span></span><br><span class="line"><span class="keyword"> </span>   <span class="meta">.asciz</span>  <span class="string">"if n5:%d\r\n"</span></span><br><span class="line">    .size   .L.<span class="keyword">str, </span><span class="number">11</span></span><br><span class="line"></span><br><span class="line">    .type   .L.<span class="keyword">str.1,%object </span>       <span class="comment">@ @.str.1</span></span><br><span class="line"><span class="symbol">.L.str.1</span>:</span><br><span class="line">    <span class="meta">.asciz</span>  <span class="string">"else n5:%d\r\n"</span></span><br><span class="line">    .size   .L.<span class="keyword">str.1, </span><span class="number">13</span></span><br><span class="line"></span><br><span class="line">    .type   .L.<span class="keyword">str.2,%object </span>       <span class="comment">@ @.str.2</span></span><br><span class="line"><span class="symbol">.L.str.2</span>:</span><br><span class="line">    <span class="meta">.asciz</span>  <span class="string">"case 1\r\n"</span></span><br><span class="line">    .size   .L.<span class="keyword">str.2, </span><span class="number">9</span></span><br><span class="line"></span><br><span class="line">    .type   .L.<span class="keyword">str.3,%object </span>       <span class="comment">@ @.str.3</span></span><br><span class="line"><span class="symbol">.L.str.3</span>:</span><br><span class="line">    <span class="meta">.asciz</span>  <span class="string">"case 2\r\n"</span></span><br><span class="line">    .size   .L.<span class="keyword">str.3, </span><span class="number">9</span></span><br><span class="line"></span><br><span class="line">    .type   .L.<span class="keyword">str.4,%object </span>       <span class="comment">@ @.str.4</span></span><br><span class="line"><span class="symbol">.L.str.4</span>:</span><br><span class="line">    <span class="meta">.asciz</span>  <span class="string">"case 3\r\n"</span></span><br><span class="line">    .size   .L.<span class="keyword">str.4, </span><span class="number">9</span></span><br><span class="line"></span><br><span class="line">    .type   .L.<span class="keyword">str.5,%object </span>       <span class="comment">@ @.str.5</span></span><br><span class="line"><span class="symbol">.L.str.5</span>:</span><br><span class="line">    <span class="meta">.asciz</span>  <span class="string">"case 4\r\n"</span></span><br><span class="line">    .size   .L.<span class="keyword">str.5, </span><span class="number">9</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    .ident  <span class="string">"Android (5900059 based on r365631c) clang version 9.0.8 (https://android.googlesource.com/toolchain/llvm-project 207d7abc1a2abf3ef8d4301736d6a7ebc224a290) (based on LLVM 9.0.8svn)"</span></span><br><span class="line">    <span class="meta">.section</span>    <span class="string">".note.GNU-stack"</span>,<span class="string">""</span>,%progbits</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="函数、结构体、数组、位操作"><a href="#函数、结构体、数组、位操作" class="headerlink" title="函数、结构体、数组、位操作"></a>函数、结构体、数组、位操作</h3><h4 id="main-c"><a href="#main-c" class="headerlink" title="main.c"></a>main.c</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func_arg_type</span><span class="params">(<span class="keyword">char</span> ch, <span class="keyword">short</span> s, <span class="keyword">int</span> n, <span class="keyword">int</span> f, <span class="keyword">int</span> d, <span class="keyword">int</span> n2, <span class="keyword">int</span> n3)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%c %d %d %d %d\r\n"</span>, ch, s, n, f, d);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">func</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> n1;</span><br><span class="line">    <span class="keyword">int</span> n2;</span><br><span class="line">    <span class="keyword">int</span> n3;</span><br><span class="line">    <span class="keyword">char</span>* lpstr;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">func_ret_int</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">func</span> <span class="title">f</span> = &#123;</span><span class="number">0</span>&#125;;</span><br><span class="line">    f.n1 = <span class="number">1</span>;</span><br><span class="line">    f.n2 = <span class="number">2</span>;</span><br><span class="line">    f.n3 = <span class="number">3</span>;</span><br><span class="line">    f.lpstr = <span class="string">"123"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> f.n3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">struct func <span class="title">func_ret_struct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">func</span> <span class="title">f</span> = &#123;</span><span class="number">0</span>&#125;;</span><br><span class="line">    f.n1 = <span class="number">1</span>;</span><br><span class="line">    f.n2 = <span class="number">2</span>;</span><br><span class="line">    f.n3 = <span class="number">3</span>;</span><br><span class="line">    f.lpstr = <span class="string">"123"</span>;</span><br><span class="line">    <span class="keyword">return</span> f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n1 = <span class="number">333</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> global_array[<span class="number">100</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// func_arg_type('a', 10, 1000, 123, 456, 200, 300);</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// func_ret_struct();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// func_ret_int();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// struct func f = &#123;0&#125;;</span></span><br><span class="line">    <span class="comment">// f.n1 = 1;</span></span><br><span class="line">    <span class="comment">// f.n2 = 2;</span></span><br><span class="line">    <span class="comment">// f.n3 = 3;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// struct func* lp_f = &amp;f;</span></span><br><span class="line">    <span class="comment">// lp_f-&gt;n1 = 4;</span></span><br><span class="line">    <span class="comment">// lp_f-&gt;n2 = 5;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// union union_u &#123;</span></span><br><span class="line">    <span class="comment">//     int n1;</span></span><br><span class="line">    <span class="comment">//     int n2;</span></span><br><span class="line">    <span class="comment">//     short s3;</span></span><br><span class="line">    <span class="comment">// &#125;;</span></span><br><span class="line">    <span class="comment">// union union_u u = &#123;0&#125;;</span></span><br><span class="line">    <span class="comment">// u.n1 = 7;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// printf("%d\r\n", u.n2);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// static int n = 222;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// n = n1;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// int n_array[20] = &#123;0&#125;;</span></span><br><span class="line">    <span class="comment">// n_array[3] = 3;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// for (size_t i = 0; i &lt; sizeof(n_array); i++)</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">//     n_array[i] = i + 3;</span></span><br><span class="line">    <span class="comment">//     *(n_array + i) = i + 6;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// int* lp_array = n_array;</span></span><br><span class="line">    <span class="comment">// for (size_t i = sizeof(n_array) - 1; i &gt;= 0; i--)</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">//     *(lp_array - i) = i + 9;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// static char static_array[100] = &#123;0&#125;;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// for (size_t i = 0; i &lt; sizeof(static_array); i++)</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">//    static_array[i] = i;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">//  for (size_t i = 0; i &lt; sizeof(global_array); i++)</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">//    global_array[i] = i;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> n1 = <span class="number">0x100</span>;</span><br><span class="line">    <span class="keyword">int</span> n2 = ~n1;</span><br><span class="line">    <span class="keyword">int</span> n3 = n1 &amp; n2;</span><br><span class="line">    <span class="keyword">int</span> n4 = n1 ^ n3;</span><br><span class="line">    <span class="keyword">int</span> n5 = n1 &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> n6 = n1 &lt;&lt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> n7 = n1 | n2;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h4><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">.text</span></span><br><span class="line">    .syntax unified</span><br><span class="line">    .eabi_attribute <span class="number">67</span>, <span class="string">"2.09"</span>  <span class="comment">@ Tag_conformance</span></span><br><span class="line">    .cpu    arm7tdmi</span><br><span class="line">    .eabi_attribute <span class="number">6</span>, <span class="number">2</span>    <span class="comment">@ Tag_CPU_arch</span></span><br><span class="line">    .eabi_attribute <span class="number">8</span>, <span class="number">1</span>    <span class="comment">@ Tag_ARM_ISA_use</span></span><br><span class="line">    .eabi_attribute <span class="number">9</span>, <span class="number">1</span>    <span class="comment">@ Tag_THUMB_ISA_use</span></span><br><span class="line">    .eabi_attribute <span class="number">34</span>, <span class="number">0</span>   <span class="comment">@ Tag_CPU_unaligned_access</span></span><br><span class="line">    .eabi_attribute <span class="number">15</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_PCS_RW_data</span></span><br><span class="line">    .eabi_attribute <span class="number">16</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_PCS_RO_data</span></span><br><span class="line">    .eabi_attribute <span class="number">17</span>, <span class="number">2</span>   <span class="comment">@ Tag_ABI_PCS_GOT_use</span></span><br><span class="line">    .eabi_attribute <span class="number">20</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_FP_denormal</span></span><br><span class="line">    .eabi_attribute <span class="number">21</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_FP_exceptions</span></span><br><span class="line">    .eabi_attribute <span class="number">23</span>, <span class="number">3</span>   <span class="comment">@ Tag_ABI_FP_number_model</span></span><br><span class="line">    .eabi_attribute <span class="number">24</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_align_needed</span></span><br><span class="line">    .eabi_attribute <span class="number">25</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_align_preserved</span></span><br><span class="line">    .eabi_attribute <span class="number">38</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_FP_16bit_format</span></span><br><span class="line">    .eabi_attribute <span class="number">18</span>, <span class="number">4</span>   <span class="comment">@ Tag_ABI_PCS_wchar_t</span></span><br><span class="line">    .eabi_attribute <span class="number">26</span>, <span class="number">2</span>   <span class="comment">@ Tag_ABI_enum_size</span></span><br><span class="line">    .eabi_attribute <span class="number">14</span>, <span class="number">0</span>   <span class="comment">@ Tag_ABI_PCS_R9_use</span></span><br><span class="line">    .file   <span class="string">"func.c"</span></span><br><span class="line">    .globl  func_arg_type           <span class="comment">@ -- Begin function func_arg_type</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line">    .type   func_arg_type,%<span class="meta">function</span></span><br><span class="line">    <span class="meta">.code</span>   <span class="number">32</span>                      <span class="comment">@ @func_arg_type</span></span><br><span class="line"><span class="symbol">func_arg_type</span>:</span><br><span class="line">    .fnstart</span><br><span class="line"><span class="comment">@ %bb.0:</span></span><br><span class="line">    .save   &#123;<span class="built_in">r4</span>, <span class="built_in">r5</span>, <span class="built_in">r6</span>, <span class="built_in">r10</span>, <span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    <span class="keyword">push </span>   &#123;<span class="built_in">r4</span>, <span class="built_in">r5</span>, <span class="built_in">r6</span>, <span class="built_in">r10</span>, <span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    .setfp  <span class="built_in">r11</span>, <span class="built_in">sp</span>, <span class="number">#16</span></span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r11</span>, <span class="built_in">sp</span>, <span class="number">#16</span></span><br><span class="line">    .pad    <span class="number">#64</span></span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#64</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r12</span>, [<span class="built_in">r11</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">lr</span>, [<span class="built_in">r11</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r4</span>, <span class="built_in">r3</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r5</span>, <span class="built_in">r1</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r6</span>, <span class="built_in">r0</span></span><br><span class="line">    <span class="keyword">strb </span>   <span class="built_in">r0</span>, [<span class="built_in">r11</span>, #-<span class="number">17</span>]</span><br><span class="line">    <span class="keyword">strh </span>   <span class="built_in">r1</span>, [<span class="built_in">r11</span>, #-<span class="number">20</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r2</span>, [<span class="built_in">r11</span>, #-<span class="number">24</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r3</span>, [<span class="built_in">r11</span>, #-<span class="number">28</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r12</span>, [<span class="built_in">sp</span>, <span class="number">#44</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">lr</span>, [<span class="built_in">sp</span>, <span class="number">#40</span>]</span><br><span class="line">    <span class="keyword">ldrb </span>   <span class="built_in">r1</span>, [<span class="built_in">r11</span>, #-<span class="number">17</span>]</span><br><span class="line">    <span class="keyword">ldrsh </span>  <span class="built_in">r2</span>, [<span class="built_in">r11</span>, #-<span class="number">20</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r3</span>, [<span class="built_in">r11</span>, #-<span class="number">24</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">r11</span>, #-<span class="number">28</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r4</span>, [<span class="built_in">sp</span>, <span class="number">#36</span>]           <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r5</span>, [<span class="built_in">sp</span>, <span class="number">#32</span>]           <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r6</span>, [<span class="built_in">sp</span>, <span class="number">#28</span>]           <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">sp</span>, <span class="number">#24</span>]           <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r2</span>, [<span class="built_in">sp</span>, <span class="number">#20</span>]           <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r3</span>, [<span class="built_in">sp</span>, <span class="number">#16</span>]           <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">bl </span> __aeabi_f2d</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r2</span>, [<span class="built_in">sp</span>, <span class="number">#40</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r3</span>, [<span class="built_in">sp</span>, <span class="number">#44</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r12</span>, <span class="built_in">sp</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r3</span>, [<span class="built_in">r12</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r2</span>, [<span class="built_in">r12</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r12</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">r12</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, .LCPI0_0</span><br><span class="line"><span class="symbol">.LPC0_0</span>:</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">pc</span>, <span class="built_in">r0</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r1</span>, [<span class="built_in">sp</span>, <span class="number">#24</span>]           <span class="comment">@ 4-byte Reload</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r2</span>, [<span class="built_in">sp</span>, <span class="number">#20</span>]           <span class="comment">@ 4-byte Reload</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r3</span>, [<span class="built_in">sp</span>, <span class="number">#16</span>]           <span class="comment">@ 4-byte Reload</span></span><br><span class="line">    <span class="keyword">bl </span> printf</span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">sp</span>, <span class="built_in">r11</span>, <span class="number">#16</span></span><br><span class="line">    <span class="keyword">pop </span>&#123;<span class="built_in">r4</span>, <span class="built_in">r5</span>, <span class="built_in">r6</span>, <span class="built_in">r10</span>, <span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    <span class="keyword">bx </span> <span class="built_in">lr</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line"><span class="comment">@ %bb.1:</span></span><br><span class="line"><span class="symbol">.LCPI0_0</span>:</span><br><span class="line">    <span class="meta">.long</span>   .L.<span class="keyword">str-(.LPC0_0+8)</span></span><br><span class="line"><span class="keyword">.Lfunc_end0:</span></span><br><span class="line"><span class="keyword"> </span>   .size   func_arg_type, .Lfunc_end0-func_arg_type</span><br><span class="line">    .cantunwind</span><br><span class="line">    .fnend</span><br><span class="line">                                        <span class="comment">@ -- End function</span></span><br><span class="line">    .globl  main                    <span class="comment">@ -- Begin function main</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line">    .type   main,%<span class="meta">function</span></span><br><span class="line">    <span class="meta">.code</span>   <span class="number">32</span>                      <span class="comment">@ @main</span></span><br><span class="line"><span class="symbol">main</span>:</span><br><span class="line">    .fnstart</span><br><span class="line"><span class="comment">@ %bb.0:</span></span><br><span class="line">    .save   &#123;<span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    <span class="keyword">push </span>   &#123;<span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    .setfp  <span class="built_in">r11</span>, <span class="built_in">sp</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r11</span>, <span class="built_in">sp</span></span><br><span class="line">    .pad    <span class="number">#24</span></span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#24</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r2</span>, <span class="number">#0</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r2</span>, [<span class="built_in">r11</span>, #-<span class="number">4</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">r11</span>, #-<span class="number">8</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">sp</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="built_in">sp</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r1</span>, .LCPI1_0</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r1</span>, .LCPI1_1</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>]                <span class="comment">@[sp] double  0x4069070a3d70a3d7  -&gt; double  200.22</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#97</span>                 <span class="comment">@r0~r3 r0 = 'a'</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r1</span>, <span class="number">#10</span>                 <span class="comment">@r1 = 10</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r3</span>, <span class="number">#1000</span>               </span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r12</span>, .LCPI1_2</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r2</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]            <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r2</span>, <span class="built_in">r3</span>                  <span class="comment">@r2 = 1000;</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r3</span>, <span class="built_in">r12</span>                 <span class="comment">@r3 = 0x42c83852</span></span><br><span class="line">    <span class="keyword">bl </span> func_arg_type           <span class="comment">@ bl 调用函数, blx</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]            <span class="comment">@ 4-byte Reload</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">sp</span>, <span class="built_in">r11</span></span><br><span class="line">    <span class="keyword">pop </span>&#123;<span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    <span class="keyword">bx </span> <span class="built_in">lr</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line"><span class="comment">@ %bb.1:</span></span><br><span class="line"><span class="symbol">.LCPI1_0</span>:</span><br><span class="line">    <span class="meta">.long</span>   <span class="number">1080624906</span>              <span class="comment">@ 0x4069070a</span></span><br><span class="line"><span class="symbol">.LCPI1_1</span>:</span><br><span class="line">    <span class="meta">.long</span>   <span class="number">1030792151</span>              <span class="comment">@ 0x3d70a3d7</span></span><br><span class="line"><span class="symbol">.LCPI1_2</span>:</span><br><span class="line">    <span class="meta">.long</span>   <span class="number">1120417874</span>              <span class="comment">@ 0x42c83852</span></span><br><span class="line"><span class="symbol">.Lfunc_end1</span>:</span><br><span class="line">    .size   main, .Lfunc_end1-main</span><br><span class="line">    .cantunwind</span><br><span class="line">    .fnend</span><br><span class="line">                                        <span class="comment">@ -- End function</span></span><br><span class="line">    .type   .L.<span class="keyword">str,%object </span>         <span class="comment">@ @.str</span></span><br><span class="line">    <span class="meta">.section</span>    .rodata.<span class="keyword">str1.1,"aMS",%progbits,1</span></span><br><span class="line"><span class="keyword">.L.str:</span></span><br><span class="line"><span class="keyword"> </span>   <span class="meta">.asciz</span>  <span class="string">"%c %d %d %f %a\r\n"</span></span><br><span class="line">    .size   .L.<span class="keyword">str, </span><span class="number">17</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    .ident  <span class="string">"Android (5900059 based on r365631c) clang version 9.0.8 (https://android.googlesource.com/toolchain/llvm-project 207d7abc1a2abf3ef8d4301736d6a7ebc224a290) (based on LLVM 9.0.8svn)"</span></span><br><span class="line">    <span class="meta">.section</span>    <span class="string">".note.GNU-stack"</span>,<span class="string">""</span>,%progbits</span><br></pre></td></tr></table></figure>
<h4 id="静态变量"><a href="#静态变量" class="headerlink" title="静态变量"></a>静态变量</h4><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">.text</span></span><br><span class="line">    .syntax unified</span><br><span class="line">    .eabi_attribute <span class="number">67</span>, <span class="string">"2.09"</span>  <span class="comment">@ Tag_conformance</span></span><br><span class="line">    .cpu    arm7tdmi</span><br><span class="line">    .eabi_attribute <span class="number">6</span>, <span class="number">2</span>    <span class="comment">@ Tag_CPU_arch</span></span><br><span class="line">    .eabi_attribute <span class="number">8</span>, <span class="number">1</span>    <span class="comment">@ Tag_ARM_ISA_use</span></span><br><span class="line">    .eabi_attribute <span class="number">9</span>, <span class="number">1</span>    <span class="comment">@ Tag_THUMB_ISA_use</span></span><br><span class="line">    .eabi_attribute <span class="number">34</span>, <span class="number">0</span>   <span class="comment">@ Tag_CPU_unaligned_access</span></span><br><span class="line">    .eabi_attribute <span class="number">15</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_PCS_RW_data</span></span><br><span class="line">    .eabi_attribute <span class="number">16</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_PCS_RO_data</span></span><br><span class="line">    .eabi_attribute <span class="number">17</span>, <span class="number">2</span>   <span class="comment">@ Tag_ABI_PCS_GOT_use</span></span><br><span class="line">    .eabi_attribute <span class="number">20</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_FP_denormal</span></span><br><span class="line">    .eabi_attribute <span class="number">21</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_FP_exceptions</span></span><br><span class="line">    .eabi_attribute <span class="number">23</span>, <span class="number">3</span>   <span class="comment">@ Tag_ABI_FP_number_model</span></span><br><span class="line">    .eabi_attribute <span class="number">24</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_align_needed</span></span><br><span class="line">    .eabi_attribute <span class="number">25</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_align_preserved</span></span><br><span class="line">    .eabi_attribute <span class="number">38</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_FP_16bit_format</span></span><br><span class="line">    .eabi_attribute <span class="number">18</span>, <span class="number">4</span>   <span class="comment">@ Tag_ABI_PCS_wchar_t</span></span><br><span class="line">    .eabi_attribute <span class="number">26</span>, <span class="number">2</span>   <span class="comment">@ Tag_ABI_enum_size</span></span><br><span class="line">    .eabi_attribute <span class="number">14</span>, <span class="number">0</span>   <span class="comment">@ Tag_ABI_PCS_R9_use</span></span><br><span class="line">    .file   <span class="string">"func.c"</span></span><br><span class="line">    .globl  func_arg_type           <span class="comment">@ -- Begin function func_arg_type</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line">    .type   func_arg_type,%<span class="meta">function</span></span><br><span class="line">    <span class="meta">.code</span>   <span class="number">32</span>                      <span class="comment">@ @func_arg_type</span></span><br><span class="line"><span class="symbol">func_arg_type</span>:</span><br><span class="line">    .fnstart</span><br><span class="line"><span class="comment">@ %bb.0:</span></span><br><span class="line">    .save   &#123;<span class="built_in">r4</span>, <span class="built_in">r5</span>, <span class="built_in">r6</span>, <span class="built_in">r7</span>, <span class="built_in">r8</span>, <span class="built_in">r10</span>, <span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    <span class="keyword">push </span>   &#123;<span class="built_in">r4</span>, <span class="built_in">r5</span>, <span class="built_in">r6</span>, <span class="built_in">r7</span>, <span class="built_in">r8</span>, <span class="built_in">r10</span>, <span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    .setfp  <span class="built_in">r11</span>, <span class="built_in">sp</span>, <span class="number">#24</span></span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r11</span>, <span class="built_in">sp</span>, <span class="number">#24</span></span><br><span class="line">    .pad    <span class="number">#40</span></span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#40</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r12</span>, [<span class="built_in">r11</span>, <span class="number">#16</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">lr</span>, [<span class="built_in">r11</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r4</span>, [<span class="built_in">r11</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r5</span>, <span class="built_in">r1</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r6</span>, <span class="built_in">r0</span></span><br><span class="line">    <span class="keyword">strb </span>   <span class="built_in">r0</span>, [<span class="built_in">r11</span>, #-<span class="number">25</span>]</span><br><span class="line">    <span class="keyword">strh </span>   <span class="built_in">r1</span>, [<span class="built_in">r11</span>, #-<span class="number">28</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r2</span>, [<span class="built_in">sp</span>, <span class="number">#32</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r3</span>, [<span class="built_in">sp</span>, <span class="number">#28</span>]</span><br><span class="line">    <span class="keyword">ldrb </span>   <span class="built_in">r1</span>, [<span class="built_in">r11</span>, #-<span class="number">25</span>]</span><br><span class="line">    <span class="keyword">ldrsh </span>  <span class="built_in">r2</span>, [<span class="built_in">r11</span>, #-<span class="number">28</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r3</span>, [<span class="built_in">sp</span>, <span class="number">#32</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#28</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r7</span>, [<span class="built_in">r11</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r8</span>, <span class="built_in">sp</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r7</span>, [<span class="built_in">r8</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">r8</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, .LCPI0_0</span><br><span class="line"><span class="symbol">.LPC0_0</span>:</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">pc</span>, <span class="built_in">r0</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r12</span>, [<span class="built_in">sp</span>, <span class="number">#24</span>]          <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">lr</span>, [<span class="built_in">sp</span>, <span class="number">#20</span>]           <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r4</span>, [<span class="built_in">sp</span>, <span class="number">#16</span>]           <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r5</span>, [<span class="built_in">sp</span>, <span class="number">#12</span>]           <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r6</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]            <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">bl </span> printf</span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">sp</span>, <span class="built_in">r11</span>, <span class="number">#24</span></span><br><span class="line">    <span class="keyword">pop </span>&#123;<span class="built_in">r4</span>, <span class="built_in">r5</span>, <span class="built_in">r6</span>, <span class="built_in">r7</span>, <span class="built_in">r8</span>, <span class="built_in">r10</span>, <span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    <span class="keyword">bx </span> <span class="built_in">lr</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line"><span class="comment">@ %bb.1:</span></span><br><span class="line"><span class="symbol">.LCPI0_0</span>:</span><br><span class="line">    <span class="meta">.long</span>   .L.<span class="keyword">str-(.LPC0_0+8)</span></span><br><span class="line"><span class="keyword">.Lfunc_end0:</span></span><br><span class="line"><span class="keyword"> </span>   .size   func_arg_type, .Lfunc_end0-func_arg_type</span><br><span class="line">    .cantunwind</span><br><span class="line">    .fnend</span><br><span class="line">                                        <span class="comment">@ -- End function</span></span><br><span class="line">    .globl  func_ret_int            <span class="comment">@ -- Begin function func_ret_int</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line">    .type   func_ret_int,%<span class="meta">function</span></span><br><span class="line">    <span class="meta">.code</span>   <span class="number">32</span>                      <span class="comment">@ @func_ret_int</span></span><br><span class="line"><span class="symbol">func_ret_int</span>:</span><br><span class="line">    .fnstart</span><br><span class="line"><span class="comment">@ %bb.0:</span></span><br><span class="line">    .pad    <span class="number">#16</span></span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#16</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#0</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#1</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#2</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#3</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, .LCPI1_0</span><br><span class="line"><span class="symbol">.LPC1_0</span>:</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">pc</span>, <span class="built_in">r0</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#16</span></span><br><span class="line">    <span class="keyword">bx </span> <span class="built_in">lr</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line"><span class="comment">@ %bb.1:</span></span><br><span class="line"><span class="symbol">.LCPI1_0</span>:</span><br><span class="line">    <span class="meta">.long</span>   .L.<span class="keyword">str.1-(.LPC1_0+8)</span></span><br><span class="line"><span class="keyword">.Lfunc_end1:</span></span><br><span class="line"><span class="keyword"> </span>   .size   func_ret_int, .Lfunc_end1-func_ret_int</span><br><span class="line">    .cantunwind</span><br><span class="line">    .fnend</span><br><span class="line">                                        <span class="comment">@ -- End function</span></span><br><span class="line">    .globl  func_ret_struct         <span class="comment">@ -- Begin function func_ret_struct</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line">    .type   func_ret_struct,%<span class="meta">function</span></span><br><span class="line">    <span class="meta">.code</span>   <span class="number">32</span>                      <span class="comment">@ @func_ret_struct</span></span><br><span class="line"><span class="symbol">func_ret_struct</span>:</span><br><span class="line">    .fnstart</span><br><span class="line"><span class="comment">@ %bb.0:</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r1</span>, <span class="number">#0</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r1</span>, <span class="number">#1</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r1</span>, <span class="number">#2</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r1</span>, <span class="number">#3</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r1</span>, .LCPI2_0</span><br><span class="line"><span class="symbol">.LPC2_0</span>:</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r1</span>, <span class="built_in">pc</span>, <span class="built_in">r1</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">bx </span> <span class="built_in">lr</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line"><span class="comment">@ %bb.1:</span></span><br><span class="line"><span class="symbol">.LCPI2_0</span>:</span><br><span class="line">    <span class="meta">.long</span>   .L.<span class="keyword">str.1-(.LPC2_0+8)</span></span><br><span class="line"><span class="keyword">.Lfunc_end2:</span></span><br><span class="line"><span class="keyword"> </span>   .size   func_ret_struct, .Lfunc_end2-func_ret_struct</span><br><span class="line">    .cantunwind</span><br><span class="line">    .fnend</span><br><span class="line">                                        <span class="comment">@ -- End function</span></span><br><span class="line">    .globl  main                    <span class="comment">@ -- Begin function main</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line">    .type   main,%<span class="meta">function</span></span><br><span class="line">    <span class="meta">.code</span>   <span class="number">32</span>                      <span class="comment">@ @main</span></span><br><span class="line"><span class="symbol">main</span>:</span><br><span class="line">    .fnstart</span><br><span class="line"><span class="comment">@ %bb.0:</span></span><br><span class="line">    .pad    <span class="number">#12</span></span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#12</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r2</span>, <span class="number">#0</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r2</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">sp</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, .LCPI3_0</span><br><span class="line"><span class="symbol">.LPC3_0</span>:</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">pc</span>, <span class="built_in">r0</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r1</span>, .LCPI3_1</span><br><span class="line"><span class="symbol">.LPC3_1</span>:</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r1</span>, <span class="built_in">pc</span>, <span class="built_in">r1</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">r1</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, .LCPI3_2</span><br><span class="line"><span class="symbol">.LPC3_2</span>:</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">pc</span>, <span class="built_in">r0</span>]</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#12</span></span><br><span class="line">    <span class="keyword">bx </span> <span class="built_in">lr</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line"><span class="comment">@ %bb.1:</span></span><br><span class="line"><span class="symbol">.LCPI3_0</span>:</span><br><span class="line">    <span class="meta">.long</span>   n1-(.LPC3_0+<span class="number">8</span>)</span><br><span class="line"><span class="symbol">.LCPI3_1</span>:</span><br><span class="line">    <span class="meta">.long</span>   main.n-(.LPC3_1+<span class="number">8</span>)</span><br><span class="line"><span class="symbol">.LCPI3_2</span>:</span><br><span class="line">    <span class="meta">.long</span>   main.n-(.LPC3_2+<span class="number">8</span>)</span><br><span class="line"><span class="symbol">.Lfunc_end3</span>:</span><br><span class="line">    .size   main, .Lfunc_end3-main</span><br><span class="line">    .cantunwind</span><br><span class="line">    .fnend</span><br><span class="line">                                        <span class="comment">@ -- End function</span></span><br><span class="line">    .type   .L.<span class="keyword">str,%object </span>         <span class="comment">@ @.str</span></span><br><span class="line">    <span class="meta">.section</span>    .rodata.<span class="keyword">str1.1,"aMS",%progbits,1</span></span><br><span class="line"><span class="keyword">.L.str:</span></span><br><span class="line"><span class="keyword"> </span>   <span class="meta">.asciz</span>  <span class="string">"%c %d %d %d %d\r\n"</span></span><br><span class="line">    .size   .L.<span class="keyword">str, </span><span class="number">17</span></span><br><span class="line"></span><br><span class="line">    .type   .L.<span class="keyword">str.1,%object </span>       <span class="comment">@ @.str.1</span></span><br><span class="line"><span class="symbol">.L.str.1</span>:</span><br><span class="line">    <span class="meta">.asciz</span>  <span class="string">"123"</span></span><br><span class="line">    .size   .L.<span class="keyword">str.1, </span><span class="number">4</span></span><br><span class="line"><span class="symbol">mder</span></span><br><span class="line">    .type   n1,%object              <span class="comment">@ @n1</span></span><br><span class="line">    <span class="meta">.data</span></span><br><span class="line">    .globl  n1</span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line"><span class="symbol">n1</span>:</span><br><span class="line">    <span class="meta">.long</span>   <span class="number">333</span>                     <span class="comment">@ 0x14d</span></span><br><span class="line">    .size   n1, <span class="number">4</span></span><br><span class="line"></span><br><span class="line">    .type   main.n,%object          <span class="comment">@ @main.n</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line"><span class="symbol">main.n</span>:</span><br><span class="line">    <span class="meta">.long</span>   <span class="number">222</span>                     <span class="comment">@ 0xde</span></span><br><span class="line">    .size   main.n, <span class="number">4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    .ident  <span class="string">"Android (5900059 based on r365631c) clang version 9.0.8 (https://android.googlesource.com/toolchain/llvm-project 207d7abc1a2abf3ef8d4301736d6a7ebc224a290) (based on LLVM 9.0.8svn)"</span></span><br><span class="line">    <span class="meta">.section</span>    <span class="string">".note.GNU-stack"</span>,<span class="string">""</span>,%progbits</span><br></pre></td></tr></table></figure>
<h4 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h4><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">.text</span></span><br><span class="line">    .syntax unified</span><br><span class="line">    .eabi_attribute <span class="number">67</span>, <span class="string">"2.09"</span>  <span class="comment">@ Tag_conformance</span></span><br><span class="line">    .cpu    arm7tdmi</span><br><span class="line">    .eabi_attribute <span class="number">6</span>, <span class="number">2</span>    <span class="comment">@ Tag_CPU_arch</span></span><br><span class="line">    .eabi_attribute <span class="number">8</span>, <span class="number">1</span>    <span class="comment">@ Tag_ARM_ISA_use</span></span><br><span class="line">    .eabi_attribute <span class="number">9</span>, <span class="number">1</span>    <span class="comment">@ Tag_THUMB_ISA_use</span></span><br><span class="line">    .eabi_attribute <span class="number">34</span>, <span class="number">0</span>   <span class="comment">@ Tag_CPU_unaligned_access</span></span><br><span class="line">    .eabi_attribute <span class="number">15</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_PCS_RW_data</span></span><br><span class="line">    .eabi_attribute <span class="number">16</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_PCS_RO_data</span></span><br><span class="line">    .eabi_attribute <span class="number">17</span>, <span class="number">2</span>   <span class="comment">@ Tag_ABI_PCS_GOT_use</span></span><br><span class="line">    .eabi_attribute <span class="number">20</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_FP_denormal</span></span><br><span class="line">    .eabi_attribute <span class="number">21</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_FP_exceptions</span></span><br><span class="line">    .eabi_attribute <span class="number">23</span>, <span class="number">3</span>   <span class="comment">@ Tag_ABI_FP_number_model</span></span><br><span class="line">    .eabi_attribute <span class="number">24</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_align_needed</span></span><br><span class="line">    .eabi_attribute <span class="number">25</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_align_preserved</span></span><br><span class="line">    .eabi_attribute <span class="number">38</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_FP_16bit_format</span></span><br><span class="line">    .eabi_attribute <span class="number">18</span>, <span class="number">4</span>   <span class="comment">@ Tag_ABI_PCS_wchar_t</span></span><br><span class="line">    .eabi_attribute <span class="number">26</span>, <span class="number">2</span>   <span class="comment">@ Tag_ABI_enum_size</span></span><br><span class="line">    .eabi_attribute <span class="number">14</span>, <span class="number">0</span>   <span class="comment">@ Tag_ABI_PCS_R9_use</span></span><br><span class="line">    .file   <span class="string">"func.c"</span></span><br><span class="line">    .globl  func_arg_type           <span class="comment">@ -- Begin function func_arg_type</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line">    .type   func_arg_type,%<span class="meta">function</span></span><br><span class="line">    <span class="meta">.code</span>   <span class="number">32</span>                      <span class="comment">@ @func_arg_type</span></span><br><span class="line"><span class="symbol">func_arg_type</span>:</span><br><span class="line">    .fnstart</span><br><span class="line"><span class="comment">@ %bb.0:</span></span><br><span class="line">    .save   &#123;<span class="built_in">r4</span>, <span class="built_in">r5</span>, <span class="built_in">r6</span>, <span class="built_in">r7</span>, <span class="built_in">r8</span>, <span class="built_in">r10</span>, <span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    <span class="keyword">push </span>   &#123;<span class="built_in">r4</span>, <span class="built_in">r5</span>, <span class="built_in">r6</span>, <span class="built_in">r7</span>, <span class="built_in">r8</span>, <span class="built_in">r10</span>, <span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    .setfp  <span class="built_in">r11</span>, <span class="built_in">sp</span>, <span class="number">#24</span></span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r11</span>, <span class="built_in">sp</span>, <span class="number">#24</span></span><br><span class="line">    .pad    <span class="number">#40</span></span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#40</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r12</span>, [<span class="built_in">r11</span>, <span class="number">#16</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">lr</span>, [<span class="built_in">r11</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r4</span>, [<span class="built_in">r11</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r5</span>, <span class="built_in">r1</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r6</span>, <span class="built_in">r0</span></span><br><span class="line">    <span class="keyword">strb </span>   <span class="built_in">r0</span>, [<span class="built_in">r11</span>, #-<span class="number">25</span>]</span><br><span class="line">    <span class="keyword">strh </span>   <span class="built_in">r1</span>, [<span class="built_in">r11</span>, #-<span class="number">28</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r2</span>, [<span class="built_in">sp</span>, <span class="number">#32</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r3</span>, [<span class="built_in">sp</span>, <span class="number">#28</span>]</span><br><span class="line">    <span class="keyword">ldrb </span>   <span class="built_in">r1</span>, [<span class="built_in">r11</span>, #-<span class="number">25</span>]</span><br><span class="line">    <span class="keyword">ldrsh </span>  <span class="built_in">r2</span>, [<span class="built_in">r11</span>, #-<span class="number">28</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r3</span>, [<span class="built_in">sp</span>, <span class="number">#32</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#28</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r7</span>, [<span class="built_in">r11</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r8</span>, <span class="built_in">sp</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r7</span>, [<span class="built_in">r8</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">r8</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, .LCPI0_0</span><br><span class="line"><span class="symbol">.LPC0_0</span>:</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">pc</span>, <span class="built_in">r0</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r12</span>, [<span class="built_in">sp</span>, <span class="number">#24</span>]          <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">lr</span>, [<span class="built_in">sp</span>, <span class="number">#20</span>]           <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r4</span>, [<span class="built_in">sp</span>, <span class="number">#16</span>]           <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r5</span>, [<span class="built_in">sp</span>, <span class="number">#12</span>]           <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r6</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]            <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">bl </span> printf</span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">sp</span>, <span class="built_in">r11</span>, <span class="number">#24</span></span><br><span class="line">    <span class="keyword">pop </span>&#123;<span class="built_in">r4</span>, <span class="built_in">r5</span>, <span class="built_in">r6</span>, <span class="built_in">r7</span>, <span class="built_in">r8</span>, <span class="built_in">r10</span>, <span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    <span class="keyword">bx </span> <span class="built_in">lr</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line"><span class="comment">@ %bb.1:</span></span><br><span class="line"><span class="symbol">.LCPI0_0</span>:</span><br><span class="line">    <span class="meta">.long</span>   .L.<span class="keyword">str-(.LPC0_0+8)</span></span><br><span class="line"><span class="keyword">.Lfunc_end0:</span></span><br><span class="line"><span class="keyword"> </span>   .size   func_arg_type, .Lfunc_end0-func_arg_type</span><br><span class="line">    .cantunwind</span><br><span class="line">    .fnend</span><br><span class="line">                                        <span class="comment">@ -- End function</span></span><br><span class="line">    .globl  func_ret_int            <span class="comment">@ -- Begin function func_ret_int</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line">    .type   func_ret_int,%<span class="meta">function</span></span><br><span class="line">    <span class="meta">.code</span>   <span class="number">32</span>                      <span class="comment">@ @func_ret_int</span></span><br><span class="line"><span class="symbol">func_ret_int</span>:</span><br><span class="line">    .fnstart</span><br><span class="line"><span class="comment">@ %bb.0:</span></span><br><span class="line">    .pad    <span class="number">#16</span></span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#16</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#0</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#1</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#2</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#3</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]                <span class="comment">@ [sp, #8]=3  str</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, .LCPI1_0</span><br><span class="line"><span class="symbol">.LPC1_0</span>:</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">pc</span>, <span class="built_in">r0</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]                <span class="comment">@ r0 = [sp, #8] ldr</span></span><br><span class="line">    <span class="keyword">add </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#16</span></span><br><span class="line">    <span class="keyword">bx </span> <span class="built_in">lr</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line"><span class="comment">@ %bb.1:</span></span><br><span class="line"><span class="symbol">.LCPI1_0</span>:</span><br><span class="line">    <span class="meta">.long</span>   .L.<span class="keyword">str.1-(.LPC1_0+8)</span></span><br><span class="line"><span class="keyword">.Lfunc_end1:</span></span><br><span class="line"><span class="keyword"> </span>   .size   func_ret_int, .Lfunc_end1-func_ret_int</span><br><span class="line">    .cantunwind</span><br><span class="line">    .fnend</span><br><span class="line">                                        <span class="comment">@ -- End function</span></span><br><span class="line">    .globl  func_ret_struct         <span class="comment">@ -- Begin function func_ret_struct</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line">    .type   func_ret_struct,%<span class="meta">function</span></span><br><span class="line">    <span class="meta">.code</span>   <span class="number">32</span>                      <span class="comment">@ @func_ret_struct</span></span><br><span class="line"><span class="symbol">func_ret_struct</span>:</span><br><span class="line">    .fnstart</span><br><span class="line"><span class="comment">@ %bb.0:</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r1</span>, <span class="number">#0</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r1</span>, <span class="number">#1</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r1</span>, <span class="number">#2</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r1</span>, <span class="number">#3</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r1</span>, .LCPI2_0</span><br><span class="line"><span class="symbol">.LPC2_0</span>:</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r1</span>, <span class="built_in">pc</span>, <span class="built_in">r1</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">bx </span> <span class="built_in">lr</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line"><span class="comment">@ %bb.1:</span></span><br><span class="line"><span class="symbol">.LCPI2_0</span>:</span><br><span class="line">    <span class="meta">.long</span>   .L.<span class="keyword">str.1-(.LPC2_0+8)</span></span><br><span class="line"><span class="keyword">.Lfunc_end2:</span></span><br><span class="line"><span class="keyword"> </span>   .size   func_ret_struct, .Lfunc_end2-func_ret_struct</span><br><span class="line">    .cantunwind</span><br><span class="line">    .fnend</span><br><span class="line">                                        <span class="comment">@ -- End function</span></span><br><span class="line">    .globl  main                    <span class="comment">@ -- Begin function main</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line">    .type   main,%<span class="meta">function</span></span><br><span class="line">    <span class="meta">.code</span>   <span class="number">32</span>                      <span class="comment">@ @main</span></span><br><span class="line"><span class="symbol">main</span>:</span><br><span class="line">    .fnstart</span><br><span class="line"><span class="comment">@ %bb.0:</span></span><br><span class="line">    .save   &#123;<span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    <span class="keyword">push </span>   &#123;<span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    .setfp  <span class="built_in">r11</span>, <span class="built_in">sp</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r11</span>, <span class="built_in">sp</span></span><br><span class="line">    .pad    <span class="number">#48</span></span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#48</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r2</span>, <span class="number">#0</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r2</span>, [<span class="built_in">r11</span>, #-<span class="number">4</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">r11</span>, #-<span class="number">8</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r11</span>, #-<span class="number">12</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="built_in">sp</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r1</span>, <span class="number">#300</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r1</span>, <span class="number">#200</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r1</span>, <span class="number">#456</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#97</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r1</span>, <span class="number">#10</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r3</span>, <span class="number">#1000</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r12</span>, <span class="number">#123</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r2</span>, [<span class="built_in">sp</span>, <span class="number">#16</span>]           <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r2</span>, <span class="built_in">r3</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r3</span>, <span class="built_in">r12</span></span><br><span class="line">    <span class="keyword">bl </span> func_arg_type</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">sp</span>, <span class="number">#20</span></span><br><span class="line">    <span class="keyword">bl </span> func_ret_struct</span><br><span class="line">    <span class="keyword">bl </span> func_ret_int</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r1</span>, [<span class="built_in">sp</span>, <span class="number">#16</span>]           <span class="comment">@ 4-byte Reload</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#12</span>]           <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="built_in">r1</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">sp</span>, <span class="built_in">r11</span></span><br><span class="line">    <span class="keyword">pop </span>&#123;<span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    <span class="keyword">bx </span> <span class="built_in">lr</span></span><br><span class="line"><span class="symbol">.Lfunc_end3</span>:</span><br><span class="line">    .size   main, .Lfunc_end3-main</span><br><span class="line">    .cantunwind</span><br><span class="line">    .fnend</span><br><span class="line">                                        <span class="comment">@ -- End function</span></span><br><span class="line">    .type   .L.<span class="keyword">str,%object </span>         <span class="comment">@ @.str</span></span><br><span class="line">    <span class="meta">.section</span>    .rodata.<span class="keyword">str1.1,"aMS",%progbits,1</span></span><br><span class="line"><span class="keyword">.L.str:</span></span><br><span class="line"><span class="keyword"> </span>   <span class="meta">.asciz</span>  <span class="string">"%c %d %d %d %d\r\n"</span></span><br><span class="line">    .size   .L.<span class="keyword">str, </span><span class="number">17</span></span><br><span class="line"></span><br><span class="line">    .type   .L.<span class="keyword">str.1,%object </span>       <span class="comment">@ @.str.1</span></span><br><span class="line"><span class="symbol">.L.str.1</span>:</span><br><span class="line">    <span class="meta">.asciz</span>  <span class="string">"123"</span></span><br><span class="line">    .size   .L.<span class="keyword">str.1, </span><span class="number">4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    .ident  <span class="string">"Android (5900059 based on r365631c) clang version 9.0.8 (https://android.googlesource.com/toolchain/llvm-project 207d7abc1a2abf3ef8d4301736d6a7ebc224a290) (based on LLVM 9.0.8svn)"</span></span><br><span class="line">    <span class="meta">.section</span>    <span class="string">".note.GNU-stack"</span>,<span class="string">""</span>,%progbits</span><br></pre></td></tr></table></figure>
<h4 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h4><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">.text</span></span><br><span class="line">    .syntax unified</span><br><span class="line">    .eabi_attribute <span class="number">67</span>, <span class="string">"2.09"</span>  <span class="comment">@ Tag_conformance</span></span><br><span class="line">    .cpu    arm7tdmi</span><br><span class="line">    .eabi_attribute <span class="number">6</span>, <span class="number">2</span>    <span class="comment">@ Tag_CPU_arch</span></span><br><span class="line">    .eabi_attribute <span class="number">8</span>, <span class="number">1</span>    <span class="comment">@ Tag_ARM_ISA_use</span></span><br><span class="line">    .eabi_attribute <span class="number">9</span>, <span class="number">1</span>    <span class="comment">@ Tag_THUMB_ISA_use</span></span><br><span class="line">    .eabi_attribute <span class="number">34</span>, <span class="number">0</span>   <span class="comment">@ Tag_CPU_unaligned_access</span></span><br><span class="line">    .eabi_attribute <span class="number">15</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_PCS_RW_data</span></span><br><span class="line">    .eabi_attribute <span class="number">16</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_PCS_RO_data</span></span><br><span class="line">    .eabi_attribute <span class="number">17</span>, <span class="number">2</span>   <span class="comment">@ Tag_ABI_PCS_GOT_use</span></span><br><span class="line">    .eabi_attribute <span class="number">20</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_FP_denormal</span></span><br><span class="line">    .eabi_attribute <span class="number">21</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_FP_exceptions</span></span><br><span class="line">    .eabi_attribute <span class="number">23</span>, <span class="number">3</span>   <span class="comment">@ Tag_ABI_FP_number_model</span></span><br><span class="line">    .eabi_attribute <span class="number">24</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_align_needed</span></span><br><span class="line">    .eabi_attribute <span class="number">25</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_align_preserved</span></span><br><span class="line">    .eabi_attribute <span class="number">38</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_FP_16bit_format</span></span><br><span class="line">    .eabi_attribute <span class="number">18</span>, <span class="number">4</span>   <span class="comment">@ Tag_ABI_PCS_wchar_t</span></span><br><span class="line">    .eabi_attribute <span class="number">26</span>, <span class="number">2</span>   <span class="comment">@ Tag_ABI_enum_size</span></span><br><span class="line">    .eabi_attribute <span class="number">14</span>, <span class="number">0</span>   <span class="comment">@ Tag_ABI_PCS_R9_use</span></span><br><span class="line">    .file   <span class="string">"func.c"</span></span><br><span class="line">    .globl  func_arg_type           <span class="comment">@ -- Begin function func_arg_type</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line">    .type   func_arg_type,%<span class="meta">function</span></span><br><span class="line">    <span class="meta">.code</span>   <span class="number">32</span>                      <span class="comment">@ @func_arg_type</span></span><br><span class="line"><span class="symbol">func_arg_type</span>:</span><br><span class="line">    .fnstart</span><br><span class="line"><span class="comment">@ %bb.0:</span></span><br><span class="line">    .save   &#123;<span class="built_in">r4</span>, <span class="built_in">r5</span>, <span class="built_in">r6</span>, <span class="built_in">r7</span>, <span class="built_in">r8</span>, <span class="built_in">r10</span>, <span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    <span class="keyword">push </span>   &#123;<span class="built_in">r4</span>, <span class="built_in">r5</span>, <span class="built_in">r6</span>, <span class="built_in">r7</span>, <span class="built_in">r8</span>, <span class="built_in">r10</span>, <span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    .setfp  <span class="built_in">r11</span>, <span class="built_in">sp</span>, <span class="number">#24</span></span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r11</span>, <span class="built_in">sp</span>, <span class="number">#24</span></span><br><span class="line">    .pad    <span class="number">#40</span></span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#40</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r12</span>, [<span class="built_in">r11</span>, <span class="number">#16</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">lr</span>, [<span class="built_in">r11</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r4</span>, [<span class="built_in">r11</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r5</span>, <span class="built_in">r1</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r6</span>, <span class="built_in">r0</span></span><br><span class="line">    <span class="keyword">strb </span>   <span class="built_in">r0</span>, [<span class="built_in">r11</span>, #-<span class="number">25</span>]</span><br><span class="line">    <span class="keyword">strh </span>   <span class="built_in">r1</span>, [<span class="built_in">r11</span>, #-<span class="number">28</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r2</span>, [<span class="built_in">sp</span>, <span class="number">#32</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r3</span>, [<span class="built_in">sp</span>, <span class="number">#28</span>]</span><br><span class="line">    <span class="keyword">ldrb </span>   <span class="built_in">r1</span>, [<span class="built_in">r11</span>, #-<span class="number">25</span>]</span><br><span class="line">    <span class="keyword">ldrsh </span>  <span class="built_in">r2</span>, [<span class="built_in">r11</span>, #-<span class="number">28</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r3</span>, [<span class="built_in">sp</span>, <span class="number">#32</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#28</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r7</span>, [<span class="built_in">r11</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r8</span>, <span class="built_in">sp</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r7</span>, [<span class="built_in">r8</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">r8</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, .LCPI0_0</span><br><span class="line"><span class="symbol">.LPC0_0</span>:</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">pc</span>, <span class="built_in">r0</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r12</span>, [<span class="built_in">sp</span>, <span class="number">#24</span>]          <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">lr</span>, [<span class="built_in">sp</span>, <span class="number">#20</span>]           <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r4</span>, [<span class="built_in">sp</span>, <span class="number">#16</span>]           <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r5</span>, [<span class="built_in">sp</span>, <span class="number">#12</span>]           <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r6</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]            <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">bl </span> printf</span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">sp</span>, <span class="built_in">r11</span>, <span class="number">#24</span></span><br><span class="line">    <span class="keyword">pop </span>&#123;<span class="built_in">r4</span>, <span class="built_in">r5</span>, <span class="built_in">r6</span>, <span class="built_in">r7</span>, <span class="built_in">r8</span>, <span class="built_in">r10</span>, <span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    <span class="keyword">bx </span> <span class="built_in">lr</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line"><span class="comment">@ %bb.1:</span></span><br><span class="line"><span class="symbol">.LCPI0_0</span>:</span><br><span class="line">    <span class="meta">.long</span>   .L.<span class="keyword">str-(.LPC0_0+8)</span></span><br><span class="line"><span class="keyword">.Lfunc_end0:</span></span><br><span class="line"><span class="keyword"> </span>   .size   func_arg_type, .Lfunc_end0-func_arg_type</span><br><span class="line">    .cantunwind</span><br><span class="line">    .fnend</span><br><span class="line">                                        <span class="comment">@ -- End function</span></span><br><span class="line">    .globl  func_ret_int            <span class="comment">@ -- Begin function func_ret_int</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line">    .type   func_ret_int,%<span class="meta">function</span></span><br><span class="line">    <span class="meta">.code</span>   <span class="number">32</span>                      <span class="comment">@ @func_ret_int</span></span><br><span class="line"><span class="symbol">func_ret_int</span>:</span><br><span class="line">    .fnstart</span><br><span class="line"><span class="comment">@ %bb.0:</span></span><br><span class="line">    .pad    <span class="number">#16</span></span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#16</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#0</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#1</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#2</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#3</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, .LCPI1_0</span><br><span class="line"><span class="symbol">.LPC1_0</span>:</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">pc</span>, <span class="built_in">r0</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#16</span></span><br><span class="line">    <span class="keyword">bx </span> <span class="built_in">lr</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line"><span class="comment">@ %bb.1:</span></span><br><span class="line"><span class="symbol">.LCPI1_0</span>:</span><br><span class="line">    <span class="meta">.long</span>   .L.<span class="keyword">str.1-(.LPC1_0+8)</span></span><br><span class="line"><span class="keyword">.Lfunc_end1:</span></span><br><span class="line"><span class="keyword"> </span>   .size   func_ret_int, .Lfunc_end1-func_ret_int</span><br><span class="line">    .cantunwind</span><br><span class="line">    .fnend</span><br><span class="line">                                        <span class="comment">@ -- End function</span></span><br><span class="line">    .globl  func_ret_struct         <span class="comment">@ -- Begin function func_ret_struct</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line">    .type   func_ret_struct,%<span class="meta">function</span></span><br><span class="line">    <span class="meta">.code</span>   <span class="number">32</span>                      <span class="comment">@ @func_ret_struct</span></span><br><span class="line"><span class="symbol">func_ret_struct</span>:</span><br><span class="line">    .fnstart</span><br><span class="line"><span class="comment">@ %bb.0:</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r1</span>, <span class="number">#0</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r1</span>, <span class="number">#1</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r1</span>, <span class="number">#2</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r1</span>, <span class="number">#3</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r1</span>, .LCPI2_0</span><br><span class="line"><span class="symbol">.LPC2_0</span>:</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r1</span>, <span class="built_in">pc</span>, <span class="built_in">r1</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">bx </span> <span class="built_in">lr</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line"><span class="comment">@ %bb.1:</span></span><br><span class="line"><span class="symbol">.LCPI2_0</span>:</span><br><span class="line">    <span class="meta">.long</span>   .L.<span class="keyword">str.1-(.LPC2_0+8)</span></span><br><span class="line"><span class="keyword">.Lfunc_end2:</span></span><br><span class="line"><span class="keyword"> </span>   .size   func_ret_struct, .Lfunc_end2-func_ret_struct</span><br><span class="line">    .cantunwind</span><br><span class="line">    .fnend</span><br><span class="line">                                        <span class="comment">@ -- End function</span></span><br><span class="line">    .globl  main                    <span class="comment">@ -- Begin function main</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line">    .type   main,%<span class="meta">function</span></span><br><span class="line">    <span class="meta">.code</span>   <span class="number">32</span>                      <span class="comment">@ @main</span></span><br><span class="line"><span class="symbol">main</span>:</span><br><span class="line">    .fnstart</span><br><span class="line"><span class="comment">@ %bb.0:</span></span><br><span class="line">    .save   &#123;<span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    <span class="keyword">push </span>   &#123;<span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    .setfp  <span class="built_in">r11</span>, <span class="built_in">sp</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r11</span>, <span class="built_in">sp</span></span><br><span class="line">    .pad    <span class="number">#120</span></span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#120</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r2</span>, <span class="number">#0</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r2</span>, [<span class="built_in">r11</span>, #-<span class="number">4</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">r11</span>, #-<span class="number">8</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r11</span>, #-<span class="number">12</span>]</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">sp</span>, <span class="number">#28</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r1</span>, <span class="number">#80</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r2</span>, [<span class="built_in">sp</span>, <span class="number">#4</span>]            <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">bl </span> __aeabi_memclr4</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#3</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#40</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#4</span>]            <span class="comment">@ 4-byte Reload</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#24</span>]</span><br><span class="line">    <span class="keyword">b </span>  .LBB3_1</span><br><span class="line"><span class="symbol">.LBB3_1</span>:                                <span class="comment">@ =&gt;This Inner Loop Header: Depth=1</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#24</span>]</span><br><span class="line">    <span class="keyword">cmp </span><span class="built_in">r0</span>, <span class="number">#79</span></span><br><span class="line">    <span class="keyword">bhi </span>.LBB3_4</span><br><span class="line">    <span class="keyword">b </span>  .LBB3_2</span><br><span class="line"><span class="symbol">.LBB3_2</span>:                                <span class="comment">@   in Loop: Header=BB3_1 Depth=1</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#24</span>]</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r1</span>, <span class="built_in">r0</span>, <span class="number">#3</span></span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r2</span>, <span class="built_in">sp</span>, <span class="number">#28</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r2</span>, <span class="built_in">r0</span>, <span class="keyword">lsl </span><span class="number">#2</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#24</span>]</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r1</span>, <span class="built_in">r0</span>, <span class="number">#6</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r2</span>, <span class="built_in">r0</span>, <span class="keyword">lsl </span><span class="number">#2</span>]</span><br><span class="line">    <span class="keyword">b </span>  .LBB3_3</span><br><span class="line"><span class="symbol">.LBB3_3</span>:                                <span class="comment">@   in Loop: Header=BB3_1 Depth=1</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#24</span>]</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">r0</span>, <span class="number">#1</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#24</span>]</span><br><span class="line">    <span class="keyword">b </span>  .LBB3_1</span><br><span class="line"><span class="symbol">.LBB3_4</span>:</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">sp</span>, <span class="number">#28</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#20</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#79</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#16</span>]</span><br><span class="line">    <span class="keyword">b </span>  .LBB3_5</span><br><span class="line"><span class="symbol">.LBB3_5</span>:                                <span class="comment">@ =&gt;This Inner Loop Header: Depth=1</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#16</span>]</span><br><span class="line">    <span class="keyword">cmp </span><span class="built_in">r0</span>, <span class="number">#0</span></span><br><span class="line">    <span class="keyword">blo </span>.LBB3_8</span><br><span class="line">    <span class="keyword">b </span>  .LBB3_6</span><br><span class="line"><span class="symbol">.LBB3_6</span>:                                <span class="comment">@   in Loop: Header=BB3_5 Depth=1</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#16</span>]</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r1</span>, <span class="built_in">r0</span>, <span class="number">#9</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r2</span>, [<span class="built_in">sp</span>, <span class="number">#20</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r2</span>, -<span class="built_in">r0</span>, <span class="keyword">lsl </span><span class="number">#2</span>]</span><br><span class="line">    <span class="keyword">b </span>  .LBB3_7</span><br><span class="line"><span class="symbol">.LBB3_7</span>:                                <span class="comment">@   in Loop: Header=BB3_5 Depth=1</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#16</span>]</span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">r0</span>, <span class="built_in">r0</span>, <span class="number">#1</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#16</span>]</span><br><span class="line">    <span class="keyword">b </span>  .LBB3_5</span><br><span class="line"><span class="symbol">.LBB3_8</span>:</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#0</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">b </span>  .LBB3_9</span><br><span class="line"><span class="symbol">.LBB3_9</span>:                                <span class="comment">@ =&gt;This Inner Loop Header: Depth=1</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">cmp </span><span class="built_in">r0</span>, <span class="number">#99</span></span><br><span class="line">    <span class="keyword">bhi </span>.LBB3_12</span><br><span class="line">    <span class="keyword">b </span>  .LBB3_10</span><br><span class="line"><span class="symbol">.LBB3_10</span>:                               <span class="comment">@   in Loop: Header=BB3_9 Depth=1</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r1</span>, .LCPI3_0</span><br><span class="line"><span class="symbol">.LPC3_0</span>:</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r1</span>, <span class="built_in">pc</span>, <span class="built_in">r1</span></span><br><span class="line">    <span class="keyword">strb </span>   <span class="built_in">r0</span>, [<span class="built_in">r1</span>, <span class="built_in">r0</span>]</span><br><span class="line">    <span class="keyword">b </span>  .LBB3_11</span><br><span class="line"><span class="symbol">.LBB3_11</span>:                               <span class="comment">@   in Loop: Header=BB3_9 Depth=1</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">r0</span>, <span class="number">#1</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">b </span>  .LBB3_9</span><br><span class="line"><span class="symbol">.LBB3_12</span>:</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#0</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">b </span>  .LBB3_13</span><br><span class="line"><span class="symbol">.LBB3_13</span>:                               <span class="comment">@ =&gt;This Inner Loop Header: Depth=1</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">cmp </span><span class="built_in">r0</span>, <span class="number">#99</span></span><br><span class="line">    <span class="keyword">bhi </span>.LBB3_16</span><br><span class="line">    <span class="keyword">b </span>  .LBB3_14</span><br><span class="line"><span class="symbol">.LBB3_14</span>:                               <span class="comment">@   in Loop: Header=BB3_13 Depth=1</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r1</span>, .LCPI3_1</span><br><span class="line"><span class="symbol">.LPC3_1</span>:</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r1</span>, <span class="built_in">pc</span>, <span class="built_in">r1</span></span><br><span class="line">    <span class="keyword">strb </span>   <span class="built_in">r0</span>, [<span class="built_in">r1</span>, <span class="built_in">r0</span>]</span><br><span class="line">    <span class="keyword">b </span>  .LBB3_15</span><br><span class="line"><span class="symbol">.LBB3_15</span>:                               <span class="comment">@   in Loop: Header=BB3_13 Depth=1</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">r0</span>, <span class="number">#1</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">b </span>  .LBB3_13</span><br><span class="line"><span class="symbol">.LBB3_16</span>:</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#0</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">sp</span>, <span class="built_in">r11</span></span><br><span class="line">    <span class="keyword">pop </span>&#123;<span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    <span class="keyword">bx </span> <span class="built_in">lr</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line"><span class="comment">@ %bb.17:</span></span><br><span class="line"><span class="symbol">.LCPI3_0</span>:</span><br><span class="line">    <span class="meta">.long</span>   main.static_array-(.LPC3_0+<span class="number">8</span>)</span><br><span class="line"><span class="symbol">.LCPI3_1</span>:</span><br><span class="line">    <span class="meta">.long</span>   global_array-(.LPC3_1+<span class="number">8</span>)</span><br><span class="line"><span class="symbol">.Lfunc_end3</span>:</span><br><span class="line">    .size   main, .Lfunc_end3-main</span><br><span class="line">    .cantunwind</span><br><span class="line">    .fnend</span><br><span class="line">                                        <span class="comment">@ -- End function</span></span><br><span class="line">    .type   .L.<span class="keyword">str,%object </span>         <span class="comment">@ @.str</span></span><br><span class="line">    <span class="meta">.section</span>    .rodata.<span class="keyword">str1.1,"aMS",%progbits,1</span></span><br><span class="line"><span class="keyword">.L.str:</span></span><br><span class="line"><span class="keyword"> </span>   <span class="meta">.asciz</span>  <span class="string">"%c %d %d %d %d\r\n"</span></span><br><span class="line">    .size   .L.<span class="keyword">str, </span><span class="number">17</span></span><br><span class="line"></span><br><span class="line">    .type   .L.<span class="keyword">str.1,%object </span>       <span class="comment">@ @.str.1</span></span><br><span class="line"><span class="symbol">.L.str.1</span>:</span><br><span class="line">    <span class="meta">.asciz</span>  <span class="string">"123"</span></span><br><span class="line">    .size   .L.<span class="keyword">str.1, </span><span class="number">4</span></span><br><span class="line"></span><br><span class="line">    .type   n1,%object              <span class="comment">@ @n1</span></span><br><span class="line">    <span class="meta">.data</span></span><br><span class="line">    .globl  n1</span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line"><span class="symbol">n1</span>:</span><br><span class="line">    <span class="meta">.long</span>   <span class="number">333</span>                     <span class="comment">@ 0x14d</span></span><br><span class="line">    .size   n1, <span class="number">4</span></span><br><span class="line"></span><br><span class="line">    .type   global_array,%object    <span class="comment">@ @global_array</span></span><br><span class="line">    .<span class="keyword">bss</span></span><br><span class="line"><span class="keyword"> </span>   .globl  global_array</span><br><span class="line"><span class="symbol">global_array</span>:</span><br><span class="line">    .zero   <span class="number">100</span></span><br><span class="line">    .size   global_array, <span class="number">100</span></span><br><span class="line"></span><br><span class="line">    .type   main.static_array,%object <span class="comment">@ @main.static_array</span></span><br><span class="line">    .local  main.static_array</span><br><span class="line">    .comm   main.static_array,<span class="number">100</span>,<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    .ident  <span class="string">"Android (5900059 based on r365631c) clang version 9.0.8 (https://android.googlesource.com/toolchain/llvm-project 207d7abc1a2abf3ef8d4301736d6a7ebc224a290) (based on LLVM 9.0.8svn)"</span></span><br><span class="line">    <span class="meta">.section</span>    <span class="string">".note.GNU-stack"</span>,<span class="string">""</span>,%progbits</span><br></pre></td></tr></table></figure>
<h4 id="位操作"><a href="#位操作" class="headerlink" title="位操作"></a>位操作</h4><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">.text</span></span><br><span class="line">    .syntax unified</span><br><span class="line">    .eabi_attribute <span class="number">67</span>, <span class="string">"2.09"</span>  <span class="comment">@ Tag_conformance</span></span><br><span class="line">    .cpu    arm7tdmi</span><br><span class="line">    .eabi_attribute <span class="number">6</span>, <span class="number">2</span>    <span class="comment">@ Tag_CPU_arch</span></span><br><span class="line">    .eabi_attribute <span class="number">8</span>, <span class="number">1</span>    <span class="comment">@ Tag_ARM_ISA_use</span></span><br><span class="line">    .eabi_attribute <span class="number">9</span>, <span class="number">1</span>    <span class="comment">@ Tag_THUMB_ISA_use</span></span><br><span class="line">    .eabi_attribute <span class="number">34</span>, <span class="number">0</span>   <span class="comment">@ Tag_CPU_unaligned_access</span></span><br><span class="line">    .eabi_attribute <span class="number">15</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_PCS_RW_data</span></span><br><span class="line">    .eabi_attribute <span class="number">16</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_PCS_RO_data</span></span><br><span class="line">    .eabi_attribute <span class="number">17</span>, <span class="number">2</span>   <span class="comment">@ Tag_ABI_PCS_GOT_use</span></span><br><span class="line">    .eabi_attribute <span class="number">20</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_FP_denormal</span></span><br><span class="line">    .eabi_attribute <span class="number">21</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_FP_exceptions</span></span><br><span class="line">    .eabi_attribute <span class="number">23</span>, <span class="number">3</span>   <span class="comment">@ Tag_ABI_FP_number_model</span></span><br><span class="line">    .eabi_attribute <span class="number">24</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_align_needed</span></span><br><span class="line">    .eabi_attribute <span class="number">25</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_align_preserved</span></span><br><span class="line">    .eabi_attribute <span class="number">38</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_FP_16bit_format</span></span><br><span class="line">    .eabi_attribute <span class="number">18</span>, <span class="number">4</span>   <span class="comment">@ Tag_ABI_PCS_wchar_t</span></span><br><span class="line">    .eabi_attribute <span class="number">26</span>, <span class="number">2</span>   <span class="comment">@ Tag_ABI_enum_size</span></span><br><span class="line">    .eabi_attribute <span class="number">14</span>, <span class="number">0</span>   <span class="comment">@ Tag_ABI_PCS_R9_use</span></span><br><span class="line">    .file   <span class="string">"func.c"</span></span><br><span class="line">    .globl  func_arg_type           <span class="comment">@ -- Begin function func_arg_type</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line">    .type   func_arg_type,%<span class="meta">function</span></span><br><span class="line">    <span class="meta">.code</span>   <span class="number">32</span>                      <span class="comment">@ @func_arg_type</span></span><br><span class="line"><span class="symbol">func_arg_type</span>:</span><br><span class="line">    .fnstart</span><br><span class="line"><span class="comment">@ %bb.0:</span></span><br><span class="line">    .save   &#123;<span class="built_in">r4</span>, <span class="built_in">r5</span>, <span class="built_in">r6</span>, <span class="built_in">r7</span>, <span class="built_in">r8</span>, <span class="built_in">r10</span>, <span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    <span class="keyword">push </span>   &#123;<span class="built_in">r4</span>, <span class="built_in">r5</span>, <span class="built_in">r6</span>, <span class="built_in">r7</span>, <span class="built_in">r8</span>, <span class="built_in">r10</span>, <span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    .setfp  <span class="built_in">r11</span>, <span class="built_in">sp</span>, <span class="number">#24</span></span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r11</span>, <span class="built_in">sp</span>, <span class="number">#24</span></span><br><span class="line">    .pad    <span class="number">#40</span></span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#40</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r12</span>, [<span class="built_in">r11</span>, <span class="number">#16</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">lr</span>, [<span class="built_in">r11</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r4</span>, [<span class="built_in">r11</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r5</span>, <span class="built_in">r1</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r6</span>, <span class="built_in">r0</span></span><br><span class="line">    <span class="keyword">strb </span>   <span class="built_in">r0</span>, [<span class="built_in">r11</span>, #-<span class="number">25</span>]</span><br><span class="line">    <span class="keyword">strh </span>   <span class="built_in">r1</span>, [<span class="built_in">r11</span>, #-<span class="number">28</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r2</span>, [<span class="built_in">sp</span>, <span class="number">#32</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r3</span>, [<span class="built_in">sp</span>, <span class="number">#28</span>]</span><br><span class="line">    <span class="keyword">ldrb </span>   <span class="built_in">r1</span>, [<span class="built_in">r11</span>, #-<span class="number">25</span>]</span><br><span class="line">    <span class="keyword">ldrsh </span>  <span class="built_in">r2</span>, [<span class="built_in">r11</span>, #-<span class="number">28</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r3</span>, [<span class="built_in">sp</span>, <span class="number">#32</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#28</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r7</span>, [<span class="built_in">r11</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r8</span>, <span class="built_in">sp</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r7</span>, [<span class="built_in">r8</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">r8</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, .LCPI0_0</span><br><span class="line"><span class="symbol">.LPC0_0</span>:</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">pc</span>, <span class="built_in">r0</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r12</span>, [<span class="built_in">sp</span>, <span class="number">#24</span>]          <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">lr</span>, [<span class="built_in">sp</span>, <span class="number">#20</span>]           <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r4</span>, [<span class="built_in">sp</span>, <span class="number">#16</span>]           <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r5</span>, [<span class="built_in">sp</span>, <span class="number">#12</span>]           <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r6</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]            <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">bl </span> printf</span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">sp</span>, <span class="built_in">r11</span>, <span class="number">#24</span></span><br><span class="line">    <span class="keyword">pop </span>&#123;<span class="built_in">r4</span>, <span class="built_in">r5</span>, <span class="built_in">r6</span>, <span class="built_in">r7</span>, <span class="built_in">r8</span>, <span class="built_in">r10</span>, <span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    <span class="keyword">bx </span> <span class="built_in">lr</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line"><span class="comment">@ %bb.1:</span></span><br><span class="line"><span class="symbol">.LCPI0_0</span>:</span><br><span class="line">    <span class="meta">.long</span>   .L.<span class="keyword">str-(.LPC0_0+8)</span></span><br><span class="line"><span class="keyword">.Lfunc_end0:</span></span><br><span class="line"><span class="keyword"> </span>   .size   func_arg_type, .Lfunc_end0-func_arg_type</span><br><span class="line">    .cantunwind</span><br><span class="line">    .fnend</span><br><span class="line">                                        <span class="comment">@ -- End function</span></span><br><span class="line">    .globl  func_ret_int            <span class="comment">@ -- Begin function func_ret_int</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line">    .type   func_ret_int,%<span class="meta">function</span></span><br><span class="line">    <span class="meta">.code</span>   <span class="number">32</span>                      <span class="comment">@ @func_ret_int</span></span><br><span class="line"><span class="symbol">func_ret_int</span>:</span><br><span class="line">    .fnstart</span><br><span class="line"><span class="comment">@ %bb.0:</span></span><br><span class="line">    .pad    <span class="number">#16</span></span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#16</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#0</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#1</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#2</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#3</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, .LCPI1_0</span><br><span class="line"><span class="symbol">.LPC1_0</span>:</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">pc</span>, <span class="built_in">r0</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#16</span></span><br><span class="line">    <span class="keyword">bx </span> <span class="built_in">lr</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line"><span class="comment">@ %bb.1:</span></span><br><span class="line"><span class="symbol">.LCPI1_0</span>:</span><br><span class="line">    <span class="meta">.long</span>   .L.<span class="keyword">str.1-(.LPC1_0+8)</span></span><br><span class="line"><span class="keyword">.Lfunc_end1:</span></span><br><span class="line"><span class="keyword"> </span>   .size   func_ret_int, .Lfunc_end1-func_ret_int</span><br><span class="line">    .cantunwind</span><br><span class="line">    .fnend</span><br><span class="line">                                        <span class="comment">@ -- End function</span></span><br><span class="line">    .globl  func_ret_struct         <span class="comment">@ -- Begin function func_ret_struct</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line">    .type   func_ret_struct,%<span class="meta">function</span></span><br><span class="line">    <span class="meta">.code</span>   <span class="number">32</span>                      <span class="comment">@ @func_ret_struct</span></span><br><span class="line"><span class="symbol">func_ret_struct</span>:</span><br><span class="line">    .fnstart</span><br><span class="line"><span class="comment">@ %bb.0:</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r1</span>, <span class="number">#0</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r1</span>, <span class="number">#1</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r1</span>, <span class="number">#2</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r1</span>, <span class="number">#3</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r1</span>, .LCPI2_0</span><br><span class="line"><span class="symbol">.LPC2_0</span>:</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r1</span>, <span class="built_in">pc</span>, <span class="built_in">r1</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">bx </span> <span class="built_in">lr</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line"><span class="comment">@ %bb.1:</span></span><br><span class="line"><span class="symbol">.LCPI2_0</span>:</span><br><span class="line">    <span class="meta">.long</span>   .L.<span class="keyword">str.1-(.LPC2_0+8)</span></span><br><span class="line"><span class="keyword">.Lfunc_end2:</span></span><br><span class="line"><span class="keyword"> </span>   .size   func_ret_struct, .Lfunc_end2-func_ret_struct</span><br><span class="line">    .cantunwind</span><br><span class="line">    .fnend</span><br><span class="line">                                        <span class="comment">@ -- End function</span></span><br><span class="line">    .globl  main                    <span class="comment">@ -- Begin function main</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line">    .type   main,%<span class="meta">function</span></span><br><span class="line">    <span class="meta">.code</span>   <span class="number">32</span>                      <span class="comment">@ @main</span></span><br><span class="line"><span class="symbol">main</span>:</span><br><span class="line">    .fnstart</span><br><span class="line"><span class="comment">@ %bb.0:</span></span><br><span class="line">    .pad    <span class="number">#36</span></span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#36</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r2</span>, <span class="number">#0</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r2</span>, [<span class="built_in">sp</span>, <span class="number">#32</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#28</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">sp</span>, <span class="number">#24</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#256</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#20</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#20</span>]</span><br><span class="line">    <span class="keyword">mvn </span><span class="built_in">r0</span>, <span class="built_in">r0</span>                      <span class="comment">@ ~</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#16</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#20</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r1</span>, [<span class="built_in">sp</span>, <span class="number">#16</span>]</span><br><span class="line">    <span class="keyword">and </span><span class="built_in">r0</span>, <span class="built_in">r0</span>, <span class="built_in">r1</span>                  <span class="comment">@ &amp; </span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#20</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r1</span>, [<span class="built_in">sp</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">eor </span><span class="built_in">r0</span>, <span class="built_in">r0</span>, <span class="built_in">r1</span>                  <span class="comment">@ ^ eor</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#20</span>]</span><br><span class="line">    <span class="keyword">asr </span><span class="built_in">r0</span>, <span class="built_in">r0</span>, <span class="number">#1</span>                  <span class="comment">@ &gt;&gt;</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#20</span>]</span><br><span class="line">    <span class="keyword">lsl </span><span class="built_in">r0</span>, <span class="built_in">r0</span>, <span class="number">#1</span>                  <span class="comment">@ &lt;&lt; </span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="built_in">r2</span></span><br><span class="line">    <span class="keyword">add </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#36</span></span><br><span class="line">    <span class="keyword">bx </span> <span class="built_in">lr</span></span><br><span class="line"><span class="symbol">.Lfunc_end3</span>:</span><br><span class="line">    .size   main, .Lfunc_end3-main</span><br><span class="line">    .cantunwind</span><br><span class="line">    .fnend</span><br><span class="line">                                        <span class="comment">@ -- End function</span></span><br><span class="line">    .type   .L.<span class="keyword">str,%object </span>         <span class="comment">@ @.str</span></span><br><span class="line">    <span class="meta">.section</span>    .rodata.<span class="keyword">str1.1,"aMS",%progbits,1</span></span><br><span class="line"><span class="keyword">.L.str:</span></span><br><span class="line"><span class="keyword"> </span>   <span class="meta">.asciz</span>  <span class="string">"%c %d %d %d %d\r\n"</span></span><br><span class="line">    .size   .L.<span class="keyword">str, </span><span class="number">17</span></span><br><span class="line"></span><br><span class="line">    .type   .L.<span class="keyword">str.1,%object </span>       <span class="comment">@ @.str.1</span></span><br><span class="line"><span class="symbol">.L.str.1</span>:</span><br><span class="line">    <span class="meta">.asciz</span>  <span class="string">"123"</span></span><br><span class="line">    .size   .L.<span class="keyword">str.1, </span><span class="number">4</span></span><br><span class="line"></span><br><span class="line">    .type   n1,%object              <span class="comment">@ @n1</span></span><br><span class="line">    <span class="meta">.data</span></span><br><span class="line">    .globl  n1</span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line"><span class="symbol">n1</span>:</span><br><span class="line">    <span class="meta">.long</span>   <span class="number">333</span>                     <span class="comment">@ 0x14d</span></span><br><span class="line">    .size   n1, <span class="number">4</span></span><br><span class="line"></span><br><span class="line">    .type   global_array,%object    <span class="comment">@ @global_array</span></span><br><span class="line">    .<span class="keyword">bss</span></span><br><span class="line"><span class="keyword"> </span>   .globl  global_array</span><br><span class="line"><span class="symbol">global_array</span>:</span><br><span class="line">    .zero   <span class="number">100</span></span><br><span class="line">    .size   global_array, <span class="number">100</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    .ident  <span class="string">"Android (5900059 based on r365631c) clang version 9.0.8 (https://android.googlesource.com/toolchain/llvm-project 207d7abc1a2abf3ef8d4301736d6a7ebc224a290) (based on LLVM 9.0.8svn)"</span></span><br><span class="line">    <span class="meta">.section</span>    <span class="string">".note.GNU-stack"</span>,<span class="string">""</span>,%progbits</span><br></pre></td></tr></table></figure>
<p><br></p>
<h2 id="C-程序逆向分析"><a href="#C-程序逆向分析" class="headerlink" title="C++程序逆向分析"></a>C++程序逆向分析</h2><ul>
<li>类、对象的内存布局</li>
<li>this指针</li>
<li>构造函数、析构函数</li>
<li>成员函数、成员变量</li>
<li>虚函数</li>
<li>继承、重载</li>
<li>异常</li>
</ul>
<p>函数入口<code>__libc_init</code>,再执行main函数</p>
<h3 id="main-class-cpp"><a href="#main-class-cpp" class="headerlink" title="main_class.cpp"></a>main_class.cpp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CNumber</span>&#123;</span></span><br><span class="line">    <span class="comment">//1. 空类</span></span><br><span class="line">    <span class="comment">//2. 成员变量</span></span><br><span class="line">    <span class="comment">//3. 成员函数, 隐藏的this， r0</span></span><br><span class="line">    <span class="comment">//4. 构造函数, </span></span><br><span class="line">    <span class="comment">//5. 全局对象 .init_array 初始化, 静态对象在函数中初始化一次</span></span><br><span class="line">    <span class="comment">//6. 析构函数</span></span><br><span class="line">    <span class="comment">//7. 虚函数</span></span><br><span class="line">    <span class="comment">//      虚表 构造和析构函数中，把虚表地址存在对象的0地址上，虚表中有虚函数的地址</span></span><br><span class="line">    <span class="comment">//      ida 静态分析添加虚表的结构体， 按T把偏移转成结构体</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    CNumber() &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"CNumber"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ~CNumber() &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"~CNumber"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setNum1</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        num1 = n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getNum1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> num1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getNum2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> num2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">setNum3</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        num3 = n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">int</span> <span class="title">getNum3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> num3;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> num1;</span><br><span class="line">    <span class="keyword">int</span> num2;</span><br><span class="line">    <span class="keyword">int</span> num3;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CNumber g_cnumber;      // .init_array 初始化</span></span><br><span class="line"><span class="comment">// CNumber g_cnumber2;</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// static CNumber s_cnumber;</span></span><br><span class="line">    CNumber cnumber;</span><br><span class="line">    cnumber.num1 = <span class="number">1</span>;</span><br><span class="line">    cnumber.num2 = <span class="number">2</span>;</span><br><span class="line">    cnumber.setNum3(<span class="number">3</span>);</span><br><span class="line">    CNumber* lpnumber = &amp;cnumber;</span><br><span class="line">    lpnumber-&gt;setNum3(<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">return</span> lpnumber-&gt;getNum3() ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="main-class-1-s"><a href="#main-class-1-s" class="headerlink" title="main_class_1.s"></a>main_class_1.s</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">.text</span></span><br><span class="line">    .syntax unified</span><br><span class="line">    .eabi_attribute <span class="number">67</span>, <span class="string">"2.09"</span>  <span class="comment">@ Tag_conformance</span></span><br><span class="line">    .cpu    arm7tdmi</span><br><span class="line">    .eabi_attribute <span class="number">6</span>, <span class="number">2</span>    <span class="comment">@ Tag_CPU_arch</span></span><br><span class="line">    .eabi_attribute <span class="number">8</span>, <span class="number">1</span>    <span class="comment">@ Tag_ARM_ISA_use</span></span><br><span class="line">    .eabi_attribute <span class="number">9</span>, <span class="number">1</span>    <span class="comment">@ Tag_THUMB_ISA_use</span></span><br><span class="line">    .eabi_attribute <span class="number">34</span>, <span class="number">0</span>   <span class="comment">@ Tag_CPU_unaligned_access</span></span><br><span class="line">    .eabi_attribute <span class="number">15</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_PCS_RW_data</span></span><br><span class="line">    .eabi_attribute <span class="number">16</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_PCS_RO_data</span></span><br><span class="line">    .eabi_attribute <span class="number">17</span>, <span class="number">2</span>   <span class="comment">@ Tag_ABI_PCS_GOT_use</span></span><br><span class="line">    .eabi_attribute <span class="number">20</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_FP_denormal</span></span><br><span class="line">    .eabi_attribute <span class="number">21</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_FP_exceptions</span></span><br><span class="line">    .eabi_attribute <span class="number">23</span>, <span class="number">3</span>   <span class="comment">@ Tag_ABI_FP_number_model</span></span><br><span class="line">    .eabi_attribute <span class="number">24</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_align_needed</span></span><br><span class="line">    .eabi_attribute <span class="number">25</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_align_preserved</span></span><br><span class="line">    .eabi_attribute <span class="number">38</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_FP_16bit_format</span></span><br><span class="line">    .eabi_attribute <span class="number">18</span>, <span class="number">4</span>   <span class="comment">@ Tag_ABI_PCS_wchar_t</span></span><br><span class="line">    .eabi_attribute <span class="number">26</span>, <span class="number">2</span>   <span class="comment">@ Tag_ABI_enum_size</span></span><br><span class="line">    .eabi_attribute <span class="number">14</span>, <span class="number">0</span>   <span class="comment">@ Tag_ABI_PCS_R9_use</span></span><br><span class="line">    .file   <span class="string">"main_class.cpp"</span></span><br><span class="line">    .globl  main                    <span class="comment">@ -- Begin function main</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line">    .type   main,%<span class="meta">function</span></span><br><span class="line">    <span class="meta">.code</span>   <span class="number">32</span>                      <span class="comment">@ @main</span></span><br><span class="line"><span class="symbol">main</span>:</span><br><span class="line">    .fnstart</span><br><span class="line"><span class="comment">@ %bb.0:</span></span><br><span class="line">    .pad    <span class="number">#12</span></span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#12</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r2</span>, <span class="number">#0</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r2</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">sp</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="built_in">r2</span></span><br><span class="line">    <span class="keyword">add </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#12</span></span><br><span class="line">    <span class="keyword">bx </span> <span class="built_in">lr</span></span><br><span class="line"><span class="symbol">.Lfunc_end0</span>:</span><br><span class="line">    .size   main, .Lfunc_end0-main</span><br><span class="line">    .cantunwind</span><br><span class="line">    .fnend</span><br><span class="line">                                        <span class="comment">@ -- End function</span></span><br><span class="line"></span><br><span class="line">    .ident  <span class="string">"Android (5900059 based on r365631c) clang version 9.0.8 (https://android.googlesource.com/toolchain/llvm-project 207d7abc1a2abf3ef8d4301736d6a7ebc224a290) (based on LLVM 9.0.8svn)"</span></span><br><span class="line">    <span class="meta">.section</span>    <span class="string">".note.GNU-stack"</span>,<span class="string">""</span>,%progbits</span><br></pre></td></tr></table></figure>
<h3 id="main-class-2-s"><a href="#main-class-2-s" class="headerlink" title="main_class_2.s"></a>main_class_2.s</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">.text</span></span><br><span class="line">    .syntax unified</span><br><span class="line">    .eabi_attribute <span class="number">67</span>, <span class="string">"2.09"</span>  <span class="comment">@ Tag_conformance</span></span><br><span class="line">    .cpu    arm7tdmi</span><br><span class="line">    .eabi_attribute <span class="number">6</span>, <span class="number">2</span>    <span class="comment">@ Tag_CPU_arch</span></span><br><span class="line">    .eabi_attribute <span class="number">8</span>, <span class="number">1</span>    <span class="comment">@ Tag_ARM_ISA_use</span></span><br><span class="line">    .eabi_attribute <span class="number">9</span>, <span class="number">1</span>    <span class="comment">@ Tag_THUMB_ISA_use</span></span><br><span class="line">    .eabi_attribute <span class="number">34</span>, <span class="number">0</span>   <span class="comment">@ Tag_CPU_unaligned_access</span></span><br><span class="line">    .eabi_attribute <span class="number">15</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_PCS_RW_data</span></span><br><span class="line">    .eabi_attribute <span class="number">16</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_PCS_RO_data</span></span><br><span class="line">    .eabi_attribute <span class="number">17</span>, <span class="number">2</span>   <span class="comment">@ Tag_ABI_PCS_GOT_use</span></span><br><span class="line">    .eabi_attribute <span class="number">20</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_FP_denormal</span></span><br><span class="line">    .eabi_attribute <span class="number">21</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_FP_exceptions</span></span><br><span class="line">    .eabi_attribute <span class="number">23</span>, <span class="number">3</span>   <span class="comment">@ Tag_ABI_FP_number_model</span></span><br><span class="line">    .eabi_attribute <span class="number">24</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_align_needed</span></span><br><span class="line">    .eabi_attribute <span class="number">25</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_align_preserved</span></span><br><span class="line">    .eabi_attribute <span class="number">38</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_FP_16bit_format</span></span><br><span class="line">    .eabi_attribute <span class="number">18</span>, <span class="number">4</span>   <span class="comment">@ Tag_ABI_PCS_wchar_t</span></span><br><span class="line">    .eabi_attribute <span class="number">26</span>, <span class="number">2</span>   <span class="comment">@ Tag_ABI_enum_size</span></span><br><span class="line">    .eabi_attribute <span class="number">14</span>, <span class="number">0</span>   <span class="comment">@ Tag_ABI_PCS_R9_use</span></span><br><span class="line">    .file   <span class="string">"main_class.cpp"</span></span><br><span class="line">    .globl  main                    <span class="comment">@ -- Begin function main</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line">    .type   main,%<span class="meta">function</span></span><br><span class="line">    <span class="meta">.code</span>   <span class="number">32</span>                      <span class="comment">@ @main</span></span><br><span class="line"><span class="symbol">main</span>:</span><br><span class="line">    .fnstart</span><br><span class="line"><span class="comment">@ %bb.0:</span></span><br><span class="line">    .pad    <span class="number">#16</span></span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#16</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r2</span>, <span class="number">#0</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r2</span>, [<span class="built_in">sp</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">sp</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#1</span>                  <span class="comment">@ r0 = 1</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>]                <span class="comment">@ cnumber.num1 = r0;</span></span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>]                <span class="comment">@ return cnumber.num1;</span></span><br><span class="line">    <span class="keyword">add </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#16</span></span><br><span class="line">    <span class="keyword">bx </span> <span class="built_in">lr</span></span><br><span class="line"><span class="symbol">.Lfunc_end0</span>:</span><br><span class="line">    .size   main, .Lfunc_end0-main</span><br><span class="line">    .cantunwind</span><br><span class="line">    .fnend</span><br><span class="line">                                        <span class="comment">@ -- End function</span></span><br><span class="line"></span><br><span class="line">    .ident  <span class="string">"Android (5900059 based on r365631c) clang version 9.0.8 (https://android.googlesource.com/toolchain/llvm-project 207d7abc1a2abf3ef8d4301736d6a7ebc224a290) (based on LLVM 9.0.8svn)"</span></span><br><span class="line">    <span class="meta">.section</span>    <span class="string">".note.GNU-stack"</span>,<span class="string">""</span>,%progbits</span><br></pre></td></tr></table></figure>
<h3 id="main-class-3-s"><a href="#main-class-3-s" class="headerlink" title="main_class_3.s"></a>main_class_3.s</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">.text</span></span><br><span class="line">    .syntax unified</span><br><span class="line">    .eabi_attribute <span class="number">67</span>, <span class="string">"2.09"</span>  <span class="comment">@ Tag_conformance</span></span><br><span class="line">    .cpu    arm7tdmi</span><br><span class="line">    .eabi_attribute <span class="number">6</span>, <span class="number">2</span>    <span class="comment">@ Tag_CPU_arch</span></span><br><span class="line">    .eabi_attribute <span class="number">8</span>, <span class="number">1</span>    <span class="comment">@ Tag_ARM_ISA_use</span></span><br><span class="line">    .eabi_attribute <span class="number">9</span>, <span class="number">1</span>    <span class="comment">@ Tag_THUMB_ISA_use</span></span><br><span class="line">    .eabi_attribute <span class="number">34</span>, <span class="number">0</span>   <span class="comment">@ Tag_CPU_unaligned_access</span></span><br><span class="line">    .eabi_attribute <span class="number">15</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_PCS_RW_data</span></span><br><span class="line">    .eabi_attribute <span class="number">16</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_PCS_RO_data</span></span><br><span class="line">    .eabi_attribute <span class="number">17</span>, <span class="number">2</span>   <span class="comment">@ Tag_ABI_PCS_GOT_use</span></span><br><span class="line">    .eabi_attribute <span class="number">20</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_FP_denormal</span></span><br><span class="line">    .eabi_attribute <span class="number">21</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_FP_exceptions</span></span><br><span class="line">    .eabi_attribute <span class="number">23</span>, <span class="number">3</span>   <span class="comment">@ Tag_ABI_FP_number_model</span></span><br><span class="line">    .eabi_attribute <span class="number">24</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_align_needed</span></span><br><span class="line">    .eabi_attribute <span class="number">25</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_align_preserved</span></span><br><span class="line">    .eabi_attribute <span class="number">38</span>, <span class="number">1</span>   <span class="comment">@ Tag_ABI_FP_16bit_format</span></span><br><span class="line">    .eabi_attribute <span class="number">18</span>, <span class="number">4</span>   <span class="comment">@ Tag_ABI_PCS_wchar_t</span></span><br><span class="line">    .eabi_attribute <span class="number">26</span>, <span class="number">2</span>   <span class="comment">@ Tag_ABI_enum_size</span></span><br><span class="line">    .eabi_attribute <span class="number">14</span>, <span class="number">0</span>   <span class="comment">@ Tag_ABI_PCS_R9_use</span></span><br><span class="line">    .file   <span class="string">"main_class.cpp"</span></span><br><span class="line">    .globl  main                    <span class="comment">@ -- Begin function main</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line">    .type   main,%<span class="meta">function</span></span><br><span class="line">    <span class="meta">.code</span>   <span class="number">32</span>                      <span class="comment">@ @main</span></span><br><span class="line"><span class="symbol">main</span>:</span><br><span class="line">    .fnstart</span><br><span class="line"><span class="comment">@ %bb.0:</span></span><br><span class="line">    .save   &#123;<span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    <span class="keyword">push </span>   &#123;<span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    .setfp  <span class="built_in">r11</span>, <span class="built_in">sp</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r11</span>, <span class="built_in">sp</span></span><br><span class="line">    .pad    <span class="number">#24</span></span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#24</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r2</span>, <span class="number">#0</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r2</span>, [<span class="built_in">r11</span>, #-<span class="number">4</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">r11</span>, #-<span class="number">8</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">sp</span>, <span class="number">#12</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#1</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#2</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#8</span>]</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">r0</span>, <span class="built_in">sp</span>, <span class="number">#4</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r1</span>, <span class="number">#3</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>]                <span class="comment">@ 4-byte Spill</span></span><br><span class="line">    <span class="keyword">bl </span> _ZN7CNumber7setNum1Ei</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>]                <span class="comment">@ 4-byte Reload</span></span><br><span class="line">    <span class="keyword">bl </span> _ZN7CNumber7getNum1Ev</span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">sp</span>, <span class="built_in">r11</span></span><br><span class="line">    <span class="keyword">pop </span>&#123;<span class="built_in">r11</span>, <span class="built_in">lr</span>&#125;</span><br><span class="line">    <span class="keyword">bx </span> <span class="built_in">lr</span></span><br><span class="line"><span class="symbol">.Lfunc_end0</span>:</span><br><span class="line">    .size   main, .Lfunc_end0-main</span><br><span class="line">    .fnend</span><br><span class="line">                                        <span class="comment">@ -- End function</span></span><br><span class="line">    <span class="meta">.section</span>    <span class="meta">.text</span>._ZN7CNumber7setNum1Ei,<span class="string">"axG"</span>,%progbits,_ZN7CNumber7setNum1Ei,comdat</span><br><span class="line">    .weak   _ZN7CNumber7setNum1Ei   <span class="comment">@ -- Begin function _ZN7CNumber7setNum1Ei</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line">    .type   _ZN7CNumber7setNum1Ei,%<span class="meta">function</span></span><br><span class="line">    <span class="meta">.code</span>   <span class="number">32</span>                      <span class="comment">@ @_ZN7CNumber7setNum1Ei</span></span><br><span class="line"><span class="symbol">_ZN7CNumber7setNum1Ei</span>:</span><br><span class="line">    .fnstart</span><br><span class="line"><span class="comment">@ %bb.0:</span></span><br><span class="line">    .pad    <span class="number">#8</span></span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#8</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">sp</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>, <span class="number">#4</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r1</span>, [<span class="built_in">sp</span>]</span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r1</span>, [<span class="built_in">r0</span>]</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#8</span></span><br><span class="line">    <span class="keyword">bx </span> <span class="built_in">lr</span></span><br><span class="line"><span class="symbol">.Lfunc_end1</span>:</span><br><span class="line">    .size   _ZN7CNumber7setNum1Ei, .Lfunc_end1-_ZN7CNumber7setNum1Ei</span><br><span class="line">    .cantunwind</span><br><span class="line">    .fnend</span><br><span class="line">                                        <span class="comment">@ -- End function</span></span><br><span class="line">    <span class="meta">.section</span>    <span class="meta">.text</span>._ZN7CNumber7getNum1Ev,<span class="string">"axG"</span>,%progbits,_ZN7CNumber7getNum1Ev,comdat</span><br><span class="line">    .weak   _ZN7CNumber7getNum1Ev   <span class="comment">@ -- Begin function _ZN7CNumber7getNum1Ev</span></span><br><span class="line">    .p2align    <span class="number">2</span></span><br><span class="line">    .type   _ZN7CNumber7getNum1Ev,%<span class="meta">function</span></span><br><span class="line">    <span class="meta">.code</span>   <span class="number">32</span>                      <span class="comment">@ @_ZN7CNumber7getNum1Ev</span></span><br><span class="line"><span class="symbol">_ZN7CNumber7getNum1Ev</span>:</span><br><span class="line">    .fnstart</span><br><span class="line"><span class="comment">@ %bb.0:</span></span><br><span class="line">    .pad    <span class="number">#4</span></span><br><span class="line">    <span class="keyword">sub </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#4</span></span><br><span class="line">    <span class="keyword">str </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">sp</span>]</span><br><span class="line">    <span class="keyword">ldr </span><span class="built_in">r0</span>, [<span class="built_in">r0</span>]</span><br><span class="line">    <span class="keyword">add </span><span class="built_in">sp</span>, <span class="built_in">sp</span>, <span class="number">#4</span></span><br><span class="line">    <span class="keyword">bx </span> <span class="built_in">lr</span></span><br><span class="line"><span class="symbol">.Lfunc_end2</span>:</span><br><span class="line">    .size   _ZN7CNumber7getNum1Ev, .Lfunc_end2-_ZN7CNumber7getNum1Ev</span><br><span class="line">    .cantunwind</span><br><span class="line">    .fnend</span><br><span class="line">                                        <span class="comment">@ -- End function</span></span><br><span class="line"></span><br><span class="line">    .ident  <span class="string">"Android (5900059 based on r365631c) clang version 9.0.8 (https://android.googlesource.com/toolchain/llvm-project 207d7abc1a2abf3ef8d4301736d6a7ebc224a290) (based on LLVM 9.0.8svn)"</span></span><br><span class="line">    <span class="meta">.section</span>    <span class="string">".note.GNU-stack"</span>,<span class="string">""</span>,%progbits</span><br></pre></td></tr></table></figure>
<p><br></p>
<h1 id="C-11-amp-Art虚拟机开发"><a href="#C-11-amp-Art虚拟机开发" class="headerlink" title="C++11&amp;Art虚拟机开发"></a>C++11&amp;Art虚拟机开发</h1><p><br></p>
<h1 id="LLVM-amp-OLLVM"><a href="#LLVM-amp-OLLVM" class="headerlink" title="LLVM&amp;OLLVM"></a>LLVM&amp;OLLVM</h1><ul>
<li>llvm简介与llvm编译,调试llvm</li>
<li>llvm pass</li>
<li>ollvm</li>
<li>Control Flow Flattening(fla,控制流程平坦化)</li>
<li>Bogus Control Flow(bcf, 虚假控制流程)</li>
<li>Instructions Substitution(sub, 指令替换)</li>
<li>StringObfuscation(sobf,字符串加密)</li>
<li>逆向ollvm的通用方法</li>
<li>逆向ollvm的非通用方法</li>
</ul>
<h2 id="llvm简介与调试"><a href="#llvm简介与调试" class="headerlink" title="llvm简介与调试"></a>llvm简介与调试</h2><ul>
<li><code>clang -emit-llvm -S hello_clang.c -o hello_clang.ll</code> 将c代码转成IR</li>
<li><code>lli hello_clang.ll</code> 利用lli在本地环境执行这个IR代码</li>
<li><code>llvm-as</code> 将IR转成Bytecode</li>
<li><code>llvm-dis hello_clang.bc -o hello_clang.ll</code> 把Bytecode转成IR</li>
<li><code>llc</code>将Bytecode转成二进制</li>
</ul>
<h3 id="调试Clang"><a href="#调试Clang" class="headerlink" title="调试Clang"></a>调试Clang</h3><p>使用clion调试的时候<code>llvm/tools/driver/driver.cpp</code>为代码入口</p>
<p>直接使用clang命令进行一个c的编译工作,即可进入<code>driver.cpp</code>的流程</p>
<p>具体编译的事项填入<code>program arguments</code></p>
<h3 id="调试opt"><a href="#调试opt" class="headerlink" title="调试opt"></a>调试opt</h3><p>llvm自带的pass是用来精简优化的, ollvm是用来做混淆的</p>
<ul>
<li><code>opt --help</code> 自带的pass</li>
<li><code>opt --print-bb hello_clang.bc</code>:打印ByteCode的用途</li>
</ul>
<p>pass是框架, 在llvm最重要的一部分, 可以完成编译器的转换和优化的工作, pass继承llvm:Pass类<br><code>https://llvm.org/doxygen/classllvm_1_1Pass.html</code></p>
<blockquote>
<p>一个案例pass</p>
</blockquote>
<p><code>llvm/lib/Transforms/Hello/Hello.cpp</code><br>打印一下函数的名字<br>命令为:<code>opt -load &#39;xxxx/llvm-project-9.0.1/llvm/cmake-build-debug/lib/LLVMHello.so&#39; -hello hello_clang.bc</code><br>执行效果后就是把函数名字打印出来</p>
<blockquote>
<p>如何调试</p>
</blockquote>
<p><code>opt -load xxx -xxx hello.c</code><br>具体的参数填入<code>program arguments</code><br>代码的opt入口在于<code>llvm/tools/opt/opt.cpp</code></p>
<p><br></p>
<h3 id="自写llvm-pass"><a href="#自写llvm-pass" class="headerlink" title="自写llvm pass"></a>自写llvm pass</h3><h4 id="函数名称加密Pass"><a href="#函数名称加密Pass" class="headerlink" title="函数名称加密Pass"></a>函数名称加密Pass</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">路径:/llvm/lib/Transforms/EncodeFunctionName</span><br><span class="line"></span><br><span class="line">EncodeFunctionName</span><br><span class="line">    -- CMakeLists.txt</span><br><span class="line">    -- EncodeFunctionName.cpp</span><br></pre></td></tr></table></figure>
<h5 id="CMakeLists-txt"><a href="#CMakeLists-txt" class="headerlink" title="CMakeLists.txt"></a>CMakeLists.txt</h5><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">add_llvm_library( EncodeFunctionName MODULE</span><br><span class="line">        EncodeFunctionName.cpp</span><br><span class="line"></span><br><span class="line">        PLUGIN_TOOL</span><br><span class="line">        opt</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>
<h4 id="EncodeFunctionName-cpp"><a href="#EncodeFunctionName-cpp" class="headerlink" title="EncodeFunctionName.cpp"></a>EncodeFunctionName.cpp</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"llvm/Pass.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"llvm/IR/Function.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"llvm/Support/raw_ostream.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"llvm/IR/LegacyPassManager.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"llvm/Transforms/IPO/PassManagerBuilder.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> llvm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">EncodeFunctionName</span> :</span> <span class="keyword">public</span> FunctionPass&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">char</span> ID;</span><br><span class="line">    EncodeFunctionName() : FunctionPass(ID) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">runOnFunction</span><span class="params">(Function &amp;F)</span> override </span>&#123;</span><br><span class="line">      errs() &lt;&lt; <span class="string">"Hello ThisIsEncodeFunctionName: "</span>;</span><br><span class="line">      errs().write_escaped(F.getName()) &lt;&lt; <span class="string">" ---&gt;"</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (F.getName().compare(<span class="string">"main"</span>) != <span class="number">0</span>)&#123;</span><br><span class="line">        llvm::MD5 Hasher;</span><br><span class="line">        llvm::MD5::MD5Result Hash;</span><br><span class="line">        Hasher.update(<span class="string">"test"</span>);</span><br><span class="line">        Hasher.update(F.getName());</span><br><span class="line">        Hasher.final(Hash);</span><br><span class="line"></span><br><span class="line">        SmallString&lt;<span class="number">32</span>&gt; HexString;</span><br><span class="line">        llvm::MD5::stringifyResult(Hash, HexString);</span><br><span class="line">        F.setName(HexString);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      errs().write_escaped(F.getName()) &lt;&lt; <span class="string">"\r\n"</span> ;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> EncodeFunctionName::ID = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">static</span> RegisterPass&lt;EncodeFunctionName&gt; X(<span class="string">"encode"</span>, <span class="string">"Encode Function Name Pass"</span>,</span><br><span class="line">                             <span class="literal">false</span> <span class="comment">/* Only looks at CFG */</span>,</span><br><span class="line">                             <span class="literal">false</span> <span class="comment">/* Analysis Pass */</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> llvm::<span class="function">RegisterStandardPasses <span class="title">Y</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    llvm::PassManagerBuilder::EP_EarlyAsPossible,</span></span></span><br><span class="line"><span class="function"><span class="params">[](<span class="keyword">const</span> llvm::PassManagerBuilder &amp;Builder,</span></span></span><br><span class="line"><span class="function"><span class="params">   llvm::legacy::PassManagerBase &amp;PM)</span> </span>&#123; PM.add(<span class="keyword">new</span> EncodeFunctionName()); &#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>编译命令 </p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./bin/clang -emit-llvm -S /root/Documents/some_c_cpp/arm02/hello.c -o hello.ll</span><br><span class="line"></span><br><span class="line">./bin/opt -load ./lib/EncodeFunctionName.so -encode /root/Documents/some_c_cpp/arm02/hello.bc</span><br></pre></td></tr></table></figure>
<h4 id="在LLvm源码之外开发Pass"><a href="#在LLvm源码之外开发Pass" class="headerlink" title="在LLvm源码之外开发Pass"></a>在LLvm源码之外开发Pass</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">路径:/root/Document/some_c_cpp/arm02/OutPassEncodeFunctionName</span><br><span class="line"></span><br><span class="line">OutPassEncodeFunctionName</span><br><span class="line">    -- OutEncodeFunctionName</span><br><span class="line">        -- CMakeLists.txt</span><br><span class="line">        -- OutEncodeFunctionName.cpp</span><br><span class="line">    -- CMakeLists.txt</span><br></pre></td></tr></table></figure>
<h5 id="CMakeLists-txt-out"><a href="#CMakeLists-txt-out" class="headerlink" title="CMakeLists.txt-out"></a>CMakeLists.txt-out</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.18)</span><br><span class="line"></span><br><span class="line">project(outPass)</span><br><span class="line"></span><br><span class="line">set(LLVM_DIR /root/Documents/llvm-project-9.0.1/llvm/cmake-build-debug/lib/cmake/llvm)</span><br><span class="line"></span><br><span class="line">find_package(LLVM REQUIRED CONFIG)</span><br><span class="line"></span><br><span class="line">list(APPEND CMAKE_MODULE_PATH &quot;$&#123;LLVM_CMAKE_DIR&#125;&quot;)</span><br><span class="line">include(AddLLVM)</span><br><span class="line"></span><br><span class="line">add_definitions($&#123;LLVM_DEFINITIONS&#125;)</span><br><span class="line">include_directories($&#123;LLVM_INCLUDE_DIRS&#125;)</span><br><span class="line"></span><br><span class="line">add_subdirectory(OutEncodeFunctionName)</span><br></pre></td></tr></table></figure>
<h5 id="CMakeLists-txt-inner"><a href="#CMakeLists-txt-inner" class="headerlink" title="CMakeLists.txt-inner"></a>CMakeLists.txt-inner</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">add_llvm_library(OutEncodeFunctionName MODULE</span><br><span class="line">        OutEncodeFunctionName.cpp</span><br><span class="line"></span><br><span class="line">        DEPENDS</span><br><span class="line">        intrinsics_gen</span><br><span class="line">        PLUGIN_TOOL</span><br><span class="line">        opt</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>
<h5 id="OutEncodeFunctionName-cpp"><a href="#OutEncodeFunctionName-cpp" class="headerlink" title="OutEncodeFunctionName.cpp"></a>OutEncodeFunctionName.cpp</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"llvm/Pass.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"llvm/IR/Function.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"llvm/Support/raw_ostream.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"llvm/IR/LegacyPassManager.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"llvm/Transforms/IPO/PassManagerBuilder.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> llvm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">OutEncodeFunctionName</span> :</span> <span class="keyword">public</span> FunctionPass&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">char</span> ID;</span><br><span class="line">    OutEncodeFunctionName() : FunctionPass(ID) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">runOnFunction</span><span class="params">(Function &amp;F)</span> override </span>&#123;</span><br><span class="line">      errs() &lt;&lt; <span class="string">"Hello ThisIsOutEncodeFunctionName: "</span>;</span><br><span class="line">      errs().write_escaped(F.getName()) &lt;&lt; <span class="string">" ---&gt;"</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (F.getName().compare(<span class="string">"main"</span>) != <span class="number">0</span>)&#123;</span><br><span class="line">        llvm::MD5 Hasher;</span><br><span class="line">        llvm::MD5::MD5Result Hash;</span><br><span class="line">        Hasher.update(<span class="string">"test"</span>);</span><br><span class="line">        Hasher.update(F.getName());</span><br><span class="line">        Hasher.final(Hash);</span><br><span class="line"></span><br><span class="line">        SmallString&lt;<span class="number">32</span>&gt; HexString;</span><br><span class="line">        llvm::MD5::stringifyResult(Hash, HexString);</span><br><span class="line">        F.setName(HexString);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      errs().write_escaped(F.getName()) &lt;&lt; <span class="string">"\r\n"</span> ;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> OutEncodeFunctionName::ID = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">static</span> RegisterPass&lt;OutEncodeFunctionName&gt; X(<span class="string">"encode"</span>, <span class="string">"Encode Function Name Pass"</span>,</span><br><span class="line">                             <span class="literal">false</span> <span class="comment">/* Only looks at CFG */</span>,</span><br><span class="line">                             <span class="literal">false</span> <span class="comment">/* Analysis Pass */</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> llvm::<span class="function">RegisterStandardPasses <span class="title">Y</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    llvm::PassManagerBuilder::EP_EarlyAsPossible,</span></span></span><br><span class="line"><span class="function"><span class="params">[](<span class="keyword">const</span> llvm::PassManagerBuilder &amp;Builder,</span></span></span><br><span class="line"><span class="function"><span class="params">   llvm::legacy::PassManagerBase &amp;PM)</span> </span>&#123; PM.add(<span class="keyword">new</span> OutEncodeFunctionName()); &#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>编译命令</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/root/Documents/llvm-project-9.0.1/llvm/cmake-build-debug/bin/opt -load ./OutEncodeFunctionName.so -encode /root/Documents/some_c_cpp/arm02/hello.bc</span><br></pre></td></tr></table></figure>
<h4 id="让Clang使用Pass"><a href="#让Clang使用Pass" class="headerlink" title="让Clang使用Pass"></a>让Clang使用Pass</h4><h5 id="命令clang路由so文件"><a href="#命令clang路由so文件" class="headerlink" title="命令clang路由so文件"></a>命令clang路由so文件</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang -Xclang -load -Xclang /root/CLionProjects/outPassEncodeFunctionName/cmake-build-debug/OutEncodeFunctionName/OutEncodeFunctionName.so -encode hello.ll -o hello</span><br></pre></td></tr></table></figure>
<h5 id="直接嵌套在clang-llvm体系内"><a href="#直接嵌套在clang-llvm体系内" class="headerlink" title="直接嵌套在clang llvm体系内"></a>直接嵌套在clang llvm体系内</h5><h6 id="include"><a href="#include" class="headerlink" title="include"></a>include</h6><p>新增头文件在<code>llvm/include/llvm/Transforms/EncodeFunctionName/EncodeFunctionName.h</code></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by root on 5/21/21.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> LLVM_ENCODEFUNCTIONNAME_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LLVM_ENCODEFUNCTIONNAME_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"llvm/Pass.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> llvm&#123;</span><br><span class="line">  <span class="function">Pass* <span class="title">createEncodeFunctionName</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// LLVM_ENCODEFUNCTIONNAME_H</span></span></span><br></pre></td></tr></table></figure>
<h6 id="source"><a href="#source" class="headerlink" title="source"></a>source</h6><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"llvm/Pass.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"llvm/IR/Function.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"llvm/Support/raw_ostream.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"llvm/IR/LegacyPassManager.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"llvm/Transforms/IPO/PassManagerBuilder.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"llvm/Transforms/EncodeFunctionName/EncodeFunctionName.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> llvm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">EncodeFunctionName</span> :</span> <span class="keyword">public</span> FunctionPass&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">char</span> ID;</span><br><span class="line">    EncodeFunctionName() : FunctionPass(ID) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">runOnFunction</span><span class="params">(Function &amp;F)</span> override </span>&#123;</span><br><span class="line">      errs() &lt;&lt; <span class="string">"Hello ThisIsEncodeFunctionName: "</span>;</span><br><span class="line">      errs().write_escaped(F.getName()) &lt;&lt; <span class="string">" ---&gt;"</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (F.getName().compare(<span class="string">"main"</span>) != <span class="number">0</span>)&#123;</span><br><span class="line">        llvm::MD5 Hasher;</span><br><span class="line">        llvm::MD5::MD5Result Hash;</span><br><span class="line">        Hasher.update(<span class="string">"test"</span>);</span><br><span class="line">        Hasher.update(F.getName());</span><br><span class="line">        Hasher.final(Hash);</span><br><span class="line"></span><br><span class="line">        SmallString&lt;<span class="number">32</span>&gt; HexString;</span><br><span class="line">        llvm::MD5::stringifyResult(Hash, HexString);</span><br><span class="line">        F.setName(HexString);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      errs().write_escaped(F.getName()) &lt;&lt; <span class="string">"\r\n"</span> ;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> EncodeFunctionName::ID = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">static</span> RegisterPass&lt;EncodeFunctionName&gt; X(<span class="string">"encode"</span>, <span class="string">"Encode Function Name Pass"</span>,</span><br><span class="line">                             <span class="literal">false</span> <span class="comment">/* Only looks at CFG */</span>,</span><br><span class="line">                             <span class="literal">false</span> <span class="comment">/* Analysis Pass */</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> llvm::<span class="function">RegisterStandardPasses <span class="title">Y</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    llvm::PassManagerBuilder::EP_EarlyAsPossible,</span></span></span><br><span class="line"><span class="function"><span class="params">[](<span class="keyword">const</span> llvm::PassManagerBuilder &amp;Builder,</span></span></span><br><span class="line"><span class="function"><span class="params">   llvm::legacy::PassManagerBase &amp;PM)</span> </span>&#123; PM.add(<span class="keyword">new</span> EncodeFunctionName()); &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 新增</span></span><br><span class="line"><span class="function">Pass* <span class="title">createEncodeFunctionName</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> EncodeFunctionName();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="IPO-PassManagerBuilder"><a href="#IPO-PassManagerBuilder" class="headerlink" title="IPO/PassManagerBuilder"></a>IPO/PassManagerBuilder</h6><p>路径:<code>llvm/lib/Transforms/IPO/PassManagerBuilder</code></p>
<ul>
<li>新增头文件</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"llvm/Transforms/EncodeFunctionName/EncodeFunctionName.h"</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li>PassManagerBuilder::populateModulePassManager</li>
</ul>
<p>新增一条<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MPM.add(createEncodeFunctionName());</span><br></pre></td></tr></table></figure></p>
<h6 id="so动态库转a静态库"><a href="#so动态库转a静态库" class="headerlink" title="so动态库转a静态库"></a>so动态库转a静态库</h6><ul>
<li>EncodeFunctionName/CMAKELists.txt</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">add_llvm_library(LLVMEncodeFunctionName </span><br><span class="line">        EncodeFunctionName.cpp</span><br><span class="line"></span><br><span class="line">        ADDITIONAL_HEADER_DIRS</span><br><span class="line">        $&#123;LLVM_MAIN_INCLUDE_DIR&#125;/llvm/Transforms</span><br><span class="line">        $&#123;LLVM_MAIN_INCLUDE_DIR&#125;/llvm/Transforms/Scalar</span><br><span class="line"></span><br><span class="line">        DEPENDS</span><br><span class="line">        intrinsics_gen</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>
<ul>
<li>/llvm/lib/Transforms/LLVMBuild.txt</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">subdirectories = AggressiveInstCombine Coroutines IPO InstCombine Instrumentation Scalar Utils Vectorize ObjCARC EncodeFunctionName</span><br><span class="line"></span><br><span class="line">[component_0]</span><br><span class="line">type = Group</span><br><span class="line">name = Transforms</span><br><span class="line">parent = Libraries</span><br></pre></td></tr></table></figure>
<ul>
<li>/llvm/lib/Transfroms/IPO/LLVMBuild.txt</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[component_0]</span><br><span class="line">type = Library</span><br><span class="line">name = IPO</span><br><span class="line">parent = Transforms</span><br><span class="line">library_name = ipo</span><br><span class="line">required_libraries = AggressiveInstCombine Analysis BitReader BitWriter Core InstCombine IRReader Linker Object ProfileData Scalar Support TransformUtils Vectorize Instrumentation EncodeFunctionName</span><br></pre></td></tr></table></figure>
<ul>
<li>/llvm/lib/Transfroms/EncodeFunctionName</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[component_0]</span><br><span class="line">type = Library</span><br><span class="line">name = EncodeFunctionName</span><br><span class="line">parent = Transforms</span><br><span class="line">library_name = EncodeFunctionName</span><br></pre></td></tr></table></figure>
<blockquote>
<p>调用命令</p>
</blockquote>
<p><code>clang -mllvm -encode_function_name /root/Document/some_c_cpp/arm02/hello.bc -o /root/Document/some_c_cpp/arm02/hello</code></p>
<h4 id="调试Pass"><a href="#调试Pass" class="headerlink" title="调试Pass"></a>调试Pass</h4><p>这里直接在外部的代码块打断点, 然后debug执行二进制opt即可</p>
<p><br></p>
<h3 id="ollvm的简介和移植"><a href="#ollvm的简介和移植" class="headerlink" title="ollvm的简介和移植"></a>ollvm的简介和移植</h3><h4 id="OLLVM简介"><a href="#OLLVM简介" class="headerlink" title="OLLVM简介"></a>OLLVM简介</h4><p>ollvm是一个开源项目, 主要是llvm里面Transforms的子模块Obfuscator</p>
<h4 id="OLLVM使用、特性"><a href="#OLLVM使用、特性" class="headerlink" title="OLLVM使用、特性"></a>OLLVM使用、特性</h4><h5 id="Bogus-Control-Flow"><a href="#Bogus-Control-Flow" class="headerlink" title="Bogus Control Flow"></a>Bogus Control Flow</h5><ul>
<li><code>-mllvm -bcf</code>: activates the bogus control flow pass</li>
<li><code>-mllvm -bcf_loop=3</code>: if the pass is activated, applies it 3 times on a function. Default: 1</li>
<li><code>-mllvm -bcf_prob=40</code>: if the pass is activated, a basic bloc will be obfuscated with a probability of 40%. Default: 30</li>
</ul>
<h5 id="Control-Flow-Flattening"><a href="#Control-Flow-Flattening" class="headerlink" title="Control Flow Flattening"></a>Control Flow Flattening</h5><ul>
<li><code>-mllvm -fla</code>: activates control flow flattening</li>
<li><code>-mllvm -split</code>: activates basic block splitting. Improve the flattening when applied together.</li>
<li><code>-mllvm -split_num=3</code>: if the pass is activated, applies it 3 times on each basic block. Default: 1</li>
</ul>
<h5 id="Substitution"><a href="#Substitution" class="headerlink" title="Substitution"></a>Substitution</h5><ul>
<li><code>-mllvm -sub</code>: activate instructions substitution</li>
<li><code>-mllvm -sub_loop=3</code>: if the pass is activated, applies it 3 times on a function. Default : 1.</li>
</ul>
<p><br></p>
<h2 id="ControlFlowFlattening"><a href="#ControlFlowFlattening" class="headerlink" title="ControlFlowFlattening"></a>ControlFlowFlattening</h2><h3 id="移植ollvm代码到单独的so"><a href="#移植ollvm代码到单独的so" class="headerlink" title="移植ollvm代码到单独的so"></a>移植ollvm代码到单独的so</h3><p>请查看本地资料相关代码</p>
<h3 id="调试ollvm-pass"><a href="#调试ollvm-pass" class="headerlink" title="调试ollvm pass"></a>调试ollvm pass</h3><p><code>clang -Xclang -load -Xclang ../obfuscation.so hello.c -o hello</code></p>
<p>将相关的so进行debug, 执行以上的命令</p>
<h3 id="调试Flattening"><a href="#调试Flattening" class="headerlink" title="调试Flattening"></a>调试Flattening</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Module </span><br><span class="line">    Function</span><br><span class="line">        BasicBlock</span><br><span class="line">            Instruction</span><br><span class="line">            Instruction</span><br><span class="line">            Instruction</span><br><span class="line">            SwichInst</span><br><span class="line">            BranchInst</span><br><span class="line">            ReturnInst</span><br><span class="line">            InsertValueInst</span><br><span class="line">            StoreInst</span><br><span class="line">    Function</span><br><span class="line">    Function</span><br><span class="line">    Function</span><br><span class="line">    Function</span><br><span class="line">    Function</span><br><span class="line">    Function</span><br></pre></td></tr></table></figure>
<p><br></p>
<h1 id="调试VPM"><a href="#调试VPM" class="headerlink" title="调试VPM"></a>调试VPM</h1><p><br></p>

        
    </section>
</article>



<div class="comments">
    <div id="disqus_thread">
        <p class="comment-tips">国内查看评论需要代理~</p>
    </div>
    <script>
    window.disqus_config = function () {
        this.language = 'zh';
        this.page.url = 'http://www.coderss.cn/2021/03/12/android-kernel/';
        this.page.title = '安卓ART虚拟机逆向';
        this.page.identifier = '2021/03/12/android-kernel/';
    };
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://name.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

</div>
        <footer class="footer">
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, Theme by <a href="https://github.com/sanonz/hexo-theme-concise" target="_blank">Concise</a>
</footer>

<script type="text/javascript" src="//s13.cnzz.com/z_stat.php?id=1234567890&amp;web_id=1234567890"></script>


    </div>

    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/1.9.0/jquery.min.js"></script>
    
    <script type="text/javascript" src="/js/scrollspy.min.js"></script>
    
    <script type="text/javascript">
        $(function() {
            var nodes = {
                nav: $('#nav'),
                aside: $('#aside'),
                navTags: $('#nav-tags')
            };

            $('#open-panel, #aside-mask').on('click', function() {
                nodes.aside.toggleClass('panel-show');
            });
            $('#nav-tag').on('click', function(event) {
                event.preventDefault();console.log(nodes.navTags.attr('class'))
                nodes.navTags.toggleClass('tag-show');console.log(nodes.navTags.attr('class'))
            })/*.hover(function() {
                nodes.navTags.addClass('tag-show');
            }, function() {
                nodes.navTags.removeClass('tag-show');
            });*/

            
            $(document.body).scrollspy({target: '#aside-inner'});
            
        });
    </script>

</body>
</html>
