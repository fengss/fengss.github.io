<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">

    

    

    <title>分布式文件系统 | Coderss</title>
    <meta name="author" content="coder">
    <meta name="version" content="1.0.0">
    <meta name="keywords" content="">
    <meta name="description" content="相关主流的存储解决方案,进行对比与分析
主流存储架构
DAS: Direct Attached Storage的缩写，即“直连存储”
NAS:Network Attached Storage的缩写，通常为”网络直连存储”。
SAN:Storage Area Network,”光纤存储”,基于光纤存储,也是最昂贵和复杂的存储
OSD:Object Storage Device,”对象存储”

DAS将外部数据存储设备(采用SCSI技术或FC技术)直接挂在到内部总线上的方式,如同PC机架构
能够解决">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="baidu-site-verification" content="F0CXvmUgA9">

    
    
    <link rel="icon" href="/favicon.png">
    

    <link rel="stylesheet" href="/css/style.css">
</head>
<body>

    <div class="app">
        <header class="header clearfix">
    <div id="nav" class="nav">
    <button id="open-panel" class="open-panel"><i class="icon-library"></i></button>

    <nav class="nav-inner">

        
        
        <li class="nav-item">
            <a class="nav-link" href="/">首页</a>
        </li>
        
        
        
        <li class="nav-item">
            <a class="nav-link" href="/categories/back-end">Java栈</a>
        </li>
        
        
        
        <li class="nav-item">
            <a class="nav-link" href="/categories/cpp">C/C++</a>
        </li>
        
        
        
        <li class="nav-item">
            <a class="nav-link" href="/categories/go">Golang</a>
        </li>
        
        
        
        <li class="nav-item">
            <a class="nav-link" href="/categories/cloud">System</a>
        </li>
        
        
        
        <li class="nav-item">
            <a class="nav-link" href="/categories/data">BigData</a>
        </li>
        
        
        
        <li class="nav-item">
            <a class="nav-link" href="/categories/ai">Math/AI</a>
        </li>
        
        
        
        <li class="nav-item">
            <a class="nav-link" href="/book">计划</a>
        </li>
        
        
        
        <li class="nav-item nav-item-tag">
            <a id="nav-tag" class="nav-link" href="#">标签</a>
            <div id="nav-tags" class="nav-tag-wrap">
                <i class="nav-tag-arrow"></i>
                
  <div class="widget-wrap">
    <h3 class="widget-title">
        <i class="icon-tag vm"></i>
        <span class="vm">Tags</span>
    </h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AI/">AI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Boost库/">Boost库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Collection/">Collection</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cpp编程/">Cpp编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Fescar/">Fescar</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gc/">Gc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/K8s/">K8s</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MapReduce/">MapReduce</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Math/">Math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mesos/">Mesos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python计算库/">Python计算库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Scikit/">Scikit</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sharding-jdbc/">Sharding-jdbc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SkyWalking/">SkyWalking</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SofaMesh/">SofaMesh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spark/">Spark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TensorFlow/">TensorFlow</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TroubleShoot/">TroubleShoot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Turi/">Turi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows内核/">Windows内核</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows内核驱动/">Windows内核驱动</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Yarn/">Yarn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/assembly/">assembly</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c-cpp语言/">c/cpp语言</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/debug/">debug</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/design/">design</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dubbo/">dubbo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/eth/">eth</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flume/">flume</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/">go</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go-kernel/">go-kernel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/io/">io</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/juc/">juc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/map/">map</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mfc/">mfc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/microservice/">microservice</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mybatis/">mybatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/netty/">netty</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python-book/">python-book</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/qt/">qt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/skycoin/">skycoin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring/">spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring-cloud/">spring-cloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/stl/">stl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tomcat/">tomcat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/中台/">中台</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/内网穿透/">内网穿透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式文件系统/">分布式文件系统</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/多线程编程/">多线程编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/架构/">架构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/消息队列/">消息队列</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/网络编程/">网络编程</a></li></ul>
    </div>
  </div>


            </div>
        </li>
        
        
        
        <li class="nav-item">
            <a class="nav-link" href="/archives">归档</a>
        </li>
        
        
        

    </nav>
</div>

    <aside id="aside" class="aside">
    <div id="aside-mask" class="aside-mask"></div>
    <div id="aside-inner" class="aside-inner">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"><i class="icon-search-stroke"></i></button><input type="hidden" name="sitesearch" value="http://www.coderss.cn"></form>

        
        
        
        

        
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#主流存储架构"><span class="toc-number">1.</span> <span class="toc-text">主流存储架构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#DAS"><span class="toc-number">1.1.</span> <span class="toc-text">DAS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NAS"><span class="toc-number">1.2.</span> <span class="toc-text">NAS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SAN"><span class="toc-number">1.3.</span> <span class="toc-text">SAN</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#光纤通道集线器"><span class="toc-number">1.3.1.</span> <span class="toc-text">光纤通道集线器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#交换机"><span class="toc-number">1.3.2.</span> <span class="toc-text">交换机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#桥"><span class="toc-number">1.3.3.</span> <span class="toc-text">桥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#缺点"><span class="toc-number">1.3.4.</span> <span class="toc-text">缺点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OSD"><span class="toc-number">1.4.</span> <span class="toc-text">OSD</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#简介"><span class="toc-number">1.4.1.</span> <span class="toc-text">简介</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#主流分布式存储产品"><span class="toc-number">2.</span> <span class="toc-text">主流分布式存储产品</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#TFS"><span class="toc-number">2.1.</span> <span class="toc-text">TFS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#特性"><span class="toc-number">2.1.1.</span> <span class="toc-text">特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#优点"><span class="toc-number">2.1.2.</span> <span class="toc-text">优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#缺点-1"><span class="toc-number">2.1.3.</span> <span class="toc-text">缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#应用场景"><span class="toc-number">2.1.4.</span> <span class="toc-text">应用场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FastDFS"><span class="toc-number">2.2.</span> <span class="toc-text">FastDFS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#特性-1"><span class="toc-number">2.2.1.</span> <span class="toc-text">特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#优点-1"><span class="toc-number">2.2.2.</span> <span class="toc-text">优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#缺点-2"><span class="toc-number">2.2.3.</span> <span class="toc-text">缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#应用场景-1"><span class="toc-number">2.2.4.</span> <span class="toc-text">应用场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MooseFS"><span class="toc-number">2.3.</span> <span class="toc-text">MooseFS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#特性-2"><span class="toc-number">2.3.1.</span> <span class="toc-text">特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#优点-2"><span class="toc-number">2.3.2.</span> <span class="toc-text">优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#缺点-3"><span class="toc-number">2.3.3.</span> <span class="toc-text">缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#应用场景-2"><span class="toc-number">2.3.4.</span> <span class="toc-text">应用场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GlusterFS"><span class="toc-number">2.4.</span> <span class="toc-text">GlusterFS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#特性-3"><span class="toc-number">2.4.1.</span> <span class="toc-text">特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#优点-3"><span class="toc-number">2.4.2.</span> <span class="toc-text">优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#缺点-4"><span class="toc-number">2.4.3.</span> <span class="toc-text">缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#应用场景-3"><span class="toc-number">2.4.4.</span> <span class="toc-text">应用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#术语"><span class="toc-number">2.4.5.</span> <span class="toc-text">术语</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ceph"><span class="toc-number">2.5.</span> <span class="toc-text">Ceph</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#特性-4"><span class="toc-number">2.5.1.</span> <span class="toc-text">特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#优点-4"><span class="toc-number">2.5.2.</span> <span class="toc-text">优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#缺点-5"><span class="toc-number">2.5.3.</span> <span class="toc-text">缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#应用场景-4"><span class="toc-number">2.5.4.</span> <span class="toc-text">应用场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MogileFS"><span class="toc-number">2.6.</span> <span class="toc-text">MogileFS</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#适用分布式存储产品"><span class="toc-number">3.</span> <span class="toc-text">适用分布式存储产品</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Hdfs"><span class="toc-number">3.1.</span> <span class="toc-text">Hdfs</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#特性-5"><span class="toc-number">3.1.1.</span> <span class="toc-text">特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#优点-5"><span class="toc-number">3.1.2.</span> <span class="toc-text">优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#缺点-6"><span class="toc-number">3.1.3.</span> <span class="toc-text">缺点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Xtreemfs"><span class="toc-number">3.2.</span> <span class="toc-text">Xtreemfs</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#特性-6"><span class="toc-number">3.2.1.</span> <span class="toc-text">特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#优点-6"><span class="toc-number">3.2.2.</span> <span class="toc-text">优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#缺点-7"><span class="toc-number">3.2.3.</span> <span class="toc-text">缺点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Seaweedfs"><span class="toc-number">3.3.</span> <span class="toc-text">Seaweedfs</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#FaceBook-图片存储架构"><span class="toc-number">3.3.1.</span> <span class="toc-text">FaceBook 图片存储架构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Directory"><span class="toc-number">3.3.1.1.</span> <span class="toc-text">Directory</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Cache"><span class="toc-number">3.3.1.2.</span> <span class="toc-text">Cache</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Store"><span class="toc-number">3.3.1.3.</span> <span class="toc-text">Store</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#简介-1"><span class="toc-number">3.3.2.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#优势"><span class="toc-number">3.3.3.</span> <span class="toc-text">优势</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ipFS"><span class="toc-number">3.4.</span> <span class="toc-text">ipFS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#简介-2"><span class="toc-number">3.4.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#层级"><span class="toc-number">3.4.2.</span> <span class="toc-text">层级</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#身份-amp-路由层"><span class="toc-number">3.4.2.1.</span> <span class="toc-text">身份&amp;路由层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#网络层"><span class="toc-number">3.4.2.2.</span> <span class="toc-text">网络层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#交换层"><span class="toc-number">3.4.2.3.</span> <span class="toc-text">交换层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#对象层和文件层"><span class="toc-number">3.4.2.4.</span> <span class="toc-text">对象层和文件层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#命名层"><span class="toc-number">3.4.2.5.</span> <span class="toc-text">命名层</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#优势-1"><span class="toc-number">3.4.3.</span> <span class="toc-text">优势</span></a></li></ol></li></ol></li></ol>
        
    </div>
</aside>

</header>

        <div id="content" class="content"><article class="article" itemscope="" itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            分布式文件系统
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="/2018/07/11/distributed-file/">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2018-07-11T01:31:39.000Z" itemprop="datePublished">2018-07-11</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/分布式文件系统/">分布式文件系统</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <p>相关主流的存储解决方案,进行对比与分析<br><a id="more"></a></p>
<h1 id="主流存储架构"><a href="#主流存储架构" class="headerlink" title="主流存储架构"></a>主流存储架构</h1><ul>
<li>DAS: Direct Attached Storage的缩写，即“直连存储”</li>
<li>NAS:Network Attached Storage的缩写，通常为”网络直连存储”。</li>
<li>SAN:Storage Area Network,”光纤存储”,基于光纤存储,也是最昂贵和复杂的存储</li>
<li>OSD:Object Storage Device,”对象存储”</li>
</ul>
<h2 id="DAS"><a href="#DAS" class="headerlink" title="DAS"></a>DAS</h2><p>将外部数据存储设备(采用SCSI技术或FC技术)直接挂在到内部总线上的方式,如同PC机架构</p>
<p>能够解决单台服务器的存储空间阔知,高性能传输</p>
<p>随着大容量硬盘推出,单台外置存储系统容量持续升高</p>
<h2 id="NAS"><a href="#NAS" class="headerlink" title="NAS"></a>NAS</h2><p>网络附加存储,主要为了实现不同操作系统平台下的文件共享应用</p>
<p><img src="/2018/07/11/distributed-file/file-01.png" alt="image"></p>
<p>由工作站或服务器通过网络协议(如TCP/IP)和应用程序</p>
<p>(如网络文件系统NFS或者通用 Internet文件系统CIFS)来进行文件访问</p>
<p>其中基于网络的文件级锁定提供了高级并发访问保护的功能。</p>
<p>NAS设备可以进行优化,以文件级保护向多台客户机发送文件信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">NAS设备与客户机之间主要是进行数据传输。</span><br><span class="line">今天在LAN/WAN上传输的大量数据被分成许多小的数据块。</span><br><span class="line">传输的处理过程需要占用处理器资源来中断和重新访问数据流。</span><br><span class="line">如果数据包的处理占用太多的处理器资源,则在同一服务器上运行的应用程序会受到影响。</span><br><span class="line">由于网络拥堵影响NAS的性能,所以其性能局限性之一是网络传输数据的能力。</span><br></pre></td></tr></table></figure>
<h2 id="SAN"><a href="#SAN" class="headerlink" title="SAN"></a>SAN</h2><p>通常SAN由RAID阵列连接光纤通道(Fibre Channel)组成</p>
<p>SAN和服务器以及客户机的数据通信通过SCSI命令而非TCP/IP,数据处理是“块级”。</p>
<p>典型协议SCSI-FCP(SmallComputer System Interface-Fiber Channel Protocol,小型计算机系统接口——光纤通道协议)</p>
<p><img src="/2018/07/11/distributed-file/file-02.png" alt=""></p>
<h3 id="光纤通道集线器"><a href="#光纤通道集线器" class="headerlink" title="光纤通道集线器"></a>光纤通道集线器</h3><p>它类似于局域网集线器，所有的设备连接到作为中心的集线器端口上</p>
<p>在集线器内部把它们连接成环，物理拓扑结构看越来是星形，但工作时按照环网的方式运行，所以也被称作星环结构。</p>
<p>仲裁环是SAN中一种比较简单的方式,它最多可以连接126个存储设备和应用服务器。</p>
<p>但是这种连接方式在增加和除去其中的一个设备时必须让环上所有的设备都停止工作一段时间。</p>
<p>另外,如果一个设各有了故障,整个环都不能正常工作。 </p>
<h3 id="交换机"><a href="#交换机" class="headerlink" title="交换机"></a>交换机</h3><p>光纤通道交换机则不同，当一个设备需要和另一个设备通信时</p>
<p>交换机就在它们之间建立一个通道。如果同时还有另外两个设备需要通信，交换机就为它们再建立一个通道。因此交换机能让任意两个设备都拥有一个光纤通道的带宽。</p>
<h3 id="桥"><a href="#桥" class="headerlink" title="桥"></a>桥</h3><p>光纤通道广域网桥接器可以把两个光纤通道SAN通过诸如ATM这样的广域网互连。</p>
<p>在互连的两个场点各配置一个桥接器,该桥接器一端(B端口)连接本地光纤通道SAN交换机的E端口,另一端连接ATM交换机端口。</p>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p>不利于不同操作系统主机间的数据共享:另外一个原因是因为操作系统使用不同的文件系统,格式化完之后,不同文件系统间的数据是共享不了的。</p>
<p>例如一台装了WIN7/XP,文件系统是FAT32/NTFS,而Linux是EXT4,EXT4是无法识别NTFS的文件系统的。</p>
<p>就像一只NTFS格式的U盘，插进Linux的笔记本，根本无法识别出来。所以不利于文件共享。</p>
<h2 id="OSD"><a href="#OSD" class="headerlink" title="OSD"></a>OSD</h2><blockquote>
<p> 块存储读写快,不利于共享(根据文件系统来);  </p>
<p>文件存储读写慢,利于共享(tcp传输文件数据,协议一直)。</p>
<p>能否弄一个读写快，利 于共享的出来呢。于是就有了对象存储。</p>
</blockquote>
<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>以往像FAT32这种文件系统，是直接将一份文件的<code>数据</code>与<code>metadata</code>一起存储的,存储过程先将文件按照文件系统的最小块大小来打散(如4M的文件，假设文件系统要求一个块4K，那么就将文件打散成为1000个小块),再写进硬盘里面,过程中没有区分<code>数据</code>和<code>metadata</code>的。</p>
<p>而每个块最后会告知你下一个要读取的块的地址，然后一直这样顺序地按图索骥，最后完成整份文件的所有块的读取 ,这种情况下读写速率很慢。</p>
<p>而对象存储则将元数据独立了出来，控制节点叫元数据服务器（服务器+对象存储管理软件）</p>
<ul>
<li>主要负责存储对象的属性（主要是对象的数据被打散存放到了那几台分布式服务器中的信息）</li>
<li>其他负责存储数据的分布式服务器叫做OSD，主要负责存储文件的数据部分。</li>
</ul>
<p>当用户访问对象，会先访问元数据服务器，元数据服务器只负责反馈对象存储在哪些OSD，</p>
<p>假设反馈文件A存储在B、C、D三台OSD，那么用户就会再次直接访问3台OSD服务器去读取数据。</p>
<p><br></p>
<p><br></p>
<h1 id="主流分布式存储产品"><a href="#主流分布式存储产品" class="headerlink" title="主流分布式存储产品"></a>主流分布式存储产品</h1><table>
<thead>
<tr>
<th style="text-align:center">对比说明/文件系统</th>
<th style="text-align:center">TFS</th>
<th style="text-align:center">FastDFS</th>
<th style="text-align:center">MogileFS</th>
<th style="text-align:center">MooseFS</th>
<th style="text-align:center">GlusterFS</th>
<th style="text-align:center">Ceph</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">开发语言</td>
<td style="text-align:center">C++</td>
<td style="text-align:center">C</td>
<td style="text-align:center">Perl</td>
<td style="text-align:center">C</td>
<td style="text-align:center">C</td>
<td style="text-align:center">C++</td>
</tr>
<tr>
<td style="text-align:center">开源协议</td>
<td style="text-align:center">GPL V2</td>
<td style="text-align:center">GPL V3</td>
<td style="text-align:center">GPL</td>
<td style="text-align:center">GPL V3</td>
<td style="text-align:center">GPL V3</td>
<td style="text-align:center">LGPL</td>
</tr>
<tr>
<td style="text-align:center">数据存储方式</td>
<td style="text-align:center">块</td>
<td style="text-align:center">文件/Trunk</td>
<td style="text-align:center">文件</td>
<td style="text-align:center">块</td>
<td style="text-align:center">文件/块</td>
<td style="text-align:center">对象/文件/块</td>
</tr>
<tr>
<td style="text-align:center">集群节点通信协议</td>
<td style="text-align:center">私有协议（TCP）</td>
<td style="text-align:center">私有协议（TCP）</td>
<td style="text-align:center">HTTP</td>
<td style="text-align:center">私有协议（TCP）</td>
<td style="text-align:center">私有协议（TCP）/ RDAM(远程直接访问内存)</td>
<td style="text-align:center">私有协议（TCP）</td>
</tr>
<tr>
<td style="text-align:center">专用元数据存储点</td>
<td style="text-align:center">占用NS</td>
<td style="text-align:center">无</td>
<td style="text-align:center">占用DB</td>
<td style="text-align:center">占用MFS</td>
<td style="text-align:center">无</td>
<td style="text-align:center">占用MDS</td>
</tr>
<tr>
<td style="text-align:center">在线扩容</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
</tr>
<tr>
<td style="text-align:center">冗余备份</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">-</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
</tr>
<tr>
<td style="text-align:center">单点故障</td>
<td style="text-align:center">存在</td>
<td style="text-align:center">不存在</td>
<td style="text-align:center">存在</td>
<td style="text-align:center">存在</td>
<td style="text-align:center">不存在</td>
<td style="text-align:center">存在</td>
</tr>
<tr>
<td style="text-align:center">跨集群同步</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">部分支持</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">不适用</td>
</tr>
<tr>
<td style="text-align:center">易用性</td>
<td style="text-align:center">安装复杂，官方文档少</td>
<td style="text-align:center">安装简单，社区相对活跃</td>
<td style="text-align:center">-</td>
<td style="text-align:center">安装简单，官方文档多</td>
<td style="text-align:center">安装简单，官方文档专业化</td>
<td style="text-align:center">安装简单，官方文档专业化</td>
</tr>
<tr>
<td style="text-align:center">适用场景</td>
<td style="text-align:center">跨集群的小文件</td>
<td style="text-align:center">单集群的中小文件</td>
<td style="text-align:center">-</td>
<td style="text-align:center">单集群的大中文件</td>
<td style="text-align:center">跨集群云存储</td>
<td style="text-align:center">单集群的大中小文件</td>
</tr>
</tbody>
</table>
<h2 id="TFS"><a href="#TFS" class="headerlink" title="TFS"></a><strong>TFS</strong></h2><p> TFS（Taobao File System）是由淘宝开发的一个分布式文件系统，其内部经过特殊的优化处理，适用于海量的小文件存储，目前已经对外开源；</p>
<h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1）在TFS文件系统中，NameServer负责管理文件元数据，通过HA机制实现主备热切换，由于所有元数据都是在内存中，其处理效率非常高效，系统架构也非常简单，管理也很方便；</span><br><span class="line">2）TFS的DataServer作为分部署数据存储节点，同时也具备负载均衡和冗余备份的功能，由于采用自有的文件系统，对小文件会采取合并策略，减少数据碎片，从而提升IO性能；</span><br><span class="line">3）TFS将元数据信息（BlockID、FileID）直接映射至文件名中，这一设计大大降低了存储元数据的内存空间；</span><br></pre></td></tr></table></figure>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1）针对小文件量身定做，随机IO性能比较高；</span><br><span class="line">2）支持在线扩容机制，增强系统的可扩展性；</span><br><span class="line">3）实现了软RAID，增强系统的并发处理能力及数据容错恢复能力；</span><br><span class="line">4）支持主备热倒换，提升系统的可用性；</span><br><span class="line">5）支持主从集群部署，其中从集群主要提供读/备功能；</span><br></pre></td></tr></table></figure>
<h3 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1）TFS只对小文件做优化，不适合大文件的存储；</span><br><span class="line">2）不支持POSIX通用接口访问，通用性较低；</span><br><span class="line">3）不支持自定义目录结构，及文件权限控制；</span><br><span class="line">4）通过API下载，存在单点的性能瓶颈；</span><br><span class="line">5）官方文档非常少，学习成本高；</span><br></pre></td></tr></table></figure>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1）多集群部署的应用</span><br><span class="line">2）存储后基本不做改动</span><br><span class="line">3）海量小型文件</span><br><span class="line">根据目前官方提供的材料，对单个集群节点，存储节点在1000台以内可以良好工作，如存储节点扩大可能会出现NameServer的性能瓶颈，目前淘宝线上部署容量已达到1800TB规模（2009年数据）</span><br></pre></td></tr></table></figure>
<h2 id="FastDFS"><a href="#FastDFS" class="headerlink" title="FastDFS"></a><strong>FastDFS</strong></h2><p>FastDFS是国人开发的一款分布式文件系统，目前社区比较活跃。如上图所示系统中存在三种节点：Client、Tracker、Storage，在底层存储上通过逻辑的分组概念，使得通过在同组内配置多个Storage，从而实现软RAID10,提升并发IO的性能、简单负载均衡及数据的冗余备份；同时通过线性的添加新的逻辑存储组，从容实现存储容量的线性扩容。</p>
<p>文件下载上，除了支持通过API方式，目前还提供了apache和nginx的插件支持，同时也可以不使用对应的插件，直接以Web静态资源方式对外提供下载。</p>
<p>目前FastDFS(V4.x)代码量大概6w多行，内部的网络模型使用比较成熟的libevent三方库，具备高并发的处理能力。</p>
<h3 id="特性-1"><a href="#特性-1" class="headerlink" title="特性"></a>特性</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1）在上述介绍中Tracker服务器是整个系统的核心枢纽，其完成了访问调度（负载均衡），监控管理Storage服务器，由此可见Tracker的作用至关重要，也就增加了系统的单点故障，为此FastDFS支持多个备用的Tracker，虽然实际测试发现备用Tracker运行不是非常完美，但还是能保证系统可用。</span><br><span class="line">2）在文件同步上，只有同组的Storage才做同步，由文件所在的源Storage服务器push至其它Storage服务器，目前同步是采用Binlog方式实现，由于目前底层对同步后的文件不做正确性校验，因此这种同步方式仅适用单个集群点的局部内部网络，如果在公网上使用，肯定会出现损坏文件的情况，需要自行添加文件校验机制。</span><br><span class="line">3）支持主从文件，非常适合存在关联关系的图片，在存储方式上，FastDFS在主从文件ID上做取巧，完成了关联关系的存储。</span><br></pre></td></tr></table></figure>
<h3 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1）系统无需支持POSIX(可移植操作系统)，降低了系统的复杂度，处理效率更高</span><br><span class="line">2）支持在线扩容机制，增强系统的可扩展性</span><br><span class="line">3）实现了软RAID，增强系统的并发处理能力及数据容错恢复能力</span><br><span class="line">4）支持主从文件，支持自定义扩展名</span><br><span class="line">5）主备Tracker服务，增强系统的可用性</span><br></pre></td></tr></table></figure>
<h3 id="缺点-2"><a href="#缺点-2" class="headerlink" title="缺点"></a>缺点</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1）不支持断点续传，对大文件将是噩梦（FastDFS不适合大文件存储）</span><br><span class="line">2）不支持POSIX通用接口访问，通用性较低</span><br><span class="line">3）对跨公网的文件同步，存在较大延迟，需要应用做相应的容错策略</span><br><span class="line">4）同步机制不支持文件正确性校验，降低了系统的可用性</span><br><span class="line">5）通过API下载，存在单点的性能瓶颈</span><br></pre></td></tr></table></figure>
<h3 id="应用场景-1"><a href="#应用场景-1" class="headerlink" title="应用场景"></a>应用场景</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1）单集群部署的应用</span><br><span class="line">2）存储后基本不做改动</span><br><span class="line">3）小中型文件根据</span><br><span class="line">目前官方提供的材料，现有的使用FastDFS系统存储容量已经达到900T，物理机器已经达到100台（50个组）</span><br></pre></td></tr></table></figure>
<h2 id="MooseFS"><a href="#MooseFS" class="headerlink" title="MooseFS"></a><strong>MooseFS</strong></h2><p>MooseFS是一个高可用的故障容错分布式文件系统，它支持通过FUSE方式将文件挂载操作，同时其提供的web管理界面非常方便查看当前的文件存储状态。</p>
<h3 id="特性-2"><a href="#特性-2" class="headerlink" title="特性"></a>特性</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1）从下图中我们可以看到MooseFS文件系统由四部分组成：Managing Server 、Data Server 、Metadata Backup Server 及Client</span><br><span class="line">2）其中所有的元数据都是由Managing Server管理，为了提高整个系统的可用性，Metadata Backup Server记录文件元数据操作日志，用于数据的及时恢复</span><br><span class="line">3）Data Server可以分布式部署，存储的数据是以块的方式分布至各存储节点的，因此提升了系统的整体性能，同时Data Server提供了冗余备份的能力，提升系统的可靠性</span><br><span class="line">4）Client通过FUSE方式挂载，提供了类似POSIX的访问方式，从而降低了Client端的开发难度，增强系统的通用性</span><br></pre></td></tr></table></figure>
<ul>
<li>元数据服务器（master）:负责各个数据存储服务器的管理，文件读写调度，文件空间回收以及恢复</li>
<li>元数据日志服务器（metalogger）:负责备份master服务器的变化日志文件，以便于在master server出问题的时候接替其进行工作</li>
<li>数据存储服务器（chunkserver）:数据实际存储的地方，由多个物理服务器组成，负责连接管理服务器，听从管理服务器调度，提供存储空间，并为客户提供数据传输；多节点拷贝;在数据存储目录，看不见实际的数据</li>
</ul>
<h3 id="优点-2"><a href="#优点-2" class="headerlink" title="优点"></a>优点</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1）部署安装非常简单，管理方便</span><br><span class="line">2）支持在线扩容机制，增强系统的可扩展性</span><br><span class="line">3）实现了软RAID，增强系统的 并发处理能力及数据容错恢复能力</span><br><span class="line">4）数据恢复比较容易，增强系统的可用性5）有回收站功能，方便业务定制</span><br></pre></td></tr></table></figure>
<h3 id="缺点-3"><a href="#缺点-3" class="headerlink" title="缺点"></a>缺点</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1）存在单点性能瓶颈及单点故障</span><br><span class="line">2）MFS Master节点很消耗内存</span><br><span class="line">3）对于小于64KB的文件，存储利用率较低</span><br></pre></td></tr></table></figure>
<h3 id="应用场景-2"><a href="#应用场景-2" class="headerlink" title="应用场景"></a>应用场景</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1）单集群部署的应用</span><br><span class="line">2）中、大型文件</span><br></pre></td></tr></table></figure>
<h2 id="GlusterFS"><a href="#GlusterFS" class="headerlink" title="GlusterFS"></a><strong>GlusterFS</strong></h2><p>GlusterFS是Red Hat旗下的一款开源分布式文件系统，它具备高扩展、高可用及高性能等特性，由于其无元数据服务器的设计，使其真正实现了线性的扩展能力，使存储总容量可 轻松达到PB级别，支持数千客户端并发访问；对跨集群，其强大的Geo-Replication可以实现集群间数据镜像，而且是支持链式复制，这非常适用 于垮集群的应用场景</p>
<h3 id="特性-3"><a href="#特性-3" class="headerlink" title="特性"></a>特性</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1）目前GlusterFS支持FUSE方式挂载，可以通过标准的NFS/SMB/CIFS协议像访问本体文件一样访问文件系统，同时其也支持HTTP/FTP/GlusterFS访问，同时最新版本支持接入Amazon的AWS系统</span><br><span class="line">2）GlusterFS系统通过基于SSH的命令行管理界面，可以远程添加、删除存储节点，也可以监控当前存储节点的使用状态</span><br><span class="line">3）GlusterFS支持集群节点中存储虚拟卷的扩容动态扩容；同时在分布式冗余模式下，具备自愈管理功能，在Geo冗余模式下，文件支持断点续传、异步传输及增量传送等特点</span><br></pre></td></tr></table></figure>
<h3 id="优点-3"><a href="#优点-3" class="headerlink" title="优点"></a>优点</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1）系统支持POSIX(可移植操作系统)，支持FUSE挂载通过多种协议访问，通用性比较高</span><br><span class="line">2）支持在线扩容机制，增强系统的可扩展性</span><br><span class="line">3）实现了软RAID，增强系统的 并发处理能力及数据容错恢复能力</span><br><span class="line">4）强大的命令行管理，降低学习、部署成本</span><br><span class="line">5）支持整个集群镜像拷贝，方便根据业务压力，增加集群节点</span><br><span class="line">6）官方资料文档专业化，该文件系统由Red Hat企业级做维护，版本质量有保障</span><br></pre></td></tr></table></figure>
<h3 id="缺点-4"><a href="#缺点-4" class="headerlink" title="缺点"></a>缺点</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1）通用性越强，其跨越的层次就越多，影响其IO处理效率</span><br><span class="line">2）频繁读写下，会产生垃圾文件，占用磁盘空间</span><br></pre></td></tr></table></figure>
<h3 id="应用场景-3"><a href="#应用场景-3" class="headerlink" title="应用场景"></a>应用场景</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1）多集群部署的应用</span><br><span class="line">2）中大型文件根据目前官方提供的材料，现有的使用GlusterFS系统存储容量可轻松达到PB</span><br></pre></td></tr></table></figure>
<h3 id="术语"><a href="#术语" class="headerlink" title="术语"></a>术语</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">brick：分配到卷上的文件系统块；</span><br><span class="line">client：挂载卷，并对外提供服务；</span><br><span class="line">server：实际文件存储的地方；</span><br><span class="line">subvolume：被转换过的文件系统块；</span><br><span class="line">volume：最终转换后的文件系统卷。</span><br></pre></td></tr></table></figure>
<h2 id="Ceph"><a href="#Ceph" class="headerlink" title="Ceph"></a><strong>Ceph</strong></h2><p>Ceph是一个可以按对象/块/文件方式存储的开源分布式文件系统，其设计之初，就将单点故障作为首先要解决的问题，因此该系统具备高可用性、高性能及可 扩展等特点。该文件系统支持目前还处于试验阶段的高性能文件系统BTRFS(B-Tree文件系统)，同时支持按OSD方式存储，因此其性能是很卓越的， 因为该系统处于试商用阶段，需谨慎引入到生产环境</p>
<h3 id="特性-4"><a href="#特性-4" class="headerlink" title="特性"></a>特性</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1）Ceph底层存储是基于RADOS（可靠的、自动的分布式对象存储），它提供了LIBRADOS/RADOSGW/RBD/CEPH FS方式访问底层的存储系统，如下图所示</span><br><span class="line">2）通过FUSE，Ceph支持类似的POSIX访问方式；Ceph分布式系统中最关键的MDS节点是可以部署多台，无单点故障的问题，且处理性能大大提升</span><br><span class="line">3）Ceph通过使用CRUSH算法动态完成文件inode number到object number的转换，从而避免再存储文件metadata信息，增强系统的灵活性</span><br></pre></td></tr></table></figure>
<h3 id="优点-4"><a href="#优点-4" class="headerlink" title="优点"></a>优点</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1）支持对象存储（OSD）集群，通过CRUSH算法，完成文件动态定位， 处理效率更高</span><br><span class="line">2）支持通过FUSE方式挂载，降低客户端的开发成本，通用性高</span><br><span class="line">3）支持分布式的MDS/MON，无单点故障</span><br><span class="line">4）强大的容错处理和自愈能力5）支持在线扩容和冗余备份，增强系统的可靠性</span><br></pre></td></tr></table></figure>
<h3 id="缺点-5"><a href="#缺点-5" class="headerlink" title="缺点"></a>缺点</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1）目前处于试验阶段，系统稳定性有待考究</span><br></pre></td></tr></table></figure>
<h3 id="应用场景-4"><a href="#应用场景-4" class="headerlink" title="应用场景"></a>应用场景</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1）全网分布式部署的应用</span><br><span class="line">2）对实时性、可靠性要求比较高官方宣传，存储容量可轻松达到PB级别</span><br></pre></td></tr></table></figure>
<h2 id="MogileFS"><a href="#MogileFS" class="headerlink" title="MogileFS"></a><strong>MogileFS</strong></h2><ul>
<li>开发语言：perl</li>
<li>开源协议：GPL</li>
<li>依赖数据库</li>
<li>Trackers(控制中心):负责读写数据库，作为代理复制storage间同步的数据</li>
<li>Database:存储源数据（默认mysql）</li>
<li>Storage:文件存储</li>
<li>除了API，可以通过与nginx集成，对外提供下载服务</li>
</ul>
<h1 id="适用分布式存储产品"><a href="#适用分布式存储产品" class="headerlink" title="适用分布式存储产品"></a>适用分布式存储产品</h1><table>
<thead>
<tr>
<th>系统名称</th>
<th>Hdfs</th>
<th>xtreemfs</th>
<th>Seaweedfs</th>
<th>Ipfs</th>
</tr>
</thead>
<tbody>
<tr>
<td>开发语言</td>
<td>Java</td>
<td>Java</td>
<td>Go</td>
<td>Go</td>
</tr>
<tr>
<td>项目地址</td>
<td><a href="https://github.com/apache/hadoop-hdfs" target="_blank" rel="noopener">Hdfs</a></td>
<td><a href="https://github.com/xtreemfs/xtreemfs" target="_blank" rel="noopener">Xtreemfs</a></td>
<td><a href="https://github.com/chrislusf/seaweedfs" target="_blank" rel="noopener">Seaweedfs</a></td>
<td><a href="https://github.com/ipfs/go-ipfs" target="_blank" rel="noopener">Ipfs</a></td>
</tr>
<tr>
<td>优势</td>
<td>Hadoop稳定<br>存储非常大的文件</td>
<td>分布式集群容错的高可用</td>
<td>3Wtps</td>
<td>比较火热的存储项目</td>
</tr>
<tr>
<td>劣势</td>
<td>不能低延时数据访问<br>无法进行追加写入</td>
<td></td>
<td></td>
<td>_</td>
</tr>
</tbody>
</table>
<h2 id="Hdfs"><a href="#Hdfs" class="headerlink" title="Hdfs"></a>Hdfs</h2><h3 id="特性-5"><a href="#特性-5" class="headerlink" title="特性"></a>特性</h3><ul>
<li><p>Blocks:<code>HDFS</code>的<code>Block</code>块比一般单机文件系统大得多,默认为<code>128M</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">物理磁盘中有块的概念,磁盘的物理Block是磁盘操作最小的单元,读写操作均以Block为最小单元,一般为512 Byte。文件系统在物理Block之上抽象了另一层概念,文件系统Block物理磁盘Block的整数倍。通常为几KB。</span><br><span class="line">Hadoop提供的df、fsck这类运维工具都是在文件系统的Block级别上进行操作。</span><br><span class="line"></span><br><span class="line">HDFS的文件被拆分成block-sized的chunk</span><br><span class="line">chunk作为独立单元存储,比Block小的文件不会占用整个Block，只会占据实际大小。</span><br><span class="line">例如:如果一个文件大小为1M，则在HDFS中只会占用1M的空间，而不是128M。</span><br></pre></td></tr></table></figure>
</li>
<li><p>Namenode </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">整个HDFS集群由Namenode和Datanode构成master-worker（主从）模式。</span><br><span class="line">Namenode复杂构建命名空间,管理文件的元数据等,而Datanode负责实际存储数据,负责读写工作。</span><br><span class="line"></span><br><span class="line">Namenode存放文件系统树及所有文件、目录的元数据</span><br><span class="line">元数据持久化为2种形式：namespcae image,edit log</span><br><span class="line"></span><br><span class="line">但是持久化数据中不包括Block所在的节点列表,及文件的Block分布在集群中的哪些节点上</span><br><span class="line">这些信息是在系统重启的时候重新构建（通过Datanode汇报的Block信息）。 </span><br><span class="line"></span><br><span class="line">在HDFS中,Namenode可能成为集群的单点故障,Namenode不可用时,整个文件系统是不可用的。</span><br><span class="line">HDFS针对单点故障提供了2种解决机制： </span><br><span class="line">1）备份持久化元数据 </span><br><span class="line">将文件系统的元数据同时写到多个文件系统， 例如同时将元数据写到本地文件系统及NFS。这些备份操作都是同步的、原子的。</span><br><span class="line"></span><br><span class="line">2）Secondary Namenode </span><br><span class="line">Secondary节点定期合并主Namenode的namespace image和edit log,避免edit log过大,通过创建检查点checkpoint来合并。</span><br><span class="line">它会维护一个合并后的namespace image副本,可用于在Namenode完全崩溃时恢复数据。</span><br></pre></td></tr></table></figure>
</li>
<li><p>Datanode</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">数据节点负责存储和提取Block,读写请求可能来自namenode,也可能直接来自客户端。</span><br><span class="line">数据节点周期性向Namenode汇报自己节点上所存储的Block相关信息。</span><br></pre></td></tr></table></figure>
</li>
<li><p>HDFS Federation</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">NameNode的内存会制约文件数量</span><br><span class="line">HDFS Federation提供了一种横向扩展NameNode的方式。</span><br><span class="line">在Federation模式中，每个NameNode管理命名空间的一部分</span><br><span class="line">例如一个NameNode管理/user目录下的文件， 另一个NameNode管理/share目录下的文件。 </span><br><span class="line"></span><br><span class="line">每个NameNode管理一个namespace volumn,所有volumn构成文件系统的元数据。</span><br><span class="line">每个NameNode同时维护一个Block Pool,保存Block的节点映射等信息。</span><br><span class="line">各NameNode之间是独立的,一个节点的失败不会导致其他节点管理的文件不可用。</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="优点-5"><a href="#优点-5" class="headerlink" title="优点"></a>优点</h3><ul>
<li><p>Block优势 </p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">block的拆分使得单个文件大小可以大于整个磁盘的容量,构成文件的Block可以分布在整个集群;</span><br><span class="line">理论上单个文件可以占据集群中所有机器的磁盘。 </span><br><span class="line">Block的抽象也简化了存储系统，对于Block，无需关注其权限，所有者等内容(这些内容都在文件级别上进行控制)。 </span><br><span class="line">Block作为容错和高可用机制中的副本单元，即以Block为单位进行复制。</span><br><span class="line"></span><br><span class="line">是为了最小化查找（seek）时间，控制定位文件与传输文件所用的时间比例。</span><br><span class="line">假设定位到Block所需的时间为10ms,磁盘传输速度为100M/s。</span><br><span class="line">如果要将定位到Block所用时间占传输时间的比例控制1%，则Block大小需要约100M。 </span><br><span class="line">但是如果Block设置过大在MapReduce任务中，Map或者Reduce任务的个数 如果小于集群机器数量，会使得作业运行效率很低。</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="缺点-6"><a href="#缺点-6" class="headerlink" title="缺点"></a>缺点</h3><ul>
<li>不适合低延迟数据访问场景：比如毫秒级，低延迟与高吞吐率</li>
<li>不适合小文件存取场景:占用NameNode大量内存。 寻道时间超过读取时间。</li>
<li>不适合并发写入场景:一个文件只能有一个写者。 </li>
</ul>
<p><br></p>
<h2 id="Xtreemfs"><a href="#Xtreemfs" class="headerlink" title="Xtreemfs"></a>Xtreemfs</h2><h3 id="特性-6"><a href="#特性-6" class="headerlink" title="特性"></a>特性</h3><p>XTrimeFS实现了基于对象的文件系统体系结构</p>
<p>文件内容被分割成一系列固定大小的对象并存储在存储服务器上,而元数据存储在单独的元数据服务器上。元数据服务器将文件系统元数据组织为一组卷，每个卷以目录树的形式实现单独的文件系统命名空间。</p>
<p><img src="/2018/07/11/distributed-file/file-03.png" alt="images"></p>
<p>与基于块的文件系统相比，可用和使用的存储空间的管理从元数据服务器卸载到存储服务器。文件元数据不是包含块地址的inode列表</p>
<p>它包含负责对象的存储服务器列表，以及定义如何在字节偏移和对象ID之间转换的条带策略。这意味着对象大小可能因文件而异。</p>
<p>XTrimeFS组件,XTrimeFS安装包含三种类型的服务器</p>
<ul>
<li><p>DIR目录服务</p>
<p>目录服务是XTrimeFS中所有服务的中央注册表。MRC使用它来发现存储服务器。</p>
</li>
<li><p>MRC -元数据和副本目录</p>
<p>MRC存储目录树和文件元数据,例如文件名、大小或修改时间。此外，MRC认证用户并授权对文件的访问。</p>
</li>
<li><p>OSD -对象存储设备</p>
<p>OSD存储文件的任意对象；客户端在OSD上读取和写入文件数据。</p>
</li>
</ul>
<h3 id="优点-6"><a href="#优点-6" class="headerlink" title="优点"></a>优点</h3><ul>
<li><p>完备自动发现和注册服务流程</p>
</li>
<li><p>随意扩展MRC源数据和副本目录服务器</p>
</li>
<li><p>随意扩展OSD资源存储服务器</p>
</li>
</ul>
<h3 id="缺点-7"><a href="#缺点-7" class="headerlink" title="缺点"></a>缺点</h3><ul>
<li>有单点故障问题,无法进行Master转移</li>
</ul>
<h2 id="Seaweedfs"><a href="#Seaweedfs" class="headerlink" title="Seaweedfs"></a>Seaweedfs</h2><p>SeaweeDFS的设计原理是基于 Facebook 的一篇图片存储系统的论文</p>
<h3 id="FaceBook-图片存储架构"><a href="#FaceBook-图片存储架构" class="headerlink" title="FaceBook 图片存储架构"></a>FaceBook 图片存储架构</h3><blockquote>
<p>典型的存储架构</p>
</blockquote>
<p><img src="/2018/07/11/distributed-file/file-04.png" alt="image"></p>
<blockquote>
<p>基本的NFS架构(分布式网络文件存储)</p>
</blockquote>
<p><img src="/2018/07/11/distributed-file/file-05.png" alt="image"></p>
<blockquote>
<p>FaceBook 现情况图片服务的存储与读取  </p>
</blockquote>
<p><img src="/2018/07/11/distributed-file/image-01.png" alt="image-20180729162217659"></p>
<p><img src="/2018/07/11/distributed-file/image-02.png" alt="image-20180729162445508"></p>
<blockquote>
<p>FaceBook 相关的存储结构以及索引结构  </p>
</blockquote>
<p><img src="/2018/07/11/distributed-file/image-03.png" alt="image-20180729162754547"></p>
<table>
<thead>
<tr>
<th>字段</th>
<th>释义</th>
</tr>
</thead>
<tbody>
<tr>
<td>Header</td>
<td>头部,用于恢复间隔数据块</td>
</tr>
<tr>
<td>Cookie</td>
<td>随机数来缓解查找</td>
</tr>
<tr>
<td>Key</td>
<td>64-位图片ID</td>
</tr>
<tr>
<td>Alternate key</td>
<td>32位补充id</td>
</tr>
<tr>
<td>Flags</td>
<td>标志,象征删除</td>
</tr>
<tr>
<td>Size</td>
<td>数据大小</td>
</tr>
<tr>
<td>Data</td>
<td>实际的图片数据</td>
</tr>
<tr>
<td>Footer</td>
<td>脚步,用于恢复间隔数据块</td>
</tr>
<tr>
<td>Data Checksum</td>
<td>用来检查完整性</td>
</tr>
<tr>
<td>Padding</td>
<td>_</td>
</tr>
</tbody>
</table>
<p><img src="/2018/07/11/distributed-file/image-04.png" alt="image-20180729162814396"></p>
<table>
<thead>
<tr>
<th>字段</th>
<th>释义</th>
</tr>
</thead>
<tbody>
<tr>
<td>Key</td>
<td>64位key</td>
</tr>
<tr>
<td>Alternate key</td>
<td>32位替换关键字</td>
</tr>
<tr>
<td>Flags</td>
<td>目前是否未使用</td>
</tr>
<tr>
<td>Offset</td>
<td>偏移量在Store存储块中</td>
</tr>
<tr>
<td>Size</td>
<td>数据大小</td>
</tr>
</tbody>
</table>
<h4 id="Directory"><a href="#Directory" class="headerlink" title="Directory"></a>Directory</h4><p>平衡读写,通过hash策略去分发读写,让读和写的流量表现出良好的平衡行为</p>
<h4 id="Cache"><a href="#Cache" class="headerlink" title="Cache"></a>Cache</h4><p>缓存在大幅减少读取请求中是有效的。对机器的影响最大,可选用相关的缓存算法<code>FIFO</code>、<code>LFU</code>、<code>LRU</code>等</p>
<h4 id="Store"><a href="#Store" class="headerlink" title="Store"></a>Store</h4><p>主存储相关主要的资源</p>
<p><br></p>
<h3 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h3><p>SeaWeeDFS是一种简单且高度可扩展的分布式文件系统。</p>
<ul>
<li>存储数十亿文件！</li>
<li>快速服务档案！</li>
</ul>
<p>SaveWebFS实现O(1)磁盘查找的对象存储,以及带有POSIX接口的可选文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SaaWeeDFS作为对象存储库来有效地处理小文件。</span><br><span class="line">不是管理中央主机中的所有文件元数据,中央主机只管理文件卷,它允许这些卷服务器管理文件和它们的元数据。</span><br><span class="line"></span><br><span class="line">这减轻了来自中央主机的并发压力,并将文件元数据扩展到卷服务器,允许更快的文件访问(仅一个磁盘读取操作)。</span><br><span class="line"></span><br><span class="line">每个文件的元数据只有40字节的磁盘存储开销。</span><br><span class="line">使用O(1)磁盘读取是非常简单的，您可以用实际的用例来挑战性能。</span><br></pre></td></tr></table></figure>
<h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h3><ul>
<li>可以选择不复制或不同复制级别、机架和数据中心感知</li>
<li>自动主服务器故障转移-没有单点故障（SPOF）</li>
<li>根据文件MIME类型自动进行GZIP压缩</li>
<li>删除或更新后磁盘空间的自动压缩</li>
<li>同一集群中的服务器可以具有不同的磁盘空间、文件系统、OS等。</li>
<li>添加/删除服务器不会导致任何数据重新平衡。</li>
<li>可选文件服务器通过HTTP提供“正常”目录和文件</li>
<li>可选的安装文件，直接读取和写入文件作为本地目录</li>
<li>支持in-memory/leveldb/boltdb/btree调整以实现内存/性能平衡。</li>
</ul>
<h2 id="ipFS"><a href="#ipFS" class="headerlink" title="ipFS"></a>ipFS</h2><p>星际文件存储系统是一种点到点的分布式文件系统</p>
<p>它创建了一个允许交换<code>IPFS对象</code>的P2P集群。</p>
<p><code>IPFS对象</code>的总体构成了一个被称为<code>Merkle DAG</code>的密码验证数据结构，这个数据结构可以用来建模许多其他数据结构</p>
<ul>
<li><p><code>IPFS 对象</code></p>
<p>IPFS本质上是一个用于检索和共享IPFS对象的P2P系统。一个IPFS对象是一个具有两个字段的数据结构:</p>
<ul>
<li><p>Data—大小小于256 kB的非结构化数据块(blob)</p>
</li>
<li><p>Links — 一个Link结构体的数组。其中包含的Link指向其他IPFS对象,Link结构有三个数据字段</p>
<ul>
<li><p>Name — Link的名字</p>
</li>
<li><p>Hash — Link指向的IPFS对象的hash</p>
</li>
<li><p>Size — Link指向对象的累计大小</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">注：除了被指向对象自身的size，如果它里面有link，那么还要把link中的size加进来</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ipfs object get QmarHSr9aSNaPSR6G9KFPbuLV9aEqJfTk1y9B8pdwqK4Rq</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;Links&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Name&quot;: &quot;AnotherName&quot;, </span><br><span class="line">            &quot;Hash&quot;: &quot;QmVtYjNij3KeyGmcgg7yVXWskLaBtov3UYL9pgcGK3MCWu&quot;, </span><br><span class="line">            &quot;Size&quot;: 18</span><br><span class="line">        &#125;, </span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Name&quot;: &quot;SomeName&quot;, </span><br><span class="line">            &quot;Hash&quot;: &quot;QmbUSy8HCn8J4TMDRRdxCbK2uCCtkQyZtY6XYv3y7kLgDC&quot;, </span><br><span class="line">            &quot;Size&quot;: 58</span><br><span class="line">        &#125;</span><br><span class="line">    ], </span><br><span class="line">    &quot;Data&quot;: &quot;Hello World!&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>Merkle DAG</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">数据和命名链接构成的IPFS对象的集合即是Merkle DAG结构。</span><br><span class="line">顾名思义,DAG表明了这一种有向无环图,而Merkle说明这是一个密码验证的数据结构，使用加密哈希来寻址内容。</span><br></pre></td></tr></table></figure>
<p><img src="/2018/07/11/distributed-file/image-06.png" alt="image"></p>
<ul>
<li><p>大文件结构如上</p>
</li>
<li><p>目录结构如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">test_dir:</span><br><span class="line">bigfile.js hello.txt my_dir</span><br><span class="line"></span><br><span class="line">test_dir/my_dir:</span><br><span class="line">my_file.txt testing.txt</span><br><span class="line"></span><br><span class="line">test_dir</span><br><span class="line">    ├─bigfile.js</span><br><span class="line">    ├─hello.txt</span><br><span class="line">    └─my_dir</span><br><span class="line">        ├─my_file.txt</span><br><span class="line">        └─my_file.txt</span><br><span class="line"></span><br><span class="line">//包含Hello World!\n的文件会被的自动去重</span><br><span class="line">//文件中的数据仅存储在IPFS中的一个逻辑位置(由其hash寻址)</span><br></pre></td></tr></table></figure>
<p><img src="/2018/07/11/distributed-file/image-07.png" alt="IPFS"></p>
</li>
</ul>
</li>
</ul>
<h3 id="简介-2"><a href="#简介-2" class="headerlink" title="简介"></a>简介</h3><hr>
<blockquote>
<p> 一个由文件内容计算出的加密哈希值</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">哈希值直接反映文件的内容，哪怕只修改1比特，哈希值也会完全不同,当IPFS被请求一个文件哈希时，它会使用一个分布式哈希表找到文件所在的节点，取回文件并验证文件数据。</span><br></pre></td></tr></table></figure>
<blockquote>
<p> IPFS是通用目的的基础架构,基本没有存储上的限制</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">大文件会被切分成小的分块，下载的时候可以从多个服务器同时获取。IPFS的网络是不固定的、细粒度的、分布式的网络，可以很好的适应内容分发网络（CDN）的要求。这样的设计可以很好的共享各类数据，包括图像、视频流、分布式数据库、整个操作系统、模块链、8英寸软盘的备份，还有最重要的——静态网站。</span><br></pre></td></tr></table></figure>
<p><img src="/2018/07/11/distributed-file/image-05.png" alt="img"></p>
<p>IPFS的系统架构图， 分为5层：</p>
<ul>
<li>第一层为naming,基于PKI的一个命名空间；</li>
<li>第二层为file,类似git的版本文件控制系统</li>
<li>第三层为merkledag, IPFS 内部的逻辑数据结构,内容和寻址,不可篡改,去冗余对象；</li>
<li>第四层为exchange, 节点之间block data的交换协议,管理区块如何分布；</li>
<li>第五层为routing, 主要实现节点寻址和对象寻址；</li>
<li>第六层为network, 封装了P2P通讯的连接和传输部分。</li>
<li>第七层为identity,Kad生成对等节点身份信息生成</li>
</ul>
<h3 id="层级"><a href="#层级" class="headerlink" title="层级"></a>层级</h3><h4 id="身份-amp-路由层"><a href="#身份-amp-路由层" class="headerlink" title="身份&amp;路由层"></a>身份&amp;路由层</h4><p>对等节点身份信息的生成以及路由规则是通过<code>Kademlia</code>协议生成制定，<code>KAD</code>协议实质是构建了一个分布式松散Hash表，简称<code>DHT</code></p>
<p>每个加入这个<code>DHT</code>网络的人都要生成自己的身份信息，然后才能通过这个身份信息去负责存储这个网络里的资源信息和其他成员的联系信息</p>
<h4 id="网络层"><a href="#网络层" class="headerlink" title="网络层"></a>网络层</h4><p>使用的LibP2P可以支持任意传输层协议</p>
<p>NAT技术能让内网中的设备共用同一个外网IP</p>
<h4 id="交换层"><a href="#交换层" class="headerlink" title="交换层"></a>交换层</h4><p>类似迅雷这样的BT工具,迅雷其实是模拟了P2P网络，并创建中心服务器，当服务器登记用户请求资源时，让请求同样资源的用户形成一个小集群swarm</p>
<p>这种方式有弊端,一位服务器是由迅雷统一维护,如果出现了故障、宕机时,下载操作无法进行。</p>
<p>IPFS团队把比特流进行了创新,叫作Bitswap，它增加了信用和帐单体系来激励节点去分享</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">用户在Bitswap里增加数据会增加信用分，分享得越多信用分越高。</span><br><span class="line">如果用户只去检索数据而不存数据，信用分会越来越低，其它节点会在嵌入连接时优先选择信用分高的</span><br></pre></td></tr></table></figure>
<h4 id="对象层和文件层"><a href="#对象层和文件层" class="headerlink" title="对象层和文件层"></a>对象层和文件层</h4><p>它们管理的是IPFS上80%的数据结构,大部分数据对象都是以MerkleDag的结构存在,这为内容寻址和去重提供了便利。</p>
<p>文件层是一个新的数据结构和DAG并列,采用Git一样的数据结构来支持版本快照 </p>
<h4 id="命名层"><a href="#命名层" class="headerlink" title="命名层"></a>命名层</h4><p>具有自我验证的特性(当其他用户获取该对象时,使用指纹公钥进行验签,即验证所用的公钥是否与NodeId匹配,这验证了用户发布对象的真实性，同时也获取到了可变状态)</p>
<p>并且加入了IPNS这个巧妙的设计来使得加密后的DAG对象名可定义,增强可阅读性。提供从人类可读URI到其对应的当前IPFS哈希的映射,域名的所有者可以通过用他/她的私钥对请求进行签名来更新该域下所有URI的映射。IPNS可以以多种方式实现，但其当前的实现使用分布式哈希表（DHT）</p>
<h3 id="优势-1"><a href="#优势-1" class="headerlink" title="优势"></a>优势</h3><ul>
<li>可以为内容创作带来一定的自由。</li>
<li>可以降低存储和带宽成本</li>
<li>可以与区块链完美结合</li>
</ul>

        
    </section>
</article>



<div class="comments">
    <div id="disqus_thread">
        <p class="comment-tips">国内查看评论需要代理~</p>
    </div>
    <script>
    window.disqus_config = function () {
        this.language = 'zh';
        this.page.url = 'http://www.coderss.cn/2018/07/11/distributed-file/';
        this.page.title = '分布式文件系统';
        this.page.identifier = '2018/07/11/distributed-file/';
    };
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://name.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

</div>
        <footer class="footer">
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, Theme by <a href="https://github.com/sanonz/hexo-theme-concise" target="_blank">Concise</a>
</footer>

<script type="text/javascript" src="//s13.cnzz.com/z_stat.php?id=1234567890&amp;web_id=1234567890"></script>


    </div>

    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/1.9.0/jquery.min.js"></script>
    
    <script type="text/javascript" src="/js/scrollspy.min.js"></script>
    
    <script type="text/javascript">
        $(function() {
            var nodes = {
                nav: $('#nav'),
                aside: $('#aside'),
                navTags: $('#nav-tags')
            };

            $('#open-panel, #aside-mask').on('click', function() {
                nodes.aside.toggleClass('panel-show');
            });
            $('#nav-tag').on('click', function(event) {
                event.preventDefault();console.log(nodes.navTags.attr('class'))
                nodes.navTags.toggleClass('tag-show');console.log(nodes.navTags.attr('class'))
            })/*.hover(function() {
                nodes.navTags.addClass('tag-show');
            }, function() {
                nodes.navTags.removeClass('tag-show');
            });*/

            
            $(document.body).scrollspy({target: '#aside-inner'});
            
        });
    </script>

</body>
</html>
